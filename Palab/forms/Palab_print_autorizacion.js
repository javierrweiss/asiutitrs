/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4D6AB8EC-0344-40BE-B809-E8ED1AF9AC3C"}
 */
var f_alerta = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3D4584DA-6596-497F-8D85-EB64AA757317"}
 */
var f_horaPedido = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3D1D1307-7B0C-4537-A566-330A40CE9980"}
 */
var f_fechaPedido = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"967C48A6-AF2F-4BBB-A7CD-A15DA6D0200E",variableType:4}
 */
var f_protocolo = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"674038AC-6BC2-42DA-A0F4-643BC4F3C470"}
 */
var f_sector = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0053754A-968C-45BB-A427-1CF0B68BAF6D"}
 */
var f_servicio = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"25BE1605-2858-44E9-824D-43BD1166C332"}
 */
var f_afiliado = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C5B11B13-8B36-40B3-A062-1E20917D5F83"}
 */
var f_medicoNombre = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"6AF97593-D705-485A-A294-873288EF9728"}
 */
var f_matricula = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"212299C1-DA02-4F19-A073-504FD7109B76"}
 */
var f_histClinIngreso = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4BBF0D80-D410-4C50-8275-F9584F5AD8FD"}
 */
var f_egreso = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3991CF59-4894-4EB9-A19F-1031DBA76485"}
 */
var f_ingreso = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"357D9AB0-71BB-4AEB-8281-20E5CF43B60B"}
 */
var f_cobertura = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"259B00B3-1924-4099-87C3-E775BF9AEF97"}
 */
var f_sexo = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"99C573D1-9F40-483C-96B7-BFCF619FE3B6"}
 */
var f_hora = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B6C8D509-EDCF-4D11-A909-2E4A96B752AF"}
 */
var f_medico = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"1CB1C7B6-E3A5-4B25-A399-59990DE5B658"}
 */
var f_edad = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"DB9FF7B4-CA22-4EC2-8D18-226BA63D4488"}
 */
var f_cama = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B4C34217-9DC0-4D21-8806-4AEBB8C3BF7D",variableType:4}
 */
var f_habitacion = null;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"310C6CE3-EEAC-47B2-9E7C-0681F7E31E07",variableType:93}
 */
var f_fechaImpresion = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"93945F47-43B7-437D-B005-BC474BE6D415"}
 */
var f_histclinunica = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7CE69601-179C-4849-96E3-B718B69436DC"}
 */
var f_apelnom = null;

/**
 * @properties={typeid:24,uuid:"36D3F3EE-AD5F-4D3E-81FA-F7944C8B31B7"}
 */
function limpiarForm (){
	
	f_afiliado = null;
	f_apelnom = null;
	f_cama = null;
	f_medico = null;
	f_fechaImpresion = null;
	f_habitacion = null;
	f_histclinunica = null;
	f_hora = null;
	f_cobertura = null;
	f_sexo = null;
	f_edad = null;
	f_egreso = null;
	f_histClinIngreso = null;
	f_ingreso = null;
	f_matricula = null;
	f_medicoNombre = null;
	f_servicio = null;
	/*
	globals.Hcipiso_histClinAsist = 0;
	globals.Hcipiso_histClinPrint = 0;
	globals.Hcipiso_fechaPrint = 0;
	globals.Hcipiso_horaPrint = 0;
	
	globals.Hcipiso_obrCodigo = 0;
	globals.Hcipiso_hcUnicaPrint = 0;
	globals.Hcipiso_fechaIngresoPrint = 0;
	globals.Hcipiso_horaIngresoPrint = 0;
	globals.Hcipiso_alerHistClinPrint = 0;
	
	globals.Hcipiso_perLegajoPrint = 0;
	globals.hcipiso_medCodigoPrint = 0;
	globals.Hcipiso_patCodiPrint = 0;
	
	if(forms.Palab_print_autorizacion.foundset.getSize() > 0){
		forms.Palab_print_autorizacion.foundset.clear();
		forms.Palab_print_autorizacion.foundset.loadAllRecords();
		forms.Palab_print_autorizacion.foundset.deleteAllRecords();
	}
	*/	
	
}

/**
 * TODO generated, please specify type and doc for the params
 * @param {Number} histClin
 * @param {Number} protocolo
 * @param {Number} fecha
 * @param {Number} hora
 * @param {Number} empresa
 * @param {String} planx
 * @param {Number} servicio
 *
 * @properties={typeid:24,uuid:"906EAD1E-617A-41A8-A31D-49E209F03733"}
 */
function imprimirAutorizacion(histClin,protocolo,fecha,hora,empresa,planx,servicio){
	
	limpiarForm();
	
	globals.Palab_hisclinPrint = histClin;
	globals.Palab_prot4Print = protocolo;
	var sector = palab_rel_buscar_admision_num_print.adm_utiliza;
	
	
	if(palab_rel_buscar_admision_num_print.getSize() > 0){
		
		globals.Palab_obrCodigoPrint = palab_rel_buscar_admision_num_print.adm_obrsoc;
		
		globals.Palab_ploObraPrint = palab_rel_buscar_admision_num_print.adm_obrsoc;
		globals.Palab_ploPlanxPrint = planx;
		
		globals.Palab_sfEmpresaPrint = empresa;
		globals.Palab_sfSectorPrint = sector;
		
		globals.Palab_det1Print = histClin;
		globals.Palab_det2Print = fecha;
		globals.Palab_det3Print = hora;
		
		var medico = "Confeccionada por ";
		var matricula = "";
		
		var date = globals.IntegerToDate(fecha);
		medico += " el " + globals.getDayName(date,true) + " " + date.getDate() + " " + globals.getMonthName(date,true) + " / " + date.getFullYear() + " a las " + convertNumberToHour_HHMM(hora) + " hrs.";
		
		// cargar Header
		f_servicio = 'Laboratorio';
		f_fechaImpresion = application.getServerTimeStamp();
		f_medico = medico;
		f_matricula = matricula;
		//f_sexo = sexo; 
		f_edad = globals.Palab_calcularEdad(palab_rel_buscar_admision_num_print.adm_fecnac,fecha) + ' ' +  globals.vTipoEdad;;
		f_apelnom =  formatearHistclin(palab_rel_buscar_admision_num_print.adm_histclin) + "  " + utils.stringTrim(palab_rel_buscar_admision_num_print.adm_apelnom);
		f_afiliado = utils.stringTrim(palab_rel_buscar_admision_num_print.adm_nrobenef);
		//f_histclinunica = palab_rel_buscar_admision_num_print.adm_histclinuni;
		f_habitacion = palab_rel_buscar_admision_num_print.adm_habita;
		f_cama = palab_rel_buscar_admision_num_print.adm_cama;
		var ploPlanx10 = '';
		if(palab_rel_buscar_plan_obra_print.getSize() > 0)
			ploPlanx10 = ' - ' + palab_rel_buscar_plan_obra_print.plo_planx10; 
		f_cobertura = utils.stringTrim(palab_rel_buscar_obrasocial_print.obr_razonsoc) + ploPlanx10;
		f_sector = palab_rel_buscar_sec_fact_print.getSize() > 0 ? palab_rel_buscar_sec_fact_print.sfdescr : "Sect.de fact. no existe";
		if(palab_rel_buscar_detalle_print.getSize() > 0){
			
			f_habitacion = palab_rel_buscar_detalle_print.det4;
			f_cama = palab_rel_buscar_detalle_print.det7;
		}
		
		f_fechaPedido = String(fecha).substr(6,2) + "/" + String(fecha).substr(4,2) + "/" + String(fecha).substr(0,4) + "  " + convertNumberToHour_HHMM(hora);
		f_protocolo = protocolo;
		
		cargarAlertas();
		
		// CARGAR BODY
		cargarBody();
		
		// CARGA PIE DE PAGINA
		
		if(palab_rel_buscar_protocol_print.getSize() > 0){
			
			globals.Palab_medPerCodPrint = palab_rel_buscar_protocol_print.prot39;
			if(palab_rel_buscar_medicos_personal_print.getSize() > 0){
				
				f_medico = utils.stringTrim(palab_rel_buscar_medicos_personal_print.medperapeynom);
				f_matricula = utils.stringTrim(palab_rel_buscar_medicos_personal_print.medpermatricula);
			}
			
			
		}
		
		//imprimir();
	}
	else{
		globals.DIALOGS.showWarningDialog("AtenciÃ³n!","No hay datos para imprimir.","Aceptar")
	}
}

/**
 * @properties={typeid:24,uuid:"E7BFBCD4-8AA0-432D-8DEF-14734C179975"}
 */
function cargarAlertas() {
	
	// Alertas
	var alertas = "";
	if(palab_rel_buscar_alerta_print.getSize() > 0){
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_1 == 1)
			alertas += '    Alergico a';	
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_2 == 1)
			alertas += '    Hipertenso';
			
		if(palab_rel_buscar_alerta_print.aler_tipaler_3 == 1)
			alertas += '    Farmacodependiente';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_4 == 1)
			alertas += '    Diabetico';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_5 == 1)
			alertas += '    Epileptico';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_6 == 1)
			alertas += '    Con Glaucoma';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_7 == 1)
			alertas += '    Inmunodeprimido';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_8 == 1)
			alertas += '    Anticoagulado';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_9 == 1)
			alertas += '    Coronario';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_10 == 1)
			alertas += '    Asmatico';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_11 == 1)
			alertas += '    Testigo de Jehova';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_12 == 1)
			alertas += '    Con Marcapasos';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_13 == 1)
			alertas += '    Con Protesis metal.';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_14 == 1)
			alertas += '    Obesidad clase II';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_15 == 1)
			alertas += '    Obesidad clase III';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_16 == 1)
			alertas += '    Insuficiencia renal';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_17 == 1)
			alertas += '    Escaras';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_18 == 1)
			alertas += '    Trombosis Venosa';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_19 == 1)
			alertas += '    Alerta Epidemiolog.';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_20 == 1)
			alertas += '    Rechazo Terapeutico';
		
		if(palab_rel_buscar_alerta_print.aler_tipaler_21 == 1)
			alertas += '    Alerta Social';
		
		f_alerta = alertas;
	}
}

/**
 * @properties={typeid:24,uuid:"06046C81-D1BB-4A72-AD39-791A33879F07"}
 * @AllowToRunInFind
 */
function cargarBody() {
	
	var protocolo = 112;// TODO COMPLETAR DE LA RELACION
	var  codAutoTipo = 2;// TODO COMPLETAR DE LA RLACION
	
	var dsAux = databaseManager.createEmptyDataSet();
	dsAux.addColumn('html_hoja');
	
	// PRESTACIONES MEDICAS.-
	var html = ''
	
	html = ''
	html += '<html><body>'
	html += '<table width=100% cellpadding=1 cellspacing=0>'
	html += '<tr>'
	html += '<td width=40%><i>' + 'PRESTACIONES MEDICAS.- :' + '</i></td>'
	html += '</tr>'
	html += '</table>'
	html += '</body></html>'
	dsAux.addRow([html]);
	
	// PROCESO-10 Prestaciones
	
	//TODO inicializar variables gobales de filtro para la relacion palab_rel_codauto_print_update
	
	if(palab_rel_codauto_print_update.getSize() > 0){
		
		palab_rel_codauto_print_update.find();
		palab_rel_codauto_print_update.codautopedi = protocolo;
		palab_rel_codauto_print_update.codautotipo = '!99';
		
		if(palab_rel_codauto_print_update.search()){
			
			var wDescrip = "";
			var update = false;
			
			for(var i = 1; i<= palab_rel_codauto_print_update.getSize() ; i++){
				
				// TODO INICIALIZAR RELACION palab_rel_codauto_print_update
				if(palab_rel_codauto_print_update.codautotipo == 88 ){
					
					if(palab_rel_codauto_print_update.codautoimpre != 1 ){
						
						// 1000-ESTRU-00
						
						//TODO inicializar variables gobales de filtro para la relaciion palab_rel_buscar_r_estr_cab_print MOVE CODAUTO-CDAR TO R-EC-CODIGO.
						
						if(palab_rel_buscar_r_estr_cab_print.getSize() > 0){
							wDescrip = utils.stringTrim(palab_rel_buscar_r_estr_cab_print.recdescr);
							update = true;
							// TODO palab_rel_codauto_print_update.codautoimpre = 1;
						}
					}
					
				}
				else{
					// 1000-NOMEN-00 MOVE CODAUTO-TIPO TO NOME-TIPO. MOVE CODAUTO-CDAR TO NOME-CODIGO. INICIALIZAR RELACION palab_rel_buscar_nomencla_print
					if(palab_rel_buscar_nomencla_print.getSize() > 0){
						wDescrip = palab_rel_buscar_nomencla_print.nome_descr;
						update = true;
						// TODO palab_rel_codauto_print_update.codautoimpre = 1;
					}
				}
			}
			/*
			if(update)
				databaseManager.saveData(palab_rel_codauto_print_update);
				*/
			
			// Descripcion
			html = ''
			html += '<html><body>'
			html += '<table width=100% cellpadding=1 cellspacing=0>'
			html += '<tr>'
			html += '<td width=40%>&nbsp;&nbsp;Pulso : ' + utils.stringTrim(wDescrip) + '</td>'
			html += '</tr>'
			html += '</table>'
			html += '</body></html>'
			dsAux.addRow([html]);
			
		}
					
		// PROCESO-40 MEDICAMENTOS.-
		html = ''
		html += '<html><body>'
		html += '<table width=100% cellpadding=1 cellspacing=0>'
		html += '<tr>'
		html += '<td width=40%><i>' + 'MEDICAMENTOS.- :' + '</i></td>'
		html += '</tr>'
		html += '</table>'
		html += '</body></html>'
		dsAux.addRow([html]);
	}
		
	// PROCESO-70 OBSERVACIONES.-
	html = ''
	html += '<html><body>'
	html += '<table width=100% cellpadding=1 cellspacing=0>'
	html += '<tr>'
	html += '<td width=40%><i>' + 'OBSERVACIONES.- :' + '</i></td>'
	html += '</tr>'
	html += '</table>'
	html += '</body></html>'
	dsAux.addRow([html]);
	
	/*
	// Pulso
	html = ''
	html += '<html><body>'
	html += '<table width=100% cellpadding=1 cellspacing=0>'
	html += '<tr>'
	html += '<td width=40%>&nbsp;&nbsp;Pulso : ' + "------------------------------------------" + ' por minuto</td>'
	html += '</tr>'
	html += '</table>'
	html += '</body></html>'
	dsAux.addRow([html]);
	*/
	
	// actualizando lista de impresion
	var $frm = solutionModel.getForm('Palab_print_autorizacion');
	var $tipos = [JSColumn.TEXT];
	$frm.dataSource = dsAux.createDataSource('Palab_print_autorizacion', $tipos);
	forms.Palab_print_autorizacion.controller.recreateUI();
}

/**
 * @properties={typeid:24,uuid:"75E8169A-AD7A-46D2-92DC-AB5CC140E80F"}
 */
function imprimir() {
	controller.setPageFormat(210,297,10,10,10,10,1,0);
	controller.print(false,false);
}

/**
 * TODO generated, please specify type and doc for the params
 * @param value
 *
 * @properties={typeid:24,uuid:"FC51EA91-4955-4650-8659-428525CD9381"}
 */
function convertNumberToHour_HHMM(value) {
	
	var hora = "";
	
	if(value < 1){
		hora = "00:00";
	}
	else{
		if(value < 10){
			hora = "00:0" + value.toString().substr(0,1);
		}
		else{
			if(value < 100){
				hora = "00:" + value.toString().substr(0,2);
			}
			else{
				if(value < 1000){
					hora = "0" + value.toString().substr(0,1) + ":" + value.toString().substr(1,2);
				}
				else{
					if(value <= 2359){
						hora = value.toString().substr(0,2) + ":" + value.toString().substr(2,2);
					}
				}
			}
		}
	}

	return hora;
}

/**
 * TODO generated, please specify type and doc for the params
 * @param {Number} HistClin
 *
 * @properties={typeid:24,uuid:"531EC58E-332E-4F19-9205-E46395146D1F"}
 */
function formatearHistclin(HistClin) {
	var histClin = '';
	if(arguments[0] != undefined)
		histClin =  HistClin.toString().substr(0,HistClin.toString().length-1)+"/"+HistClin.toString().substr(HistClin.toString().length -1,1)	

	return histClin;
}

/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"032EB77C-E571-4601-B650-B82EF1C7CFD1"}
 */
function onShow_inicializarForm(firstShow, event) {
	
	/*
	var dsAux1 = databaseManager.createEmptyDataSet();
	dsAux1.addColumn('html_hoja');
	dsAux1.addRow(['']);
	
	// actualizando lista de impresion
	var $frm = solutionModel.getForm('Palab_print_autorizacion');
	var $tipos = [JSColumn.TEXT];
	$frm.dataSource = dsAux1.createDataSource('Palab_print_autorizacion', $tipos);
	forms.Palab_print_autorizacion.controller.recreateUI();
	*/
	
	//cargarBody();
	//imprimir();
	
}
