/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"E911E7DB-3157-4454-8331-F02F22B93C15"}
 */
var $_msgSMS = '';

/**
 * @properties={typeid:35,uuid:"A48642FD-FE16-44C0-ABB9-D59FE1ACCD0F",variableType:-4}
 */
var $_wHayArm = false;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7A34E840-549A-42D9-A041-160E0F2A4BDF"}
 */
var f_fecha_ingreso_ti = ''
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"859CD44A-7641-4B7F-A704-5AE1C871DB72",variableType:4}
 */
var armChk = 0;
/**
 * @properties={typeid:35,uuid:"37B9BD4F-C2B5-4783-A51A-A10701AC4015",variableType:-4}
 */
var nuevoHciint = false;

/**
 * @properties={typeid:35,uuid:"C084EFEB-6201-4870-A78B-BFC3460815C8",variableType:-4}
 */
var $_listNumberSMS = new Array();

/**
 * @properties={typeid:35,uuid:"08102B51-0CAB-416D-B6FA-FA5342720EFB",variableType:-4}
 */
var $_wtrau = false;

/**
 * @properties={typeid:35,uuid:"5B9B1086-943D-4062-80AE-CD69831C5C38",variableType:-4}
 */
var $_wsele = false;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"500C3D7B-ACEF-4DCE-88D0-4132B5BAB4EF"}
 */
var messageError = "";

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0139A162-E8E6-4931-A4E9-7F8B5DEEC52D",variableType:-4}
 */
var isValidForm = true;

/**
 * @properties={typeid:35,uuid:"CF78E658-72A3-45B2-9C9A-A31F33F7B7CA",variableType:-4}
 */
var $_isUserOSTEE = false;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C794B847-B0FB-47AC-A019-51E0C9FA8549",variableType:4}
 */
var $_countChange = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A7C222EE-589D-4E32-8193-55E96DD258CE"}
 */
var f_habita = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B958A2F8-9F16-4645-A11E-E1B79645EF9F"}
 */
var f_cama = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7ED81EB9-7965-4E4F-AF0B-F306863D811E",variableType:4}
 */
var f_sexo = null;

/**
 * @properties={typeid:35,uuid:"89FAD83F-8C45-4848-881E-0ED6CBC259EE",variableType:-4}
 */
var f_cerrarForm = false;

/**
 * @properties={typeid:35,uuid:"710A902C-41F2-4E88-A781-B5751118CE46",variableType:-4}
 */
var $isDirty = false;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"200A5CB3-A2D2-41EF-AFD5-519875A9EDE2",variableType:4}
 */
var f_protocolo = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"509179F4-9EEA-4BEB-A00E-8D58CD84468D"}
 */
var $messageErrorInter = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"DC1C8BAD-9A61-4770-A90D-2C14E7DCC1F6"}
 */
var f_medico = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"5050AD6C-27C5-4180-B187-96E40A0D41A1"}
 */
var f_edad = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B4167D0C-22DB-4024-944C-0DD1A6BB6A1D"}
 */
var f_cobertura = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"607181D7-B31C-43C6-885F-49E6346DDACC"}
 */
var f_histClinUnica = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"EA1EC6AA-8058-4028-9CBC-31B0F038EAFF"}
 */
var f_paciente = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"DBE30C0E-527D-4A90-98B5-4FA9770C31B5"}
 */
var f_patologia1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"238D4D90-2A49-4E7C-9553-86FA7597749B"}
 */
var f_patologia2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"5E50C1A1-F68B-4AE0-A362-54E731A9CEF3"}
 */
var f_patologia3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"69F66BA1-8FD1-47CC-A6D0-1AA92CE12EBE"}
 */
var f_patologia = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2DA6BA46-1D91-4674-A747-9EBFC209DA36"}
 */


var f_descripcion_patologia1='';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"AD3871E9-A0E6-43B2-A77D-A89B13E9004B"}
 */
var f_descripcion_patologia2='';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0B7F8F14-C39D-4919-82FE-7DBBA3CA3BEC"}
 */
var f_descripcion_patologia3='';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4F0B7D14-BB95-4804-BAF8-ECFC49649F30"}
 */
var f_cbo_pulso_caract = '1';


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FF3B089F-B477-423E-8C93-B0134102D990",variableType:4}
 */
var f_cbo_tipo_temperatura = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"72925605-76ED-484F-A5DB-AEB246088003",variableType:4}
 */
var f_pulso_frecuencia = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"942481CA-2437-4C17-9893-C0C02EB6E623",variableType:4}
 */
var f_tension_arterial_max = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FF93C3F7-64E5-48ED-BF25-ABB55098EB08",variableType:4}
 */
var f_tension_arterial_min = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"CD8352A1-C15B-474E-AA76-F6913FFE09D1",variableType:4}
 */
var f_temperatura = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C5FF7527-23BF-4D53-ACF2-AB3974E24AC5"}
 */
var f_peso='';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"512087F0-8583-4CC4-8BF1-5712733AC859"}
 */
var f_pulso_caracteristico = '';
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A8DC98BF-1741-4879-BA2D-AAD059D0A61D"}
 */
var f_altura='';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"49BE7388-E824-4AF8-9B2F-8D6F8FABD583"}
 */
var f_informe_paciente= 'NO';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"23A6C103-DAE8-44BC-822A-548527C207FA"}
 */
var f_aAquien = ''
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"671721D2-B4B6-4367-A7A2-052F20580762"}
 */
var f_IMC='';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"CA883686-A28E-48E3-95A7-A01992E09A06"}
 */
var f_IMC_resultado = '';
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F5705236-3339-4229-BE92-FC71660B1E07",variableType:4}
 */
var obraSocialOSTEE_OS = 1132;

/**
 * @properties={typeid:35,uuid:"72D1D102-6600-40BC-B42C-E0088C8BB041",variableType:-4}
 */
var f_pendienteDeSeleccion = false;



/**
 * @properties={typeid:35,uuid:"426F179E-5C17-411D-8682-B967CE6F49FA",variableType:-4}
 */
var f_aislado_paciente = false;
/**
 * TODO generated, please specify type and doc for the params
 * @param firstShow
 * @param event
 *
 * @properties={typeid:24,uuid:"1D278523-25BF-462A-8825-C0C4D19BBB79"}
 */
function onShow_inicializarForm(firstShow, event) {

	//initFormFirstShow();
	elements.txt_paciente.requestFocus(); 
}


/**
 * @properties={typeid:24,uuid:"D21216CA-B6E6-4081-BA1E-2245C99BF8E7"}
 */
function mostrarRecordatorio() {

	var texto = "Resulta Indispensable, con el fin de evitar inconvenientes" + "\n legales, NO utilizar Abreviaturas, EVITAR faltas de ortografia" + "\n y señalar puntualmente localizaciones, utilizando superior," + "\n inferior, derecho, izquierdo, distal, proximal, etc." + "\n y llenar todos los espacios de la historia clinica de ingreso" + "\n a guardia." + "\n Recuerde que debe firmar y sellar la impresión de la H.Clin."
	globals.DIALOGS.showInfoDialog("Recordatorio", texto, "Aceptar");
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"DB10F722-751E-4E12-BADE-120A8FEA04AF"}
 */
function onAction_btnBuscarPaciente(event) {

	globals.AsiUtiTrs_Hoja_eventSourceButton = 1;
	openSearch();
}

/**
 * @properties={typeid:24,uuid:"77A8321C-E389-48D1-AC0A-875BD3DA7913"}
 */
function openSearch() {

	var win2 = application.createWindow("seleccion_internado", JSWindow.MODAL_DIALOG);
	win2.title = 'Búsqueda de Pacientes Internados';
	win2.resizable = false;
	win2.show(forms.AsiUtiTrs_Hoja_Ti_dlg_buscar_internado);

}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"2202CCA0-E72F-4DD5-8BC4-6086D3D163E6"}
 */
function onAction_txtBusquedaRapida(event) {

	if(elements.txt_paciente.editable){
		if(!isNaN(f_paciente)){
			var numero =  utils.stringToNumber(f_paciente);
			if(numero>2147483647){
				plugins.dialogs.showInfoDialog("Error en Nro.Internación","El número de Internación es inválido.","Ok")
				return
			}
			
		}
	
		globals.AsiUtiTrs_Hoja_hisclistrynro = f_paciente;
		if (globals.AsiUtiTrs_Hoja_hisclistrynro != '' && globals.AsiUtiTrs_Hoja_hisclistrynro != null) {
			globals.AsiUtiTrs_Hoja_eventSourceButton = 0;
			openSearch();
		} else {
			globals.DIALOGS.showWarningDialog("Atención", 'Debe ingresar Nro. de paciente o apellido.', "Aceptar")
		}
	}
	
	return true;
}

/**
 * @properties={typeid:24,uuid:"AB287BC8-C46C-486F-97C5-387767421B9A"}
 */
function pacienteSeleccionadoInter() {

	if(isValidDatosPacienteInter()){
		
			/*	IF ADM-26 = 1 OR = 6
		        DISPLAY 'Alta el ' LINE 12 COL 27 REVERSE.
		IF ADM-26 = 2 OR = 3
		        DISPLAY 'Falleci.' LINE 12 COL 27 REVERSE.
		IF ADM-26 = 4 DISPLAY 'Traslad.' LINE 12 COL 27 REVERSE.
		IF ADM-26 = 5 DISPLAY ' Fugado ' LINE 12 COL 27 REVERSE.
		IF ADM-26 > 0 AND OBR-56 NOT = 2
		DISPLAY ADM-38(7:2) LINE 12 COL 36  REVERSE '/' REVERSE
		     ADM-38(5:2) REVERSE '/' REVERSE
		     ADM-38(1:4) REVERSE ' ' REVERSE
		     ADM-39(1:2) REVERSE ':' REVERSE
		     ADM-39(3:2) REVERSE 'hs.' REVERSE
		     'ENTER' LINE 24 COL 01 REVERSE ' para continuar'
		ACCEPT NADA LINE 0 COL 0
		DISPLAY ' ' LINE 12 COL 27 ERASE EOL
		     ' ' LINE 24 COL 01 ERASE EOL
		GO ACC-HCL.
		
		IF ADM-25 NOT = 0
		MOVE 'El paciente egreso del Sanatorio. ' TO W-MENSAJE
		PERFORM MENSAJE
		GO ACC-HCL.
		
		
		*/
		
		var causaEgreso = asiutitrs_hoja_numero_to_asistencial_admision.adm_causaegre;
		var fechaAltaMedica = asiutitrs_hoja_numero_to_asistencial_admision.adm_fecepic;
		var horaAltaMedica = asiutitrs_hoja_numero_to_asistencial_admision.adm_horepic
		var altaMedica = asiutitrs_hoja_numero_to_asistencial_admision.adm_fecaltaefec
		
		if(fechaAltaMedica!=null && fechaAltaMedica!=undefined){
			var fechaEpi = fechaAltaMedica.toString().substring(6,2)+'/'+ fechaAltaMedica.toString().substring(4,2)+'/'+fechaAltaMedica.toString().substring(0,4);
			var horaEpi = horaAltaMedica.toString().substr(0,2)+ ':'+horaAltaMedica.toString().substr(2,2);
			var fechaHoraEpi =  fechaEpi + ' '+horaEpi;
		}

		var mensajeAviso = '';
		
		if(causaEgreso==1 || causaEgreso==6){
			mensajeAviso+= 'Alta el ';
		}
		if(causaEgreso==2 || causaEgreso==3){
			mensajeAviso+= 'Paciente Falleció';
		}
		if(causaEgreso==4){
			mensajeAviso+= 'Paciente Trasladadó ';
		}
		if(causaEgreso==5){
			mensajeAviso+= 'Paciente Fugado ';
		}
		if(causaEgreso>0 && asiutitrs_hoja_rel_buscar_obrasocial.obr_espami!=2){
			plugins.dialogs.showInfoDialog('Información',mensajeAviso + fechaHoraEpi ,'OK');
		}
		if(altaMedica>0){
			plugins.dialogs.showInfoDialog('Información','El paciente egreso del Sanatorio.' ,'OK');
		}
		
		editablePaciente(false);
		//$isDirty = true;
		f_paciente = asiutitrs_hoja_numero_to_tbc_admision.histcli_hojati + ' ' + utils.stringTrim(asiutitrs_hoja_numero_to_tbc_admision.adm_apelnom);
		f_histClinUnica = asiutitrs_hoja_numero_to_tbc_admision.adm_histclinuni;
		f_sexo = asiutitrs_hoja_numero_to_tbc_admision.adm_sexo;
		f_edad = globals.CalculoEdad(asiutitrs_hoja_numero_to_tbc_admision.adm_fecnac) + ' ' + globals.vTipoEdad;
		f_habita = asiutitrs_hoja_numero_to_tbc_admision.adm_habita;
		f_cama = asiutitrs_hoja_numero_to_tbc_admision.adm_cama;
		globals.AsiUtiTrs_Hoja_obrCodigo = asiutitrs_hoja_numero_to_tbc_admision.adm_obrsoc;
		
		f_cobertura = asiutitrs_hoja_rel_buscar_obrasocial.obr_razonsoc;

		var espeMed = globals.Srv_Login_Sanatorio_vEspeMed;
		
		globals.AsiUtiTrs_Hoja_hiiHisCli = asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
		  globals.AsiUtiTrs_Hoja_hisclin = asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
		
		globals.AsiUtiTrs_Hoja_histClinAsist = asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
		
		
		if(asiutitrs_hoja_rel_tbc_detalle.getSize()>0){
			var fechaIngresoTi = asiutitrs_hoja_rel_tbc_detalle.det2.toString().substr(6, 2) + "/" + asiutitrs_hoja_rel_tbc_detalle.det2.toString().substr(4, 2) + "/" + asiutitrs_hoja_rel_tbc_detalle.det2.toString().substr(0, 4);
		
			var horaIngresoTi = convertNumberToHour_HHMM(asiutitrs_hoja_rel_tbc_detalle.det3);
			
			f_fecha_ingreso_ti = fechaIngresoTi + ' '+ horaIngresoTi + 'Hs.';
		}
		
		var fechaIngreso = asiutitrs_hoja_numero_to_tbc_admision.adm_fecing.toString().substr(6, 2) + "/" + asiutitrs_hoja_numero_to_tbc_admision.adm_fecing.toString().substr(4, 2) + "/" + asiutitrs_hoja_numero_to_tbc_admision.adm_fecing.toString().substr(0, 4);
		var hora = convertNumberToHour_HHMM(asiutitrs_hoja_numero_to_tbc_admision.adm_horing);
		var horaAux = hora.split(':')
		var fechaDesde = globals.IntegerToDate(asiutitrs_hoja_numero_to_tbc_admision.adm_fecing);
		fechaDesde.setHours(Number(horaAux[0]), Number(horaAux[1]));
		//var fechaActual = utils.timestampToDate(application.getServerTimeStamp());
		var fechaActual = application.getServerTimeStamp();
		var fechaAux = fechaActual;
		var dias = contar_dias(fechaDesde, fechaActual);
		var info = "Ingresó al Sanatorio : " + fechaIngreso + "  " + globals.AsiUtiTrs_Hoja_convertNumberToHour_HHMM(String(asiutitrs_hoja_numero_to_tbc_admision.adm_horing)) + " Hrs.   " + dias + " días de Internado" + "\nDomicilio : " + utils.stringTrim(asiutitrs_hoja_numero_to_tbc_admision.adm_domicilio) + "\nT.E. : " + utils.stringTrim(asiutitrs_hoja_numero_to_asistencial_admision.adm_telefefono);
		if (asiutitrs_hoja_rel_buscar_hojati.getSize() == 0)
			info += "\n\nHistoria Clinica de Ingreso, aún no ha sido Confeccionada.";
		info += "\n¿Confirma paciente?";
		var res = globals.DIALOGS.showQuestionDialog('¡Atención!', info, 'Si', 'No');
	
		var ponerTodosEnBlanco=function(nombreForm,nameField ){
			if(nombreForm!=null && nameField!=null ){
				  forms[nombreForm].elements[nameField].bgcolor = "#ffffff";
				  
			}
		}
		globals.modificarCampos("HciutiTrs_frm_evo_medica_utiTrs_hoja_TI", ponerTodosEnBlanco,null);
	
		var elementosTab1 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex()
		for (var index = 1; index <= elementosTab1; index++) {
			var nombreFormulario = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(index);
			globals.modificarCampos(nombreFormulario, ponerTodosEnBlanco,null);

		}
		var elementosTab2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex()
		for (var index2 = 1; index2 <= elementosTab2; index2++) {
			var nombreFormulario2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(index2);
			globals.modificarCampos(nombreFormulario2, ponerTodosEnBlanco,null);
		}
		
		//var fechaActual = application.getServerTimeStamp();
		var now = globals.FormatearFecha(fechaActual,"AAAAMMDD");
		
		
		var sqlHistCliIngrTi = "select HtiFecha,HtiHora from tbc_hojati"
					  + " where  HtiHistClinica = " + globals.AsiUtiTrs_Hoja_hiiHisCli 
					  + " and HtiFecha = " + now
					  + " order by HtiFecha, HtiHora";
		var dsHistCliIngrTi = databaseManager.getDataSetByQuery('asistencial',sqlHistCliIngrTi,null,-1);
			//dsHistCliIngrtiAux
		
		if (res == 'Si') {

					if(asiutitrs_hoja_rel_buscar_hojati.getSize() >= 1){
						
						//evaluar si agregar  NUEVA/NUEVO
						var utiliza=asiutitrs_hoja_numero_to_tbc_admision.adm_utiliza
						//var primeraEvolucionMedica = false;
						
						//Si es primera evolucion medica del dia
						
						
						/*var dsrowfechaMax = databaseManager.getDataSetByQuery("asistencial", "select  max(HitFecha)  from tbc_hciti where HitHiscli="+globals.AsiUtiTrs_Hoja_hiiHisCli, null, -1);
						var fechaMaximaHistClin=dsrowfechaMax.getValue(1,1);
						var dsrowhoraMax = databaseManager.getDataSetByQuery("asistencial", "select  max(HitHora)  from tbc_hciti where HitHiscli="+globals.AsiUtiTrs_Hoja_hiiHisCli +" and HitFecha="+fechaMaximaHistClin, null, -1);
						var horaMaximaHistClin=dsrowhoraMax.getValue(1,1);
						var dsrowfechaMaxDetalle = databaseManager.getDataSetByQuery("asistencial", "select  max(Det2)  from tbc_detalle where Det1="+globals.AsiUtiTrs_Hoja_hiiHisCli, null, -1);
						var fechaMaximaDetalle=dsrowfechaMaxDetalle.getValue(1,1);
						if(fechaMaximaDetalle!=null){
							var dsrowhoraMaxDetalle = databaseManager.getDataSetByQuery("asistencial", "select  max(Det3)  from tbc_detalle where Det1="+globals.AsiUtiTrs_Hoja_hiiHisCli +" and Det2="+fechaMaximaDetalle, null, -1);
							var horaMaximaDetalle=dsrowhoraMaxDetalle.getValue(1,1);
						}
						
						
						var generarNueva=false;
						if(fechaMaximaDetalle>fechaMaximaHistClin || (fechaMaximaHistClin==fechaMaximaDetalle && horaMaximaDetalle>horaMaximaHistClin)){
							generarNueva=true;
						}
						
						var dsHistCliIngrtiAux = databaseManager.createEmptyDataSet();
						dsHistCliIngrtiAux.addColumn('id');
						dsHistCliIngrtiAux.addColumn('fecha');
						dsHistCliIngrtiAux.addColumn('hora');
						dsHistCliIngrtiAux.addColumn('ult_clin_flag');
						dsHistCliIngrtiAux.addColumn('texto');
						
						
						for(var j=1; j<=dsHistCliIngrTi.getMaxRowIndex(); j++){
							var ultima = (fechaMaximaHistClin==dsHistCliIngrTi.getValue(j,1) && horaMaximaHistClin==dsHistCliIngrTi.getValue(j,2))==true?1:0;
							fechaIngreso = dsHistCliIngrTi.getValue(j,1);
							dsHistCliIngrtiAux.addRow([globals.AsiUtiTrs_Hoja_hiiHisCli 
												,dsHistCliIngrTi.getValue(j,1)
												,dsHistCliIngrTi.getValue(j,2)
												,ultima
												,fechaIngreso.toString().substr(6, 2) + "/" + fechaIngreso.toString().substr(4, 2) + "/" + fechaIngreso.toString().substr(0, 4) + "  " + convertNumberToHour_HHMM(dsHistCliIngrTi.getValue(j,2).toString())
												]);
						}*/
						
						var estaBloqueado = globals.isLock(application.getSolutionName(),controller.getName(),asiutitrs_hoja_numero_to_tbc_admision.adm_histclin.toString(),globals.Srv_Login_Sanatorio_vLega.toString(),"Hoja Médica");
						
						/*if((utiliza==2 || utiliza==10 || utiliza==12) && generarNueva && estaBloqueado==false){
								dsHistCliIngrtiAux.addRow([0,0,0,1,'NUEVA']);
						}*/
						
						var dsHistCliIngrtiAux = databaseManager.createEmptyDataSet();
						dsHistCliIngrtiAux.addColumn('id');
						dsHistCliIngrtiAux.addColumn('fecha');
						dsHistCliIngrtiAux.addColumn('hora');
						dsHistCliIngrtiAux.addColumn('texto');
						
						
						for(var j=1; j<=dsHistCliIngrTi.getMaxRowIndex(); j++){
							fechaIngreso = dsHistCliIngrTi.getValue(j,1);
							dsHistCliIngrtiAux.addRow([globals.AsiUtiTrs_Hoja_hiiHisCli 
												,dsHistCliIngrTi.getValue(j,1)
												,dsHistCliIngrTi.getValue(j,2)
												,fechaIngreso.toString().substr(6, 2) + "/" + fechaIngreso.toString().substr(4, 2) + "/" + fechaIngreso.toString().substr(0, 4) + "  " + convertNumberToHour_HHMM(dsHistCliIngrTi.getValue(j,2).toString())
												]);
						}
						if((utiliza==2 || utiliza==10 || utiliza==12) && estaBloqueado==false ){
							dsHistCliIngrtiAux.addRow([0,0,0,'NUEVA']);
						}
						//dsHistCliIngrtiAux.addRow([0,0,0,'NUEVA']);
						
						var $tipos = [JSColumn.NUMBER,JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT];
						var $frm = solutionModel.getForm('AsiUtiTrs_Hoja_tbl_hojati');
						$frm.dataSource = dsHistCliIngrtiAux.createDataSource('hojas_medicas', $tipos);
						forms.AsiUtiTrs_Hoja_tbl_hojati.controller.recreateUI();
						
						var win2 = application.createWindow("seleccion_hciint", JSWindow.MODAL_DIALOG);
						win2.title = 'Hoja Médica Terapia Intensiva';
						win2.resizable = true;
						//win2.setSize(250,600);
						//win2.show(forms.AsiUtiTrs_Hoja_dlg_historial_his_clinicas);
						win2.show(forms.AsiUtiTrs_Hoja_tbl_hojati);
					}
					else{
						loadHciint();
						
					}
			
		} 
		else{
			
			limpiarForm();
		}	
	}
	else{
		
		elements.txt_paciente.requestFocus();
	}
}

/**
 * @properties={typeid:24,uuid:"AEDA42C2-0F7E-43AE-A3DB-67396978A98E"}
 * @AllowToRunInFind
 */
function loadHciint() {
	//databaseManager.acquireLock(asiutitrs_rel_tbc_hciti_to_tbc_hciti, recordIndex)
	var bloqueado = globals.AsistFunciones_isRegisterTableLocked(application.getSolutionName(),controller.getName(),asiutitrs_hoja_numero_to_tbc_admision.adm_histclin.toString(),globals.Srv_Login_Sanatorio_vLega.toString(),"Historia Clinica");
	//var bloqueado = globals.AsistFunciones_isRegisterTableLocked(application.getSolutionName(),controller.getName(),asiutitrs_hoja_numero_to_tbc_admision.adm_histclin.toString(),globals.Srv_Login_Sanatorio_vLega.toString(),"Historia Clinica");
	if(!bloqueado){
		globals.AsiUtiTrs_Hoja_soloLectura=false;
		globals.AsiUtiTrs_Hoja_recursoObtenido= true;
		
	}else{
	// Solo lectura
	globals.AsiUtiTrs_Hoja_soloLectura=true;
	//globals.DIALOGS.showWarningDialog("Recurso en Uso","La historia clínica que quiere acceder esta siendo usada actualmente por otro profesional. Aguarde o reintente mas tarde para poder editar información o Agregar Nueva Historia")
	globals.AsiUtiTrs_Hoja_recursoObtenido= false;
	globals.ModoLecturaVisualizarFactoresYvaloracion=true;
	
	}
	globals.AsiUtiTrs_Hoja_fechaHisclin = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha;
	editableSolicitudAutomatica(true)
	
//	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.grp_diagnostico.readOnly=true;
//	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.grp_signovitale.readOnly=true;
//	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.grp_solicitud.readOnly=true;
		
		
	if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.getSize() > 0) {
		
									/*if(!globals.AsiUtiTrs_Hoja_ultimaHisCli && 	globals.AsiUtiTrs_Hoja_permiso_especial==false || globals.AsiUtiTrs_Hoja_recursoObtenido==false){
										forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=false;
									}else{
										forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=true;
									}*/
									//habilitarExamenFisico(false)
									forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_imprimir.enabled=true;
									forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=true;
									
									if(globals.AsiUtiTrs_Hoja_soloLectura){
										forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=false;
										forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_imprimir.enabled=false;
									}else{
										forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=true;
										forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=true;
									}
									
									
									/* Solo permite modificar las hojas cargadas por el medico y que sean del mismo dia */
									if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitipomed!=globals.Srv_Login_Sanatorio_vTipoOperador || 
										asiutitrs_rel_tbc_hojati_to_tbc_hojati.htilegajomed!=globals.Srv_Login_Sanatorio_vLega ||
										asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha1!=utils.stringToNumber(globals.CapturaFechaSistema())
									){
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=false;
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_imprimir.enabled=false;
											
											///globals.AsiUtiTrs_Hoja_soloLectura=true;
									}
									//scopes.globals.verValoresRelacion(asiutitrs_rel_tbc_hojati_to_tbc_hojati, "asistencial", "tbc_hojati")
							
									habilitarExamenFisico(false)
									
									globals.ModoLecturaVisualizarFactoresYvaloracion=true;
									
									
									globals.AsiUtiTrs_Hoja_hiiHisCli = asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
									globals.AsiUtiTrs_Hoja_fechaTxt = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha;
									globals.AsiUtiTrs_Hoja_horaTxt = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora;
									
									globals.AsiUtiTrs_Hoja_fechaActual = globals.FormatearFecha(application.getServerTimeStamp(),"AAAAMMDD");
									//globals.AsiUtiTrs_Hoja_grupoTxt = 1;
									//globals.AsiUtiTrs_Hoja_ppcTxt = asiutitrs_rel_tbc_hojati_to_tbc_hojati.hittval_10 -asiutitrs_rel_tbc_hojati_to_tbc_hojati.hittval_11;
						
									if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiviav==1){
										globals.AsiUtiTrs_Hoja_ViaEndCetral_Lugar=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiviavl
									}
									if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hticatc==1){
										globals.AsiUtiTrs_Hoja_Cateter_Cook_Lugar=asiutitrs_rel_tbc_hojati_to_tbc_hojati.hticatcl
									}
									if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htivesical==1){
										globals.AsiUtiTrs_Hoja_SondaVesical_Obs=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htivesicalobs
									}
									if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hting==1){
										globals.AsiUtiTrs_Hoja_SondaNG_Obs=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htingobs
									}
									if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisog==1){
										globals.AsiUtiTrs_Hoja_SondaSog_Obs=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisogobs
									}
									if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotras==1){
										globals.AsiUtiTrs_Hoja_SondaOtras_Obs=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotrasobs
									}
									if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiescara==1){
										globals.AsiUtiTrs_Hoja_Escaras_Obs=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiescaraobs
									}
								
									// cargar Examen fisico y diagnostico de primer evol medica
									cargarExamenFisico();
									cargarDiagnosticos();
									
									calcularImc();
									
									if(asiutitrs_rel_tbc_tvp_escaras_to_tbc_tvp_escaras.getSize()>0){
										elements.btn_VerFactoresValoracion.visible=true
									}
									//var isHoy =utils.stringToNumber(globals.CapturaFechaSistema())==asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha;
									
									if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.getSize()>0){
										if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1!=0){
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1;
											f_descripcion_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1.pat_descrip
											if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1!=0){
												forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=true;
											}
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos2;
											f_descripcion_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2.pat_descrip
											if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2!=0){
												forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=true;
											}
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia3=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos3;
											f_descripcion_patologia3 = asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_3.pat_descrip
										}
										if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagevo1!=0){
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagevo1;
											f_descripcion_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1_segunda.pat_descrip
											if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1!=0){
												forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=true;
											}
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagevo2;
											f_descripcion_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2_segunda.pat_descrip;
											if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2!=0){
												forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=false;
											}
										}
									}
						
							
									//forms.AsiUtiTrs_Hoja_txt_neurológico.calcularGlassgow();
									//forms.AsiUtiTrs_Hoja_txt_neurológico.calcularPcc();
									/*globals.modificarCampos("HciutiTrs_frm_evo_medica_utiTrs_hoja_TI", globals.setearEnModoLecturaCampos,null);
									*/
									
									var elementosTab1 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex()
									for (var index = 1; index <= elementosTab1; index++) {
										var nombreFormulario = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(index);
										globals.modificarCampos(nombreFormulario, globals.setearEnModoLecturaCampos,null);
										
										
									}
									var elementosTab2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex()
									for (var index2 = 1; index2 <= elementosTab2; index2++) {
										var nombreFormulario2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(index2);
										globals.modificarCampos(nombreFormulario2, globals.setearEnModoLecturaCampos,null);
									}
									
									if (asiutitrs_rel_hojatitxt.getSize() > 0) {				
									 	cargarInformes()

									} else {
							
										//cargar informes de Relativity
										var sqlInfo = "select HetiGrupo,HetiSecuencia,HetiLinea from tbc_hojatitxt"  //AsiUtiTrs_Hoja_hcititxt" //asiucotrs_hciucotxt  //puse  tbc_hciinttxt
													+ " where HetiHistClinica = " + asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihistclinica 
													+ " and HetiFecha = " + asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha
													+ " and HetiHora = " + asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora
													//+ " and HetiGrupo = 1" 
													+ " order by HetiGrupo, HetiSecuencia";
										var ds_info = databaseManager.getDataSetByQuery("asistencial", sqlInfo, null, -1);
										if(ds_info.getMaxRowIndex()>0){
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=false;
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_grabar.enabled=false;
											forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_cancelar.enabled=false;
											//globals.AsiUtiTrs_Hoja_soloLectura = true;
										}
										var i;
										var indiceMaxTab1 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex()
										var indiceMaxTab2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex()
										for (i = 1; i < indiceMaxTab1; i++) {
							
											
											
											
										//	elements.tab_informe_1.setTabFGColorAt(previousIndex, '#000000');
										//	elements.tab_informe_1.setTabFGColorAt(elements.tab_informe_1.tabIndex, '#3336ff');
											/*var current = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.tabIndex;
											
											var nameTab= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(current);
											if(forms[nameTab].elements[0]!=undefined){
												forms[nameTab].elements[0].requestFocus();
											}*/
											
											var nameTab= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(i);
											if(nameTab!=null && forms[nameTab].elements[0]!=undefined){
												//forms[nameTab].elements[0].requestFocus();
												//forms[nameTab].f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												
												if(utils.stringTrim(forms[nameTab].f_informe).length == 0)
													forms[nameTab].f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms[nameTab].f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
												
											}
											
											
										//	if(ds_info.getValue(i,1))
											
											/*if (ds_info.getValue(i, 1) == 1){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_motivo_ingreso.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_motivo_ingreso.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_motivo_ingreso.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
							
											if (ds_info.getValue(i, 1) == 7){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_examen_fisico.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_examen_fisico.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_examen_fisico.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
											
											if (ds_info.getValue(i, 1) == 8){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_neurológico.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_neurológico.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_neurológico.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
								
											if (ds_info.getValue(i, 1) == 12){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_cardiovascular.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_cardiovascular.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_cardiovascular.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
							
											if (ds_info.getValue(i, 1) == 13){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_respiratorio.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_respiratorio.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_respiratorio.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
							
											if (ds_info.getValue(i, 1) == 15){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_abdominal.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_abdominal.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_abdominal.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
							
											if (ds_info.getValue(i, 1) == 16){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_osteo_articular.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_osteo_articular.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_osteo_articular.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
							
											if (ds_info.getValue(i, 1) == 17){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_urogenital.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_urogenital.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_urogenital.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
							
							
											if (ds_info.getValue(i, 1) == 20){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_tratamiento_ingreso.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_tratamiento_ingreso.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_tratamiento_ingreso.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
							
											if (ds_info.getValue(i, 1) == 19){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_estudios_solicitados.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_estudios_solicitados.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_estudios_solicitados.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
							
											if (ds_info.getValue(i, 1) == 21){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_interconsulta.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_interconsulta.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_interconsulta.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}
							
											if (ds_info.getValue(i, 1) == 22){
												
												if(utils.stringTrim(forms.AsiUtiTrs_Hoja_txt_otros.f_informe).length == 0)
													forms.AsiUtiTrs_Hoja_txt_otros.f_informe += utils.stringTrim(ds_info.getValue(i, 3));
												else
													forms.AsiUtiTrs_Hoja_txt_otros.f_informe += '\n' + utils.stringTrim(ds_info.getValue(i, 3));
											}*/
							
											
										}
										
										for (var j = 1; j <= indiceMaxTab2; j++) {
											
												
												var nameTab2= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(j);
												if(nameTab2!=null && forms[nameTab2].elements[0]!=undefined){
													//forms[nameTab].elements[0].requestFocus();
													//forms[nameTab].f_informe += utils.stringTrim(ds_info.getValue(i, 3));
													
													if(utils.stringTrim(forms[nameTab2].f_informe).length == 0)
														forms[nameTab2].f_informe += utils.stringTrim(ds_info.getValue(6+j, 3));
													else
														forms[nameTab2].f_informe += '\n' + utils.stringTrim(ds_info.getValue(6+j, 3));
													
												}
												
								
												
											}
											globals.AsiUtiTrs_Hoja_soloLectura=true;
									}
							
									$isDirty = false;
									visibleBody(true);
									//var fechaActual = application.getServerTimeStamp();
								//	var now = globals.FormatearFecha(fechaActual,"AAAAMMDD");
									if(!globals.AsiUtiTrs_Hoja_soloLectura){
										//seccion aislamiento.
										f_aislado_paciente = false;
										scopes.globals.AsiUtiTrs_Hoja_hiiHisCli=globals.AsiUtiTrs_Hoja_hiiHisCli ;
										//scopes.globals.AsiUtiTrs_Hoja_horaHciint = now;
										scopes.globals.AsiUtiTrs_Hoja_Estado_Aislamiento=0;
										
										globals.Srv_Aislamiento_Sanatorio_hisclin = globals.AsiUtiTrs_Hoja_hiiHisCli;
										globals.Srv_Aislamiento_Sanatorio_vLega = globals.Srv_Login_Sanatorio_vLega
										globals.Srv_Aislamiento_Sanatorio_vTipoOperador = globals.Srv_Login_Sanatorio_vTipoOperador;
										globals.Srv_Aislamiento_Sanatorio_hiiHisCli = globals.AsiUtiTrs_Hoja_hiiHisCli
										globals.aislamientoPaciente();
										
										//ALERTAS ASISTENCIALES
										globals.ControlAlerta(0,globals.AsiUtiTrs_Hoja_hiiHisCli,1,1)
									}
								
	} 
	else {
		
		if(globals.AsiUtiTrs_Hoja_soloLectura==false){
			//Hoja TI NUEVA
			globals.AsiUtiTrs_Nueva_Evol_Medica = true;
			globals.AsiUtiTrs_Hoja_hiiHisCli = 0;
			globals.AsiUtiTrs_Hoja_fechaHciint = 0;
			globals.AsiUtiTrs_Hoja_horaHciint = 0;
			globals.AsiUtiTrs_Hoja_soloLectura = false;
			//globals.AsiUtiTrs_Primera_Evol_Medica_Dia = true;
			var fechaHoy = utils.stringToNumber(globals.CapturaFechaSistema());
			elements.btn_VerFactoresValoracion.visible=false;
			//globals.modificarCampos('AsiUtiTrs_Ti_Examen_Fisico', globals.setearEnModoLecturaCampos,'txt')
			habilitarExamenFisico(false);
			
			globals.AsiUtiTrs_Hoja_fechaHciint = fechaHoy;
			globals.AsiUtiTrs_Hoja_fechaActual= fechaHoy;
			globals.AsiUtiTrs_Hoja_hiiHisCli =asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
			
			//Valido si es la primera evolución medica del dia y habilitar 3 diagnosticos.
			
		
			globals.ModoLecturaVisualizarFactoresYvaloracion=true;
			
			// se habilita examen fisico, si es la primera evol del dia.
			if(!asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.getSize()>0){
				globals.AsiUtiTrs_Primera_Evol_Medica_Dia = true;
			}else{
				globals.AsiUtiTrs_Primera_Evol_Medica_Dia = false
			}
			f_pulso_caracteristico='Normal';
		
			
			habilitarTabs(true);
			
			cargarExamenFisico()
			cargarDiagnosticos()
			//habilitar examen fisico
			if(globals.AsiUtiTrs_Primera_Evol_Medica_Dia){
				habilitarExamenFisico(true);
			
			}else{
				habilitarExamenFisico(false)
			}
			
			
			elements.txt_pulso_caracteristico.editable=false;
		/*	var histClin = asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
			var fecha = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha;
			var hora = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora;*/

		
			//globals.modificarCampos("HciutiTrs_frm_evo_medica_utiTrs_hoja_TI", globals.habilitarCampos,null);
			
		
			
		
			
			
			/*var elementosTab11 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex()
			for (var index1 = 1; index1 <= elementosTab11; index++) {
				var nombreFormulario11 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(index1);
				globals.modificarCampos(nombreFormulario11, globals.habilitarCampos,null);
				
			}
			var elementosTab22 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex()
			for (var index22 = 1; index22 <= elementosTab22; index22++) {
				var nombreFormulario22 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(index22);
				globals.modificarCampos(nombreFormulario22, globals.habilitarCampos,null);
			}*/
			
			
			asiutitrs_rel_tbc_hojati_to_tbc_hojati.newRecord();
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=false;
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_grabar.enabled=true;
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_cancelar.enabled=false;
			scopes.globals.InicializarDatosDeRelacion(asiutitrs_rel_tbc_hojati_to_tbc_hojati, "asistencial", "tbc_hojati")
			//asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipulsocarac = 'Normal';
			
			if(globals.AsiUtiTrs_Primera_Evol_Medica_Dia){
				asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia=1;
				asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihayef = 1
			}
			
			//si no tiene evoluciones hechas, se habilita diagnostico 3.
			if(asiutitrs_rel_tbc_hojati_to_tbc_hojati_unica.getSize()>0){
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=false;
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.enabled=false;
			}else{
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable = true;
				asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc=1;
			}
			
			visibleBody(true);
			//editableSolicitudAutomatica(true);
			//inicializarRelacionHcint();
			//enable
			//asiutitrs_hoja_rel_alerta.newRecord();
			//inicializarRelacionAlert();
		}else{
			limpiarForm();
		}
		
	}

	
	//elements.btn_VerFactoresValoracion.visible=false;
/*	if((globals.AsiUtiTrs_Primera_Evol_Medica_Dia || asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc == 1 || asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1)){
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.grp_diagnostico.readOnly=false;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.grp_signovitale.readOnly=false;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.grp_solicitud.readOnly=false;
	}*/
	elements.txt_frecuencia.requestFocus();
	
}

/**
 * @properties={typeid:24,uuid:"DACACAE7-2700-4748-8757-4C35D70652D0"}
 */
function isValidDatosPacienteInter() {

	var isValid = true;
	$messageErrorInter = '';

	if($_isUserOSTEE){
		 if(asiutitrs_hoja_numero_to_tbc_admision.adm_obrsoc != obraSocialOSTEE_OS){
			 $messageErrorInter += "\nEl paciente NO corresponde a OSTEE.";
			 isValid = false;
		 }
	 }
	var utiliza=asiutitrs_hoja_numero_to_tbc_admision.adm_utiliza
	if(utiliza!=2 && utiliza!=10 && utiliza!=12){
		 $messageErrorInter += "\nEl paciente no esta en T.I.";
		 isValid = false;
	}
		
	 if(!isValid){
		 globals.DIALOGS.showWarningDialog("Atención!", $messageErrorInter, "Aceptar")
	 }
	
	return isValid;
}

/**
 * TODO generated, please specify type and doc for the params
 * @param value
 *
 * @properties={typeid:24,uuid:"A4684F33-9DE9-4EEE-8B56-68E2F51E1219"}
 */
function editablePaciente(value) {
	elements.txt_paciente.editable = value;
	elements.btn_buscarPaciente.enabled = value;
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4A8B5DB3-EE90-4B9A-AC4A-E923F3FFC6BA"}
 * @AllowToRunInFind
 */
function onAction_btnNuevo(event) {
	plugins.scheduler.removeJob("desbloquear");
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_grabar.enabled=false;
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_imprimir.enabled=false;
	scopes.globals.InicializarDatosDeRelacion(asiutitrs_rel_tbc_hojati_to_tbc_hojati, "asistencial", "tbc_hojati")
	//solutionModel.getR
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=false;
	
	var limpiar = false;
	if ($isDirty) {
		var respuesta = globals.DIALOGS.showQuestionDialog('¡Atención!', 'Existen datos que no hay sido guardados. ¿Está seguro que desea continuar?', 'Si', 'No');
		if (respuesta == 'Si')
			limpiar = true;
	} else {
		limpiar = true;
	}

	if (limpiar) {
		
		if(globals.AsiUtiTrs_Hoja_recursoObtenido){
			globals.AsistFunciones_unLockRegisterTable(application.getSolutionName(),controller.getName(),asiutitrs_hoja_numero_to_tbc_admision.adm_histclin.toString(),globals.Srv_Login_Sanatorio_vLega.toString(),"Historia Clinica");
			globals.AsiUtiTrs_Hoja_recursoObtenido= false
		}
		limpiarForm();
	}
}

/**
 * @properties={typeid:24,uuid:"AEF53F0B-40A1-4A88-801E-C1B54D76656D"}
 */
function limpiarForm() {

	databaseManager.revertEditedRecords();
	

	
		/*forms.AsiUtiTrs_Ti_txt_Estudios_IC_Solicitados.f_informe=null;
		forms.AsiUtiTrs_Ti_txt_Semiologico_Sistema_Nervioso_Central.f_informe=null;*/

	
	
	
	

	inicializarForm();
	//forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=false;
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_cancelar.enabled=false;
	elements.txt_paciente.requestFocus();
	//elements.txt_paciente.requestFocus();
	$isDirty = false;

}

/**
 * @properties={typeid:24,uuid:"2048174E-189B-41E2-9307-7367825A41D9"}
 */
function inicializarForm() {

	f_histClinUnica = null;
	f_paciente = null;
	f_cobertura = null;
	f_protocolo = null;
	f_edad = null;
	f_sexo = null;
	f_cerrarForm = false;
	//f_medico = null;
	f_habita = null;
	f_cama = null;
	$_countChange = 1;
	$_wsele = false;
	$_wtrau = false;
	$_msgSMS = "";
	$_listNumberSMS = new Array();
	armChk = 0;
	f_informe_paciente = 'NO'
	f_aAquien = ''
	f_fecha_ingreso_ti = ''
	
	//capmos examen fisico 
	f_patologia1='';
	f_patologia2='';
	f_patologia3='';
	f_descripcion_patologia1 = '';
	f_descripcion_patologia2 = '';
	f_descripcion_patologia3 = '';
	
	f_altura='';
	f_peso='';
	f_pulso_frecuencia=0
	f_tension_arterial_max=0
	f_tension_arterial_min=0
	f_temperatura = 0
	f_cbo_tipo_temperatura = 0
	f_pulso_caracteristico ='';
	f_cbo_pulso_caract= '1';
		
	
	
	
	globals.AsiUtiTrs_Hoja_ViaEndCetral_Lugar = '';
	globals.AsiUtiTrs_Hoja_Cateter_Cook_Lugar = '';
	globals.AsiUtiTrs_Hoja_SondaVesical_Obs= '';
	globals.AsiUtiTrs_Hoja_SondaNG_Obs='';
	globals.AsiUtiTrs_Hoja_SondaSog_Obs='';
	globals.AsiUtiTrs_Hoja_SondaOtras_Obs='';
	globals.AsiUtiTrs_Hoja_Escaras_Obs='';

	
	globals.AsiUtiTrs_Nueva_Evol_Medica = false;
	f_IMC_resultado='';
	f_IMC = '';
	elements.lbl_procesando.visible = false;
	application.updateUI();

	// SEGUIR ADEMAS LIMPIAR LAS VARIABLES GLOBALES ANALIZAR CUALES.
	// TABS
	
	// LIMPIAR CAMPOS DE TEXTO TABS
	
	globals.modificarCampos('HciutiTrs_frm_evo_medica_utiTrs_hoja_TI', globals.setearEnModoLecturaCampos,null);
	
	var cantidad = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex();
	var nameTab="";
	for (var index = 1; index <= cantidad; index++) {
		nameTab= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(index);
		globals.AsiUtiTrs_Hoja_grupoTxt = index;
		if(nameTab!=null && nameTab!='' && forms[nameTab].f_informe!=undefined){
			forms[nameTab].f_informe = null;
		}
		/*else if(nameTab!=null && nameTab!='' && forms[nameTab].f_informe==undefined && forms[nameTab].elements.length>0){
			var nombreField = '';
			 var datoProveedorRelacionValor = '';
			for (var indice = 0; indice < forms[nameTab].elements.length; indice++) {
				 nombreField = forms[nameTab].elements[indice].getName();
				 if(nombreField.indexOf('txt')){
					 forms[nameTab].elements[nombreField]
					  datoProveedorRelacionValor = forms.AsiUtiTrs_Ti_Examen_Fisico.elements.txt_Cateter_Cook.getDataProviderID().split('.');
					  asiutitrs_rel_tbc_hojati_to_tbc_hojati[datoProveedorRelacionValor[1]] = '';
				 }
				 
				 else if(nombreField.indexOf('ckh')){
					 
				 }
			}
			
		}*/
	}
	
	var cantidad2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex();
	var nameTab2="";
	for (var index2 = 1; index2 <= cantidad2; index2++) {
		nameTab2= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(index2);
		globals.AsiUtiTrs_Hoja_grupoTxt = 6+index2;
		if(nameTab2!=null && nameTab2!=''){
			forms[nameTab2].f_informe = null;
		}
	}
	
	
	
	/*forms.AsiUtiTrs_Hoja_txt_abdominal.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_cardiovascular.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_examen_fisico.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_interconsulta.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_motivo_ingreso.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_neurológico.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_osteo_articular.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_respiratorio.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_tratamiento_ingreso.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_urogenital.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_otros.f_informe = null;
	forms.AsiUtiTrs_Hoja_txt_estudios_solicitados.f_informe = null;*/
	
	//forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.generarECG=false;
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$_wsele=false;
	//forms.AsiUtiTrs_Hoja_txt_neurológico.f_glassgow = '';
	//forms.AsiUtiTrs_Hoja_txt_neurológico.f_ppc='';
	
	
	globals.AsiUtiTrs_Hoja_hisclin = 0;
	globals.AsiUtiTrs_Hoja_hisclistrynro = '';
	globals.AsiUtiTrs_Hoja_hiiHisCli = 0;
	globals.AsiUtiTrs_Hoja_itemTxt = 0;
	globals.AsiUtiTrs_Hoja_obrCodigo = 0;
	globals.AsiUtiTrs_Hoja_patDataProvider = '';
	globals.AsiUtiTrs_Hoja_histClinAsist = 0;
	globals.AsiUtiTrs_Hoja_fechaHciint = 0;
	globals.AsiUtiTrs_Hoja_horaHciint = 0;
	globals.AsiUtiTrs_Hoja_servCodigo = 0;
	globals.AsiUtiTrs_Hoja_ipedPedido = 0;
	globals.AsiUtiTrs_Hoja_ipedServicio = 0;
	globals.AsiUtiTrs_Hoja_camCama = '';
	globals.AsiUtiTrs_Hoja_camHabita = 0;
	//globals.closeFechaIngresoTI=false;

	
	visibleBody(false);
	editablePaciente(true);
	elements.btn_VerFactoresValoracion.visible=false;
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_grabar.enabled=false;
}

/**
 * TODO generated, please specify type and doc for the params
 * @param value
 *
 * @properties={typeid:24,uuid:"365B661C-437B-48CF-A073-EBA651B8F250"}
 */
function visibleBody(value) {

	elements.tab_informe_1.visible = value;
	elements.tab_informe_2.visible = value;
	elements.shs_informe.visible = value;

	if (value) {
		elements.tab_informe_1.tabIndex = 1;
		elements.tab_informe_2.tabIndex = 1;
	}
	elements.grp_diagnostico.visible = value;
	elements.grp_signovitale.visible = value;
	elements.grp_solicitud.visible = value;
	elements.label_Examenes.visible = value;
	elements.chk_arm.visible=value;
	elements.grp_informePac.visible = value
}

/**
 * TODO generated, please specify type and doc for the params
 * @param {Boolean} value
 *
 * @properties={typeid:24,uuid:"2953680A-3EF5-4285-AEBF-B072D07BE3D5"}
 */
function editableSolicitudAutomatica(value){
	
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.grp_solicitud.enabled = value;
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4E8A1298-A2E8-4912-80EF-76AA68D658E6"}
 * @AllowToRunInFind
 */
function onAction_btnGuardar(event) {
	plugins.scheduler.removeJob("desbloquear");
/*	f_informe_paciente = plugins.dialogs.showQuestionDialog('INFORME AL FAMILIAR/PACIENTE','Informe al familiar y/o paciente','SI', 'NO');
	var aQuienInformar = ''
	if(f_informe_paciente=='SI'){
		f_aAquien = plugins.dialogs.showInputDialog('A Quien','Indique a quién')
		
	}else{
		f_aAquien = ' '
	}*/
	var res = globals.DIALOGS.showQuestionDialog('¡Atención!', '¿ Esta seguro que desea guardar la evolución Médica?', 'Si', 'No');
	if (res == 'Si') {

		if ($isDirty) {

			if (isValidDataForm()) {
				if (isValidData()) {
					
					var fecha = 0;
					var hora = 0;
					nuevoHciint = false;
					var resultSave = false
					try {
						
						if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha == 0) {
							
							nuevoHciint = true;
							
							fecha = utils.stringToNumber(globals.CapturaFechaSistema());
							hora = utils.stringToNumber(globals.CapturaHoraSistema("HHMM"));

							// Completando cabecera
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihistclinica= asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihistclinica2= asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha = fecha;
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora = hora;

							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha1 = fecha;
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora1 = hora;
							
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitipomed= globals.Srv_Login_Sanatorio_vTipoOperador;
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htilegajomed = globals.Srv_Login_Sanatorio_vLega;

							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha2 = fecha;
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora2 = hora;
							//DUDA htihistdescr APELYNOMB
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihistdescr  = utils.stringTrim(asiutitrs_hoja_numero_to_tbc_admision.adm_apelnom);
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihabi = asiutitrs_hoja_numero_to_tbc_admision.adm_habita;
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.hticama = asiutitrs_hoja_numero_to_tbc_admision.adm_cama;
						
							//habilitarECG();

						}
						else{
							fecha = utils.stringToNumber(globals.CapturaFechaSistema());
							hora = utils.stringToNumber(globals.CapturaHoraSistema("HHMM"));
							
						}
						
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htievolinmant = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Evolucion_Anterior.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiaparrespi = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Examen_Semiologico_Respiratorio.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiaparcircu = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Examen_Semiologico_Circulatorio.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiapardiges = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Examen_Semiologico_Digestivo.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisistnervi = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Semiologico_Sistema_Nervioso_Central.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotrosapar = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Examen_Semiologico_Otros.f_informe).length > 0 ? 1 : 0;
						//DUDA
						
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiestrecfec = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Estudios_Recibidos.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiestpendefec = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Estudios_Pendientes.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiestpendinf = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Pendientes_De_Informe.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiesticsolfec = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Estudios_IC_Solicitados.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitratind = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Tratamiento_Indicado.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiatb = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Antibioticos.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipresdiagact = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Presuncion_Orientacion_Diagnostica.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htimotsegint = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Motivo_Seguir_Internado.f_informe).length > 0 ? 1 : 0;
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotrosdatosint = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Otros_Datos_Interes.f_informe).length > 0 ? 1 : 0;
						
					
						// ESPECIALIDAD DIFERENTES CAMPOS DE DONDE REGISTRAR
						if(globals.Srv_Login_Sanatorio_vTipoOperador == 0){
							scopes.globals.AsiUtiTrs_Hoja_perLegajoPrint = scopes.globals.Srv_Login_Sanatorio_vLega
							if(asiutitrs_hoja_rel_buscar_personal_print.getSize()>0){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiespec = asiutitrs_hoja_rel_buscar_personal_print.per_espemed
							}
							
						}else{
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiespec = asiutitrs_hoja_vlegajo_to_tbc_medicos.med_espemed
						}
						
						if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc==1 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1.getSize()==0){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1=0;
							}
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2.getSize()==0){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos2=0;
							}
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_3.getSize()==0){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos3=0;
							}
							
						}else{
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1_segunda.getSize()==0){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1=0;
							}
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2_segunda.getSize()==0){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos2=0;
							}
							
						}
						
						
						// guardando sector. Si no es de T.I ..hace que se genera una evolucion completa con 3 diagnosticos.
						asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisector = asiutitrs_hoja_numero_to_tbc_admision.adm_utiliza
						//guardando examen fisico solo si es primer evolución del día o es la primera evolucion medica en hacerse.
						if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1 || globals.AsiUtiTrs_Primera_Evol_Medica_Dia ){
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitemper = f_temperatura;
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipulsofrec = f_pulso_frecuencia
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitensionmax= f_tension_arterial_max
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitensionmin = f_tension_arterial_min
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipulsocarac = f_pulso_caracteristico
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipeso = f_peso
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htialtura = f_altura
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitipotemp = f_cbo_tipo_temperatura
							/*if(f_informe_paciente=='SI'){
								if(utils.stringTrim(f_aAquien)==""){
									plugins.dialogs.showErrorDialog('NO INDICO A QUIEN','Si indica que si quiere informar el campo no puede ser vacio')
								}else{
									asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiaquien = f_aAquien
									asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiinffam = 1;
								}
					
							}else{
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiaquien = f_aAquien
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiinffam = 0;
							}*/
							
							
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiviav = forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_via_end_ctral
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.hticatc = forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_cateter_cook
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htivesical = forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_vesical
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.hting = forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_ng
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisog = forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_sog
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotras = forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_otras
							asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiescara = forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_escaras
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiviav==1){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiviavl = globals.AsiUtiTrs_Hoja_ViaEndCetral_Lugar
							}
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hticatc==1){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.hticatcl = globals.AsiUtiTrs_Hoja_Cateter_Cook_Lugar
							}
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htivesical==1){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htivesicalobs = globals.AsiUtiTrs_Hoja_SondaVesical_Obs
							}
							if(	asiutitrs_rel_tbc_hojati_to_tbc_hojati.hting ==1){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htingobs = globals.AsiUtiTrs_Hoja_SondaNG_Obs
							}
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisog==1){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisogobs = globals.AsiUtiTrs_Hoja_SondaSog_Obs
							}
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotras==1){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotrasobs =  globals.AsiUtiTrs_Hoja_SondaOtras_Obs
							}
							if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiescara ==1){
								asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiescaraobs = globals.AsiUtiTrs_Hoja_Escaras_Obs
							}
						
							
						}else{
							globals.AsiUtiTrs_Hoja_soloLectura=true;
						}
						databaseManager.startTransaction();
					resultSave = databaseManager.saveData(asiutitrs_rel_tbc_hojati_to_tbc_hojati.getRecord(1));	
						
					} catch (e) {
						plugins.dialogs.showInfoDialog("Error al procesar evolución médica. Avise a Sistemas, por favor!",e.toString(),"ok")
					}
					
					
					//scopes.globals.verValoresRelacion(asiutitrs_rel_tbc_hojati_to_tbc_hojati, "asistencial", "tbc_hojati")
					//habilitarECG();
					// Actualizando base de datos
					
					if(resultSave && nuevoHciint){
						
						globals.AsiUtiTrs_Hoja_hiiHisCli = asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
						globals.AsiUtiTrs_Hoja_fechaHciint = fecha;
						globals.AsiUtiTrs_Hoja_horaHciint = hora;
					}
					
					
					// Guardando informes
					var itemHistClin = asiutitrs_hoja_numero_to_tbc_admision.adm_histclin;
					var itemFecha = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha;
					var itemHora = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora;
//					var itemGrupo = 1;

					
					/*var cantTabs1 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex(); 
					var cantTabs2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex();
					var cantTabsTodos = cantTabs1 + cantTabs2;
					
					for (var idTab = 1; idTab <= cantTabsTodos; idTab++) {
						
						if(idTab>cantTabs1){
							
						}else{
							var nameTab= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(idTab);
							if(forms[nameTab].elements[0]!=undefined){
								//forms[nameTab].elements[0].requestFocus();
								if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.hittval_1 == 1 && resultSave)
							}
						}
					}
					forms.AsiUtiTrs_Ti_txt_Evolucion_Anterior.elements[0].getDesignTimeProperty('relacion')*/
					
					
					// TAB 1
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htievolinmant == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 1, forms.AsiUtiTrs_Ti_txt_Evolucion_Anterior.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiaparrespi == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 2, forms.AsiUtiTrs_Ti_txt_Examen_Semiologico_Respiratorio.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiaparcircu == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 3, forms.AsiUtiTrs_Ti_txt_Examen_Semiologico_Circulatorio.f_informe);

					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiapardiges == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 4, forms.AsiUtiTrs_Ti_txt_Examen_Semiologico_Digestivo.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisistnervi == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 5, forms.AsiUtiTrs_Ti_txt_Semiologico_Sistema_Nervioso_Central.f_informe);

					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotrosapar == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 6, forms.AsiUtiTrs_Ti_txt_Examen_Semiologico_Otros.f_informe);
					
					/*asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiestrecfec = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Estudios_Recibidos.f_informe).length > 0 ? 1 : 0;
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiestpendefec = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Estudios_Pendientes.f_informe).length > 0 ? 1 : 0;
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiestpendinf = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Pendientes_De_Informe.f_informe).length > 0 ? 1 : 0;
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiesticsolfec = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Estudios_IC_Solicitados.f_informe).length > 0 ? 1 : 0;
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitratind = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Tratamiento_Indicado.f_informe).length > 0 ? 1 : 0;
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiatb = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Antibioticos.f_informe).length > 0 ? 1 : 0;
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipresdiagact = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Presuncion_Orientacion_Diagnostica.f_informe).length > 0 ? 1 : 0;
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htimotsegint = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Motivo_Seguir_Internado.f_informe).length > 0 ? 1 : 0;
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotrosdatosint = utils.stringTrim(forms.AsiUtiTrs_Ti_txt_Otros_Datos_Interes.f_informe).length > 0 ? 1 : 0;
					*/
					
					// TAB 2
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiestrecfec == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 7, forms.AsiUtiTrs_Ti_txt_Estudios_Recibidos.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiestpendefec == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 8, forms.AsiUtiTrs_Ti_txt_Estudios_Pendientes.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiestpendinf == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 9, forms.AsiUtiTrs_Ti_txt_Pendientes_De_Informe.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitratind == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 10, forms.AsiUtiTrs_Ti_txt_Estudios_IC_Solicitados.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisistnervi == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 11, forms.AsiUtiTrs_Ti_txt_Tratamiento_Indicado.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiatb == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 12, forms.AsiUtiTrs_Ti_txt_Antibioticos.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipresdiagact == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 13, forms.AsiUtiTrs_Ti_txt_Presuncion_Orientacion_Diagnostica.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htimotsegint == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 14, forms.AsiUtiTrs_Ti_txt_Motivo_Seguir_Internado.f_informe);
					
					if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotrosdatosint == 1 && resultSave)
						resultSave = guardarTexto(itemHistClin, itemFecha, itemHora, 15, forms.AsiUtiTrs_Ti_txt_Otros_Datos_Interes.f_informe);
				
				
					
					
					if (resultSave == true) {
						databaseManager.commitTransaction();
							if(utils.stringToNumber(f_edad)<75){
								forms.AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion.elements.grp_factores_escaras.visible=false;
							}else{
								forms.AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion.elements.grp_factores_escaras.visible=true;
							}
							globals.ModoLecturaVisualizarFactoresYvaloracion=false;
							//Muestra Formulario Principal
						/*if(globals.AsiUtiTrs_Primera_Evol_Medica_Dia){
							
						}*/
						if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
							var winIngreso = application.createWindow("Ulceras_Presion",JSWindow.MODAL_DIALOG)	
						    winIngreso.title= 'Factores de Riesgo para el Desarrollo de Ulceras por Presion(ESCARAS)';
						    winIngreso.resizable = false	
						    winIngreso.setSize(580,700);
						    winIngreso.show(forms.AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion)	
						}
						    
							//win.destroy()
							
						globals.modificarCampos('AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion',globals.setearEnModoLecturaCampos,null);
						habilitarExamenFisico(false)
						habilitarTabs(false);
						
						globals.ModoLecturaVisualizarFactoresYvaloracion=true;
						
						forms.AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion.elements.btn_Confirmar_Factor_Valoracion.enabled=false;
						//databaseManager.commitTransaction();
						 globals.DIALOGS.showInfoDialog("Resultado", "La evolución Médica se guardo correctamente.", "Aceptar");

						editablePaciente(false);
						forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_imprimir.enabled=false;
					
						
						/* NO BORRAR */
						/* comentar FUNCIONALIDAD/MODULO ARM PROBLEMAS TABLAS EN PRODUCCION */
						if(globals.AsiUtiTrs_Primera_Evol_Medica_Dia || asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
							// ACC-ARM
							tratamientoARM();
							// Paciene en ARM : SI : 1
							
							if(armChk == 1 && globals.AsiArmTrs_Mod_wGraboARM){
							
								if(!$_wHayArm){
									
									grabarCodAuto();
								}else{
									asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiarm=1;
									asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiarmf = globals.AsiArmTrs_Mod_wFecha
									var guardoDataArm = databaseManager.saveData(asiutitrs_rel_tbc_hojati_to_tbc_hojati);
								}
							}
						}				
					
						forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_grabar.enabled=false;
						forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_cancelar.enabled=false;
						
						globals.AsiUtiTrs_Hoja_soloLectura=true;
						
						var print = globals.DIALOGS.showQuestionDialog('¡Atención!', '¿Desea imprimir la evolución Médica?', 'Si', 'No');
						if (print == 'Si') {
							imprimir(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihistclinica, asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha, asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora);
							var sql = "select htihojah from tbc_hojati where HtiHistClinica="+asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihistclinica +" order by htihojah desc";
							var dsQuery = databaseManager.getDataSetByQuery('asistencial',sql,null,-1);
							var cantidadHojasDesde = dsQuery.getValue(1,1)
							asiutitrs_hoja_rel_buscar_hojati_print.htiimprimio=1;
							asiutitrs_hoja_rel_buscar_hojati_print.htihojad = cantidadHojasDesde+1
							asiutitrs_hoja_rel_buscar_hojati_print.htihojah = cantidadHojasDesde + globals.AsiUtiTrs_Hoja_CantidadHojas
							databaseManager.saveData(asiutitrs_hoja_rel_buscar_hojati_print.getRecord(1));
						}
						
						var salir = plugins.dialogs.showErrorDialog("Salir de Evolución",'Desea salir de la evolución','SI', 'NO');
						$isDirty = false;
						if(salir=='SI'){
							onAction_btnNuevo()
						}

						$isDirty = false;
					} else {
						var error1 = ''
						var error2 = ''
						var array = databaseManager.getFailedRecords()
						for (var i = 0; i < array.length; i++) {
							var record = array[i];
							var jstable = databaseManager.getTable(record);
							var tableSQLName = jstable.getSQLName();
							error1 = 'Error de Grabación en Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
							error2 = 'Error en grabación ' + record.exception;
							if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
								// exception thrown in pre-insert/update/delete event method
								var thrown = record.exception.getValue()
								//plugins.dialogs.showErrorDialog("Error de grabación","Record validation failed: " + thrown)
							}
						}

						databaseManager.rollbackTransaction()

						if (error1 != '') {
							globals.DIALOGS.showErrorDialog("Error de grabación", "Record validation failed: " + thrown)
							globals.DIALOGS.showErrorDialog("Error en grabacion de Histórico", error1, "Aceptar")
							globals.DIALOGS.showErrorDialog("Error en grabacion de Histórico", error2, "Aceptar")
						}
						globals.DIALOGS.showErrorDialog("Error en grabación", "Se ha producido un error de grabación. " + '\n' + "Avise a Sistemas, por favor.", "Aceptar")
					}
				}
			}
		} else {
			globals.DIALOGS.showWarningDialog("Atención!", "No hay datos para guardar.", "Aceptar")
			elements.txt_paciente.requestFocus();
		}
	} else
		elements.txt_paciente.requestFocus();
}



/**
 * @properties={typeid:24,uuid:"67E76414-B042-457D-A341-53B1B8AED76F"}
 */
function tratamientoARM() {
	
	globals.AsiArmTrs_Mod_wGraboARM = false;
	$_wHayArm = false;
	var wHoraArm = 0;
	var wFecinArm = 0;
	

	
	// BUSCO-TIENE-ARM
	var sqlArm = "select ArmFecing,ArmHora,ArmFecegr from tbc_arm_dia_noinva"
			   + " where ArmHcli = " + asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin
			   + " order by ArmFech desc, ArmHora desc";
			   
	var dsArm = databaseManager.getDataSetByQuery('asistencial',sqlArm,null,-1);
	if(dsArm.getMaxRowIndex() > 0){
		
		$_wHayArm = true;
		if(dsArm.getValue(1,3) == 0){
		
			wFecinArm = dsArm.getValue(1,1);		
			wHoraArm = dsArm.getValue(1,2);
		}
	}
	
	globals.AsiArmTrs_Mod_wNumLega = globals.Srv_Login_Sanatorio_vLega;
	globals.AsiArmTrs_Mod_wTipLega = globals.Srv_Login_Sanatorio_vTipoOperador;
	
	// Existe ARM fecha ingreso?
	if(wFecinArm != 0){
		
		if(armChk == 0){
			
			// Paciente en ARM : NO : 1
			globals.DIALOGS.showInfoDialog("Resultado", "Paciente en ARM.\nDebe generar Informe y Dejar Respirador.", "Aceptar");
		}
		else{
			
			// Paciente en ARM : SI : 2
		}
		
		globals.AsiArmTrs_Mod_wHistClin = asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin;
		globals.AsiArmTrs_Mod_wFecha = utils.stringToNumber(globals.CapturaFechaSistema());
		globals.AsiArmTrs_Mod_wHora = wHoraArm; // aca hay un problema en cobol 
		openARM();
		
	}
	else{
		
		// Paciene en ARM : SI : 1
		if(armChk == 1){
			globals.AsiArmTrs_Mod_wHistClin = asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin;
			globals.AsiArmTrs_Mod_wFecha = utils.stringToNumber(globals.CapturaFechaSistema());
			globals.AsiArmTrs_Mod_wHora = utils.stringToNumber(globals.CapturaHoraSistema("HHMM"));
			
			openARM();
		}
	}	   
}

/**
 * TODO generated, please specify type and doc for the params
 * @param histClin
 * @param fecha
 * @param hora
 * @param grupo
 * @param texto
 *
 * @properties={typeid:24,uuid:"020CE226-AA61-4C85-B72D-4C6576FFB189"}
 */
function guardarTexto(histClin, fecha, hora, grupo, texto) {
	var guardoTexto=false
	globals.AsiUtiTrs_Hoja_hiiHisCli = histClin;
	globals.AsiUtiTrs_Hoja_fechaTxt = fecha;
	globals.AsiUtiTrs_Hoja_horaTxt = hora;
	globals.AsiUtiTrs_Hoja_grupoTxt = grupo;
	
	
	//globals.AsiUtiTrs_Hoja_itemTxt = item;
	if (asiutitrs_hoja_rel_buscar_hojatitxt.getSize() == 0) {

		asiutitrs_hoja_rel_buscar_hojatitxt.newRecord();
		asiutitrs_hoja_rel_buscar_hojatitxt.histclinica = histClin;
		asiutitrs_hoja_rel_buscar_hojatitxt.fecha = fecha;
		asiutitrs_hoja_rel_buscar_hojatitxt.hora = hora;
		asiutitrs_hoja_rel_buscar_hojatitxt.grupo = grupo;

	}

	asiutitrs_hoja_rel_buscar_hojatitxt.linea = utils.stringTrim(texto);
	try {
		guardoTexto = databaseManager.saveData(asiutitrs_hoja_rel_buscar_hojatitxt.getRecord(1));
	} catch (e) {
		plugins.dialogs.showInfoDialog("Error al procesar un informe. Avise a Sistemas, por favor!",e.toString(),"ok")
	}
	
	return guardoTexto

}

/**
 * @properties={typeid:24,uuid:"C2928AC2-941C-431E-9C2C-8F75D5F89B01"}
 */
function isValidDataForm() {

	
	isValidForm = true;
	messageError = "No ha sido posible guardar la solicitud. Corrija los siguientes errores y vuelva a intentar."
	
	
	

	/*
	if (globals.IsBlank(f_patologia1) || asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1<1) {
		messageError += "\nDebe ingresar al menos una patología.";
		isValidForm = false;
	}*/

	//  INICI VALIDADOR MASIVO GENERICO 
	validateRequired("HciutiTrs_frm_evo_medica_utiTrs_hoja_TI",false,'',false,0);
	
	var elementosTab1 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex()
	for (var index = 1; index <= elementosTab1; index++) {
		var nombreFormulario = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(index);
		validateRequired(nombreFormulario,true,'txt_area_',true,17);
		
	}
	var elementosTab2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex()
	for (var index2 = 1; index2 <= elementosTab2; index2++) {
		var nombreFormulario2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(index2);
		
		validateRequired(nombreFormulario2,true,'txt_area_',true,17);
	}
	// FIN  VALIDADOR MASIVO GENERICO 
	
	if (f_tension_arterial_min > f_tension_arterial_max) {
		messageError += "\n La Tension Arterial Mínima debe ser menor o igual a la Máxima.";
		isValidForm = false;
	}
	
	//Se valida solo primeras evolucion del dia o modificacion de evoluciones con marca primer dia o primera evolucion del paciente.
	
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
		
		if (forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_via_end_ctral==1){
			if(utils.stringTrim(globals.AsiUtiTrs_Hoja_ViaEndCetral_Lugar).length<1) {
					messageError += "\n El lugar de Via End. Ctral no puede estar vacio";
					isValidForm = false;
				}else{
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiviavl=globals.AsiUtiTrs_Hoja_ViaEndCetral_Lugar;
				}
		}

		
		if (forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_cateter_cook==1){
			if(utils.stringTrim(globals.AsiUtiTrs_Hoja_Cateter_Cook_Lugar).length<1) {
				messageError += "\n El lugar donde fue ubicado el Cateter Cook no puede estar vacio.";
				isValidForm = false;
			}else{
				asiutitrs_rel_tbc_hojati_to_tbc_hojati.hticatcl=globals.AsiUtiTrs_Hoja_Cateter_Cook_Lugar;
			}

		}
		
		
		if (forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_vesical==1){
			if(utils.stringTrim(globals.AsiUtiTrs_Hoja_SondaVesical_Obs).length<1) {
				messageError += "\n La Observación de la sonda Vesical no puede ser vacia";
				isValidForm = false;
			}else{
				asiutitrs_rel_tbc_hojati_to_tbc_hojati.htivesicalobs=globals.AsiUtiTrs_Hoja_SondaVesical_Obs
			}
		} 
		
		if (forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_ng==1){
			if(utils.stringTrim(globals.AsiUtiTrs_Hoja_SondaNG_Obs).length<1) {
				messageError += "\n La Observación de la sonda NG no puede ser vacia";
				isValidForm = false;
			}else{
				asiutitrs_rel_tbc_hojati_to_tbc_hojati.htingobs=globals.AsiUtiTrs_Hoja_SondaNG_Obs;
			}
		}
		

		
		
		if (forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_sog==1){
			if(utils.stringTrim(globals.AsiUtiTrs_Hoja_SondaSog_Obs).length<1) {
				messageError += "\n La Observación de la sonda SOG no puede ser vacia";
				isValidForm = false;
			}else{
				asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisogobs=globals.AsiUtiTrs_Hoja_SondaSog_Obs
			}
		}
		

		
		if (forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_otras==1){
			 if(utils.stringTrim(globals.AsiUtiTrs_Hoja_SondaOtras_Obs).length<1) {
					messageError += "\n La Observación de la sonda Otras no puede ser vacia";
					isValidForm = false;
				}else{
					asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotrasobs=globals.AsiUtiTrs_Hoja_SondaOtras_Obs
				}
		}
		
		if (forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_escaras==1){
			if(utils.stringTrim(globals.AsiUtiTrs_Hoja_Escaras_Obs).length<1) {
				messageError += "\n La Observación de escaras no puede ser vacia";
				isValidForm = false;
			}else{
				asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiescaraobs=globals.AsiUtiTrs_Hoja_Escaras_Obs
			}
		} 
		
	}

	
	
	//validacion de campos obligatorios dentro de cada tab
	
	
	/*if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.hitresver< 1) {
		messageError += "\nDebe ingresar: Respuesta Verbal.";
		isValidForm = false;
	}

	if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.hitresocu<1) {
		messageError += "\nDebe ingresar: Respuesta Ocular.";
		isValidForm = false;
	}

	if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.hitresmot<1) {
		messageError += "\nDebe ingresar: Respuesta Motora";
		isValidForm = false;
	}*/
	
	/*if(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.generarECG==false){
		var seguroECG= globals.DIALOGS.showQuestionDialog("Generación ECG","¿Esta Seguro que no quiere Generar ECG?","SI","NO ESTOY SEGURO");
		if(seguroECG=="NO ESTOY SEGURO"){
			messageError += "\nChequeé la opción ECG para generarla";
			isValidForm = false;
		}
	}*/

	
	/*////////// INICIO VALIDADOR ////////////////////*/
	
	/*////////// FIN VALIDADOR ////////////////////*/
	
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc==1 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
		validarPatologia(f_patologia1,'htidiagnos1');
		validarPatologia(f_patologia2,'htidiagnos2');
		validarPatologia(f_patologia3,'htidiagnos3');
	}else if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
		validarPatologia(f_patologia1,'htidiagevo1');
		validarPatologia(f_patologia2,'htidiagevo2');
	}
	/*validarPatologia(f_patologia1,'htidiagnos1');
	validarPatologia(f_patologia2,'htidiagnos2');
	validarPatologia(f_patologia3,'htidiagnos3');*/
	
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc==1 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
		if (globals.IsBlank(f_patologia1) || asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1<1) {
			messageError += "\nDebe ingresar al menos una patología.";
			isValidForm = false;
		}
	}
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc==0){
		if (globals.IsBlank(f_patologia1) || asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagevo1<1) {
			messageError += "\nDebe ingresar al menos una patología.";
			isValidForm = false;
		}
	}
	
	
	//bloqueado hasta solucionar tablas de ARM en Relativity del sc3
	if (isValidForm) {
		
		if(armChk == 0){
			
			//elements.txt_paciente.border = borderError;
			messageError += "\nDebe seleccionar paciente en ARM.";
			isValidForm = false;
			elements.chk_arm.requestFocus()
		}
	}
	
	if (!isValidForm) {
		globals.DIALOGS.showWarningDialog("¡Atención!", messageError, "Aceptar")
		return isValidForm;
	}
	
	return isValidForm;
}

/**
 * @properties={typeid:24,uuid:"3533CFC4-5CDC-40C3-97AC-EB56A53514F4"}
 * @SuppressWarnings(unused)
 */
function isValidData() {

	var isValid = true;
	var messageError = "No ha sido posible guardar la solicitud. Corrija los siguientes errores y vuelva a intentar."
		//var borderError = 'LineBorder,1,#ff0000';
		//setDefaultBorderElements();
		/*
	 if(isValid){

	 if(f_protocolo == null){

	 var res = globals.DIALOGS.showQuestionDialog('¡Atención!','¿ Desea Guardar Ingreso de Historia Clinica de Cirugia sin Protocolo ?', 'Si', 'No');
	 if( res == 'Si'){
	 }
	 else{

	 messageError += "\nHistoria Clinica de Cirugia sin Protocolo."
	 isValid = false;
	 }
	 }
	 }
	 else{
	 globals.DIALOGS.showWarningDialog("Atención!",messageError,"Aceptar")
	 elements.txt_paciente.requestFocus();
	 }
	 */
	return isValid;

}



/**
 * TODO generated, please specify type and doc for the params
 * @param formName
 * @param validarSinPropertys
 * @param patron
 * @param validarCantCaracteres
 * @param minCaracteres
 *
 * @properties={typeid:24,uuid:"5D245DE8-7098-4352-BF0B-0148F51DCCDD"}
 */
function validateRequired(formName, validarSinPropertys, patron, validarCantCaracteres, minCaracteres) {
    var ok = true;
    var textReplace=(patron!=null && !globals.IsBlank(patron))?patron:'txt_';
    var flds = forms[formName].elements;
    for (var item in flds) {
        var elm = flds[item];
        var propEncontrada = elm.getDesignTimeProperty('requerido');
        var name= elm.getName();
        //application.output(name); ver campos que se validan
        if(patron!=null && !globals.IsBlank(patron)){
        	if(name.indexOf(patron)==-1 && propEncontrada==undefined){ //si propEncontra no es nula hay que validar igual o no.
        		continue;
        	}
        }
        if (name!=null && name.indexOf("grp")==-1 && propEncontrada==true || validarSinPropertys &&  propEncontrada==undefined) {//si tiene propertys hay que validar
            var dp = elm.getDataProviderID() //obtenemos variable asociada
            //if (!forms[formName].foundset.getSegetSelectedRecord()[dp]) { //esto se usaba para obtener el recurso.
            var arrRelacion = dp.split(".");
            if (dp.indexOf("rel")>0 &&!globals[arrRelacion[0]][arrRelacion[1]]>=1) {
               // forms[formName].elements[name].bgcolor = "#ffbc78";
                isValidForm = false;
                if(propEncontrada && name.indexOf(textReplace)==-1){
        			messageError += "\nDebe ingresar: " + forms[formName].elements[name].getName().replace('txt_','').replace(/\_/g,' ');
        		}else{
        			messageError += "\nDebe ingresar: " + forms[formName].elements[name].getName().replace(textReplace,'').replace(/\_/g,' ');
        		}
        		if(validarCantCaracteres && propEncontrada==undefined){
        			messageError+=' Con '+ minCaracteres +' caracteres como mínimo.';
        		}
            	
            }else if(dp.indexOf("rel")==-1 && dp.indexOf("cbo")==-1){
            	if((validarCantCaracteres && forms[formName][dp]!=null && forms[formName][dp].length<minCaracteres) || ""==utils.stringTrim(forms[formName][dp]) ){
            		
            		  //forms[formName].elements[name].bgcolor = "#ffbc78";
            		isValidForm = false;
            		if(propEncontrada && name.indexOf(textReplace)==-1){
            			messageError += "\nDebe ingresar: " + forms[formName].elements[name].getName().replace('txt_','').replace(/\_/g,' ');
            		}else{
            			messageError += "\nDebe ingresar: " + forms[formName].elements[name].getName().replace(textReplace,'').replace(/\_/g,' ');
            		}
            		
            		
            		if(validarCantCaracteres && propEncontrada==undefined){
            			messageError+=' Con '+ minCaracteres +' caracteres como mínimo.';
            		}
            	}else{
            		// forms[formName].elements[name].bgcolor = "#d4e8d4";
            	}
            }else if(dp.indexOf("cbo")!=-1){
               	if((validarCantCaracteres && forms[formName][dp]!=null && forms[formName][dp]<minCaracteres) ||  ""==utils.stringTrim(forms[formName][dp]) ){
            		
          		  //forms[formName].elements[name].bgcolor = "#ffbc78";
          		isValidForm = false;
          		if(propEncontrada && name.indexOf(textReplace)==-1){
          			messageError += "\nDebe ingresar: " + forms[formName].elements[name].getName().replace('txt_','').replace(/\_/g,' ');
          		}else{
          			messageError += "\nDebe ingresar: " + forms[formName].elements[name].getName().replace(textReplace,'').replace(/\_/g,' ');
          		}
          		
          		
          		if(validarCantCaracteres && propEncontrada==undefined){
          			messageError+=' Con '+ minCaracteres +' caracteres como mínimo.';
          		}
          	}else{
          		// forms[formName].elements[name].bgcolor = "#d4e8d4";
          	}
            }
            
            else {
                //forms[formName].elements[name].bgcolor = "#d4e8d4";
            }
            propEncontrada=false;
        }
    }
    
	
	
    
    
    return ok;
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"A33682BA-C961-4C8E-B489-3D3BD4BC7DDB"}
 */
function onAction_btnCerrar(event) {
	plugins.scheduler.removeJob("desbloquear")
	if ($isDirty) {
		if (globals.DIALOGS.showQuestionDialog('¡Atención!', 'Existen datos que no hay sido guardados. ¿Está seguro que desea continuar?', 'Si', 'No') == 'Si')
			f_cerrarForm = true;
	} else {
		f_cerrarForm = true;
	}

	if (f_cerrarForm) {
		/*plugins.Log.debugLevel = 'INFO';
		plugins.Log.logFilePath =  plugins.file.getDefaultUploadLocation()+'\\bloqueos.log';
		plugins.Log.outputPattern = '%s %p %d{HH:mm:ss.S}: %m%n';
		
		plugins.Log.info('DESBLOQUEO: ' + application.getSolutionName()+','+controller.getName()+','+ asiutitrs_hoja_numero_to_tbc_admision.adm_histclin.toString()+','+globals.Srv_Login_Sanatorio_vLega.toString()+','+ "Historia Clinica" + "IP: "+application.getIPAddress());
		*/
		if(globals.AsiUtiTrs_Hoja_recursoObtenido){
			globals.AsistFunciones_unLockRegisterTable(application.getSolutionName(),controller.getName(),asiutitrs_hoja_numero_to_tbc_admision.adm_histclin.toString(),globals.Srv_Login_Sanatorio_vLega.toString(),"Historia Clinica");		
			globals.AsiUtiTrs_Hoja_recursoObtenido = false;
		}
		
		
		var $win = application.getWindow(application.getActiveWindow().getName());
		if ($win != null) {
			$win.hide();
			$win.destroy();
		}
	}
}

/**
 * Handle hide window.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"8C22014D-750A-46B9-87CE-1EFF336F2FE0"}
 */
function onHide_cerrarForm(event) {
	if(!f_cerrarForm)
		globals.DIALOGS.showInfoDialog("Atención","Para cerrar el programa debe presionar el boton Salir.","Aceptar")
	return f_cerrarForm;
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"F254B748-54A0-4D35-BA7D-F8D2C9E45DF6"}
 */
function onAction_buscarPatologia_1(event) {
	f_patologia = f_patologia1;
	if(globals.AsiUtiTrs_Primera_Evol_Medica_Dia){
		globals.AsiUtiTrs_Hoja_patDataProvider = 'htidiagnos1';
	}else{
		
		globals.AsiUtiTrs_Hoja_patDataProvider = 'htidiagevo1';
	}

	openBuscarPatologia();
}

/**
 * @properties={typeid:24,uuid:"F01EA3D8-F1C1-40EA-AB37-F46F3CF4E4C0"}
 */
function openBuscarPatologia() {
	//globals.AsiUtiTrs_Hoja_ultimaHisCli==true &&
	if(globals.AsiUtiTrs_Hoja_examen_fisicio_habilitado){
		var win2 = application.createWindow("seleccion_patologia", JSWindow.MODAL_DIALOG);
		win2.title = 'Búsqueda de Diagnóstico';
		win2.resizable = false;
		win2.show(forms.asiutitrs_hoja_dlg_buscar_patologia);
	}

}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"C2A2099B-C07C-4914-9EAA-579C8894ACD5"}
 */
function onAction_buscarPatologia_2(event) {
	f_patologia = f_patologia2;
	if(globals.AsiUtiTrs_Primera_Evol_Medica_Dia){
		globals.AsiUtiTrs_Hoja_patDataProvider = 'htidiagnos2';  
		if(!globals.IsBlank(f_patologia1) && f_patologia1!=0)
			openBuscarPatologia();
	}else{
		globals.AsiUtiTrs_Hoja_patDataProvider = 'htidiagevo2'; 
		if(!globals.IsBlank(f_patologia1) && f_patologia1!=0)
			openBuscarPatologia();
	}

	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"1F1756FD-C235-4C3B-98ED-D2B3BBE665DD"}
 */
function onAction_buscarPatologia_3(event) {
	f_patologia = f_patologia3;
	if(globals.AsiUtiTrs_Primera_Evol_Medica_Dia){
	globals.AsiUtiTrs_Hoja_patDataProvider = 'htidiagnos3';
	if(!globals.IsBlank(f_patologia2) && f_patologia2!=0 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2.getSize() && asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1.getSize()>0)
		openBuscarPatologia();
	}else{
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=false;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.enabled=false;
	}
}


/**
 * TODO generated, please specify type and doc for the params
 * @param {Date} Fecha_Desde
 * @param {Date} Fecha_Hasta
 *
 * @properties={typeid:24,uuid:"03A98A58-A7A8-4EDC-B540-A751582D23FA"}
 */
function contar_dias(Fecha_Desde, Fecha_Hasta) {
	// El hasta dede ser mayor al desde
	var $contar = 0;

	var $x = Fecha_Hasta - Fecha_Desde//diferencias entre dos dias y lo muestra en milisegundos
	var $un_dia = 1000 * 60 * 60 * 24 //ms * sec * min * hrs de un día
	var $dif_dias = $x / $un_dia //calcula la diferencia en días
		//$contar = Math.ceil($dif_dias )   //redondea
	//$contar = Math.round($dif_dias)
	$contar = Math.floor($dif_dias) //redondea

	return $contar
}

/**
 * TODO generated, please specify type and doc for the params
 * @param {Number} realValue
 *
 * @properties={typeid:24,uuid:"42248D89-26AA-47D2-BC6D-26F2E103AAFC"}
 */
function convertNumberToHour_HHMM(realValue) {

	var hora = "";
	if (realValue != null) {
		var value = realValue;
		if (value < 1) {
			hora = "00:00";
		} else {
			if (value < 10) {
				hora = "00:0" + value.toString().substr(0, 1);
			} else {
				if (value < 100) {
					hora = "00:" + value.toString().substr(0, 2);
				} else {
					if (value < 1000) {
						hora = "0" + value.toString().substr(0, 1) + ":" + value.toString().substr(1, 2);
					} else {
						if (value <= 2359) {
							hora = value.toString().substr(0, 2) + ":" + value.toString().substr(2, 2);
						}
					}
				}
			}
		}
	}

	return hora;
}

/**
 * Callback method when the user changes tab in a tab panel or divider position in split pane.
 *
 * @param {Number} previousIndex index of tab shown before the change
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"C3CCF6CE-FB92-4A00-B6FE-6724099E7165"}
 */
function onTabChange_informe_1(previousIndex, event) {

	//if($_countChange == 1)
	//validarInforme(previousIndex,elements.tab_informe_1.getName(),elements.tab_informe_1.getTabFormNameAt(previousIndex),elements.tab_informe_1.getTabTextAt(previousIndex));
	elements.tab_informe_1.setTabFGColorAt(previousIndex, '#000000');
	elements.tab_informe_1.setTabFGColorAt(elements.tab_informe_1.tabIndex, '#3336ff');
	var current = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.tabIndex;
	
	var nameTab= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(current);
	if(forms[nameTab].elements[0]!=undefined && nameTab!='AsiUtiTrs_Ti_Examen_Fisico'){
		forms[nameTab].elements[0].requestFocus();
	}
	
	
	
	
	/*if(elements.tab_informe_1.tabIndex == 1)
		forms.AsiUtiTrs_Hoja_txt_motivo_ingreso.elements.t.reque
	
	if(elements.tab_informe_1.tabIndex == 2)
		forms.AsiUtiTrs_Hoja_txt_examen_fisico.elements.txt_area_Examen_Fisico.requestFocus();
	
	if(elements.tab_informe_1.tabIndex == 3)
		forms.AsiUtiTrs_Hoja_txt_neurológico.elements.txt_area_Neurológico.requestFocus();
	
	if(elements.tab_informe_1.tabIndex == 4)
		forms.AsiUtiTrs_Hoja_txt_cardiovascular.elements.txt_area_Cardiovascular.requestFocus();
	
	if(elements.tab_informe_1.tabIndex == 5)
		forms.AsiUtiTrs_Hoja_txt_respiratorio.elements.txt_area_Respiratorio.requestFocus();
	
	if(elements.tab_informe_1.tabIndex == 6)
		forms.AsiUtiTrs_Hoja_txt_abdominal.elements.txt_area_Abdominal.requestFocus();*/

}

/**
 * TODO generated, please specify type and doc for the params
 * @param {Number} previousIndex
 * @param {String} tabName
 * @param {String} formName
 * @param {String} title
 *
 * @properties={typeid:24,uuid:"6B257C57-5D02-4857-B92B-656A35ED0334"}
 */
function validarInforme(previousIndex, tabName, formName, title) {

	if (previousIndex != 3) {

		var isValid = true;
		if (utils.stringTrim(forms[formName].f_informe).length < 18)
			isValid = false;

		if (!isValid) {

			// Para evitar la recursividad
			$_countChange = 0;
			elements[tabName].tabIndex = previousIndex;

			var messageError = "";
			messageError += "Informe : " + title;
			messageError += "\n\n Dr.";
			messageError += "\nPor favor explayese algo mas."
			messageError += "\nResulta Indispensable, con el fin de evitar inconvenientes";
			messageError += "\nlegales, NO utilizar Abreviaturas."

			globals.DIALOGS.showWarningDialog("¡Atención!", messageError, "Aceptar");
			//forms[formName].controller.focusFirstField()
			$_countChange = 1;

		} else {
			//forms[formName].controller.focusFirstField();
			elements[tabName].setTabFGColorAt(previousIndex, '#000000');
			elements[tabName].setTabFGColorAt(elements[tabName].tabIndex, '#3336ff');

			$_countChange = 1;
		}
	} else {
		elements[tabName].setTabFGColorAt(previousIndex, '#000000');
		elements[tabName].setTabFGColorAt(elements[tabName].tabIndex, '#3336ff');
	}
}

/**
 * Callback method when the user changes tab in a tab panel or divider position in split pane.
 *
 * @param {Number} previousIndex index of tab shown before the change
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D9390EB4-BD6B-4A2C-A658-10EFF4BE2413"}
 */
function onTabChange_informe_2(previousIndex, event) {

	//if($_countChange == 1)
	//validarInforme(previousIndex,elements.tab_informe_2.getName(),elements.tab_informe_2.getTabFormNameAt(previousIndex),elements.tab_informe_2.getTabTextAt(previousIndex));

	elements.tab_informe_2.setTabFGColorAt(previousIndex, '#000000');
	elements.tab_informe_2.setTabFGColorAt(elements.tab_informe_2.tabIndex, '#3336ff');
	
	var current2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.tabIndex;
	
	var nameTab2= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(current2);
	forms[nameTab2].elements[0].requestFocus();
	
}



/**
 * TODO generated, please specify type and doc for the params
 * @param histClin
 * @param fecha
 * @param hora
 *
 * @properties={typeid:24,uuid:"C55D2296-1579-4659-B53C-F8595D7EE737"}
 */
function imprimir(histClin, fecha, hora) {
	
	
	f_informe_paciente = plugins.dialogs.showQuestionDialog('INFORME AL FAMILIAR/PACIENTE','Informe al familiar y/o paciente','SI', 'NO');
	var aQuienInformar = ''
	if(f_informe_paciente=='SI'){
		f_aAquien = plugins.dialogs.showInputDialog('A Quien','Indique a quién')
		
	}else{
		f_aAquien = ' '
	}
	
	if(f_informe_paciente=='SI'){
		if(utils.stringTrim(f_aAquien)==""){
			plugins.dialogs.showErrorDialog('NO INDICO A QUIEN','Si indica que si quiere informar el campo no puede ser vacio')
		}else{
			asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiaquien = f_aAquien
			asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiinffam = 1;
		}

	}else{
		asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiaquien = f_aAquien
		asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiinffam = 0;
	}
	
	
	
	if(asiutitrs_hoja_buscar_tbc_impresos.getSize()>0){//hay evoluciones anteriores sin imprimir en ese dia.
		plugins.dialogs.showWarningDialog('Hojas sin Imprimir','Hay hojas de hoy sin imprimir, anterior a esta evolución','OK');
		return false;
	}
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiimprimio==1){
		var confirma_reimprimir = plugins.dialogs.showQuestionDialog('Evolución Impresa','Está hoja ya fue impresa anteriormente. ¿esta seguro de volver a imprimirla?','SI', 'NO');
		if("SI"!=confirma_reimprimir){
			return false;
		}
		//plugins.dialogs.showWarningDialog('Evolución Impresa','La evolución ya ha sido impresa','OK');
		
	}
	
	forms.AsiUtiTrs_Evolucion_print.imprimirAsiUtiTrs(histClin, fecha, hora)
	//forms.AsiUtiTrs_Hoja_print.controller.setPageFormat(210,297,10,10,10,10,1,0);
	//forms.AsiUtiTrs_Hoja_print.controller.print(false,false);
	/*
	 var win = application.createWindow("impri_paciente",JSWindow.MODAL_DIALOG);
	 win.title = "Impresion de Hitória Clínica";
	 win.resizable = false;
	 win.show(forms.AsiUtiTrs_Hoja_print)
	 */
	return true
}

/**
 * Handle changed data.
 *
 * @param {Number} oldValue old value
 * @param {Number} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"77589D24-02DB-45F5-A859-02B96F7F39E6"}
 */
function onDataChange_txtField(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc==1 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
		validarPatologia(f_patologia1,'htidiagnos1');
	}else{
		validarPatologia(f_patologia1,'htidiagevo1');
	}

	/*if(f_patologia1==null || globals.IsBlank(f_patologia1)){
		f_patologia1=0;
	}
	if(f_patologia1!=0 && (!isNaN(f_patologia1) && utils.stringToNumber(f_patologia1)>2147483647)){
		plugins.dialogs.showInfoDialog("Valor Diagnostico","valor no valido","ok")
		return;
	}
	if(!globals.IsBlank(f_patologia1) && !isNaN(f_patologia1)){
		asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1=f_patologia1;
	}else{
		asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1=0;
	}
	$isDirty = true;

	return true*/
}

/**
 * TODO generated, please specify type and doc for the params
 * @param oldValue
 * @param newValue
 * @param event
 *
 * @properties={typeid:24,uuid:"AAFD1086-BB83-436B-A92A-CFB8485863E5"}
 */
function onDataChange_txtField2(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc==1 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
		validarPatologia(f_patologia2,'htidiagnos2');
	}else{
		validarPatologia(f_patologia2,'htidiagevo2');
	}

	/*if(f_patologia2==null || globals.IsBlank(f_patologia2)){
		f_patologia2=0;
	}
	if(f_patologia2!=0  && (!isNaN(f_patologia2) && utils.stringToNumber(f_patologia2)>2147483647)){
		plugins.dialogs.showInfoDialog("Valor Diagnostico","valor no valido","ok")
		return;
	}
	if(!globals.IsBlank(f_patologia2) && !isNaN(f_patologia2)){
		asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos2=f_patologia2;
	}else{
		asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos2=0;
	}
		
		$isDirty = true;

	
	return true*/
}

/**
 * TODO generated, please specify type and doc for the params
 * @param oldValue
 * @param newValue
 * @param event
 *
 * @properties={typeid:24,uuid:"0CC8AA08-66E8-46C0-AB5D-3B03E463FF0A"}
 */
function onDataChange_txtField3(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc==1 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
		validarPatologia(f_patologia3,'htidiagnos3');
	}
	
	/*if(f_patologia3==null || globals.IsBlank(f_patologia3)){
		f_patologia3=0;
	}
	if(f_patologia3!=0  && (!isNaN(f_patologia3) && utils.stringToNumber(f_patologia3)>2147483647)){
		plugins.dialogs.showInfoDialog("Valor Diagnostico","valor no valido","ok")
		return;
	}

	if(!globals.IsBlank(f_patologia3) && !isNaN(f_patologia3)){
		asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos3=f_patologia3;
	}else{
		asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos3=0;
	}
		
		$isDirty = true;

	
	return true*/
}

/**
 * TODO generated, please specify type and doc for the params
 * @param patologia
 * @param secPatologia
 *
 * @properties={typeid:24,uuid:"683922DA-6429-4827-AD92-00071A6C531D"}
 * @AllowToRunInFind
 */
function validarPatologia(patologia, secPatologia){ //htidiagnos1, htidiagnos2, htidiagnos3
	
	if(patologia==null || globals.IsBlank(patologia)){
		patologia="";
	}
	if(patologia!=0  && (!isNaN(patologia) && utils.stringToNumber(patologia)>2147483647)){
		plugins.dialogs.showInfoDialog("Valor Diagnostico","valor no valido","ok")
		return;
	}
	// si es codigo
	if(!globals.IsBlank(patologia) && !isNaN(patologia)){
		switch (secPatologia) {
		case 'htidiagnos1':
			asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1.pat_codi=patologia;
			asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=patologia;
			f_descripcion_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1.pat_descrip
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=true;
			if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1.getSize()==0){
				asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=0;
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=false;
			}
			break;
		case 'htidiagnos2':
			asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2.pat_codi=patologia;
			asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=patologia;
			f_descripcion_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2.pat_descrip
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=true;
			if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2.getSize()==0){
				asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=0;
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=false;
			}
			break;
		case 'htidiagnos3':
			asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_3.pat_codi=patologia;
			asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=patologia;
			f_descripcion_patologia3=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_3.pat_descrip
			if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_3.getSize()==0){
				asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=0;
			}
			break
			
		case 'htidiagevo1':
			asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1.pat_codi=patologia;
			asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=patologia;
			f_descripcion_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1_segunda.pat_descrip
			if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1_segunda.getSize()==0){
				asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=0;
			}else{
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=true;
			}
			break
		
		case 'htidiagevo2':
			asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2.pat_codi=patologia;
			asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=patologia;
			f_descripcion_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2_segunda.pat_descrip
			if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2_segunda.getSize()==0){
				asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=0;
			}
			break
		
		default:
			break;
		}
		
		//asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1.pat_codi=patologia;
		
	}
	else{//si es texto
		if(!globals.IsBlank(patologia)){
			f_pendienteDeSeleccion=true;
		}else{
			asiutitrs_rel_tbc_hojati_to_tbc_hojati[secPatologia]=0;
			switch (secPatologia) {
			case 'htidiagnos1':
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=false;
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=false;
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2="";
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia3="";
				break;
			case 'htidiagnos2':
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=false;
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia3="";
				break;
				
			default:
				break;
			}
		}
		/*var textoPatologia = patologia.toLocaleUpperCase();
		
		if(textoPatologia){
			forms.AsiUtiTrs_Hoja_tbl_patologia_alfa.foundset.find();
		    forms.AsiUtiTrs_Hoja_tbl_patologia_alfa.foundset.pat_descrip = '>=' + valorIngresado;
		    forms.AsiUtiTrs_Hoja_tbl_patologia_alfa.foundset.search();
		}
		asiutitrs_rel_tbc_hojati_to_tbc_hojati[globals.AsiUtiTrs_Hoja_patDataProvider] = foundset.pat_codi;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;*/
		
	}
		
		$isDirty = true;
	
	//return true
	
}

/**
 * Handle changed data.
 *
 * @param {Number} oldValue old value
 * @param {Number} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"D6ECCAD7-54DF-46B4-B5AB-F9ACBB5AC1A0"}
 */
function onDataChange_cboSelect(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	$isDirty = true;
	elements.txt_temperatura.requestFocus();
	return true
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"1C518720-2B4C-4844-A71B-EAC78B1E45D7"}
 */
function onAction_imprimir(event) {
	
	if (asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha > 0) {
		
		if(!$isDirty){
			var respuesta = globals.DIALOGS.showQuestionDialog('¡Atención!', '¿Esta seguro que desea imprimir?', 'Si', 'No');
			if (respuesta == 'Si') {
				imprimir(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihistclinica,asiutitrs_rel_tbc_hojati_to_tbc_hojati.htifecha,asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora);
				var sql = "select htihojah from tbc_hojati where HtiHistClinica="+asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihistclinica +" order by htihojah desc";
				var dsQuery = databaseManager.getDataSetByQuery('asistencial',sql,null,-1);
				var cantidadHojasDesde = dsQuery.getValue(1,1)
				
				asiutitrs_hoja_rel_buscar_hojati_print.htiimprimio=1;
				asiutitrs_hoja_rel_buscar_hojati_print.htihojad = cantidadHojasDesde+1
				asiutitrs_hoja_rel_buscar_hojati_print.htihojah = cantidadHojasDesde + globals.AsiUtiTrs_Hoja_CantidadHojas
				databaseManager.saveData(asiutitrs_hoja_rel_buscar_hojati_print.getRecord(1));
				
			
				
				
			}
		}
		else
			globals.DIALOGS.showInfoDialog("Atención", "No ha sido posible imprimir. Existen modificaciones pendientes para guardar.", "Aceptar")
	} else
		globals.DIALOGS.showWarningDialog("Atención!", "No existe una hitória clínica de ingreso para imprimir.", "Aceptar");
}


/**
 * TODO generated, please specify type and doc for the params
 * @param {String} serverName
 * @param {String} tableName
 * @param {String} columnName
 * @param {String} primaryKey
 * @param {Number} keyValue
 *
 * @properties={typeid:24,uuid:"A8A04386-4939-401A-9314-472EB761AA8B"}
 */
function obtenerNumerador (serverName,tableName,columnName,primaryKey,keyValue) {
	
	var numero = 0;
	
	var msg = '';
	var msgEn = '';
	
	var sql = "begin; lock table " + tableName + " in row exclusive mode;";
    var done = plugins.rawSQL.executeSQL(serverName,tableName,sql);
	if (done) {
		
		// Lock de registros
		sql = "select * from " + tableName + " where " + primaryKey + " = " + keyValue + " for update;";
		done = plugins.rawSQL.executeSQL(serverName,tableName,sql);
		if (done) {
			
			sql = "SELECT " + columnName + " FROM " + tableName + " WHERE " + primaryKey + " = " + keyValue;
			var vDataset = databaseManager.getDataSetByQuery(serverName, sql, null, 1);
			
			if(vDataset.getMaxRowIndex() > 0){
				
				sql = "update " + tableName + " set " + columnName + " = " + columnName + " + 1 where " + primaryKey + " = " + keyValue + "; commit;";
				done = plugins.rawSQL.executeSQL(serverName, tableName, sql);
				if(done){
					
					numero = vDataset.getValue(1,1) + 1;
				}
				else{
					
					plugins.rawSQL.executeSQL(serverName, tableName, "end;");
					globals.DIALOGS.showWarningDialog("¡Atencion!", "No ha sido posible actualizar el numerador : \n" + msgEn, "Aceptar");
				}
			}
			else{
				
				plugins.rawSQL.executeSQL(serverName, tableName, "end;");
				globals.DIALOGS.showWarningDialog("¡Atencion!", "No existe el numerador : \n" + msgEn, "Aceptar");
			}
		}
		else{
			
			plugins.rawSQL.executeSQL(serverName, tableName, "end;");
			globals.DIALOGS.showWarningDialog("¡Atencion!", "Error al consultar tabla de numerador :\n" + msgEn + "Error en Select for update" , 'Aceptar');
		}
	}
	else{
		
		msg = plugins.rawSQL.getException().getMessage(); //see exception node for more info about the exception obj
		globals.DIALOGS.showWarningDialog("¡Atencion!", "Error al consultar tabla de numerador :\n" + msgEn + "\nSQL exception:" + msg, 'Aceptar');
	}
	
	return numero;
}

/**
 * TODO generated, please specify type and doc for the params
 * @param {String} paciente
 * @param {String} afiliado
 * @param {String} nomeDesc
 * @param {Number} fecha
 * @param {Number} sector
 * @param {Number} hora
 *
 * @properties={typeid:24,uuid:"147FA0DC-82A5-420E-ACFC-4C1667079425"}
 * @AllowToRunInFind
 */
function enviarEmail(paciente,afiliado,nomeDesc,fecha,sector,hora) {
	
	if(asiutitrs_hoja_rel_buscar_obrasocial.obrmodautpre == 1 || asiutitrs_hoja_rel_buscar_obrasocial.obrmodautpre == 3){
		
		var mailObrTipo = 2;
		if(asiutitrs_hoja_rel_buscar_obrasocial.obr_codigo == obraSocialOSTEE_OS)
			mailObrTipo = 4;

		var fs_mailObra = databaseManager.getFoundSet("asistencial","tbc_mail_obra");
		fs_mailObra.find();
		fs_mailObra['mailobr1'] = asiutitrs_hoja_rel_buscar_obrasocial.obr_codigo
		fs_mailObra['mailobrtipo'] = mailObrTipo;
		fs_mailObra.search();
		
		if(fs_mailObra.getSize() > 0){
			
			var aux_mail_para = '';
			var aux_mail_cc = '';
			var aux_mail_cco = '';
			var aux_mail_error = '';
			for (var x=1;x<=10;x++){
				
				switch (fs_mailObra['mailobrdestino_'+x]){
					
				case 1:{
					
					if(plugins.mail.isValidEmailAddress(utils.stringTrim(fs_mailObra['mailobrmail_'+x]))){
						
						if(utils.stringTrim(aux_mail_para).length == 0)
							aux_mail_para = utils.stringTrim(fs_mailObra['mailobrmail_'+x]);
						else
							aux_mail_para += "," + utils.stringTrim(fs_mailObra['mailobrmail_'+x]);
					}
					else
						aux_mail_error += ' ' + utils.stringTrim(fs_mailObra['mailobrmail_'+x]);
					
				}
				break;
				case 2:{
					
					if(plugins.mail.isValidEmailAddress(utils.stringTrim(fs_mailObra['mailobrmail_'+x]))){
						
						if(utils.stringTrim(aux_mail_cc).length == 0)
							aux_mail_cc = utils.stringTrim(fs_mailObra['mailobrmail_'+x]);
						else
							aux_mail_cc += "," + utils.stringTrim(fs_mailObra['mailobrmail_'+x]);
					}
					else
						aux_mail_error += ' ' + utils.stringTrim(fs_mailObra['mailobrmail_'+x]);
				}
				break;
				case 3:{
					
					if(plugins.mail.isValidEmailAddress(utils.stringTrim(fs_mailObra['mailobrmail_'+x]))){
						
						if(utils.stringTrim(aux_mail_cco).length == 0)
							aux_mail_cco = utils.stringTrim(fs_mailObra['mailobrmail_'+x]);
						else
							aux_mail_cco += "," + utils.stringTrim(fs_mailObra['mailobrmail_'+x]);
					}
					else
						aux_mail_error += ' ' + utils.stringTrim(fs_mailObra['mailobrmail_'+x]);
				}
				break;
			}
		}
			
			//if(utils.stringTrim(aux_mail_para).length > 0){
				
				// Medico responsable por sector
				var codAutoSect = sector;
				var firmaRecCod = 0;
				
				if( codAutoSect == 2 || codAutoSect == 6 || codAutoSect == 8 || codAutoSect == 9 || codAutoSect == 10 || codAutoSect == 12)
					firmaRecCod = 8017;
				
				if( codAutoSect == 4 || codAutoSect == 05 || codAutoSect == 11)
					firmaRecCod = 7004;
				
				if( codAutoSect == 1 || codAutoSect == 3 || codAutoSect == 13 || codAutoSect == 14 || codAutoSect == 15 || codAutoSect == 16 )
					firmaRecCod = 7127;
				
				// Buscar Medico responsable, imagen y matricula
				var fileNameFirma = "Logo300px.png";//Default
				var matricula = "";
				
				var fs_firmaRec = databaseManager.getFoundSet('maestros','tbc_firma_rec');
				fs_firmaRec.find();
				fs_firmaRec['firmareccod'] = firmaRecCod;
				fs_firmaRec.search();
				
				if(fs_firmaRec.getSize() > 0){
					
					var myMedia = solutionModel.getMedia(utils.stringTrim(fs_firmaRec['firmarecarchjpg']));
					if(myMedia)
						fileNameFirma = fs_firmaRec['firmarecarchjpg'];
					
					matricula = fs_firmaRec['firmarecmatricula'];
				}
	
				var medPerCod = firmaRecCod;
				// Buscar Medico
				var medico = "Dr. ";
				var sqlMedPer = "select MedPerApeynom from tbc_medicos_personal where MedPerCod = " + medPerCod;
				var ds_medPer = databaseManager.getDataSetByQuery("maestros",sqlMedPer,null,-1);
				if(ds_medPer.getMaxRowIndex() > 0 )
					medico += utils.stringTrim(ds_medPer.getValue(1,1));
				
				//Buscar Diagnostico
				var diagnostico = 'Dx : ';
				var patCie = asiutitrs_hoja_numero_to_asistencial_admision.adm_patoling;
				
				var sqlMaxFecha = "select ptpfecha,ptphora,ptppatol from tbc_patolpac where"
				  + " ptphistclinica = " + asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin
				  + " and ptpfecha <= " + fecha
				  + " order by ptpfecha desc, ptphora desc";
				var ds_PatolPac = databaseManager.getDataSetByQuery('asistencial',sqlMaxFecha,null,-1);
				if(ds_PatolPac.getMaxRowIndex() > 0){
					
					if(ds_PatolPac.getValue(1,1) < fecha){
						// tomar el primer registro
						patCie = ds_PatolPac.getValue(1,3);
					}
					else{
						// mismo dia
						for(var i=1 ; i<= ds_PatolPac.getMaxRowIndex() ; i++ ){
							//evaluar la hora
							if( ds_PatolPac.getValue(i,2) <= hora){
								patCie = ds_PatolPac.getValue(i,3);
								break;
							}
						}
					}
				}
								
				if(asiutitrs_hoja_rel_buscar_obrasocial.obr_espami == 1){
					// Es pami
					/*
					var fs_patCie = databaseManager.getFoundSet('maestros','tbc_patcie'); 
					fs_patCie.find();
					fs_patCie['patcie1'] = patCie;
					// TODO Faltaria un criterio de filtro, o cual de la lista tomar ??
					//TODO: fs_patCie['patcie3'] = ;
					fs_patCie.search();
					
					if(fs_patCie.getSize() > 0)
						diagnostico += utils.stringTrim(fs_patCie['patcie22']);
					*/
				}
				else{
					
					var fs_patologia = databaseManager.getFoundSet('maestros','tbc_patologia'); 
					fs_patologia.find();
					fs_patologia['pat_codi'] = patCie;
					fs_patologia.search();
					
					if(fs_patologia.getSize() > 0)
						diagnostico += utils.stringTrim(fs_patologia['pat_descrip']);
				}
				
				var $ds2 = databaseManager.createEmptyDataSet()
				$ds2.addColumn('fld_apeynom',1,JSColumn.TEXT)
				$ds2.addColumn('fld_cobertura',2,JSColumn.TEXT)
				$ds2.addColumn('fld_afiliado',3,JSColumn.TEXT)
				$ds2.addColumn('fld_cod',4,JSColumn.TEXT)
				$ds2.addColumn('fld_rp1',5,JSColumn.TEXT)
				$ds2.addColumn('fld_rp5',6,JSColumn.TEXT)
				$ds2.addColumn('fld_apeynom_dr',7,JSColumn.TEXT)
				$ds2.addColumn('fld_matricula',8,JSColumn.TEXT)
				
				var histClinica = asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin;
				var histClin =  histClinica.toString().substr(0,histClinica.toString().length-1)+"/"+histClinica.toString().substr(histClinica.toString().length -1,1)
				
				$ds2.addRow([paciente,asiutitrs_hoja_rel_buscar_obrasocial.obr_razonsoc,afiliado,histClin,nomeDesc,diagnostico,medico,matricula])
				// Generacion de PDF
				var title = "";
				if(codAutoSect == 2 || codAutoSect == 6 || codAutoSect == 8 || codAutoSect == 10 || codAutoSect == 12)
					title = "TERAPIA INTENSIVA";
				else{
					
					if( codAutoSect == 4 || codAutoSect == 5 )
						title = "UNIDAD CORONARIA";
					else
						title = "PISO";
				}
				
				var params = {
					pr_firma: "media:///" + fileNameFirma,
					pr_recetario: "media:///RecetarioSC2_004.jpg",
					pr_titulo_dr: title
				}
				
				var fileName = asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin + "-"+ fecha + "-" + hora + ".pdf";
				var arch;
				try{
					arch = plugins.file.createFile(fileName);
					//application.output( arch.getAbsolutePath());
					//globals.DIALOGS.showWarningDialog("Atencion","Directorio del archivo: " + arch.getAbsolutePath(),"Aceptar");
					
				}catch(msg){
					grabaLog(msg.toString(),asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin);
				}
				
				if (arch){	
					try{
						//var fileName = "c:/temp/LB-CIRUAMBU-" + fechaDesde + "-" + fechaHasta;
						//plugins.jasperPluginRMI.compileReport("asiutitrs-SOL-AUT.jrxml");
						plugins.jasperPluginRMI.runReport($ds2,'asiutitrs-SOL-AUT.jasper',arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,params)
					}catch(e){
						grabaLog(e.message,asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin)
					}
				}
				
				var attachment1;
				try{
					attachment1 = plugins.mail.createBinaryAttachment(fileName,plugins.file.readFile(arch.getAbsolutePath()));
					
				}catch(msg){
					grabaLog(msg.toString(),asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin)
				}	
				
				// Envio de email
				var subJect = "Solicitud Autoriz.- Paciente " + paciente + " - " + nomeDesc;
				
				var msgText = "Estimado/a\n\n"
				+ "                Se adjunta Practica en formato PDF para Autorizar correspondiente al paciente " + paciente + " Afiliado: " + afiliado + " con indicacion de: " + nomeDesc + "\n\n"
				
				msgText+= "Atte.\n"; 
				//msgText+= "Unidad Quirugica\n";
				msgText+= "Sanatorio Colegiales";
				
				// Enviando email
				var cuenta = '2';
				var userName = 'autorizaciones@sanatoriocolegiales.com.ar';
				var passWord = 'auto45';
				var properties = new Array();
				properties[0] = 'mail.smtp.host=200.80.43.104';
				properties[1] = 'mail.smtp.auth=true';
				properties[2] = 'mail.smtp.username=' + userName;
				properties[3] = 'mail.smtp.password=' + passWord;
				properties[4] = 'mail.smtp.port=25';
				
				//TODO  test-1
				/*
				var toAux = utils.stringTrim(aux_mail_para).length > 0 ? aux_mail_para : null;
				var ccAux = utils.stringTrim(aux_mail_cc).length > 0 ? aux_mail_cc : null;
				var ccoAux = utils.stringTrim(aux_mail_cco).length > 0 ? aux_mail_cco : null;
				application.output("TO: " + toAux);
				application.output("CC: " + ccAux);
				application.output("CCO: " + ccoAux);
				*/
				// end test-1
				var to = null;
				var cc = null;
				var cco = null;
				var url='';
				
				var largo_url=application.getServerURL().length
				if (largo_url<24){
					//to = 'ggennari@sanatoriocolegiales.com.ar';
					to = 'hchoque@cirendsa.com.ar';
					globals.DIALOGS.showInfoDialog("E-MAIL",msgText + '\nTo: ' + to,"Aceptar");
					
				}else{
					url = application.getServerURL().substr(0,23);
					var puerto = url.split(':');
					
					if(puerto[2]!='8080'){
						// Ambiente de pruebas
						to = globals.DIALOGS.showInputDialog(puerto[2],"Ingrese Dirección de correo electronico",'fhuertas@cirendsa.com.ar');
						//cc = 'fhuertas@cirendsa.com.ar';
						cc = 'hchoque@cirendsa.com.ar';
						//cc = 'ggennari@sanatoriocolegiales.com.ar';
					}
					else{
						// Ambiente operativo
						to = utils.stringTrim(aux_mail_para).length > 0 ? aux_mail_para : null;
						cc = utils.stringTrim(aux_mail_cc).length > 0 ? aux_mail_cc : null;
						cco = utils.stringTrim(aux_mail_cco).length > 0 ? aux_mail_cco : null;
						
					}
				}
				
				var attachmentList = new Array();
				var archivo_1 = {nombre:fileName,path:arch.getAbsolutePath()};
				attachmentList.push(archivo_1);
				
				if(utils.stringTrim(aux_mail_error).length == 0){
					
					var success = plugins.mail.sendMail(to, userName, subJect, msgText,cc,cco,[attachment1], properties);
					if (!success){
						
						grabarReenviaMail(asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin,to,cc,cco,subJect,msgText,attachmentList,cuenta);
						var msgMail = "No ha sido posible enviar la autorización de ingreso a piso via E-mail";
						grabaLog(msgMail,asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin);
					}
				}
				else{
					
					grabarReenviaMail(asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin,to,cc,cco,subJect,msgText,attachmentList,cuenta);
					var msg = "No ha sido posible enviar la autorización de ingreso a piso. Direccion de correo electrónico no válido.\n E-mail: " + to;
					grabaLog(msg,asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin)
				}
					
				if(arch){
					
					try{
					  	plugins.file.deleteFile(arch.getAbsolutePath())
					  	plugins.file.deleteFile(arch)
					  }catch(msg){
							grabaLog("Error al elimnar archivo pdf.",asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin)
					}	
				}
			//}
		}
	}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param {Number} nroInterCons
 * @param {Number} fecha
 * @param {Number} hora
 *
 * @properties={typeid:24,uuid:"9AE3E905-A95C-4A50-8EC2-59B8FD45E6FC"}
 * @AllowToRunInFind
 */
function enviarEmailInterconsulta(nroInterCons,fecha,hora) {
	
	var fs_mailProf = databaseManager.getFoundSet("maestros","tbc_mail_prof");
	fs_mailProf.find();
	fs_mailProf['mailesp'] = globals.AsiUtiTrs_Hoja_vEspeMed;
	fs_mailProf.search();
	
	if(fs_mailProf.getSize() > 0){
		
		var fechaAux = globals.IntegerToDate(fecha);
		var nroDiaOut = fechaAux.getDay();// servoy 0: Domingo 1: Lunes ...
		if(nroDiaOut == 0)
			nroDiaOut = 7;// cobol 7: domingo
			
		var wADM4;
		if(globals.AsiUtiTrs_Hoja_wEquipo == 1)
			wADM4 = 401;
		else
			wADM4 = asiutitrs_hoja_numero_to_tbc_admision.adm_obrsoc;
		
		var asignarCorreo = false;
		var mailProf = "";

		for(var i = 1; i <= fs_mailProf.getSize(); i++){
			
			asignarCorreo = false;
			//Mail-DIA 0:No atiende 1:Atiende
			if(fs_mailProf.getRecord(i)['maildia_' + nroDiaOut] == 1){
				
				// MAIL-OBR-1 0=todas atiendea todas las obras sociales
				if(fs_mailProf.getRecord(i)['mailobr1'] == 0){
					
					asignarCorreo = true;
				}
					
				// MAIL-OBR-1 1=excluyntes no atiene a ciertas obras sociales
				if(fs_mailProf.getRecord(i)['mailobr1'] == 1){
					
					asignarCorreo = true;
					for (var x=1;x<=10;x++){
						
						if(fs_mailProf.getRecord(i)['mailobr2exclu_'+x] == wADM4){
							asignarCorreo = false;
							break;
						}
					}
				}
				
				// MAIL-OBR-1 2=habilitadas solo atiende a ciertas obras sociales
				if(fs_mailProf.getRecord(i)['mailobr1'] == 2){
					
					asignarCorreo = false;
					for (var t=1;t<=10;t++){
						
						if(fs_mailProf.getRecord(i)['mailobr2habil_'+t] == wADM4){
							asignarCorreo = true;
							break;
						}
					}
				}
				
				if(asignarCorreo){
					// completa en pr-2920
					if(plugins.mail.isValidEmailAddress(utils.stringTrim(fs_mailProf.getRecord(i)['maildireccion']))){

						if(mailProf == "")
							mailProf = utils.stringTrim(fs_mailProf.getRecord(i)['maildireccion']);
						else
							mailProf += "," + utils.stringTrim(fs_mailProf.getRecord(i)['maildireccion']);
					}
					
					if(plugins.mail.isValidEmailAddress(utils.stringTrim(fs_mailProf.getRecord(i)['maildireccion2']))){

						if(mailProf == "")
							mailProf = utils.stringTrim(fs_mailProf.getRecord(i)['maildireccion2']);
						else
							mailProf += "," + utils.stringTrim(fs_mailProf.getRecord(i)['maildireccion2']);
					}
					
					$_listNumberSMS.push(fs_mailProf.getRecord(i)['mailcodareacel'] + "|" + fs_mailProf.getRecord(i)['mailnrolineacel']);
				}	
			}
		}
		
		//MAIL-PROFE
		var aux_mail_para = mailProf;
		var aux_mail_cc = '';
		var aux_mail_cco = 'pzamora@cirendsa.com.ar,fflores@sanatoriocolegiales.com.ar,clausmocovich@sanatoriocolegiales.com.ar,clongo@sanatoriocolegiales.com.ar,sgallo@cirendsa.com.ar';
		
		if(utils.stringTrim(aux_mail_para).length > 0){
			
			// Envio de email
			var paciente = utils.stringTrim(asiutitrs_hoja_numero_to_asistencial_admision.adm_apelnom);
			var histClin = asiutitrs_hoja_numero_to_tbc_admision.histcli_hojati;
			var habita = asiutitrs_hoja_numero_to_asistencial_admision.adm_habita;
			var cama = asiutitrs_hoja_numero_to_asistencial_admision.adm_cama;
			var cobertura = utils.stringTrim(asiutitrs_hoja_rel_buscar_obrasocial.obr_razonsoc);
			var prioridad = "URGENTE";
			
			// Solicitud de Interconsulta Nro : 380344 - DENTRO DE LAS 24 Hs. - Paciente: URSINO MARIA ESTHER - N.Inter.246441/0 - Habitacion: 206 - Cama: B - Obras Social: OSTEE-OSTrab.Emp.Ele
			var subJect = "Solicitud de Interconsulta Nro : "+ nroInterCons + " - " + prioridad + " - Paciente: " + paciente + " - N.Inter. " + histClin + " - Habitacion: " + habita + " - Cama: " + cama + " - Obras Social: " + cobertura;
			
			var fechaMsg = fecha.toString().substr(6, 2) + "/" + fecha.toString().substr(4, 2) + "/" + fecha.toString().substr(0, 4);
			var fechaMsgSMS = fecha.toString().substr(6, 2) + "/" + fecha.toString().substr(4, 2) + "/" + fecha.toString().substr(2, 2);
			var horaMsg = convertNumberToHour_HHMM(hora);
			
			//Sr. Profesional: Se solicita una Interconsulta  Nro: 380344 - DENTRO DE LAS 24 Hs. -  del  17/01/2018 hora : 11:56, correspondiente al paciente: URSINO MARIA ESTHER - N.Inter.246441/0     - Habitacion:  206 - Cama: B - Obra Social : OSTEE-OSTrab.Emp.Ele- Medico solicito: CASAZZA GUSTAVO LUIS
			var msgText = "Sr. Profesional: Se solicita una Interconsulta  Nro: " + nroInterCons  + " - " + prioridad +  " - del " + fechaMsg + " hora : " + horaMsg + ", correspondiente al paciente: " + paciente + " - N.Inter. " + histClin + " - Habitacion: " + habita + " - Cama: " + cama + " - Obras Social: " + cobertura + " - Medico solicito: " + utils.stringTrim(globals.Srv_Login_Sanatorio_vOperador);
			msgText += "\nRESUMEN:";
			
			// Completando Resumen y Motivo
			var sqlInter = "select * from tbc_intercons where Intercons1 = " + nroInterCons + " order by Intercons2,Intercons2";
			var ds_interCons = databaseManager.getDataSetByQuery('asistencial',sqlInter,null,-1);
			var resumen = "";
			var motivo = "";
			
			if(ds_interCons.getMaxRowIndex() > 0){
				
				for(var k=1; k <= ds_interCons.getMaxRowIndex(); k++){
					
					if(ds_interCons.getValue(k,2) < 3){
						
						if(ds_interCons.getValue(k,2)== 0)
							resumen += "\n" + utils.stringTrim(ds_interCons.getValue(k,4));
						else
							motivo += "\n" + utils.stringTrim(ds_interCons.getValue(k,4));
					}
				}
			}
			msgText += resumen;
			msgText += "\nMOTIVO:";
			msgText += motivo;
			
			msgText += "\n\nEste correo es informativo, favor no responder a esta direccion de correo. Si requiere mayor informacion sobre el contenido de este mensaje, contactar al Sanatorio Colegiales 4556-4800.";
			
			msgText+= "\n\nAtte."; 
			//msgText+= "Unidad Quirugica\n";
			msgText+= "\nSanatorio Colegiales";
			
			//ARMO-TEXTO-SMS-INTERCONSULTA
			//Sr.Profesional:Se Solicita Interconsulta Nro.380436 del 24/01/18 08:43 hs-URGENTE-Pac. GHO,CARLOS(24357/0)hAB.6A
			$_msgSMS = "Sr.Profesional:Se Solicita Interconsulta Nro." + nroInterCons + " del " + fechaMsgSMS + " " + horaMsg + " hs-URGENTE-Pac. " + paciente + "(" + histClin + ")Hab." + habita + cama;
			
			// Enviando email
			var cuenta = "1";
			var userName = 'aviso@sanatoriocolegiales.com.ar';
			var passWord = 'avi32avi';
			var properties = new Array();
			properties[0] = 'mail.smtp.host=200.80.43.104';
			properties[1] = 'mail.smtp.auth=true';
			properties[2] = 'mail.smtp.username=' + userName;
			properties[3] = 'mail.smtp.password=' + passWord;
			properties[4] = 'mail.smtp.port=25';
			
			//TODO  test-1
			/*
			var toAux = utils.stringTrim(aux_mail_para).length > 0 ? aux_mail_para : null;
			var ccAux = utils.stringTrim(aux_mail_cc).length > 0 ? aux_mail_cc : null;
			var ccoAux = utils.stringTrim(aux_mail_cco).length > 0 ? aux_mail_cco : null;
			application.output("TO: " + toAux);
			application.output("CC: " + ccAux);
			application.output("CCO: " + ccoAux);
			*/
			// end test-1
			var to = null;
			var cc = null;
			var cco = null;
			var url='';
			
			var largo_url=application.getServerURL().length
			if (largo_url<24){
				
				to = 'hchoque@cirendsa.com.ar';
				globals.DIALOGS.showInfoDialog("E-MAIL",subJect + '\n\n' + msgText + '\nTo: ' + to,"Aceptar");
				
			}else{
				url = application.getServerURL().substr(0,23);
				var puerto = url.split(':');
				
				if(puerto[2]!='8080'){
					// Ambiente de pruebas
					to = globals.DIALOGS.showInputDialog(puerto[2],"Ingrese Dirección de correo electronico",'fhuertas@cirendsa.com.ar');
					//cc = 'fhuertas@cirendsa.com.ar';
					cc = 'hchoque@cirendsa.com.ar';
				}
				else{
					// Ambiente operativo
					to = utils.stringTrim(aux_mail_para).length > 0 ? aux_mail_para : null;
					cc = utils.stringTrim(aux_mail_cc).length > 0 ? aux_mail_cc : null;
					cco = utils.stringTrim(aux_mail_cco).length > 0 ? aux_mail_cco : null;
				}
			}
			/*
			var attachmentList = new Array();
			var archivo_1 = {nombre:fileName,path:arch.getAbsolutePath()};
			attachmentList.push(archivo_1);
			*/
			//Enviando E-Mail
			var success = plugins.mail.sendMail(to, userName, subJect, msgText,cc,cco,null, properties);
			if (!success){
				
				grabarReenviaMail(asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin,to,cc,cco,subJect,msgText,null,cuenta);
				var msgSuccess = "No ha sido posible enviar la interconsulta de traumatologia via E-mail";
				grabaLog(msgSuccess,asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin);
			}
		}
		else{
			
			grabarReenviaMail(asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin,to,cc,cco,subJect,msgText,null,cuenta);
			var msgMail = "No ha sido posible enviar la interconsulta de traumatologia. Direccion de correo electrónico no válido.\n E-mail: " + aux_mail_para;
			grabaLog(msgMail,asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin)
		}
	}
	else{
		var msg = "No ha sido posible enviar la interconsulta de traumatologia. No existen profecionales para la especialidad " + globals.Srv_Login_Sanatorio_vEspeMed + " en tbc_mail_prof.";
		grabaLog(msg,asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin)
	}
}

/**
 * @properties={typeid:24,uuid:"AC70D891-02C4-4310-802D-4B4D354255E6"}
 * @SuppressWarnings(unused)
 */
function enviarSMSinterconsulta(){
	
	var nroCelular;
	var destinatario;
	elements.lbl_procesando.visible = true;
	application.updateUI();
	for(var j=0;j<$_listNumberSMS.length ; j++){
		
		var item = $_listNumberSMS.slice(j);
		var subItem = String(item[0]).split('|');
		nroCelular = subItem[0]+subItem[1];
		application.output("CodArea-NroCelular: " + subItem[0] + " - " + subItem[1]);
		
		// Validar codigo de area y numero celular
		
		destinatario = "";
		var url='';
		var largo_url=application.getServerURL().length
		if (largo_url<24){
			
			destinatario = "0";
			globals.DIALOGS.showInfoDialog("SMS",nroCelular + "\n" +  $_msgSMS,"Aceptar");
			
			
		}else{
			url = application.getServerURL().substr(0,23);
			var puerto = url.split(':');
			
			if(puerto[2]!='8080'){
				// Ambiente de pruebas 
				destinatario = globals.DIALOGS.showInputDialog(puerto[2],"Ingrese Dirección de correo electronico",'1199999999');
				
			}
			else{
				// Ambiente operativo
				destinatario = nroCelular;
			}
		}
		
		// Enviando SMS
		
		//var vString = vServer.executeCommand('ssh -l svysc 10.200.0.90 -C "sh sh-pruebaservoy1"');
		//var vString = vServer.executeCommand("`/usr/bin/curl --insecure --progress-bar -X POST -F 'number=03484360393' -F 'text=Prueba de comando' https://10.200.0.65:44443/EnvioSMS.php`");
		//var vString = vServer.executeCommand("/usr/bin/curl  --insecure https://10.200.0.65:44443/EnvioSMS.php?number=3484360393&text=Hola Mundo");
		//var vString = vServer.executeCommand("/app/servoy/scripts/sh-curl "+3484360393+" "+ftexto1+" "+ftexto2+" "+ftexto1+" "+ftexto2+" "+ftexto1+" "+ftexto2+" "+ftexto1+" "+ftexto2);
		if(utils.stringToNumber(destinatario) > 0){
			
			plugins.UserManager.register( "Hypertelia", "q9SA5eCyb085cvATVO8s9onGe3iBzJyCTel8Y7J72BuG599wodOiU5OL26/pkKyv");
			var vServer = plugins.UserManager.Server();
			var vString = vServer.executeCommand("/app/servoy/scripts/sh-curl "+destinatario+" "+$_msgSMS);
			//ENVIO OK
		}
		
	}
	elements.lbl_procesando.visible = false;
	application.updateUI();
}

/**
 * TODO generated, please specify type and doc for the params
 * @param {String} texto
 * @param {Number} histClin 
 *
 * @properties={typeid:24,uuid:"061FD0FF-BA2B-47CD-8A11-1A184EBAA809"}
 */
function grabaLog(texto,histClin) {
	
	var id = application.getUUID();
	//Verificando si existe clave primaria
	var sql = "SELECT EXISTS( SELECT id FROM cirugia_errores WHERE id='" + id + "')"
	var dsExists = databaseManager.getDataSetByQuery('bases_auxiliares',sql,null,-1);
	while(dsExists.getValue(1,1) == 1){
		id = application.getUUID();
		sql = "SELECT EXISTS( SELECT id FROM cirugia_errores WHERE id='" + id + "')"
		dsExists = databaseManager.getDataSetByQuery('bases_auxiliares',sql,null,-1);
	}
	
	var fs = databaseManager.getFoundSet("bases_auxiliares","cirugia_errores")
	var fechacarga = application.getServerTimeStamp();
	fs.newRecord()
	fs['id'] = id;
	fs['hiscli'] = histClin;
	fs['protocolo'] = 0;
	fs['texto_errores'] = application.getSolutionName() + "|" +  application.getIPAddress() + "|" + controller.getName() + "|" +  texto;
	fs['tipo_pac'] = 'Int';
	fs['fecha']=application.getServerTimeStamp();
	fs['hora']=fechacarga.getHours()+''+fechacarga.getMinutes()
	
	databaseManager.startTransaction()
	var result = databaseManager.saveData(fs);
	if(result){
		databaseManager.commitTransaction();				
	}
	else{
		var error1 = ''
		var error2 = ''
		var array = databaseManager.getFailedRecords()
		for (var i = 0; i < array.length; i++) {
			var record = array[i];
			var jstable = databaseManager.getTable(record);
			var tableSQLName = jstable.getSQLName();
			error1='Error de Grabación en Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
			error2='Error en grabación '+record.exception;
			if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
		
				var thrown = record.exception.getValue()
			
			}
		}
		databaseManager.rollbackTransaction()
	}
}

/**
 * Callback method when form is (re)loaded.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"27744148-CCB9-4E37-BA21-C9ACDECD05E8"}
 */
function onLoad_inicializarForm(event) {
	
	initFormFirstShow();
	//forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.ejemplo_menu.

	/*var vMenu = new Array();
	var vMenuItem;

	// Add some items
	vMenuItem = plugins.popupmenu.createMenuItem('Menu 1', aMethod);
	vMenu[vMenu.length] = vMenuItem;
	
	vMenuItem = plugins.popupmenu.createMenuItem('Menu 2', aMethod);
	vMenu[vMenu.length] = vMenuItem;

	// Create submenu
	var vSubMenu = new Array();
	vMenuItem = plugins.popupmenu.createMenuItem('Menu 2.1', aMethod);
	vSubMenu [vSubMenu.length] = vMenuItem;
	vMenuItem = plugins.popupmenu.createMenuItem('Menu 2.2', aMethod);
	vSubMenu [vSubMenu.length] = vMenuItem;

	// Add submenu
	vMenuItem = plugins.popupmenu.createMenuItem('mySubmenu', vSubMenu );
	vMenu[vMenu.length] = vMenuItem;*/
	
	
}

/**
 * @properties={typeid:24,uuid:"262F7DB3-CF90-4729-A5DB-C561F2E93449"}
 */
function initFormFirstShow(){
	
	inicializarForm();
	f_medico = utils.stringTrim(globals.Srv_Login_Sanatorio_vOperador);
	mostrarRecordatorio();
	
	if(globals.Srv_Login_Sanatorio_vTipoOperador == 0){
		
		var ds_personal = databaseManager.getDataSetByQuery('maestros','select per_espemed from tbc_personal where per_legajo = ' + globals.Srv_Login_Sanatorio_vLega,null,-1);
		globals.Srv_Login_Sanatorio_vEspeMed = ds_personal.getMaxRowIndex() > 0 ? ds_personal.getValue(1,1) : 0;
	}	
	else{
		
		var ds_medicos = databaseManager.getDataSetByQuery('maestros','select med_espemed from tbc_medicos where med_codigo = ' + globals.Srv_Login_Sanatorio_vLega,null,-1);
		globals.Srv_Login_Sanatorio_vEspeMed = ds_medicos.getMaxRowIndex() > 0 ? ds_medicos.getValue(1,1) : 0;
	}
	
	
	// Evaluando si el usuario logeado es ostee    		
	var $form = controller.getName();
	for (var i = 1; i <= globals.Srv_Login_Sanatorio_permisos.getMaxRowIndex(); i++){	
		
		if ($form == globals.Srv_Login_Sanatorio_permisos.getValue(i,3)){
			
			if('user_ostee' == globals.Srv_Login_Sanatorio_permisos.getValue(i,4)){
					
				if(globals.Srv_Login_Sanatorio_permisos.getValue(i,6)==true){
						
					$_isUserOSTEE = true;
					break;
				}
			}
			
		}
	}
	// Inicializando impresion
	//forms.AsiUtiTrs_Hoja_print.onShow_inicializarForm(true,null);
}

/**
 * 
 * @param {Number} hisCli
 * @param {String} to
 * @param {String} cc
 * @param {String} cco
 * @param {String} asunto
 * @param {String} mensaje
 * @param {Array<Object>} attachment
 * @param {String} cuenta
 *
 * @properties={typeid:24,uuid:"CF01BACA-4F0F-4879-B859-4FEB306FC30F"}
 */
function grabarReenviaMail(hisCli,to,cc,cco,asunto,mensaje,attachment,cuenta){
	
	var id = application.getUUID();
	//Verificando si existe clave primaria
	var sql = "SELECT EXISTS( SELECT id FROM reenvia_mail WHERE id='" + id + "')";
	var dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
	while(dsExists.getValue(1,1) == 1){
		id = application.getUUID();
		sql = "SELECT EXISTS( SELECT id FROM reenvia_mail WHERE id='" + id + "')";
		dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
	}
	
	var fs = databaseManager.getFoundSet("desal","reenvia_mail");
	fs.newRecord();
	
	fs['id'] = id;
	fs['hiscli'] = hisCli;
	fs['fecha'] = application.getServerTimeStamp();;
	fs['mail_para'] = to;
	fs['mail_cc'] = cc;
	fs['mail_cco'] = cco;
	fs['id_cuenta_origen'] = cuenta;
	fs['asunto'] = asunto;
	fs['mensaje'] = mensaje;
	fs['estado'] = false;
	
	var fsItem = databaseManager.getFoundSet('desal','reenvia_mail_adjunto');
	if(attachment != null){
		
		var idItem;
		for(var k=0; k<attachment.length; k++){
			
			fsItem.newRecord();
			idItem = application.getUUID();
			//Verificando si existe clave primaria
			sql = "SELECT EXISTS( SELECT id FROM reenvia_mail_adjunto WHERE id='" + idItem + "')";
			dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
			while(dsExists.getValue(1,1) == 1){
				idItem = application.getUUID();
				sql = "SELECT EXISTS( SELECT id FROM reenvia_mail_adjunto WHERE id='" + idItem + "')";
				dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
			}
			
			fsItem['id'] = idItem;
			fsItem['id_reenvia_mail'] = id;
			fsItem['nombre_archivo'] = attachment[k]['nombre'];
			fsItem['archivo'] = plugins.file.readFile(attachment[k]['path']);
		}
	}
	
	databaseManager.startTransaction()
	var resultFs = databaseManager.saveData(fs);
	
	var resultItem = true;
	if(fsItem.getSize() > 0)
		resultItem = databaseManager.saveData(fsItem);
	
	if(resultFs && resultItem){

		databaseManager.commitTransaction();				
	}
	else{
		
		databaseManager.rollbackTransaction();
		var msgMail = "No ha sido posible grabar en tabla reenvia_mail. HC " + hisCli + "para " + to + cc + cco;
		grabaLog(msgMail,hisCli);
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"6F381C38-EA6A-43F9-8E60-6E3E042530DC"}
 */
function onFocusLostTensionMin(event) {
	// TODO Auto-generated method stub
	if (f_tension_arterial_min < 1) {
		globals.DIALOGS.showWarningDialog("Dato incompleto","Debe ingresar Tension Arterial Mínima")
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_Tensión_Mínima.requestFocus();
		return
	}

	if (f_tension_arterial_min > f_tension_arterial_max) {
		globals.DIALOGS.showWarningDialog("Dato incorrecto","La Tension Arterial Mínima debe ser menor o igual a la Máxima.")
		if(f_tension_arterial_max==0 || f_tension_arterial_max==null){
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_Tensión_Máxima.requestFocus();
		}else{
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_Tensión_Mínima.requestFocus();
		}
		
		return
	}
	
	
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"8437F8AF-1739-4397-A889-27D0E92CE62C"}
 */
function onFocusLostTxtTemperatura(event) {
	// TODO Auto-generated method stub
	
	if (f_temperatura < 1) {
		globals.DIALOGS.showWarningDialog("Dato incompleto","Debe ingresar valor de Temperatura.")
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_temperatura.requestFocus();
		return
	}
}

/**
 * Handle changed data.
 *
 * @param {String} oldValue old value
 * @param {String} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"5BA00596-88BC-46B6-9C10-52BCC9F4BFC5"}
 */
function onDataChange(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	
	/*if(isNaN(f_paciente)){ //Si no es numero es true!!
	}else{
		 if(f_paciente>2147483647){
			 plugins.dialogs.showInfoDialog("Error en Nro.Internación","El número de Internación no es válido","Ok")
		 }
		
	   
	}
	return true*/
}

/**
 * Handle focus gained event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"F392D2F7-A1BC-4649-A93A-39F04CA55DB2"}
 */
function onFocusGained(event) {
	// TODO Auto-generated method stub
	var tabSeq=controller.getTabSequence()
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"5A372AD0-6AEC-401F-A3A6-BBDCCDF1765C"}
 */
function onAction(event) {
	// TODO Auto-generated method stub
	var tabseq = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.controller.getTabSequence();
	var secActual= tabseq.indexOf(event.getElementName());
	if (tabseq.length > 1) {
	    forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.controller.focusField(tabseq[secActual+1], true);
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"310D9C0A-4A98-4927-9DF5-24DC27E5C03A"}
 */
function onEnterFocusSecuence(event) {
	// TODO Auto-generated method stub
	$isDirty = true;
	var tabseq = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.controller.getTabSequence();
	if (tabseq.length > 1 && isNaN(event)) {
	var secActual= tabseq.indexOf(event.getElementName());
	    forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.controller.focusField(tabseq[secActual+1], true);
	}
}

/**
 * Handle changed data.
 *
 * @param {String} oldValue old value
 * @param {String} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"CC55F5EC-A0CC-49E7-B57F-6200CD778803"}
 */
function onDataChangeEcg(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	$isDirty = true;
	return true
}

/**
 * @properties={typeid:24,uuid:"F1FB2E22-9169-40E3-8FBE-266FF41B8F27"}
 */
function habilitarECG(){
	
	var fechaActual = application.getServerTimeStamp();
	var fechaAux = fechaActual;
	var now = globals.FormatearFecha(fechaActual,"AAAAMMDD");
	
	fechaAux.setDate( fechaActual.getDate() - 1 );
	var ayer = globals.FormatearFecha(fechaAux,"AAAAMMDD");
	
	
	var sql_query = "select * from tbc_imapedi_new IMAPEDI inner join tbc_imapedet_new IMAPEDET on IMAPEDET.IdetServicio = IMAPEDI.IpedServicio AND IMAPEDET.IdetPedido = IMAPEDI.IpedPedido AND IMAPEDET.IdetCodiNom=170101 AND IMAPEDET.IdetTipoNom=01";
	sql_query += " WHERE IMAPEDI.IpedServicio1=12 AND IMAPEDI.IpedAdmis=0 AND IMAPEDI.IpedHistClinica="+asiutitrs_rel_tbc_hojati_to_tbc_hojati.hithiscli+" and (IMAPEDI.IpedFechaPedido="+ayer+" OR IMAPEDI.IpedFechaPedido="+now+") ORDER BY IMAPEDI.IpedServicio1, IMAPEDI.IpedAdmis, IMAPEDI.IpedHistClinica";
	var pElectro = databaseManager.getDataSetByQuery('asistencial',sql_query,null,-1);
	if(pElectro.getMaxRowIndex() > 0 || nuevoHciint==false ){
		editableSolicitudAutomatica(false)
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.generarECG=0;
	}else{
		editableSolicitudAutomatica(true)
	
	}
	
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B13997D1-2A15-4E24-A3F3-187A7D7D0F14"}
 */
function onAction_btnEditar(event) {
	// TODO Auto-generated method stub

	if(!asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiimprimio==1){
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_grabar.enabled=true;
	globals.ModoLecturaVisualizarFactoresYvaloracion=false;
	globals.modificarCampos("AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion",globals.habilitarCampos,null)
	
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc==1) {
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=true;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.enabled=true;
	}else{
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=false;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.enabled=false;
	}
	
	forms.AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion.elements.btn_Confirmar_Factor_Valoracion.enabled=true;
	//forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.grp_sesion.visible=true;
	//Permitir editar solo a la ultima historia clinica activa.
/*	var dsrowfechaMax = databaseManager.getDataSetByQuery("asistencial", "select  max(HitFecha)  from tbc_hciti where HitHiscli="+globals.AsiUtiTrs_Hoja_hiiHisCli, null, -1);
	var fechaMaximaHistClin=dsrowfechaMax.getValue(1,1);
	var dsrowhoraMax = databaseManager.getDataSetByQuery("asistencial", "select  max(HitHora)  from tbc_hciti where HitHiscli="+globals.AsiUtiTrs_Hoja_hiiHisCli +" and HitFecha="+fechaMaximaHistClin, null, -1);
	var horaMaximaHistClin=dsrowhoraMax.getValue(1,1);
	var dsrowfechaMaxDetalle = databaseManager.getDataSetByQuery("asistencial", "select  max(Det2)  from tbc_detalle where Det1="+globals.AsiUtiTrs_Hoja_hiiHisCli, null, -1);
	var fechaMaximaDetalle=dsrowfechaMaxDetalle.getValue(1,1);
	if(fechaMaximaDetalle!=null){
		var dsrowhoraMaxDetalle = databaseManager.getDataSetByQuery("asistencial", "select  max(Det3)  from tbc_detalle where Det1="+globals.AsiUtiTrs_Hoja_hiiHisCli +" and Det2="+fechaMaximaDetalle, null, -1);
		var horaMaximaDetalle=dsrowhoraMaxDetalle.getValue(1,1);
	}
	
	var esLaUltimaHistoriaClin=true;
	if(fechaMaximaDetalle>fechaMaximaHistClin || (fechaMaximaHistClin==fechaMaximaDetalle && horaMaximaDetalle>horaMaximaHistClin)){
		esLaUltimaHistoriaClin=false;
	}*/
	
	/*if(globals.AsiUtiTrs_Hoja_fechaHisclin!=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htihora){
		plugins.dialogs.showWarningDialog("Datos modificados","Los Datos fueron cambiados recientemente por otro profesional, vuelva a ingresar a la historia para ver los datos actuales");
		limpiarForm();
	}*/
	var seImprimio = false;
	 globals.AsiUtiTrs_Hoja_soloLectura=false
		if(seImprimio==false){
		
				//globals.modificarCampos("HciutiTrs_frm_evo_medica_utiTrs_hoja_TI", globals.habilitarCampos,null);
				
				habilitarTabs(true)
				if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){
					habilitarExamenFisico(true);
				}else{
					habilitarExamenFisico(false);
				} 
				
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=false;
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_cancelar.enabled=true;
				
				
				var fechaActual = application.getServerTimeStamp();
				var horaActualModificacion = globals.FormatearFecha(fechaActual,"HH:MM");
				//produccion
				plugins.scheduler.addCronJob("desbloquear", '0 '+horaActualModificacion.substr(3,5)+' '+horaActualModificacion.substring(0,2)+'/5 ? * * *', desbloquearHistCli) //cada min --> 0 0/1 * ? * * *   //cada 5 horas * * 0/5 ? * * * 
			
				//pruebas en local y  desarrollo
				//plugins.scheduler.addCronJob("desbloquear", '0 */10 * ? * *', desbloquearHistCli)
	
		}
	}else{
			plugins.dialogs.showInfoDialog("Documento fue Impreso","Esta evolución ya no será posible editar");

	}
	
}

/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"87D147D5-8656-4593-A21F-711C6A4F7088"}
 */
function onShow(firstShow, event) {
	// TODO Auto-generated method stub
	elements.txt_paciente.requestFocus()
	//i18n.setLocale('en','US');
	
}

/**
 * @properties={typeid:24,uuid:"285F32FB-0F07-4C58-9405-56AB246EAFF2"}
 */
function desbloquearHistCli(){
	//Paso x tiempo sacarle recurso.
	globals.AsistFunciones_unLockRegisterTable(application.getSolutionName(),controller.getName(),asiutitrs_hoja_numero_to_tbc_admision.adm_histclin.toString(),globals.Srv_Login_Sanatorio_vLega.toString(),"Historia Clinica");
	
	//globals.modificarCampos("HciutiTrs_frm_evo_medica_utiTrs_hoja_TI", globals.setearEnModoLecturaCampos,null);
	habilitarExamenFisico(false)
	
	var elementosTab1 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex()
	for (var index = 1; index <= elementosTab1; index++) {
		var nombreFormulario = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(index);
		globals.modificarCampos(nombreFormulario, globals.setearEnModoLecturaCampos,null);
		
	}
	var elementosTab2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex()
	for (var index2 = 1; index2 <= elementosTab2; index2++) {
		var nombreFormulario2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(index2);
		globals.modificarCampos(nombreFormulario2, globals.setearEnModoLecturaCampos,null);
	}
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=true;
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_grabar.enabled=false;
	
	plugins.scheduler.removeJob("desbloquear");
	application.exit();
	
	
}

/**
 * @properties={typeid:24,uuid:"C070A062-2A95-446B-8642-FE714017F008"}
 */
function contador(){
	
msToTime(utils.stringToNumber(globals.horaContador)-60000).toString();
forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.foundset.setDataProviderValue('txt_contador',globals.horaContador)
}

/**
 * TODO generated, please specify type and doc for the params
 * @param duration
 *
 * @properties={typeid:24,uuid:"04705168-FFF7-4DD2-829D-B6CF05630C42"}
 */
function msToTime(duration) {
	    var minutes = Math.floor((duration / (1000 * 60)) % 60);
	    var hours = Math.floor((duration / (1000 * 60 * 60)) % 24);

	  hours = (hours < 10) ? "0" + hours : hours;
	  minutes = (minutes < 10) ? "0" + minutes : minutes;

	  return hours + ":" + minutes;  //+ ":" + seconds + "." + milliseconds;
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D7E417F6-2DA6-4BE6-801A-A3458A5D07A9"}
 */
function onAction_btnCancelar(event) {
	// TODO Auto-generated method stub
	if(!globals.AsiUtiTrs_Nueva_Evol_Medica){
		databaseManager.revertEditedRecords();
		cargarInformes();
		resetValues();
		globals.ModoLecturaVisualizarFactoresYvaloracion=true;
		//globals.modificarCampos("HciutiTrs_frm_evo_medica_utiTrs_hoja_TI", globals.setearEnModoLecturaCampos,null);
		habilitarExamenFisico(false)
		
		var elementosTab1 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex()
		for (var index = 1; index <= elementosTab1; index++) {
			var nombreFormulario = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(index);
			globals.modificarCampos(nombreFormulario, globals.setearEnModoLecturaCampos,null);
			
			
		}
		var elementosTab2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex()
		for (var index2 = 1; index2 <= elementosTab2; index2++) {
			var nombreFormulario2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(index2);
			globals.modificarCampos(nombreFormulario2, globals.setearEnModoLecturaCampos,null);
		}
		if(plugins.scheduler.getCurrentJobNames()!=null){
			plugins.scheduler.removeJob("desbloquear");
		}
	
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_editar.enabled=true;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_cancelar.enabled=false;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.btn_grabar.enabled=false;
		
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico_1.readOnly=true;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.readOnly=true;
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.readOnly=true;
		
		 globals.AsiUtiTrs_Hoja_soloLectura=true
	 }
	//databaseManager.revertEditedRecords(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI);
	//forms.AsiUtiTrs_Hoja_dlg_buscar_internado.foundset
	//forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.
}

/**
 * @properties={typeid:24,uuid:"B870DB62-8EDA-4685-830B-6E783B442BC2"}
 */
function cargarInformes(){
	// cargar informes de Postgres
	
	var cantidad = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex();
	var nameTab="";
	for (var index = 1; index <= cantidad; index++) {
		nameTab= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(index);
		if(nameTab!=null && nameTab!=''){
			globals.AsiUtiTrs_Hoja_grupoTxt = index;
			forms[nameTab].f_informe = asiutitrs_hoja_rel_buscar_hojatitxt.linea;
		}
	}
	
	var cantidad2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex();
	var nameTab2="";
	for (var index2 = 1; index2 <= cantidad2; index2++) {
		nameTab2= forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(index2);
		if(nameTab2!=null && nameTab2!=''){
			globals.AsiUtiTrs_Hoja_grupoTxt = 6+index2;
			forms[nameTab2].f_informe = asiutitrs_hoja_rel_buscar_hojatitxt.linea;
		}
	}
	
	
	
	//var current2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.tabIndex;
	
	
	
	
	
	/*globals.AsiUtiTrs_Hoja_itemTxt = 1;
	forms.AsiUtiTrs_Hoja_txt_motivo_ingreso.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;

	globals.AsiUtiTrs_Hoja_itemTxt = 2;
	forms.AsiUtiTrs_Hoja_txt_examen_fisico.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;
	
	globals.AsiUtiTrs_Hoja_itemTxt = 3;
	forms.AsiUtiTrs_Hoja_txt_neurológico.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;
	
	globals.AsiUtiTrs_Hoja_itemTxt = 4;
	forms.AsiUtiTrs_Hoja_txt_cardiovascular.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;
	
	globals.AsiUtiTrs_Hoja_itemTxt = 5;
	forms.AsiUtiTrs_Hoja_txt_respiratorio.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;
	
	globals.AsiUtiTrs_Hoja_itemTxt = 6;
	forms.AsiUtiTrs_Hoja_txt_abdominal.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;
	
	//segundo bloque de tabs
	
	globals.AsiUtiTrs_Hoja_itemTxt = 7;
	forms.AsiUtiTrs_Hoja_txt_osteo_articular.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;
	
	
	globals.AsiUtiTrs_Hoja_itemTxt = 8;
	forms.AsiUtiTrs_Hoja_txt_urogenital.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;


	globals.AsiUtiTrs_Hoja_itemTxt = 9;
	forms.AsiUtiTrs_Hoja_txt_tratamiento_ingreso.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;

	globals.AsiUtiTrs_Hoja_itemTxt = 10;
	forms.AsiUtiTrs_Hoja_txt_estudios_solicitados.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;

	globals.AsiUtiTrs_Hoja_itemTxt = 11;
	forms.AsiUtiTrs_Hoja_txt_interconsulta.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;

	globals.AsiUtiTrs_Hoja_itemTxt = 12;
	forms.AsiUtiTrs_Hoja_txt_otros.f_informe = asiutitrs_hoja_rel_buscar_hcititxt.linea;*/
}


/**
 * TODO generated, please specify type and doc for the params
 * @param oldValue
 * @param newValue
 * @param event
 *
 * @properties={typeid:24,uuid:"2EB9E0E6-5FB7-4A20-A038-345484CABB58"}
 */
function onDataChange_cboPulsoCaract(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	$isDirty = true;
	// TODO Auto-generated method stub
	if(newValue==2){
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_pulso_caracteristico.editable=true;
		f_pulso_caracteristico = ' ';
		elements.txt_pulso_caracteristico.requestFocus();
	}else{
		forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_pulso_caracteristico.editable=false;
		f_pulso_caracteristico= 'Normal';
		elements.txt_Tensión_Máxima.requestFocus();
	}
	return true
	
	
}




/**
 * Handle changed data.
 *
 * @param {Number} oldValue old value
 * @param {Number} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"3FF067FB-8B1C-4AF1-84C4-56EF7A991DE2"}
 */
function onDataChangeAltura(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	calcularImc();
	return true
}

/**+
 * Handle changed data.
 *
 * @param {Number} oldValue old value
 * @param {Number} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"A87D9A15-8448-4AD4-A493-1DADFB669E07"}
 */
function onDataChangePeso(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	calcularImc();
	
	return true
}

/**
 * @properties={typeid:24,uuid:"D52346D0-EB87-43E3-B01B-55EE2C05C164"}
 */
function calcularResultadoImc(){
	var valorIMC = utils.stringToNumber(f_IMC);
	if(valorIMC!=0){
		if(valorIMC<18.5){
			f_IMC_resultado='Bajo peso';
		}else if(!(valorIMC>24.9)){
			f_IMC_resultado='Rango normal';
		}else if(!(valorIMC>29.9)){
			f_IMC_resultado='Preobesidad';
		}else if(!(valorIMC>34.9)){
			f_IMC_resultado='Obesidad clase 1';
		}else if(!(valorIMC>39.9)){
			f_IMC_resultado='Obesidad clase 2';
		}else{
			f_IMC_resultado='Obesidad clase 3';
		}
	}

		
}

/**
 * @properties={typeid:24,uuid:"B8421981-8721-4A19-8B44-41CDF489A609"}
 */
function calcularImc(){
	if(f_peso!='' && f_altura!=''){
		var pesokg = utils.stringToNumber(f_peso, ",");
		var alturamts  =  utils.stringToNumber(f_altura, ",");
		var calculo = pesokg/Math.pow(alturamts,2)
		f_IMC= utils.numberFormat(calculo,1);
		calcularResultadoImc();
	}else{
		f_IMC = 0;
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"DBD768EA-B41A-405B-BAA1-CA2806DC8C4B"}
 */
function onVerFactoresYvaloracion(event) {
	// TODO Auto-generated method stub
	//globals.ModoLecturaVisualizarFactoresYvaloracion=true;
	if(utils.stringToNumber(f_edad)<75){
		forms.AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion.elements.grp_factores_escaras.visible=false;
	}else{
		forms.AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion.elements.grp_factores_escaras.visible=true;
	}
	
	var winIngreso = application.createWindow("Ulceras_Presion",JSWindow.MODAL_DIALOG)	
    winIngreso.title= 'Factores de Riesgo para el Desarrollo de Ulceras por Presion(ESCARAS)';
    winIngreso.resizable = false	
    winIngreso.setSize(580,700);
    winIngreso.show(forms.AsiUtiTrs_Hoja_Factor_Riesgo_Ulcera_Presion)	
	
}

/**
 * Handle changed data.
 *
 * @param {Number} oldValue old value
 * @param {Number} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"633E48EE-A458-48E1-B740-8A94492E84BD"}
 */
function onDataChangeTemperatura(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	return true
}



/**
 * @properties={typeid:24,uuid:"B6C1C1CE-7D5B-4F9E-BB3C-51AD759D3F6C"}
 */
function cargarDiagnosticos(){
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.getSize()>0){
		if(asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htidiagnos1!=0 && !globals.AsiUtiTrs_Primera_Evol_Medica_Dia){
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htidiagnos1;
			f_descripcion_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.asiutitrs_hoja_rel_buscar_patologia_1.pat_descrip
			if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1!=0){
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=true;
			}
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htidiagnos2;
			f_descripcion_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.asiutitrs_hoja_rel_buscar_patologia_2.pat_descrip
			if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2!=0){
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=true;
			}
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia3=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htidiagnos3;
			f_descripcion_patologia3=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.asiutitrs_hoja_rel_buscar_patologia_3.pat_descrip
		}
		
		if(asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htidiagevo1!=0 && !globals.AsiUtiTrs_Primera_Evol_Medica_Dia){
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htidiagevo1;
			f_descripcion_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.asiutitrs_hoja_rel_buscar_patologia_1_segunda.pat_descrip
			if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1!=0){
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=true;
			}
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htidiagevo2;
			f_descripcion_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.asiutitrs_hoja_rel_buscar_patologia_2_segunda.pat_descrip;
			if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2!=0){
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=false;
			}
		}
		
		
	}


	
	
	
	
	
	
}

/**
 * @properties={typeid:24,uuid:"2235578E-80CE-4AA8-966B-22A9B548DF40"}
 */
function habilitarTabs(actividadTabs){
	var funcion;
	if(actividadTabs){
		funcion=  globals.habilitarCampos;
	}else{
		funcion=  globals.setearEnModoLecturaCampos;
	}
	
	var elementosTab1 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getMaxTabIndex()
	for (var index = 1; index <= elementosTab1; index++) {
		var nombreFormulario = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_1.getTabFormNameAt(index);
		globals.modificarCampos(nombreFormulario, funcion,null);
		
		
	}
	var elementosTab2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getMaxTabIndex()
	for (var index2 = 1; index2 <= elementosTab2; index2++) {
		var nombreFormulario2 = forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.tab_informe_2.getTabFormNameAt(index2);
		globals.modificarCampos(nombreFormulario2, funcion,null);
	}
}


/**
 * TODO generated, please specify type and doc for the params
 * @param habilitar
 *
 * @properties={typeid:24,uuid:"3BBA302E-D8F9-49A0-AFE2-FCF581A675C4"}
 */
function habilitarExamenFisico(habilitar){
	elements.grp_diagnostico.readOnly=!habilitar;
	elements.grp_signovitale.readOnly=!habilitar;
	elements.grp_solicitud.readOnly=!habilitar;
	elements.grp_diagnostico.enabled=habilitar;
	elements.grp_signovitale.enabled=habilitar;
	elements.grp_solicitud.enabled=habilitar;
	elements.cbo_Caracteris.enabled=habilitar;
	elements.cbo_temperatura.enabled=habilitar;
	elements.cbo_Caracteris.readOnly=!habilitar;
	elements.cbo_temperatura.readOnly=!habilitar
	elements.chk_arm.enabled=habilitar;
	globals.AsiUtiTrs_Hoja_examen_fisicio_habilitado= habilitar;
	forms.AsiUtiTrs_Ti_Examen_Fisico.elements.grp_examen_2.enabled=habilitar
	
}
/**
 * @properties={typeid:24,uuid:"958E054F-5B07-4607-A862-2F9132B51738"}
 */
function cargarExamenFisico(){
	var cbo_tipo_temp = application.getValueListItems('AsiUtiTrs_vl_temperatura_ti')
	var cbo_tipo_caract = application.getValueListItems('vl_tipo_caracteris') 
	
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.getSize()>0 && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia!=undefined && asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevoldia==1){ //editables
		f_altura=utils.numberFormat(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htialtura,2)
		f_peso=utils.numberFormat(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipeso,2)
		f_pulso_frecuencia=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipulsofrec
		f_tension_arterial_max=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitensionmax
		f_tension_arterial_min=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitensionmin
		f_temperatura = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitemper
		armChk = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiarm;
		f_cbo_tipo_temperatura = cbo_tipo_temp.getValue(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitipotemp,2);
		f_pulso_caracteristico = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipulsocarac
		//f_cbo_pulso_caract = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htitipotemp
		
		//carga examen fisico actual 
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_via_end_ctral = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiviav;
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_cateter_cook = asiutitrs_rel_tbc_hojati_to_tbc_hojati.hticatc
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_vesical = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htivesical
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_ng = asiutitrs_rel_tbc_hojati_to_tbc_hojati.hting
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_sog = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisog
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_otras = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotras
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_escaras = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiescara
		
		globals.AsiUtiTrs_Hoja_ViaEndCetral_Lugar = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiviavl
		globals.AsiUtiTrs_Hoja_Cateter_Cook_Lugar = asiutitrs_rel_tbc_hojati_to_tbc_hojati.hticatcl
		globals.AsiUtiTrs_Hoja_SondaVesical_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htivesicalobs
		globals.AsiUtiTrs_Hoja_SondaNG_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htingobs
		globals.AsiUtiTrs_Hoja_SondaSog_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htisogobs
		globals.AsiUtiTrs_Hoja_SondaOtras_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiotrasobs
		globals.AsiUtiTrs_Hoja_Escaras_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati.htiescaraobs
		
		
		
		if(utils.stringTrim(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htipulsocarac)=='Normal'){
			
			f_cbo_pulso_caract= cbo_tipo_caract.getValue(1,2) ;
			
		}else{
			f_cbo_pulso_caract= cbo_tipo_caract.getValue(2,2);
		}
		//Si es la primera de todas. habilitar diagnostico 3.
		if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.hties1erevolcc==1){
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable = true;
		}
		
		
	}else if(asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.getSize()>0 && !globals.AsiUtiTrs_Primera_Evol_Medica_Dia){//y deben ser solo de lectura //siutitrs_rel_tbc_hojati_to_tbc_hojati_primera.getSize()>0)
		//globals.AsiUtiTrs_Hoja_soloLectura = true;
		f_altura=utils.numberFormat(asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htialtura,2)
		f_peso=utils.numberFormat(asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htipeso,2)
		f_pulso_frecuencia=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htipulsofrec
		f_tension_arterial_max=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htitensionmax
		f_tension_arterial_min=asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htitensionmin
		f_pulso_caracteristico = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htipulsocarac
		armChk = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htiarm;
		f_aAquien = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htiaquien
		
		//carga examen fisico actual 
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_via_end_ctral = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htiviav;
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_cateter_cook = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.hticatc
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_vesical = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htivesical
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_ng = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.hting
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_sog = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htisog
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_sonda_otras = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htiotras
		forms.AsiUtiTrs_Ti_Examen_Fisico.f_chk_escaras = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htiescara
		globals.AsiUtiTrs_Hoja_ViaEndCetral_Lugar = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htiviavl
		globals.AsiUtiTrs_Hoja_Cateter_Cook_Lugar = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.hticatcl
		globals.AsiUtiTrs_Hoja_SondaVesical_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htivesicalobs
		globals.AsiUtiTrs_Hoja_SondaNG_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htingobs
		globals.AsiUtiTrs_Hoja_SondaSog_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htisogobs
		globals.AsiUtiTrs_Hoja_SondaOtras_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htiotrasobs
		globals.AsiUtiTrs_Hoja_Escaras_Obs = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htiescaraobs
		
		if(utils.stringTrim(f_pulso_caracteristico)=='Normal'){
			f_cbo_pulso_caract= cbo_tipo_caract.getValue(1,2) ;
			
		}else{
			f_cbo_pulso_caract =2;
			f_cbo_pulso_caract= application.getValueListItems('vl_tipo_caracteris').getValue(2,2) ;
		}
		
		f_temperatura = asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htitemper
		f_cbo_tipo_temperatura = cbo_tipo_temp.getValue(asiutitrs_rel_tbc_hojati_to_tbc_hojati_primera_dia.htitipotemp,2);
		
	}
	calcularImc();
	
}
/**
 * Handle changed data.
 *
 * @param {String} oldValue old value
 * @param {String} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"33A0460A-1581-4B29-8355-075352072564"}
 */
function onDataChangePulsoCarac(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	return true
}

/**
 * Handle changed data.
 *
 * @param {String} oldValue old value
 * @param {String} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"3B5AE0C7-BEF5-44C6-8CDF-0B4C188FF735"}
 */
function onDataChangeTensionMaxima(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	return true
}

/**
 * Handle changed data.
 *
 * @param {String} oldValue old value
 * @param {String} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"486A7E4B-3F91-4D59-87B3-2DC77E57DFCD"}
 */
function onDataChangeTensionMinima(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	return true
}

/**
 * Handle changed data.
 *
 * @param {String} oldValue old value
 * @param {String} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"4CFFA95C-CD29-4D25-80C8-413CA78784AB"}
 */
function onDataChangeDiagnosticos(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.$isDirty = true;
	return true
}



/**
 * @properties={typeid:24,uuid:"895031E4-C671-43D4-9F0B-CCA37215CDC7"}
 */
function grabarCodAuto() {
	
	var camaActual = 0;
	
	var sql = "select Cam_UtilActual_1,Cam_UtilActual_2,Cam_UtilActual_3,Cam_UtilActual_4,Cam_UtilActual_5"
		    + ",Cam_UtilAlterna_1,Cam_UtilAlterna_2,Cam_UtilAlterna_3,Cam_UtilAlterna_4,Cam_UtilAlterna_5,Cam_UtilStand"
			+ " from tbc_camas where Cam_Habi = " + asiutitrs_hoja_numero_to_asistencial_admision.adm_habita + " and cam_Cama = '" + asiutitrs_hoja_numero_to_asistencial_admision.adm_cama + "'";
	var ds = databaseManager.getDataSetByQuery('maestros',sql,null,-1);
	
	if(ds.getMaxRowIndex() > 0){
		
		//Cam_UtilActual_1
		if(ds.getValue(1,1) == 1)
			camaActual = ds.getValue(1,6);//Cam_UtilAlterna_1
		//Cam_UtilActual_2
		if(ds.getValue(1,2) == 1)
			camaActual = ds.getValue(1,7);//Cam_UtilAlterna_2
		//Cam_UtilActual_3
		if(ds.getValue(1,3) == 1)
			camaActual = ds.getValue(1,8);//Cam_UtilAlterna_3
		//Cam_UtilActual_4
		if(ds.getValue(1,4) == 1)
			camaActual = ds.getValue(1,9);//Cam_UtilAlterna_4
		//Cam_UtilActual_5
		if(ds.getValue(1,5) == 1)
			camaActual = ds.getValue(1,10);//Cam_UtilAlterna_5
		
		if(camaActual == 0)
			camaActual = ds.getValue(1,11);//Cam_UtilStand
	}
	
	// Cod Auto
	var empresa = 1;
	var obra = asiutitrs_hoja_numero_to_asistencial_admision.adm_obrsoc;
	var planX10 = asiutitrs_hoja_numero_to_asistencial_admision.adm_planobr;
	var nomeTipo = 1;
	var nomeCodi = 431110;
	var nomeDesc = '';

	globals.Call_2142_InicializarVariables();
	globals.Call_2142_empresa = empresa;
	globals.Call_2142_obra = obra;
	globals.Call_2142_planX10 = planX10;
	globals.Call_2142_sector = camaActual;
	globals.Call_2142_tipoNome = nomeTipo;
	globals.Call_2142_codiNome = nomeCodi;
	globals.Call_2142_planX = ' ';
	
	sql = "select PloPlanX from tbc_PLAN_OBRA where PloObra = " + obra + " and PloPlanX10 = '" + planX10 + "'";
	ds = databaseManager.getDataSetByQuery('asistencial',sql,null,-1);
	if(ds.getMaxRowIndex() > 0)
		globals.Call_2142_planX = ds.getValue(1,1);
	
	// AUTORIZACION-CODAUTO
	globals.Call_2142_ControlCodobra();
	if(globals.Call_2142_ok == true && globals.Call_2142_autori == 1){
		
		var servCodAuto = 22;
		var fecha = utils.stringToNumber(globals.CapturaFechaSistema());
		var hora = globals.CapturaHoraSistema('HHMMSSDD');
		
		asiutitrs_hoja_rel_codauto.newRecord();
		
		scopes.globals.InicializarDatosDeRelacion(asiutitrs_hoja_rel_codauto, "asistencial", "tbc_codauto")
		//inicializarRelacionCodAuto();
		
		asiutitrs_hoja_rel_codauto.codautoempr = empresa;
		asiutitrs_hoja_rel_codauto.codautoempr5 = empresa;
		asiutitrs_hoja_rel_codauto.codautoadmi = 0;
		asiutitrs_hoja_rel_codauto.codautoobra = obra;
		asiutitrs_hoja_rel_codauto.codautoobra3 = obra;
		asiutitrs_hoja_rel_codauto.codautoobra4 = obra;
		asiutitrs_hoja_rel_codauto.codautoobra6 = obra;
	
		asiutitrs_hoja_rel_codauto.codautohist = asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin;
		asiutitrs_hoja_rel_codauto.codautohist3 = asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin;
		asiutitrs_hoja_rel_codauto.codautohist4 = asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin;
		asiutitrs_hoja_rel_codauto.codautohist5 = asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin;
		asiutitrs_hoja_rel_codauto.codautohist6 = asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin;
		
		asiutitrs_hoja_rel_codauto.codautoserv = servCodAuto;
		asiutitrs_hoja_rel_codauto.codautoserv3 = servCodAuto;
		asiutitrs_hoja_rel_codauto.codautoserv4 = servCodAuto;
		asiutitrs_hoja_rel_codauto.codautoserv6 = servCodAuto;
		asiutitrs_hoja_rel_codauto.codautofsol = fecha
		asiutitrs_hoja_rel_codauto.codautohsol = hora;
		asiutitrs_hoja_rel_codauto.codautotipo = nomeTipo;
		asiutitrs_hoja_rel_codauto.codautocdar = nomeCodi;
		asiutitrs_hoja_rel_codauto.codautosect = camaActual;
		asiutitrs_hoja_rel_codauto.codautopedi = 0;
		asiutitrs_hoja_rel_codauto.codautotmed = globals.Srv_Login_Sanatorio_vTipoOperador;
		asiutitrs_hoja_rel_codauto.codautomedi = globals.Srv_Login_Sanatorio_vLega;
		asiutitrs_hoja_rel_codauto.codautoutiliza = asiutitrs_hoja_numero_to_asistencial_admision.adm_utiliza;
		asiutitrs_hoja_rel_codauto.codautohabita = 0;
		
		if(asiutitrs_hoja_rel_buscar_obrasocial.obrmodautpre == 1 || asiutitrs_hoja_rel_buscar_obrasocial.obrmodautpre == 3){
			var codAutoEsta = 2;
			asiutitrs_hoja_rel_codauto.codautoesta3 = codAutoEsta;
			asiutitrs_hoja_rel_codauto.codautoesta4 = codAutoEsta;
			asiutitrs_hoja_rel_codauto.codautoesta6 = codAutoEsta;
		}
	
		var sql_query = "select nome_pantalla,nome_descr from tbc_nomencla where nome_tipo = " + nomeTipo + " and nome_codigo = " + nomeCodi;
		var ds_nomencla = databaseManager.getDataSetByQuery('maestros',sql_query,null,-1);
		if(ds_nomencla.getMaxRowIndex() > 0){
			asiutitrs_hoja_rel_codauto.codautopant = ds_nomencla.getValue(1,1);
			nomeDesc = utils.stringTrim(ds_nomencla.getValue(1,2));
		}
		else
			asiutitrs_hoja_rel_codauto.codautopant = 4;
		
		asiutitrs_hoja_rel_codauto.codautoplan = globals.Call_2142_planX;
		asiutitrs_hoja_rel_codauto.codautoplan3 = globals.Call_2142_planX;
		asiutitrs_hoja_rel_codauto.codautoplan4 = globals.Call_2142_planX;
		asiutitrs_hoja_rel_codauto.codautoplan6 = globals.Call_2142_planX;
		
		var isValidSave = databaseManager.saveData(asiutitrs_hoja_rel_codauto.getRecord(1));
		if(isValidSave){
			
			var paciente = utils.stringTrim(asiutitrs_hoja_numero_to_asistencial_admision.adm_apelnom);
			var afiliado = utils.stringTrim(asiutitrs_hoja_numero_to_asistencial_admision.adm_nrobenef);
			enviarEmail(paciente,afiliado,nomeDesc,fecha,camaActual,Number(hora));
		}
	}
}



/**
 * @properties={typeid:24,uuid:"DCAE5E29-A33C-444E-A1BD-825A586982D5"}
 */
function openARM() {
	
	var formName = 'AsiArmTrs_Mod_frm_arm_dia';
	var myform = solutionModel.getForm(formName);
	
	if(myform != null){
		
		var bloqueado = globals.AsistFunciones_isRegisterTableLocked(application.getSolutionName(),formName,asiutitrs_hoja_numero_to_asistencial_admision.adm_histclin.toString(),globals.Srv_Login_Sanatorio_vLega.toString(),"Asistencia Respiratoria Mecanica");
		if(!bloqueado){
			
			globals.AsiArmTrs_Mod_wPaciente = f_paciente;
			var win2 = application.createWindow("tratamiento_ARM", JSWindow.MODAL_DIALOG);
			win2.title = 'Asistencia Respiratoria Mecanica';
			win2.resizable = false;
			win2.show(forms[formName]);
		}
	}
	else
		globals.DIALOGS.showInfoDialog("Resultado", "No existe el formulario de ARM.", "Aceptar");
	
}


/**
 * @properties={typeid:24,uuid:"C2F5A861-8429-41AE-B511-4D1FDBD47D7D"}
 */
function resetValues(){
	
	cargarExamenFisico()
	
	calcularImc();
	
	if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.getSize()>0){
		if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1!=0){
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos1;
			f_descripcion_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1.pat_descrip
			if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1!=0){
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=true;
			}
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos2;
			f_descripcion_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2.pat_descrip
			if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2!=0){
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=true;
			}
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia3=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagnos3;
			f_descripcion_patologia3 = asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_3.pat_descrip
		}
		if(asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagevo1!=0){
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagevo1;
			f_descripcion_patologia1=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_1_segunda.pat_descrip
			if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia1!=0){
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico2.editable=true;
			}
			forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.htidiagevo2;
			f_descripcion_patologia2=asiutitrs_rel_tbc_hojati_to_tbc_hojati.asiutitrs_hoja_rel_buscar_patologia_2_segunda.pat_descrip;
			if(!globals.IsBlank(forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2) && forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.f_patologia2!=0){
				forms.HciutiTrs_frm_evo_medica_utiTrs_hoja_TI.elements.txt_diagnostico3.editable=false;
			}
		}
	}
	
}


/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"F7C82F3E-531F-4FE8-8831-8B01CF3215BF"}
 */
function onActionCboPulsoCaract(event) {
	// TODO Auto-generated method stub
	if("Normal"!=f_cbo_pulso_caract){
		elements.txt_pulso_caracteristico.requestFocus();
	}else{
		elements.txt_Tensión_Máxima.requestFocus();
	}
	return true
	
}
