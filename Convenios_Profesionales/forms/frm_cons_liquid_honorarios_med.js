/**
 * @properties={typeid:35,uuid:"43717761-1815-49A0-ADAD-F378739D2781",variableType:-4}
 */

var frm_catalogo = null;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3700F729-E6C4-4CEE-B439-689C57BF780B",variableType:4}
 */
var frm_total_cant_pdf1 = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"61AF4461-DAFE-458A-A66C-7BB67588F4FC",variableType:4}
 */
var frm_total_cant_pdf2 = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"42D7B198-EBB3-4199-B7FA-2347B890D77C",variableType:4}
 */
var frm_total_cant_pdf3 = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"14C38E2A-4F89-4649-A6C6-3559EC7ABB5D",variableType:4}
 */
var frm_total_cant_pdf4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"83097716-B56E-4117-A405-BE11B1E07100",variableType:4}
 */
var frm_total_cant_1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A23D7B96-BC4D-4F43-AD49-68BF9004BADD",variableType:4}
 */
var frm_total_cant_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1B6E949C-E999-4CE6-9556-CD6884E6D424",variableType:4}
 */
var frm_total_cant_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"133A2BC8-D6E8-464F-A274-B698EA5D9A8A",variableType:4}
 */
var frm_total_cant_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"99C8D279-435A-446C-868F-F5CA274B39BE",variableType:8}
 */
var frm_total_valor_1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C863BE4F-63DC-4D9C-AA82-CE8FA2691B0B",variableType:8}
 */
var frm_total_valor_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B9618753-E64C-4D23-8519-268C3F4BC827",variableType:8}
 */
var frm_total_valor_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BC848CBB-E89B-46FD-8C8D-742D81FFF7CF",variableType:8}
 */
var frm_total_valor_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"78F3153D-45FC-49AE-8597-D6A96A133ABA",variableType:8}
 */
var frm_total_iva_1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0E652472-561A-452C-9BB8-9A699748AE1C",variableType:8}
 */
var frm_total_iva_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"974133C4-A708-433A-9054-83161938950D",variableType:8}
 */
var frm_total_iva_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BA4E9D23-423F-4B9E-B507-33FC5709A2B4",variableType:8}
 */
var frm_total_iva_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D54C21F4-6154-4800-844F-8BF40466DA86",variableType:8}
 */
var frm_total_imp_1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"819FADA8-9905-4581-B4DB-2FF910373AA4",variableType:8}
 */
var frm_total_imp_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"18104400-51BE-4D99-8B18-15E73AABCF97",variableType:8}
 */
var frm_total_imp_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"098E96ED-F673-42A5-A7BD-2E68F05EE123",variableType:8}
 */
var frm_total_imp_4 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7D769F7A-822C-4C69-A096-F4D6C7155757"}
 */
var frm_prof_descripcion = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"04AAC7A2-A2E3-4C8F-87FD-25B2F58BC085"}
 */
var frm_tipo_prestacion = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"152F11E1-B7EA-468B-AD4F-EF8FD88E4A65"}
 */
var frm_con_profesional = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"611E1DEC-96B3-47BE-8BFB-F08644F1E402",variableType:4}
 */
var frm_error = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F0BA22F6-3643-45CD-80A4-B682D2AB76F3",variableType:4}
 */
var frm_lote = 0;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"39B9ED9E-D397-4A42-A13E-FA0894CFC0D8",variableType:93}
 */
var frm_fecha_desde = null;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"7A17F5B0-59C3-4070-9E8F-B80FF0D86D99",variableType:93}
 */
var frm_fecha_hasta = null;

/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"28E358DB-D7C0-4869-AEBB-8337CA63387D"}
 */
function onShow_inicio(firstShow, event) {
	elements.lbl_titulo.text = 'Liquidación Honorarios Médicos'	
	inicializa_campos()
}

/**
 * @properties={typeid:24,uuid:"5F269797-CC56-41A3-9CCD-129D0F9918B8"}
 */
function controlar_profesional(){
	if(frm_con_profesional != ''){
	    // identifica si el campo es numérico o alfanumerico
		var largo = frm_con_profesional.length;
		var esnumero = true;
		for (var i= 0;i<largo && esnumero == true; i++){
	    	if (frm_con_profesional.charCodeAt(i)< 48 || frm_con_profesional.charCodeAt(i) > 57){
		    	esnumero = false
		   	}
		}
		if (esnumero){
	        if(largo>6){
	    	   //muestra mensaje de "dialogo"				   
				globals.DIALOGS.showErrorDialog('Error','Código inexistente', 'Ok')
				elements.con_profesional.requestFocus()				   				   
		   	}else{
		   	   globals.gbl_profesional = utils.stringToNumber(frm_con_profesional.toString())
			   var $size = gbl_prof_to_prof.getSize()
			   if (globals.gbl_catalogo == 'cirendsa'){
				   $size = gbl_prof_to_prof_cirendsa.getSize()			   }					   
	   		   if ($size < 1){	
				   frm_error = 1				       
				   globals.DIALOGS.showErrorDialog('Error','Código inexistente', 'Ok')				       
			       globals.gbl_profesional = 0					   
			   	   frm_con_profesional     = ' '
				   frm_prof_descripcion    = ''
				   elements.con_profesional.requestFocus()					   
			   }else {
				   var $legajo_personal = gbl_prof_to_prof.prof20
				   var $legajo_medico   = gbl_prof_to_prof.prof28
				   if (globals.gbl_catalogo == 'cirendsa'){
					   $legajo_personal = gbl_prof_to_prof_cirendsa.prof20
					   $legajo_medico   = gbl_prof_to_prof_cirendsa.prof28
				   }
				   if($legajo_personal == 0 && $legajo_medico == 0){
					   frm_error = 1				       
					   globals.DIALOGS.showErrorDialog('Error','Relación inexistente', 'Ok')				       
				       globals.gbl_profesional = 0					   
				   	   frm_con_profesional     = ' '
					   frm_prof_descripcion    = ''
					   elements.con_profesional.requestFocus()
			       }else{
			    	   frm_prof_descripcion = gbl_prof_to_prof.prof2_2
			    	   globals.gbl_sit_iva  = gbl_prof_to_prof.prof6
					   if (globals.gbl_catalogo == 'cirendsa'){
						  frm_prof_descripcion = gbl_prof_to_prof_cirendsa.prof2_2
						  globals.gbl_sit_iva  = gbl_prof_to_prof_cirendsa.prof6
					   }
			   	       elements.con_lote.requestFocus()
			       }
			   }		
		   	}
	    }else{
	        globals.gbl_con_indice = 1	       	   
		    globals.gbl_con_busca = frm_con_profesional
			var win = application.createWindow("Busca_profe",JSWindow.MODAL_DIALOG)	
			win.title= 'Buscar Profesional'
			win.resizable = false
			win.show(forms.frm_tab_profesionales)

			if (forms.frm_scr_profesionales.foundset.codigo> 0){
				if(forms.frm_scr_profesionales.foundset.legajo_personal == 0 && forms.frm_scr_profesionales.foundset.legajo_medico == 0){
					frm_error = 1				       
					globals.DIALOGS.showErrorDialog('Error','Relación inexistente', 'Ok')				       
				    globals.gbl_profesional = 0					   
				   	frm_con_profesional     = ' '
					frm_prof_descripcion    = ''
					elements.con_profesional.requestFocus()
			    }else{
			        frm_con_profesional  = forms.frm_scr_profesionales.foundset.codigo.toString()
			        frm_prof_descripcion = forms.frm_scr_profesionales.foundset.descripcion			   
			        globals.gbl_sit_iva  = forms.frm_scr_profesionales.foundset.sit_iva
					elements.con_lote.requestFocus()
			    }
			}
		}	    
	}
}

/**
 * @properties={typeid:24,uuid:"2401AEEE-A36A-4E31-A093-73A8AF64547E"}
 */
function buscar_profesional(){
	var largo = frm_con_profesional.length;
    var esnumero = true;
    globals.gbl_con_indice = 1; 
    for (var i= 0;i<largo && esnumero == true; i++){
	   if (frm_con_profesional.charCodeAt(i)< 48 || frm_con_profesional.charCodeAt(i) > 57){
		   esnumero = false
	   }
    }
    if (esnumero){
	   globals.gbl_profesional = utils.stringToNumber(frm_con_profesional.valueOf())
	   globals.gbl_con_indice = 2
    }else{
	   globals.gbl_con_indice = 1
    }    
	globals.gbl_con_busca = frm_con_profesional
	var win = application.createWindow("Busca_profe",JSWindow.MODAL_DIALOG)	
	win.title= 'Buscar Profesional'
	win.resizable = false		
	win.show(forms.frm_tab_profesionales)

	if (forms.frm_scr_profesionales.foundset.codigo > 0){
		if(forms.frm_scr_profesionales.foundset.legajo_personal == 0 && forms.frm_scr_profesionales.foundset.legajo_medico == 0){
			frm_error = 1				       
			globals.DIALOGS.showErrorDialog('Error','Relación inexistente', 'Ok')				       
		    globals.gbl_profesional = 0					   
		   	frm_con_profesional     = ' '
			frm_prof_descripcion    = ''
			elements.con_profesional.requestFocus()
	    }else{
	        frm_con_profesional  = forms.frm_scr_profesionales.foundset.codigo.toString()
	        frm_prof_descripcion = forms.frm_scr_profesionales.foundset.descripcion	   
	        globals.gbl_sit_iva  = forms.frm_scr_profesionales.foundset.sit_iva
			elements.con_lote.requestFocus()
	    }
	}else{
	   globals.gbl_profesional = 0
	   frm_prof_descripcion    = ''
	}	
}

/**
 * @properties={typeid:24,uuid:"1792B0BA-8520-4815-9EC5-A55E7C441027"}
 */
function controlar_lote(){
	globals.gbl_lote = frm_lote 
	if (frm_lote != ''){
		globals.gbl_lote = frm_lote	   		
		if (tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.getSize() < 1){
		    frm_error = 1
		    globals.DIALOGS.showErrorDialog('Error','Código inexistente', 'Ok')			   	   
		    globals.gbl_lote = 0
		    elements.con_lote.requestFocus()
			inicializa_campos()
		}else{
			frm_tipo_prestacion = application.getValueListDisplayValue('vl_tipo_prestacion',tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.tipo_prestacion)
			elements.btn_procesar.requestFocus()
		}   
    }
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"8B85CA18-8652-4107-9A78-CC203D89C92A"}
 */
function buscar_lote(event) {
	globals.gbl_lote = frm_lote
	if(globals.gbl_profesional == 0){
		globals.DIALOGS.showErrorDialog('Error','Falta el código del Profesional', 'Ok')	
	}else{		
		forms.frm_tab_lotes_liq_prof.cargar_tabla()
	    var win = application.createWindow("Busca_lote",JSWindow.MODAL_DIALOG)	
	    win.title= 'Buscar Lote Liquidación Honorarios'
	    win.resizable = false		
	    win.show(forms.frm_tab_lotes_liq_prof)

	    if (forms.frm_scr_lotes_liq_prof.foundset.lote > 0){
	        frm_lote = forms.frm_scr_lotes_liq_prof.foundset.lote
	        frm_tipo_prestacion = forms.frm_scr_lotes_liq_prof.foundset.tipo_prestacion
   	        elements.btn_procesar.requestFocus()	   
	    }else{
	       globals.gbl_lote = 0
	    }
	}	
}

/**
 * @properties={typeid:24,uuid:"F9151E9D-7633-4993-8351-FA0067B89BB9"}
 */
function inicializa_campos(){
	globals.gbl_con_empresa  = 1
	frm_con_profesional      = ' '
	globals.gbl_profesional  = 0
	frm_prof_descripcion     = ''
	globals.gbl_sit_iva      = null 
	globals.gbl_lote         = 0
	globals.gbl_operador             = ''
	frm_lote                 = 0
	frm_tipo_prestacion      = ''
	inicializa_tot() 	
	globals.gbl_cerrarConsultaRegistro = false;	
	elements.btn_imprimir.enabled      = false
	elements.btn_email.enabled         = false
	forms.frm_scr_cons_liquid_honorarios_med.foundset.deleteAllRecords()
	forms.frm_scr_cons_liquid_honorarios_med_practicas.foundset.deleteAllRecords()
	forms.frm_scr_cons_liquid_honorarios_med_intercons.foundset.deleteAllRecords()
	forms.frm_scr_cons_liquid_honorarios_med_seguimien.foundset.deleteAllRecords()
	elements.tabless.tabIndex = 1
	
	globals.gbl_catalogo        = 'maestros'
	//Carga tabla de Profesionales
    forms.frm_tab_profesionales.cargar_tabla()
	//Carga tabla de Obras Sociales
    forms.frm_tab_coberturas_emp.cargar_tabla()
}

/**
 * @properties={typeid:24,uuid:"140EAF7F-A8AD-477F-9960-DA38B3E1957A"}
 */
function inicializa_tot(){
    frm_total_cant_1         = 0
	frm_total_cant_2         = 0
	frm_total_cant_3         = 0
	frm_total_cant_4         = 0
	frm_total_valor_1        = 0
	frm_total_valor_2        = 0
	frm_total_valor_3        = 0
	frm_total_valor_4        = 0
	frm_total_iva_1          = 0
	frm_total_iva_2          = 0
	frm_total_iva_3          = 0
	frm_total_iva_4          = 0
	frm_total_imp_1          = 0
	frm_total_imp_2          = 0
	frm_total_imp_3          = 0
	frm_total_imp_4          = 0
	frm_total_cant_pdf1      = 0
	frm_total_cant_pdf2      = 0
	frm_total_cant_pdf3      = 0
	frm_total_cant_pdf4      = 0
}




/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"78E390B0-DDE9-40E5-B78D-3DE244855B0E"}
 * @AllowToRunInFind
 */
function onAction_procesar(event) {
	if (frm_con_profesional == ''|| frm_lote == 0){
		globals.DIALOGS.showWarningDialog('Atención','No se puede procesar, faltan datos', 'Ok')
	    elements.con_profesional.requestFocus()
	}else{
		elements.lbl_procesando.text = 'Procesando.....'
		elements.lbl_procesando.visible = true
		application.updateUI()		
		//Cargar tabla de liquidacion
		var $Args
		var $SQL = "select * from tbl_liquid_hon_prof_cons "            
            $SQL+= "where lote = "
            $SQL+= frm_lote		
            $SQL+= " and profesional = "
            $SQL+= globals.gbl_profesional
            $SQL+= " order by lote asc, fecha asc, hora asc "
			
		var $ds = databaseManager.getDataSetByQuery("desal", $SQL, $Args, -1);
		var $max = $ds.getMaxRowIndex()
		if ($max != 0){		
		    var frm_ds2 = databaseManager.createEmptyDataSet()
		    frm_ds2.addColumn('res_cod_med',          1,JSColumn.NUMBER)
			frm_ds2.addColumn('res_des_med',          2,JSColumn.TEXT)
		    frm_ds2.addColumn('res_cod_esp',          3,JSColumn.NUMBER)
			frm_ds2.addColumn('res_des_esp',          4,JSColumn.TEXT)
			frm_ds2.addColumn('res_fecha',            5,JSColumn.DATETIME)	
			frm_ds2.addColumn('res_hora',             6,JSColumn.TEXT)
			frm_ds2.addColumn('res_cod_obra',         7,JSColumn.NUMBER)
		    frm_ds2.addColumn('res_des_obra',         8,JSColumn.TEXT)
			frm_ds2.addColumn('res_plan_obra',        9,JSColumn.TEXT)
			frm_ds2.addColumn('res_hist_cli',        10,JSColumn.NUMBER)						
			frm_ds2.addColumn('res_afiliado',        11,JSColumn.TEXT)
			frm_ds2.addColumn('res_iva',             12,JSColumn.TEXT)			
			frm_ds2.addColumn('res_tipo_nome',       13,JSColumn.NUMBER)
			frm_ds2.addColumn('res_cod_nomencla',    14,JSColumn.NUMBER)
			frm_ds2.addColumn('res_des_nomencla',    15,JSColumn.TEXT)
			
			frm_ds2.addColumn('res_cantidad',        16,JSColumn.NUMBER)
			frm_ds2.addColumn('res_imp_valor',       17,JSColumn.NUMBER)
			frm_ds2.addColumn('res_grupo_nome',      18,JSColumn.NUMBER)
			frm_ds2.addColumn('res_txt_nomencla',    19,JSColumn.TEXT)
			frm_ds2.addColumn('res_des_hist_cli',    20,JSColumn.TEXT)
			frm_ds2.addColumn('res_fecha_pedido',    21,JSColumn.DATETIME)
			frm_ds2.addColumn('res_fecha_realizado', 22,JSColumn.DATETIME)
			frm_ds2.addColumn('res_remoto',          23,JSColumn.TEXT)
			frm_ds2.addColumn('res_urgente',         24,JSColumn.TEXT)
			frm_ds2.addColumn('res_pedido',          25,JSColumn.NUMBER)
			var $aux_iva = ''		
			frm_fecha_desde = forms.frm_scr_lotes_liq_prof.foundset.fecha_desde
			frm_fecha_hasta = forms.frm_scr_lotes_liq_prof.foundset.fecha_hasta
			
			for (var i= 1; i <= $max; i++){		
				switch ($ds.getValue(i,13)){
					case 1: $aux_iva = 'No gravado       '; break
					case 2: $aux_iva = 'Alícuota General '; break
					case 3: $aux_iva = 'Alícuota Reducida'; break
				}
									
				var $hora  = $ds.getValue(i,6).toString()
				switch ($hora.length){
				    case 1: $hora = '00:0' + $hora.substr(0,1); break;
				    case 2: $hora = '00:' + $hora.substr(0,1) + $hora.substr(1,1) ; break;
				    case 3: $hora = '0' + $hora.substr(0,1) + ':' + $hora.substr(1,1) + $hora.substr(2,1) ; break;
				    case 7: $hora = '0' + $hora.substr(0,1) + ':' + $hora.substr(1,1) + $hora.substr(2,1) ; break;
				    default : $hora = $hora.substr(0,1) + $hora.substr(1,1) + ':' + $hora.substr(2,1)+$hora.substr(3,1) ; break;
				}
				var $txt_nomencla =  $ds.getValue(i,9).toString()					
				switch ($txt_nomencla.length){
				    case 1: $txt_nomencla = '00.00.00' + $txt_nomencla.substr(0,1); break;
				    case 2: $txt_nomencla = '00.00.' + $txt_nomencla.substr(0,1) + $txt_nomencla.substr(1,1) ; break;
				    case 3: $txt_nomencla = '00.0' + $txt_nomencla.substr(0,1) + '.' + $txt_nomencla.substr(1,1) + $txt_nomencla.substr(2,1) ; break;
				    case 4: $txt_nomencla = '00.' + $txt_nomencla.substr(0,1) + $txt_nomencla.substr(1,1) + '.' + $txt_nomencla.substr(2,1) + $txt_nomencla.substr(3,1) ; break;
				    case 5: $txt_nomencla = '0' + $txt_nomencla.substr(0,1) + '.' + $txt_nomencla.substr(1,1) + $txt_nomencla.substr(2,1) + '.' + $txt_nomencla.substr(3,1) 
						                        + $txt_nomencla.substr(4,1); break;				        
				    case 6: $txt_nomencla = $txt_nomencla.substr(0,1) + $txt_nomencla.substr(1,1) + '.' + $txt_nomencla.substr(2,1) + $txt_nomencla.substr(3,1) + '.' 
						                        + $txt_nomencla.substr(4,1) + $txt_nomencla.substr(5,1); break;
				    default:$txt_nomencla = $txt_nomencla.substr(0,1) + $txt_nomencla.substr(1,1) + '.' + $txt_nomencla.substr(2,1) + $txt_nomencla.substr(3,1) + '.' 
                                               + $txt_nomencla.substr(4,1) + $txt_nomencla.substr(5,1); break;
				}					
					
				var $fecha_desde = $ds.getValue(i,5).toString()
				    $fecha_desde = $fecha_desde.substr(0,4) + '-' + $fecha_desde.substr(4,2) + '-' + $fecha_desde.substr(6,2)
				var $aux_remoto = 'No'
				if($ds.getValue(i,31) == 1){
					$aux_remoto = 'Si'
				}
				var $aux_urgente = 'Dentro de las 24 Hs.'
				if($ds.getValue(i,32) == 1){
					$aux_urgente = 'Urgente'
				}
				if($ds.getValue(i,28) == 2){
				    $aux_urgente = application.getValueListDisplayValue('vl_prestacion_sitio',$ds.getValue(i,32))
				}
				frm_ds2.addRow([$ds.getValue(i,2), $ds.getValue(i,14), $ds.getValue(i,3), $ds.getValue(i,15), $ds.getValue(i,5),
			                   $hora, $ds.getValue(i,4), $ds.getValue(i,16), $ds.getValue(i,7), $ds.getValue(i,11),
							   $ds.getValue(i,12), $aux_iva, $ds.getValue(i,10), $ds.getValue(i,9), $ds.getValue(i,17),
							   $ds.getValue(i,18), $ds.getValue(i,19), $ds.getValue(i,8), $txt_nomencla, $ds.getValue(i,25),
							   $ds.getValue(i,29), $ds.getValue(i,30), $aux_remoto, $aux_urgente, $ds.getValue(i,33),])				
			}
				
			var $tipos = [JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.DATETIME, 
			              JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, 
						  JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER,
						  JSColumn.NUMBER, JSColumn.TEXT, JSColumn.TEXT, JSColumn.DATETIME, JSColumn.DATETIME, JSColumn.TEXT,
						  JSColumn.TEXT, JSColumn.NUMBER]
			var $frm = null
			if($ds.getValue(1,28) == 1){
		        $frm = solutionModel.getForm('frm_scr_cons_liquid_honorarios_med')
				$frm.dataSource = frm_ds2.createDataSource('Auxd_frm_scr_cons_liquid_honorarios_med', $tipos)
			    forms.frm_scr_cons_liquid_honorarios_med.calcular_totales()
		        forms.frm_scr_cons_liquid_honorarios_med.controller.recreateUI()
			    elements.tabless.tabIndex = 2
			}
			if($ds.getValue(1,28) == 2){
		        $frm = solutionModel.getForm('frm_scr_cons_liquid_honorarios_med_practicas')
		        $frm.dataSource = frm_ds2.createDataSource('Auxd_frm_scr_cons_liquid_honorarios_med_practicas', $tipos)
			    forms.frm_scr_cons_liquid_honorarios_med_practicas.calcular_totales()
		        forms.frm_scr_cons_liquid_honorarios_med_practicas.controller.recreateUI()
			    elements.tabless.tabIndex = 3
			}
			if($ds.getValue(1,28) == 3){
		        $frm = solutionModel.getForm('frm_scr_cons_liquid_honorarios_med_intercons')
		        $frm.dataSource = frm_ds2.createDataSource('Auxd_frm_scr_cons_liquid_honorarios_med_intercons', $tipos)
			    forms.frm_scr_cons_liquid_honorarios_med_intercons.calcular_totales()
		        forms.frm_scr_cons_liquid_honorarios_med_intercons.controller.recreateUI()
			    elements.tabless.tabIndex = 4
			}
			if($ds.getValue(1,28) == 4){
		        $frm = solutionModel.getForm('frm_scr_cons_liquid_honorarios_med_seguimien')
		        $frm.dataSource = frm_ds2.createDataSource('Auxd_frm_scr_cons_liquid_honorarios_med_seguimien', $tipos)
			    forms.frm_scr_cons_liquid_honorarios_med_seguimien.calcular_totales()
		        forms.frm_scr_cons_liquid_honorarios_med_seguimien.controller.recreateUI()
			    elements.tabless.tabIndex = 5
			}
			elements.btn_imprimir.enabled = true
			elements.btn_email.enabled    = true
		}else{
			globals.DIALOGS.showWarningDialog('Atención','No hay datos para mostrar')
			 inicializa_campos()	
		}
	} 
		
	elements.lbl_procesando.visible = false	
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"E48E0FF0-619F-4014-A298-1AB255721CE6"}
 */
function onHide_consultaRegistro(event) {
	if(globals.gbl_cerrarConsultaRegistro){
		var $win = application.getWindow(application.getActiveWindow().getName());
		if($win != null){
			$win.hide();
			$win.destroy();
		}
	}
	return globals.gbl_cerrarConsultaRegistro;
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"C40A563A-B40F-4EB9-98A1-8785EEF5434C"}
 */
function onAction_cerrar(event) {
	globals.gbl_cerrarConsultaRegistro = true;
	onHide_consultaRegistro(event);
}

/**
 * @properties={typeid:24,uuid:"91DA848B-191A-4274-97D7-7A65C21856E5"}
 */
function imprimir_pdf(){
	
	var nombres = globals.vOperador.split(' ');
	var operadorAbreviado  = ''
	var cantNombre = nombres.length>3?3:nombres.length
	for (var index = 0; index < cantNombre; index++) {
		if(index >0){
			operadorAbreviado = operadorAbreviado +' '+ globals.abreviarNombre(nombres[index])+'.'
			
		}else{
			operadorAbreviado = operadorAbreviado+ nombres[index];
		}
	}
	globals.gbl_operador = operadorAbreviado + ' LEG '+ globals.vLega
	
	var $params = {		
		pr_img1:"media:///logo1.png", pr_img2:"media:///logo2.png",	pr_fecha_desde: frm_fecha_desde, pr_fecha_hasta: frm_fecha_hasta,
		pr_profesional: frm_prof_descripcion, pr_lote: frm_lote, pr_operador: globals.gbl_operador,
		res_total_cant_1: frm_total_cant_pdf1, res_total_cant_2: frm_total_cant_pdf2, res_total_cant_3: frm_total_cant_pdf3, res_total_cant_4: frm_total_cant_pdf4, 
		res_total_valor_1 : frm_total_valor_1, res_total_valor_2 : frm_total_valor_2, res_total_valor_3 : frm_total_valor_3, res_total_valor_4 : frm_total_valor_4,              
		res_total_iva_1 : frm_total_iva_1, res_total_iva_2 : frm_total_iva_2, res_total_iva_3 : frm_total_iva_3, res_total_iva_4 : frm_total_iva_4,
		res_total_imp_1 : frm_total_imp_1, res_total_imp_2 : frm_total_imp_2, res_total_imp_3 : frm_total_imp_3, res_total_imp_4 : frm_total_imp_4		
	
	}
	
	var $arch = plugins.file.showFileSaveDialog('SQ-LIQUID-PROF' + application.getIPAddress() + '.pdf')
	if ($arch){	
		if (tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.tipo_prestacion == 1){
		    plugins.jasperPluginRMI.runReport(forms.frm_scr_cons_liquid_honorarios_med.foundset,'rp_liquid_prof.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		}
		
		if (tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.tipo_prestacion == 2){
		    plugins.jasperPluginRMI.runReport(forms.frm_scr_cons_liquid_honorarios_med_practicas.foundset,'rp_liquid_prof_practicas.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		}
		if (tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.tipo_prestacion == 3){
		    plugins.jasperPluginRMI.runReport(forms.frm_scr_cons_liquid_honorarios_med_intercons.foundset,'rp_liquid_prof_intercons.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		}
		if (tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.tipo_prestacion == 4){
		    plugins.jasperPluginRMI.runReport(forms.frm_scr_cons_liquid_honorarios_med_seguimien.foundset,'rp_liquid_prof_seguimien.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		}
		var $OS = application.getOSName();
		if (/Windows/.test($OS)) {
		    application.executeProgram("rundll32.exe", ["url.dll,FileProtocolHandler", $arch.getAbsolutePath()]);	      
	    } else if (/Linux|Freebsd/.test($OS)) {
	       application.executeProgram('xdg-open', $arch);
	    } else if (/Mac/.test($OS)) {
	       application.executeProgram('open', $arch);
	    }
	}	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"AB72F3BE-500B-4F1D-82DF-3D5D4C058B40"}
 * @AllowToRunInFind
 */
function envio_email(event) {
	
	var nombres = globals.vOperador.split(' ');
	var operadorAbreviado  = ''
	var cantNombre = nombres.length>3?3:nombres.length
	for (var index = 0; index < cantNombre; index++) {
		if(index >0){
			operadorAbreviado = operadorAbreviado +' '+ globals.abreviarNombre(nombres[index])+'.'
			
		}else{
			operadorAbreviado = operadorAbreviado+ nombres[index];
		}
	}
	globals.gbl_operador = operadorAbreviado + ' LEG '+ globals.vLega
	
	if (gbl_prof_to_prof.prof26 == null || gbl_prof_to_prof.prof26 == ''){
		globals.DIALOGS.showWarningDialog('Atención','El profesional no posee correo electrónico')
	}else{
		var ok = globals.DIALOGS.showInfoDialog('Atención','Se enviará por email al profesional el lote de liquidación, confirma ', 'Si', 'No')
		if(ok == 'Si'){
			var $params = {		
				pr_img1:"media:///logo1.png", pr_img2:"media:///logo2.png",	pr_fecha_desde: frm_fecha_desde, pr_fecha_hasta: frm_fecha_hasta,
				pr_profesional: frm_prof_descripcion, pr_lote: frm_lote,  pr_operador: globals.gbl_operador,
				res_total_cant_1: frm_total_cant_pdf1, res_total_cant_2: frm_total_cant_pdf2, res_total_cant_3: frm_total_cant_pdf3, res_total_cant_4: frm_total_cant_pdf4, 
				res_total_valor_1 : frm_total_valor_1, res_total_valor_2 : frm_total_valor_2, res_total_valor_3 : frm_total_valor_3, res_total_valor_4 : frm_total_valor_4,              
				res_total_iva_1 : frm_total_iva_1, res_total_iva_2 : frm_total_iva_2, res_total_iva_3 : frm_total_iva_3, res_total_iva_4 : frm_total_iva_4,
				res_total_imp_1 : frm_total_imp_1, res_total_imp_2 : frm_total_imp_2, res_total_imp_3 : frm_total_imp_3, res_total_imp_4 : frm_total_imp_4		
			}
			
			var tempFile = plugins.file.createTempFile('tmp', '.pdf');	
	
			//var $arch =plugins.file.convertToJSFile('c:/temp/tmp.pdf')
			var $arch =plugins.file.convertToJSFile(tempFile.getAbsolutePath())
			
			var fs_mail = databaseManager.getFoundSet("parametros","param_mail_autoriz")
			fs_mail.find()
			fs_mail['cuenta']= 'pmedicas'
			fs_mail.search()
			if(fs_mail.getSize()<1){
				globals.DIALOGS.showErrorDialog('Error','No se encontro cuenta de correo desde.')
				return
			}else{
				fs_mail.setSelectedIndex(1)
			}
			if (tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.tipo_prestacion == 1){
			    plugins.jasperPluginRMI.runReport(forms.frm_scr_cons_liquid_honorarios_med.foundset,'rp_liquid_prof.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
			}
			if (tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.tipo_prestacion == 2){
			    plugins.jasperPluginRMI.runReport(forms.frm_scr_cons_liquid_honorarios_med_practicas.foundset,'rp_liquid_prof_practicas.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
			}
			if (tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.tipo_prestacion == 3){
			    plugins.jasperPluginRMI.runReport(forms.frm_scr_cons_liquid_honorarios_med_intercons.foundset,'rp_liquid_prof_intercons.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
			}
			if (tbl_liquid_hon_prof_cons_to_tbl_liquid_hon_prof_cons.tipo_prestacion == 4){
			    plugins.jasperPluginRMI.runReport(forms.frm_scr_cons_liquid_honorarios_med_seguimien.foundset,'rp_liquid_prof_seguimien.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
			}
			var properties = new Array();	
	        properties[0] = 'mail.smtp.host=' + fs_mail['mail_smtp_host'];
	        properties[1] = 'mail.smtp.auth=true';
	        properties[2] = 'mail.smtp.username=' + fs_mail['username'];
	        properties[3] = 'mail.smtp.password=' + fs_mail['clave'];
	        properties[4] = 'mail.smtp.port=25';
			//var attachment= plugins.mail.createBinaryAttachment('Liquidación de honorarios médicos',plugins.file.readFile('c:/temp/tmp.pdf'));
	        var attachment= plugins.mail.createBinaryAttachment('Liquidación de honorarios médicos',plugins.file.readFile(tempFile.getAbsolutePath()));
			var asunto    = "Liquidación de honorarios médicos - Profesional "+ frm_prof_descripcion  
			var bodymsg   = "<html><body>"+"Se adjunta liquidaci&#243;n en archivo pdf correspondiente al Lote Nro. " + frm_lote
			bodymsg += "<br>Sr. Profesional: <br>"
			bodymsg += "La factura correspondiente debe ser enviada a los siguientes correos electr&#243;nicos:<br>"
			bodymsg += "Para: lmunoz@sanatoriocolegiales.com.ar <br>"
			bodymsg += "Para: nfontan@sanatoriocolegiales.com.ar <br>"
			bodymsg += "CC: clausmocovich@sanatoriocolegiales.com.ar <br><br>"
			bodymsg += "Este correo se env&#237;a en forma autom&#225;tica, por favor no lo responda "+"</body></html>";
			var mail_para = gbl_prof_to_prof.prof26
			var mail_cc   = 'clausmocovich@sanatoriocolegiales.com.ar, clongo@sanatoriocolegiales.com.ar, lmunoz@sanatoriocolegiales.com.ar'
			var mail_cco  = 'fhuertas@cirendsa.com.ar'	
			var success = plugins.mail.sendMail(mail_para,  fs_mail['mail_origen'], asunto, bodymsg, mail_cc, mail_cco,[attachment], properties);
			
			// guardar log de mail
			
			var $id = application.getUUID();
			//Verificando si existe clave primaria
			var sql = "SELECT EXISTS( SELECT id FROM tbl_mail_liq_conv_prof WHERE id='" + $id + "')"
			var dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
			while(dsExists.getValue(1,1) == 1){
				$id = application.getUUID();
				sql = "SELECT EXISTS( SELECT id FROM tbl_mail_liq_conv_prof WHERE id='" + $id + "')"
				dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
			}	
			var fs = databaseManager.getFoundSet("desal","tbl_mail_liq_conv_prof")
			fs.newRecord()
			
			fs['id']         = $id;
			fs['fecha']      =globals.gbl_fecha_hoy;
			fs['hora']       =application.getServerTimeStamp();
			fs['profesional']=profesional;
			fs['lote']       =frm_lote;
			fs['mail_para']  =mail_para;
			fs['mail_cc']    =mail_cc;
			fs['mail_cco']   =mail_cco;
			//fs['pdf']        =plugins.file.readFile('c:/temp/tmp.pdf');
			fs['pdf']        =plugins.file.readFile(tempFile.getAbsolutePath());
			if(!success){
				fs['estado']     =false;
		    }else{
		    	fs['estado']     =true;
		    }
			fs['legajo']     =globals.vLega;
			
			
			databaseManager.startTransaction()
			var result = databaseManager.saveData(fs);
			if(result){
				databaseManager.commitTransaction();
			}else{
				databaseManager.rollbackTransaction()	
			}
			if (!success){
				globals.DIALOGS.showErrorDialog('Error','No se pudo enviar email, intentelo nuevamente.')
			}else{
			    globals.DIALOGS.showInfoDialog('Envío','El envío de correo se efectuo satifactoriamente.')
			}
			plugins.file.deleteFile(tempFile.getAbsolutePath())
		}
	}
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"9B5CAD12-F24A-4262-996E-5A179B96D720"}
 */
function onAction_controlar_empresa(event) {
	switch (globals.gbl_con_empresa){
        case 1: globals.gbl_catalogo = 'maestros';break;
        case 11: globals.gbl_catalogo = 'cirendsa';break;	
        default: globals.gbl_catalogo = 'maestros';break;	    
    }
    //Carga tabla de Profesionales
    frm_con_profesional         = ' ' 
    globals.gbl_con_profesional = ' '
    globals.gbl_profesional     = 0
    frm_prof_descripcion        = ''
    elements.lbl_procesando.text = 'Cargando Tabla Profesionales'
    elements.lbl_procesando.visible = true       
    forms.frm_tab_profesionales.cargar_tabla()
    elements.lbl_procesando.visible = false
}
