/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"DADEAF24-E82D-4B86-A526-E9D03281D3B2",variableType:4}
 */
var frm_tipo_prestacion = 1;
/**
 * @properties={typeid:35,uuid:"AE1BFCA5-144B-4C65-81FD-F2FAF23E19A7",variableType:-4}
 */
var frm_catalogo = null;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"35BDDF73-5502-40B3-9C33-2540AF736CAD"}
 */
var frm_arch = ''
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9C80719E-C0B9-4594-989D-ACE8595A22A2",variableType:4}
 */
var frm_total_cant_pdf1 = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"53301E39-4588-4462-86DA-FF4535301568",variableType:4}
 */
var frm_total_cant_pdf2 = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"841E4A4E-0946-4D35-8444-DAD4E5A62A88",variableType:4}
 */
var frm_total_cant_pdf3 = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2103F196-92E5-4F04-B487-66D9D3329CF1",variableType:4}
 */
var frm_total_cant_pdf4 = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6B20E0E7-AB97-42A1-B225-AAB6A50A01A2",variableType:4}
 */
var frm_total_cant_1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FA0FC1CE-F049-4116-92F5-D496AE727430",variableType:4}
 */
var frm_total_cant_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9FFF54F1-05A0-4EDD-A78D-ED80239989FA",variableType:4}
 */
var frm_total_cant_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"67F11F31-9B9E-440B-A0B0-BA0AEDDE682D",variableType:4}
 */
var frm_total_cant_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"55E642CB-DD1D-4638-A038-1B1B8A3AA16A",variableType:8}
 */
var frm_total_valor_1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B59568FA-9A67-4593-BB23-7713CC5A9B16",variableType:8}
 */
var frm_total_valor_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"81B02181-6D24-4E57-8E13-258FB89EDD9D",variableType:8}
 */
var frm_total_valor_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4E1AAF9D-996D-45D7-A595-6EF6290A5F2D",variableType:8}
 */
var frm_total_valor_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"00E977A9-F505-4257-84F9-F0C4F146876A",variableType:8}
 */
var frm_total_iva_1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3FBA8F42-8644-4894-8252-D22D891B82F3",variableType:8}
 */
var frm_total_iva_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A734DE84-E01E-4DC2-AB36-DEB9B82A9C0F",variableType:8}
 */
var frm_total_iva_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D8E046B6-7539-4311-9CD4-4C3D78984C8C",variableType:8}
 */
var frm_total_iva_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"28E9E7C3-5851-44FD-A08E-E6B8A84C6E04",variableType:8}
 */
var frm_total_imp_1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2F56F6C0-A760-47A1-A77A-BCC9C0D33926",variableType:8}
 */
var frm_total_imp_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"01B29832-4FF8-41C6-B783-52CC971B3C02",variableType:8}
 */
var frm_total_imp_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6331DC1A-D2DF-4FA9-8B42-7353F0E2302F",variableType:8}
 */
var frm_total_imp_4 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"702EC142-F6E7-409A-954E-A2EEC327E721"}
 */
var frm_prof_descripcion = null;
/**
 * @properties={typeid:35,uuid:"8B39F929-52D9-47E9-87D7-F8B7724242F4",variableType:-4}
 */
var frm_obra_descripcion = null;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"26A86078-86A2-4008-8C97-3E33132A6AC1",variableType:93}
 */
var frm_fecha_desde = null;

/**
 * @type {Date}
 * 
 * @properties={typeid:35,uuid:"B5DD0282-9196-484B-89A6-44D43C420359",variableType:93}
 */
var frm_fecha_hasta = null;

/**
 * @properties={typeid:35,uuid:"46DAA287-20E6-4821-A273-6B70167A6B41",variableType:-4}
 */
var frm_especialidad = null;

/**
 * @properties={typeid:35,uuid:"F235A92A-65E7-445A-B149-D5059C428DB8",variableType:-4}
 */
var frm_espe_descripcion = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"930FEA74-D433-43E2-8345-4713DE47A919"}
 */
var frm_con_profesional = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"41371C8C-1E12-46C1-B180-13FF356D10C7"}
 */
var frm_con_especialidad = '';
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"EEC9508B-BCF6-449A-A193-312468885579"}
 */
var frm_con_cobertura = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"101D620C-BAA0-4C77-8E81-7F8F715FD38A",variableType:4}
 */
var frm_error = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"01886A1F-0D0C-40C5-AFBC-50D9ED78B6CA",variableType:4}
 */
var frm_lote = 0;

/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4F1646BA-B55F-46D8-9ACD-D4906F509B5E"}
 */
function onShow_inicio(firstShow, event) {
	elements.lbl_titulo.text = 'Liquidación Honorarios Médicos'	
	inicializa_campos()
}

/**
 * @properties={typeid:24,uuid:"94436686-BF88-4F3B-AB9F-DDB072305EB3"}
 */
function controlar_profesional(){
	if(frm_con_profesional != ''){
	    // identifica si el campo es numérico o alfanumerico
		var largo = frm_con_profesional.length;
		var esnumero = true;
		for (var i= 0;i<largo && esnumero == true; i++){
	    	if (frm_con_profesional.charCodeAt(i)< 48 || frm_con_profesional.charCodeAt(i) > 57){
		    	esnumero = false
		   	}
		}
		if (esnumero){
	        if(largo>6){
	    	   //muestra mensaje de "dialogo"				   
				globals.DIALOGS.showErrorDialog('Error','Código inexistente', 'Ok')
				elements.con_profesional.requestFocus()				   				   
		   	}else{
		   	   globals.gbl_profesional = utils.stringToNumber(frm_con_profesional.toString())	
			   var $size = gbl_prof_to_prof.getSize()
			   if (globals.gbl_catalogo == 'cirendsa'){
				   $size = gbl_prof_to_prof_cirendsa.getSize()
			   }					   
	   		   if ($size < 1){		   	   
				   frm_error = 1				       
				   globals.DIALOGS.showErrorDialog('Error','Código inexistente', 'Ok')				       
			       globals.gbl_profesional = 0					   
			   	   frm_con_profesional     = ' '
				   frm_prof_descripcion    = ''
				   elements.con_profesional.requestFocus()					   
			   }else {
				   var $legajo_personal = gbl_prof_to_prof.prof20
				   var $legajo_medico   = gbl_prof_to_prof.prof28
				   if (globals.gbl_catalogo == 'cirendsa'){
					   $legajo_personal = gbl_prof_to_prof_cirendsa.prof20
					   $legajo_medico   = gbl_prof_to_prof_cirendsa.prof28
				   }
				   if($legajo_personal == 0 && $legajo_medico == 0){
					   frm_error = 1				       
					   globals.DIALOGS.showErrorDialog('Error','Relación inexistente', 'Ok')				       
				       globals.gbl_profesional = 0					   
				   	   frm_con_profesional     = ' '
					   frm_prof_descripcion    = ''
					   elements.con_profesional.requestFocus()
			       }else{
				       frm_prof_descripcion = gbl_prof_to_prof.prof2_2
					   globals.gbl_sit_iva  = gbl_prof_to_prof.prof6
					   if (globals.gbl_catalogo == 'cirendsa'){
						  frm_prof_descripcion = gbl_prof_to_prof_cirendsa.prof2_2
						  globals.gbl_sit_iva  = gbl_prof_to_prof_cirendsa.prof6
					   }
			   	       elements.con_especialidad.requestFocus()
			       }
			   }		
		   	}
	    }else{
	        globals.gbl_con_indice = 1	       	   
		    globals.gbl_con_busca = frm_con_profesional
			var win = application.createWindow("Busca_profe",JSWindow.MODAL_DIALOG)	
			win.title= 'Buscar Profesional'
			win.resizable = false
			win.show(forms.frm_tab_profesionales)

			if (forms.frm_scr_profesionales.foundset.codigo > 0){
				if(forms.frm_scr_profesionales.foundset.legajo_personal == 0 && forms.frm_scr_profesionales.foundset.legajo_medico == 0){
					frm_error = 1				       
					globals.DIALOGS.showErrorDialog('Error','Relación inexistente', 'Ok')				       
				    globals.gbl_profesional = 0					   
				   	frm_con_profesional     = ' '
					frm_prof_descripcion    = ''
					elements.con_profesional.requestFocus()
			    }else{
			        frm_con_profesional  = forms.frm_scr_profesionales.foundset.codigo.toString()
			        frm_prof_descripcion = forms.frm_scr_profesionales.foundset.descripcion	
			        globals.gbl_sit_iva  = forms.frm_scr_profesionales.foundset.sit_iva
					elements.con_especialidad.requestFocus()
			    }
			}
		}	    
	}
}

/**
 * @properties={typeid:24,uuid:"D3EAD555-3453-46A4-8F1A-A047B3CAF80A"}
 */
function buscar_profesional(){
	var largo = frm_con_profesional.length;
    var esnumero = true;
    globals.gbl_con_indice = 1; 
    for (var i= 0;i<largo && esnumero == true; i++){
	   if (frm_con_profesional.charCodeAt(i)< 48 || frm_con_profesional.charCodeAt(i) > 57){
		   esnumero = false
	   }
    }
    if (esnumero){
	   globals.gbl_profesional = utils.stringToNumber(frm_con_profesional.valueOf())
	   globals.gbl_con_indice = 2
    }else{
	   globals.gbl_con_indice = 1
    }    
	globals.gbl_con_busca = frm_con_profesional
	var win = application.createWindow("Busca_profe",JSWindow.MODAL_DIALOG)	
	win.title= 'Buscar Profesional'
	win.resizable = false		
	win.show(forms.frm_tab_profesionales)

	if (forms.frm_scr_profesionales.foundset.codigo > 0){
		if(forms.frm_scr_profesionales.foundset.legajo_personal == 0 && forms.frm_scr_profesionales.foundset.legajo_medico == 0){
			frm_error = 1				       
			globals.DIALOGS.showErrorDialog('Error','Relación inexistente', 'Ok')				       
		    globals.gbl_profesional = 0					   
		   	frm_con_profesional     = ' '
			frm_prof_descripcion    = ''
			elements.con_profesional.requestFocus()
	    }else{
	        frm_con_profesional  = forms.frm_scr_profesionales.foundset.codigo.toString()
	        frm_prof_descripcion = forms.frm_scr_profesionales.foundset.descripcion
	        globals.gbl_sit_iva  = forms.frm_scr_profesionales.foundset.sit_iva
   	        elements.con_especialidad.requestFocus()
	    }
	}else{
	   globals.gbl_profesional = 0
	   frm_prof_descripcion    = ''
	}	
}

/**
 * @properties={typeid:24,uuid:"9C6C4CE0-C89B-41E4-ADBB-07F776F65BA0"}
 */
function controlar_especialidad(){
	if (frm_con_especialidad != '' && frm_con_especialidad != 'TODAS'){
        // identifica si el campo es numérico o alfanumerico
		var largo = frm_con_especialidad.length;
		var esnumero = true;
		for (var i= 0;i<largo && esnumero == true; i++){
	    	if (frm_con_especialidad.charCodeAt(i)< 48 || frm_con_especialidad.charCodeAt(i) > 57){
		    	esnumero = false
		   	}
		}
	    if (esnumero){
	       if(largo>4){
	    	   //muestra mensaje de "dialogo"
	    	   globals.DIALOGS.showErrorDialog('Error','Código inexistente', 'Ok')
			   elements.con_especialidad.requestFocus()				   
			   frm_error = 1
		   }else{
			   globals.gbl_especialidad = utils.stringToNumber(frm_con_especialidad.valueOf())	   		
			   if (gbl_espe_to_especialidad.getSize() < 1){
				   frm_error = 1
				   globals.DIALOGS.showErrorDialog('Error','Código inexistente', 'Ok')
			   	   
			   	   globals.gbl_especialidad = 0
			   	   frm_con_especialidad     = ''				   	   
				   frm_espe_descripcion     = ''
			   	   elements.con_especialidad.requestFocus()
			   	   
			   }else{
				   frm_espe_descripcion = gbl_espe_to_especialidad.esp_descrip				           
				   elements.con_cobertura.requestFocus()					   
			   }		
		   }
	    }else{	    	   
	       globals.gbl_con_indice = 1
	       globals.gbl_con_busca = frm_con_especialidad
	       var win = application.createWindow("Busca_espe",JSWindow.MODAL_DIALOG)	
		   win.title= 'Buscar Especialidad'
		   win.resizable = false
		   win.show(forms.frm_tab_especialidad)
		   if (forms.frm_scr_especialidad.foundset.esp_codi > 0){
			   frm_con_especialidad = forms.frm_scr_especialidad.foundset.esp_codi.toString()
		       frm_espe_descripcion = forms.frm_scr_especialidad.foundset.esp_descrip
		       elements.con_cobertura.requestFocus()				   
		   }		   
	   }
	}else{
		frm_con_especialidad     = 'TODAS'
		globals.gbl_especialidad = 9999
		frm_espe_descripcion     = ''
		elements.con_cobertura.requestFocus()
	}
}

/**
 * @properties={typeid:24,uuid:"CBD31CE7-588C-4C0A-94F3-E71C205749E4"}
 */
function buscar_especialidad(){
	var largo = frm_con_especialidad.length;
	var esnumero = true;    
	globals.gbl_con_indice = 1;
	if(frm_con_especialidad == 'TODAS'){
    	frm_con_especialidad = ' '
    }
    for (var i= 0;i<largo && esnumero == true; i++){
	   if (frm_con_especialidad.charCodeAt(i)< 48 || frm_con_especialidad.charCodeAt(i) > 57){
		   esnumero = false
	   }
    }
    if (esnumero){
	   globals.gbl_especialidad = utils.stringToNumber(frm_con_especialidad.valueOf())
	   globals.gbl_con_indice = 2
    }else{
	   globals.gbl_con_indice = 1
    }
    globals.gbl_con_busca = frm_con_especialidad
    var win = application.createWindow("Busca_espe",JSWindow.MODAL_DIALOG)	
    win.title= 'Buscar Especialidad'
    win.resizable = false
    win.show(forms.frm_tab_especialidad)

    if (forms.frm_scr_especialidad.foundset.esp_codi > 0){
    	frm_con_especialidad = forms.frm_scr_especialidad.foundset.esp_codi.toString()
	    frm_espe_descripcion = forms.frm_scr_especialidad.foundset.esp_descrip
	    elements.con_cobertura.requestFocus()    	
    }else{
	    globals.gbl_especialidad = 0    
		frm_espe_descripcion     = ''      
    }
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"70B6867E-BA48-4C79-BDD1-5381128F6AA4"}
 */
function onAction_controlar_obra(event) {
	if (frm_con_cobertura != '' && frm_con_cobertura != 'TODAS'){
		// identifica si el campo es numérico o alfanumerico
		var largo = frm_con_cobertura.length;
		var esnumero = true;
		for (var i= 0;i<largo && esnumero == true; i++){
	    	if (frm_con_cobertura.charCodeAt(i)< 48 || frm_con_cobertura.charCodeAt(i) > 57){
		     	esnumero = false
		   	}
		}
	    if (esnumero){
	   	    if(largo>4){
	    	    //muestra mensaje de "dialogo"
	    		globals.DIALOGS.showErrorDialog('Error','Código inexistente', 'Ok')
				elements.con_cobertura.requestFocus()
				frm_error = 1
		    }else{
		   	    globals.gbl_cobertura = utils.stringToNumber(frm_con_cobertura.valueOf())
				var $size = gbl_cob_to_coberturas.getSize()
				if (globals.gbl_catalogo == 'cirendsa'){
				    $size = gbl_cob_to_coberturas_cirendsa.getSize()
				}					   
		   		if ($size < 1){			    
				    frm_error = 1
					globals.DIALOGS.showErrorDialog('Error','Código inexistente', 'Ok')
				   	frm_con_cobertura     = ''
				   	globals.gbl_cobertura = 0
					frm_obra_descripcion  = '' 
				   	elements.con_cobertura.requestFocus()
				}else{
				    frm_obra_descripcion = gbl_cob_to_coberturas.obr_razonsoc
					if (globals.gbl_catalogo == 'cirendsa'){
					   frm_obra_descripcion = gbl_cob_to_coberturas_cirendsa.obr_razonsoc
					}
				    elements.con_tipo_prestacion.requestFocus()
				}
		    }
		}else{	    	   
	        globals.gbl_con_indice = 1
	    	if (frm_con_cobertura == 'TODAS'){
			    frm_con_cobertura = ' '
			}
			globals.gbl_con_busca = frm_con_cobertura
	       	var win = application.createWindow("Busca_cober",JSWindow.MODAL_DIALOG)	
			win.title= 'Buscar Obra Social'
			win.resizable = false
		    win.show(forms.frm_tab_coberturas_emp)
			if(forms.frm_scr_coberturas_emp.foundset.codigo != 0){
				frm_con_cobertura     = forms.frm_scr_coberturas_emp.foundset.codigo.toString()
                globals.gbl_cobertura = forms.frm_scr_coberturas_emp.foundset.codigo
				frm_obra_descripcion  = forms.frm_scr_coberturas_emp.foundset.descripcion
				elements.con_tipo_prestacion.requestFocus()
			}else{
				frm_con_cobertura     = 'TODAS'
			   	globals.gbl_cobertura = 9999
				frm_obra_descripcion  = ''
			}
		}
	}else{
		frm_con_cobertura     = 'TODAS'
	    globals.gbl_cobertura = 9999
		frm_obra_descripcion  = ''
	    elements.con_tipo_prestacion.requestFocus()					 
	}
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"5EB91E2C-B0BB-419B-9588-C5B07BFA3953"}
 */
function onAction_buscar_obra(event) {
	var largo = frm_con_cobertura.length;
	var esnumero = true;
    if(frm_con_cobertura == 'TODAS'){
    	frm_con_cobertura = ' '
    }
	globals.gbl_con_indice = 1;
    for (var i= 0;i<largo && esnumero == true; i++){
	   if (frm_con_cobertura.charCodeAt(i)< 48 || frm_con_cobertura.charCodeAt(i) > 57){
		   esnumero = false
	   }
    }
    if (esnumero){
	   globals.gbl_cobertura = utils.stringToNumber(frm_con_cobertura.valueOf())
	   globals.gbl_con_indice = 2
    }else{
	   globals.gbl_con_indice = 1
    }
    if (frm_con_cobertura == 'TODAS'){
		frm_con_cobertura = ' '
	}
	globals.gbl_con_busca = frm_con_cobertura
	var win = application.createWindow("Busca_cober",JSWindow.MODAL_DIALOG)	
    win.title= 'Buscar Obra Social'
    win.resizable = false
    win.show(forms.frm_tab_coberturas_emp)
	if(forms.frm_scr_coberturas_emp.foundset.codigo != 0){
		frm_con_cobertura     = forms.frm_scr_coberturas_emp.foundset.codigo.toString()
		globals.gbl_cobertura = forms.frm_scr_coberturas_emp.foundset.codigo
		frm_obra_descripcion  = forms.frm_scr_coberturas_emp.foundset.descripcion
		elements.con_tipo_prestacion.requestFocus()
	}else{
		frm_con_cobertura     = 'TODAS'
		globals.gbl_cobertura = 9999
		frm_obra_descripcion  = ''
	}	
}
/**
 * @properties={typeid:24,uuid:"EFA014A3-3D9E-4DF1-9695-61A7CC9F9C6E"}
 */
function inicializa_campos(){
	globals.gbl_con_empresa  = 1
	frm_tipo_prestacion      = 1
	frm_con_profesional      = ' '
	globals.gbl_profesional  = 0
	frm_prof_descripcion     = ''
	globals.gbl_sit_iva      = null
	frm_con_especialidad     = 'TODAS'
	globals.gbl_especialidad = 9999
	frm_con_cobertura        = 'TODAS'
	globals.gbl_cobertura    = 9999
	frm_obra_descripcion     = ''
	frm_espe_descripcion     = ''	
	frm_fecha_desde          = null
	frm_fecha_hasta          = null	
    inicializa_tot() 	
	globals.gbl_cerrarConsultaRegistro = false;
	elements.btn_grabar.enabled        = false
	elements.btn_imprimir.enabled      = false	
	forms.frm_scr_liquid_prof_validacion.foundset.deleteAllRecords()
	forms.frm_scr_liquid_prof_validacion_practicas.foundset.deleteAllRecords()
	forms.frm_scr_liquid_prof_validacion_intercons.foundset.deleteAllRecords()
	forms.frm_scr_liquid_prof_validacion_seguimien.foundset.deleteAllRecords()
	forms.frm_scr_liquid_prof_validacion_cirugias.foundset.deleteAllRecords()
	elements.tabless.tabIndex = 1
	
	globals.gbl_catalogo        = 'maestros'
	//Carga tabla de Profesionales
    forms.frm_tab_profesionales.cargar_tabla()
	//Carga tabla de Obras Sociales
    forms.frm_tab_coberturas_emp.cargar_tabla()
}

/**
 * @properties={typeid:24,uuid:"86443149-CB0D-420B-B3BF-CA4B0379E04C"}
 */
function inicializa_tot(){
    frm_total_cant_1         = 0
	frm_total_cant_2         = 0
	frm_total_cant_3         = 0
	frm_total_cant_4         = 0
	frm_total_valor_1        = 0
	frm_total_valor_2        = 0
	frm_total_valor_3        = 0
	frm_total_valor_4        = 0
	frm_total_iva_1          = 0
	frm_total_iva_2          = 0
	frm_total_iva_3          = 0
	frm_total_iva_4          = 0
	frm_total_imp_1          = 0
	frm_total_imp_2          = 0
	frm_total_imp_3          = 0
	frm_total_imp_4          = 0
	frm_total_cant_pdf1      = 0
	frm_total_cant_pdf2      = 0
	frm_total_cant_pdf3      = 0
	frm_total_cant_pdf4      = 0
}
/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"95F3100E-F294-4E02-B167-21E02720172D"}
 * @AllowToRunInFind
 */
function onAction_procesar(event) {
	if (frm_con_profesional == ''|| frm_con_especialidad == '' ||		
		frm_fecha_desde == null|| frm_fecha_hasta == null){		
		globals.DIALOGS.showWarningDialog('Atención','No se puede procesar, faltan datos', 'Ok')
	    elements.con_profesional.requestFocus()
	}else{		 
		var $aux_prof_per = gbl_prof_to_prof.prof20		
		var $aux_prof_med = gbl_prof_to_prof.prof28
		if (globals.gbl_catalogo == 'cirendsa'){
			   $aux_prof_per = gbl_prof_to_prof_cirendsa.prof20
			   $aux_prof_med = gbl_prof_to_prof_cirendsa.prof28
			}
		if($aux_prof_per > 0){
			if(frm_tipo_prestacion != 2){
			    var aux_dig = new Array(5);
			    if($aux_prof_per.toString().length==2){
				    aux_dig[0] = 0
				    aux_dig[1] = 0
				    aux_dig[2] = 0
				    aux_dig[3] = $aux_prof_per.toString().substr(0,1);
				    aux_dig[4] = $aux_prof_per.toString().substr(1,1);
			    }else{
				    if ($aux_prof_per.toString().length==3){
					    aux_dig[0] = 0
					    aux_dig[1] = 0
					    aux_dig[2] = $aux_prof_per.toString().substr(0,1);
					    aux_dig[3] = $aux_prof_per.toString().substr(1,1);
					    aux_dig[4] = $aux_prof_per.toString().substr(2,1);
				    }else{
					    if($aux_prof_per.toString().length==4){
  						    aux_dig[0] = 0
						    aux_dig[1] = $aux_prof_per.toString().substr(0,1);
						    aux_dig[2] = $aux_prof_per.toString().substr(1,1);
						    aux_dig[3] = $aux_prof_per.toString().substr(2,1);
						    aux_dig[4] = $aux_prof_per.toString().substr(3,1);
					    }else{
						    if($aux_prof_per.toString().length==5){
							    aux_dig[0] = $aux_prof_per.toString().substr(0,1);
							    aux_dig[1] = $aux_prof_per.toString().substr(1,1);
							    aux_dig[2] = $aux_prof_per.toString().substr(2,1);
							    aux_dig[3] = $aux_prof_per.toString().substr(3,1);
							    aux_dig[4] = $aux_prof_per.toString().substr(4,1);
						    }
					    }
				    }
			    }			
			    var $verificador = utils.stringToNumber(aux_dig[1]) + utils.stringToNumber(aux_dig[2]) * 3 + utils.stringToNumber(aux_dig[3]) * 9 + utils.stringToNumber(aux_dig[4]) * 7;
			    var larg = $verificador.toString().length - 1;
			    $verificador = $verificador.toString().substr(larg,1)
			    $aux_prof_per = $aux_prof_per + $verificador
			}
	    }
		if(frm_tipo_prestacion != 2  && frm_tipo_prestacion != 3 && frm_tipo_prestacion != 4){
		    if($aux_prof_med > 0){
	            $aux_prof_med = $aux_prof_med + '0'
		    }
	    }
	    inicializa_tot()
		elements.lbl_procesando.text = 'Procesando.....'
		elements.lbl_procesando.visible = true
		application.updateUI()		
		
		//Cargar tabla de liquidacion		
		var $aux_fecha_desde = globals.FormateaFecha(frm_fecha_desde,'AAAAMMDD')
		var $aux_fecha_hasta = globals.FormateaFecha(frm_fecha_hasta,'AAAAMMDD')
		var $Args		
		switch (frm_tipo_prestacion){
		case 1:	//Consultorios Externos
		    var $SQL = "select reservasmed, MED.MedturNya, reservasesp, ESP.Esp_Descrip, reservasfech, reservashora, reservasobra, OBRA.Obr_RazonSoc, "            
                $SQL+= "reservasobrpla, reservashiscli, reservasnroben, reservasiva, RESE.ResecodTipcod, RESE.ResecodNumcod, NOME.Nome_Descr, "
                $SQL+= "RESE.ResecodCantid, reservastipo, reservasesta, reservasatendi, NOME.Nome_Grupo, HISC.histcab_apellnom,0,0,0,0,NOME.nome_honespec "
		        $SQL+= "from tbc_reservas "
		        $SQL+= "inner join tbc_hist_cab HISC on HISC.HistCab_NroUnico = reservashiscli "	
                $SQL+= "inner join tbc_medtur MED on MED.MedturCod = reservasmed and MED.MedturEsp = reservasesp " 
                $SQL+= "inner join maestros.tbc_especial ESP on ESP.Esp_Codi = reservasesp "  
                $SQL+= "inner join maestros.tbc_obras OBRA on OBRA.Obr_Codigo = reservasobra "
                $SQL+= "left join tbc_resecod RESE on RESE.resecodesp = reservasesp and RESE.resecodmed = reservasmed " 
			    $SQL+= "and RESE.resecodfech = reservasfech and RESE.resecodhora = reservashora "
			    $SQL+= "inner join maestros.tbc_nomencla NOME on NOME.Nome_Tipo = RESE.ResecodTipcod and NOME.Nome_Codigo = RESE.resecodNumcod "
                $SQL+= "where reservasfech >= "
                $SQL+= $aux_fecha_desde
                $SQL+= " and reservasfech <= "
                $SQL+= $aux_fecha_hasta
                if($aux_prof_per > 0 && $aux_prof_med > 0 ){
			        $SQL+= " and (reservasmed = "			
			        $SQL+= $aux_prof_per
			        $SQL+= " or reservasmed = "			
			        $SQL+= $aux_prof_med
			        $SQL+= ")"
                }else{
            	    if($aux_prof_per > 0 ){
    			        $SQL+= " and reservasmed = "			
    			        $SQL+= $aux_prof_per
            	    }else{
    			        $SQL+= " and reservasmed = "			
    			        $SQL+= $aux_prof_med    			    
            	    }
                }
			    if(globals.gbl_especialidad != 9999){
                    $SQL+= " and reservasesp = "
			        $SQL+= frm_con_especialidad
			    }
			    if(globals.gbl_cobertura != 9999){
                    $SQL+= " and reservasobra = "
			        $SQL+= frm_con_cobertura 
			    }
			    $SQL+= " order by reservasfech asc, reservashora asc "
		    var $ds = databaseManager.getDataSetByQuery("asistencial", $SQL, $Args, -1)		 
		    var $max = $ds.getMaxRowIndex(); break;
		case 2: //Prácticas
	            $SQL = "select IdetMedInfor,' ', SER.ServCodigo, SER.ServDescripcion, IdetFechaInfor, IdetHoraInfor, IPED.IpedObra, OBRA.Obr_RazonSoc, "            
                $SQL+= "IPED.IpedPlan, IPED.IpedHistClinica, 0, 1, IdetTipoNom1, IdetCodiNom1, NOME.Nome_Descr, "
                $SQL+= "1, IdetTipoInf, IdetEstado, IPED.IpedEstado, NOME.Nome_Grupo, IPED.IpedHistClDesc, IPED.IpedFechaPedido, IdetFechaReali, " 
                $SQL+= "IdetRemoto, ipedlconfecc, NOME.nome_honespec, IpedPedido, "
                $SQL+= "RES.ReservasIva, IPED.IpedAdmis, IPED.IpedSector, ADM.Adm_Iva  "
                $SQL+= "from tbc_imapedet_new "
                $SQL+= "inner join tbc_imapedi_new IPED on IPED.IpedServicio = IdetServicio and IPED.IpedPedido = IdetPedido "	
                $SQL+= "inner join maestros.tbc_servicios SER on SER.ServCodigo = IdetServicio "
                $SQL+= "left join tbc_reservas RES on RES.ReservasEsp = IPED.IpedReservasEsp and RES.ReservasMed = IPED.IpedReservasMed and "
                $SQL+= "RES.ReservasFech = IPED.IpedReservasFech and RES.ReservasHora = IPED.IpedReservasHora "	
                $SQL+= "left join tbc_admision ADM on ADM.Adm_Histclin = IPED.IpedHistClinica "
             //   $SQL+= "left join tbc_guardia GUAR on GUAR.Guar_HistClinica = IPED.IpedHistClinica and RES.ReservasMed = IPED.IpedReservasMed "
             //   $SQL+= "and RES.ReservasFech = IPED.IpedReservasFech and RES.ReservasHora = IPED.IpedReservasHora "
                $SQL+= "inner join maestros.tbc_obras OBRA on OBRA.Obr_Codigo = IPED.IpedObra "  
                $SQL+= "inner join maestros.tbc_nomencla NOME on NOME.Nome_Tipo = IdetTipoNom1 and NOME.Nome_Codigo = IdetCodiNom1 "
                $SQL+= "where IdetServicio5 > 0 and IdetFechaReali >= "
                $SQL+= $aux_fecha_desde
                $SQL+= " and IdetFechaReali <= "
                $SQL+= $aux_fecha_hasta
                if($aux_prof_per > 0 && $aux_prof_med> 0 ){
	                $SQL+= " and (IdetMedInfor = "			
	                $SQL+= $aux_prof_per
	                $SQL+= " or IdetMedInfor = "			
	                $SQL+= $aux_prof_med
	                $SQL+= ")"
                }else{
    	            if($aux_prof_per > 0 ){
		                $SQL+= " and IdetMedInfor = "			
		                $SQL+= $aux_prof_per
    	            }else{
		                $SQL+= " and IdetMedInfor = "			
		                $SQL+= $aux_prof_med    			    
    	            }
                }                
                $ds = databaseManager.getDataSetByQuery("asistencial", $SQL, $Args, -1)
                $max = $ds.getMaxRowIndex(); break; 
		case 3: //Interconsultas
			    $SQL = "select IntconsMedInter,' ', IntconsEspecialidad, ESP.Esp_Descrip, IntconsFechaRealizado, IntconsHoraRealizado, IntconsObra, OBRA.Obr_RazonSoc, "            
                $SQL+= "if (IntconsTipoHc = 1, HISC.histcab_planx, ADM.Adm_PlanObr) Plan_obra, IntconsHClinica, 0, ADM.Adm_Iva, 1, "
                $SQL+= "if (IntconsUrgente = 1, NOMEU.Nome_Codigo, NOME.Nome_Codigo) Nome_Codigo, if (IntconsUrgente = 1, NOMEU.Nome_Descr, NOME.Nome_Descr) Nome_descripcion, "
                $SQL+= "1, 0, IntconsBaja, 0, NOME.Nome_Grupo, if (IntconsTipoHc = 1, HISC.histcab_apellnom, ADM.Adm_ApelNom ) HC_Nombre, IntconsFechaRealizado, "
                $SQL+= "IntconsFechaCarga, IntconsUrgente,0, NOME.nome_honespec "
                $SQL+= "from tbc_intcons_it "
                $SQL+= "left join tbc_hist_cab HISC on HISC.HistCab_NroUnico = IntconsHClinica "
                $SQL+= "left join tbc_admision ADM on ADM.Adm_HistClin = IntconsHClinica "
                $SQL+= "inner join maestros.tbc_especial ESP on ESP.Esp_Codi = IntconsEspecialidad " 
                $SQL+= "inner join maestros.tbc_obras OBRA on OBRA.Obr_Codigo = IntconsObra "  
                $SQL+= "inner join maestros.tbc_nomencla NOMEU on NOMEU.Nome_Tipo = 1 and NOMEU.Nome_Codigo = 420303 "
                $SQL+= "inner join maestros.tbc_nomencla NOME on NOME.Nome_Tipo = 1 and NOME.Nome_Codigo = 420122 "
                $SQL+= "where IntconsFechaRealizado > 0 and IntconsFechaRealizado >= "
                $SQL+= $aux_fecha_desde
                $SQL+= " and IntconsFechaRealizado <= "
                $SQL+= $aux_fecha_hasta
                if($aux_prof_per > 0 && $aux_prof_med > 0 ){
                    $SQL+= " and (IntconsMedInter = "			
                    $SQL+= $aux_prof_per
                    $SQL+= " or IntconsMedInter = "			
                    $SQL+= $aux_prof_med
                    $SQL+= ")"
                }else{ 
                    if($aux_prof_per > 0 ){
                        $SQL+= " and IntconsMedInter = "			
                        $SQL+= $aux_prof_per
                    }else{
                        $SQL+= " and IntconsMedInter = "			
                        $SQL+= $aux_prof_med    			    
                    }
                }                
                $ds = databaseManager.getDataSetByQuery("asistencial", $SQL, $Args, -1)
                $max = $ds.getMaxRowIndex(); break;
                
		case 4: //Seguimientos
                $SQL = "select HomLegajoMed,' ', HomEspec, ESP.Esp_Descrip, HomFecha, HomHora, ADM.Adm_obrsoc, OBRA.Obr_RazonSoc, "            
                $SQL+= "ADM.Adm_PlanObr, HomHistClinica, 0, ADM.Adm_Iva, 1, 900987, NOME.Nome_Descr, "
                $SQL+= "1, 0, HomTipoInf, 0, NOME.Nome_Grupo, ADM.Adm_ApelNom, HomFecha, HomFecha, 0, 0, NOME.nome_honespec "
                $SQL+= "from tbc_hojamed "
                $SQL+= "left join tbc_hist_cab HISC on HISC.HistCab_NroUnico = HomHistClinica "
                $SQL+= "left join tbc_admision ADM on ADM.Adm_HistClin = HomHistClinica "
                $SQL+= "inner join maestros.tbc_especial ESP on ESP.Esp_Codi = HomEspec " 
                $SQL+= "inner join maestros.tbc_obras OBRA on OBRA.Obr_Codigo = ADM.Adm_Obrsoc "  
                $SQL+= "inner join maestros.tbc_nomencla NOME on NOME.Nome_Tipo = 1 and NOME.Nome_Codigo = 900987 "
                $SQL+= "where (HomTipoMed = 0 or HomTipoMed = 1) and HomFecha > 0 and HomFecha >= "
                $SQL+= $aux_fecha_desde
                $SQL+= " and HomFecha <= "
                $SQL+= $aux_fecha_hasta
                if($aux_prof_per > 0 && $aux_prof_med > 0 ){
                    $SQL+= " and (HomLegajoMed = "			
                    $SQL+= $aux_prof_per
                    $SQL+= " or HomLegajoMed = "			
                    $SQL+= $aux_prof_med
                    $SQL+= ")"
                }else{
                    if($aux_prof_per > 0 ){
                        $SQL+= " and HomLegajoMed = "			
                        $SQL+= $aux_prof_per
                    }else{
                        $SQL+= " and HomLegajoMed = "			
                        $SQL+= $aux_prof_med    			    
                    }
                }                
                $ds = databaseManager.getDataSetByQuery("asistencial", $SQL, $Args, -1)
                $max = $ds.getMaxRowIndex(); break; 		
                
	    case 5: //Cirugias
	    	$SQL = "select rdcmedcirugia_1,' ', IntconsEspecialidad, ESP.Esp_Descrip, IntconsFechaRealizado, IntconsHoraRealizado, if (IntconsTipoHc = 1, HISC.HistCab_Obra, ADM.Adm_ObrSoc) Cod_obra, OBRA.Obr_RazonSoc, "            
            $SQL+= "if (IntconsTipoHc = 1, HISC.histcab_planx, ADM.Adm_PlanObr) Plan_obra, IntconsHClinica, 0, ADM.Adm_Iva, 1, "
            $SQL+= "if (IntconsUrgente = 1, NOMEU.Nome_Codigo, NOME.Nome_Codigo) Nome_Codigo, if (IntconsUrgente = 1, NOMEU.Nome_Descr, NOME.Nome_Descr) Nome_descripcion, "
            $SQL+= "1, 0, IntconsBaja, 0, NOME.Nome_Grupo, if (IntconsTipoHc = 1, HISC.histcab_apellnom, ADM.Adm_ApelNom ) HC_Nombre, IntconsFechaRealizado, "
            $SQL+= "IntconsFechaCarga, IntconsUrgente,0, NOME.nome_honespec "
            $SQL+= "from tbc_rend_cir "
            $SQL+= "left join tbc_hist_cab HISC on HISC.HistCab_NroUnico = rdchclinica "
            $SQL+= "left join tbc_admision ADM on ADM.Adm_HistClin = rdchclinica "
            $SQL+= "inner join maestros.tbc_especial ESP on ESP.Esp_Codi = IntconsEspecialidad " 
            $SQL+= "left join maestros.tbc_obras OBRA   on OBRA.Obr_Codigo = HISC.HistCab_Obra "
            $SQL+= "left join maestros.tbc_obras OBRA_A on OBRA_A.Obr_Codigo = ADM.Adm_ObrSoc "            
            $SQL+= "inner join maestros.tbc_nomencla NOME on NOME.Nome_Tipo = 1 and NOME.Nome_Codigo = rdccodnom "
            $SQL+= "where rdcfecha > 0 and rdcfecha >= "
            $SQL+= $aux_fecha_desde
            $SQL+= " and rdcfecha <= "
            $SQL+= $aux_fecha_hasta
            if($aux_prof_per > 0 && $aux_prof_med > 0 ){
                $SQL+= " and (rdcmedcirugia_1 = "			
                $SQL+= $aux_prof_per
                $SQL+= " or rdcmedcirugia_1 = "			
                $SQL+= $aux_prof_med
                $SQL+= ")"
            }else{
                if($aux_prof_per > 0 ){
                    $SQL+= " and rdcmedcirugia_1 = "			
                    $SQL+= $aux_prof_per
                }else{
                    $SQL+= " and rdcmedcirugia_1 = "			
                    $SQL+= $aux_prof_med    			    
                }
            }
		        $ds = databaseManager.getDataSetByQuery("asistencial", $SQL, $Args, -1)
                $max = $ds.getMaxRowIndex(); break;
		}
		if ($max != 0){		
		    var frm_ds2 = databaseManager.createEmptyDataSet()		
		    frm_ds2.addColumn('enabled',              1,JSColumn.NUMBER)   
		    frm_ds2.addColumn('res_cod_med',          2,JSColumn.NUMBER)
			frm_ds2.addColumn('res_des_med',          3,JSColumn.TEXT)
		    frm_ds2.addColumn('res_cod_esp',          4,JSColumn.NUMBER)
			frm_ds2.addColumn('res_des_esp',          5,JSColumn.TEXT)
			frm_ds2.addColumn('res_fecha',            6,JSColumn.DATETIME)	
			frm_ds2.addColumn('res_hora',             7,JSColumn.TEXT)
			frm_ds2.addColumn('res_cod_obra',         8,JSColumn.NUMBER)
		    frm_ds2.addColumn('res_des_obra',         9,JSColumn.TEXT)
			frm_ds2.addColumn('res_plan_obra',       10,JSColumn.TEXT)
			frm_ds2.addColumn('res_hist_cli',        11,JSColumn.NUMBER)					
			frm_ds2.addColumn('res_afiliado',        12,JSColumn.TEXT)
			frm_ds2.addColumn('res_iva',             13,JSColumn.TEXT)			
			frm_ds2.addColumn('res_tipo_nome',       14,JSColumn.NUMBER)
			frm_ds2.addColumn('res_cod_nomencla',    15,JSColumn.NUMBER)
			frm_ds2.addColumn('res_des_nomencla',    16,JSColumn.TEXT)
			
			frm_ds2.addColumn('res_cantidad',        17,JSColumn.NUMBER)
			frm_ds2.addColumn('res_imp_valor',       18,JSColumn.NUMBER)
			frm_ds2.addColumn('res_grupo_nome',      19,JSColumn.NUMBER)
			frm_ds2.addColumn('res_hora_int',        20,JSColumn.NUMBER)
			frm_ds2.addColumn('res_iva_int',         21,JSColumn.NUMBER)
			frm_ds2.addColumn('res_grupo_nome_orig', 22,JSColumn.NUMBER)
			frm_ds2.addColumn('res_cod_nome_orig',   23,JSColumn.NUMBER)
			frm_ds2.addColumn('res_validado',        24,JSColumn.NUMBER)
			frm_ds2.addColumn('res_txt_nomencla',    25,JSColumn.TEXT)
			frm_ds2.addColumn('res_des_hist_cli',    26,JSColumn.TEXT)			
			frm_ds2.addColumn('res_fecha_pedido',    27,JSColumn.DATETIME)
			frm_ds2.addColumn('res_fecha_realizado', 28,JSColumn.DATETIME)
			frm_ds2.addColumn('res_remoto',          29,JSColumn.TEXT)
			frm_ds2.addColumn('res_urgente',         30,JSColumn.TEXT)
			frm_ds2.addColumn('res_pedido',          31,JSColumn.NUMBER)
			var $aux_iva = ''
		    var $aux_iva_int = 1
			var $aux_fecha
			var $aux_hora
			
			var conveniosProfesional = new Array()
			   var $SQL3 = "select * from tbl_conv_prof "
	            $SQL3+= "where conv_empresa = "
	            $SQL3+= globals.gbl_con_empresa
	            $SQL3+= " and conv_profesional = "
	            $SQL3+= frm_con_profesional
	            $SQL3+= " and conv_fecha_desde <= '"
				$SQL3+= $aux_fecha_desde
	            $SQL3+= "' order by conv_fecha_desde desc "

	            var $ds3  = databaseManager.getDataSetByQuery("desal", $SQL3, $Args, -1);
			   
	      
				   for (var indice = 1; indice <= $ds3.getMaxRowIndex(); indice++) {
//					   jsObject = JSON.parse($ds3.getValue(1,1))
					     var convenio = new Object()
					   convenio.id = indice
					    convenio.conv_obra_social = $ds3.getValue(indice,4)
					    convenio.conv_especialidad = $ds3.getValue(indice,3)
					    convenio.conv_tipo_nom = $ds3.getValue(indice,5)
					    convenio.conv_grupo_nom = $ds3.getValue(indice,6)
					    convenio.conv_cod_nom = $ds3.getValue(indice,7) 
					    convenio.conv_fecha_desde = $ds3.getValue(indice,8) 
					    convenio.conv_tipo_valor= $ds3.getValue(indice,9)
						convenio.conv_imp_valor = $ds3.getValue(indice,10)
					    convenio.conv_imp_valor2 = $ds3.getValue(indice,29)
					    conveniosProfesional.push(convenio)
				   }
				   
			for (var i= 1; i <= $max; i++){
				if(frm_tipo_prestacion == 1 && $ds.getValue(i,18) == 1 && $ds.getValue(i,19) == 1 ||
				    (frm_tipo_prestacion == 2 && $ds.getValue(i,18) == 1 && $ds.getValue(i,19) == 2 && 
					(globals.gbl_cobertura == 9999 || $ds.getValue(i,7) == globals.gbl_cobertura)) ||
				    (frm_tipo_prestacion == 3 && 
					(globals.gbl_cobertura == 9999 || $ds.getValue(i,7) == globals.gbl_cobertura)) ||
				    (frm_tipo_prestacion == 4 && $ds.getValue(i,18) == 4 &&
					(globals.gbl_cobertura == 9999 || $ds.getValue(i,7) == globals.gbl_cobertura))					
					){
					$aux_iva_int = $ds.getValue(i,12)
					switch ($aux_iva_int){
						case 1: $aux_iva = 'No gravado       '; break
						case 2: $aux_iva = 'Alícuota General '; break
						case 3: $aux_iva = 'Alícuota Reducida'; break
					}
					// IVA Practicas
					if(frm_tipo_prestacion == 2){
						var $aux_iva_num = 1
						if($ds.getValue(i,29) == 0){
						   $aux_iva_num = $ds.getValue(i,31) 	
						}else{
							if($ds.getValue(i,29) == 1){
								if($ds.getValue(i,30) == 2){
								   $aux_iva_num = $ds.getValue(i,28)
								}
							}
						}
						switch ($aux_iva_num){
				   		    case 1: $aux_iva = 'No gravado       '; break
						    case 2: $aux_iva = 'Alícuota General '; break
						    case 3: $aux_iva = 'Alícuota Reducida'; break
					    }
						$aux_iva_int = $aux_iva_num
					}
					
					$aux_fecha = globals.IntegerToDate($ds.getValue(i,5))
					var $hora  = $ds.getValue(i,6).toString()
				    switch ($hora.length){
				  	    case 1: $hora = '00:0' + $hora.substr(0,1); break;
				        case 2: $hora = '00:' + $hora.substr(0,1) + $hora.substr(1,1) ; break;
				        case 3: $hora = '0' + $hora.substr(0,1) + ':' + $hora.substr(1,1) + $hora.substr(2,1) ; break;
				        case 7: $hora = '0' + $hora.substr(0,1) + ':' + $hora.substr(1,1) + $hora.substr(2,1) ; break;
				        default : $hora = $hora.substr(0,1) + $hora.substr(1,1) + ':' + $hora.substr(2,1)+$hora.substr(3,1) ; break;
				    }
					var $txt_nomencla =  $ds.getValue(i,14).toString()					
				    switch ($txt_nomencla.length){
				  	    case 1: $txt_nomencla = '00.00.00' + $txt_nomencla.substr(0,1); break;
				        case 2: $txt_nomencla = '00.00.' + $txt_nomencla.substr(0,1) + $txt_nomencla.substr(1,1) ; break;
				        case 3: $txt_nomencla = '00.0' + $txt_nomencla.substr(0,1) + '.' + $txt_nomencla.substr(1,1) + $txt_nomencla.substr(2,1) ; break;
				        case 4: $txt_nomencla = '00.' + $txt_nomencla.substr(0,1) + $txt_nomencla.substr(1,1) + '.' + $txt_nomencla.substr(2,1) + $txt_nomencla.substr(3,1) ; break;
				        case 5: $txt_nomencla = '0' + $txt_nomencla.substr(0,1) + '.' + $txt_nomencla.substr(1,1) + $txt_nomencla.substr(2,1) + '.' + $txt_nomencla.substr(3,1) 
						                        + $txt_nomencla.substr(4,1); break;				        
				        case 6: $txt_nomencla = $txt_nomencla.substr(0,1) + $txt_nomencla.substr(1,1) + '.' + $txt_nomencla.substr(2,1) + $txt_nomencla.substr(3,1) + '.' 
						                        + $txt_nomencla.substr(4,1) + $txt_nomencla.substr(5,1); break;
				        default:$txt_nomencla = $txt_nomencla.substr(0,1) + $txt_nomencla.substr(1,1) + '.' + $txt_nomencla.substr(2,1) + $txt_nomencla.substr(3,1) + '.' 
                                               + $txt_nomencla.substr(4,1) + $txt_nomencla.substr(5,1); break;
				    }
					
					
					var $fecha_desde = $ds.getValue(i,5).toString()
					    $fecha_desde = $fecha_desde.substr(0,4) + '-' + $fecha_desde.substr(4,2) + '-' + $fecha_desde.substr(6,2)
					//buscar en tabla_liquid_hon_prof_cons - si lo encuentra no carga el registro - 
				    var $SQL1 = "select * from tbl_liquid_hon_prof_cons "
					$SQL1+= "where tipo_prestacion = "
		            $SQL1+= frm_tipo_prestacion
		            $SQL1+= " and empresa = "
		            $SQL1+= globals.gbl_con_empresa
					$SQL1+= " and profesional = "
		            $SQL1+= frm_con_profesional
		            if(frm_tipo_prestacion == 1){ 
		                $SQL1+= " and especialidad = "
		                $SQL1+= $ds.getValue(i,3)
		            }
					$SQL1+= " and obra_social = "
					$SQL1+= $ds.getValue(i,7)
					$SQL1+= " and nome_tipo = "
					$SQL1+= $ds.getValue(i,13)
					$SQL1+= " and grupo_nome_orig = "
					$SQL1+= $ds.getValue(i,20)
					$SQL1+= " and nomenclador_orig = "
					$SQL1+= $ds.getValue(i,14)
					$SQL1+= " and fecha = '"
					$SQL1+= $fecha_desde
					$SQL1+= "' and hora = "
					$SQL1+= $ds.getValue(i,6)
					
				    var $ds1  = databaseManager.getDataSetByQuery("desal", $SQL1, $Args, 1);
				    var $max1 = $ds1.getMaxRowIndex()
					var $validado = 0
				    if ($max1 == 1){
				    	$validado = 1
				    }
				    
					//buscar convenio profesionales			        
					var $valor = 0
					$valor = obtenerValorConvenio($ds,conveniosProfesional,i)

//					var $SQL2 = "select * from tbl_conv_prof "
//		            $SQL2+= "where conv_empresa = "
//		            $SQL2+= globals.gbl_con_empresa
//		            $SQL2+= " and conv_profesional = "
//		            $SQL2+= frm_con_profesional
//		            if(frm_tipo_prestacion == 1){ 
//		                $SQL2+= " and conv_especialidad = "
//		                $SQL2+= $ds.getValue(i,3)
//		            }
//				    $SQL2+= " and conv_obra_social = "
//					$SQL2+= $ds.getValue(i,7)
//					$SQL2+= " and conv_tipo_nom = "
//					$SQL2+= $ds.getValue(i,13)
//					$SQL2+= " and conv_grupo_nom = "
//					$SQL2+= $ds.getValue(i,20)
// 					$SQL2+= " and conv_cod_nom = "
//						$SQL2+= $ds.getValue(i,14)
//					$SQL2+= " and conv_fecha_desde <= '"
//					$SQL2+= $fecha_desde
//					$SQL2+= "' order by conv_fecha_desde desc"
//				var $ds2  = databaseManager.getDataSetByQuery("desal", $SQL2, $Args, 1);
//				var $max2 = $ds2.getMaxRowIndex()
//				if ($max2 == 1){
//					if (frm_tipo_prestacion == 2 & $ds.getValue(i,25) == 1){
//						$valor = $ds2.getValue(1,29)
//					    if($ds2.getValue(1,9) == 2){
//						    $valor = $ds2.getValue(1,29) * $ds.getValue(i,26)
//					    }
//					}else{
//				        $valor = $ds2.getValue(1,10)
//					    if($ds2.getValue(1,9) == 2){
//						    $valor = $ds2.getValue(1,10) * $ds.getValue(i,26)
//					    }
//					}
//				}

			        $aux_hora = $hora
					var $aux_fecha_pedido    = 0 
					var $aux_fecha_realizado = 0
					var $aux_remoto          = 'No'
					var $aux_urgente         = 'Dentro de las 24 Hs.'	
					var $aux_pedido          = 0
					if(frm_tipo_prestacion == 1){					
					    $aux_fecha_pedido =   globals.IntegerToDate($ds.getValue(i,5))
					    $aux_fecha_realizado =  globals.IntegerToDate($ds.getValue(i,5))
					}else{
					    if(frm_tipo_prestacion == 2){
					        $aux_fecha_pedido =   globals.IntegerToDate($ds.getValue(i,22))
 					        $aux_fecha_realizado =  globals.IntegerToDate($ds.getValue(i,23))
							$aux_pedido = $ds.getValue(i,27)
							if($ds.getValue(i,24) == 1){
								$aux_remoto = 'Si'
							}
							$aux_urgente = application.getValueListDisplayValue('vl_prestacion_sitio',$ds.getValue(i,25))
							
					    }else{
					    	if(frm_tipo_prestacion == 3){
						        $aux_fecha_pedido =   globals.IntegerToDate($ds.getValue(i,22))
						        $aux_fecha_realizado =  globals.IntegerToDate($ds.getValue(i,23))
								if($ds.getValue(i,24) == 1){
									$aux_urgente = 'Urgente'
								}
						    }else{
						       	if(frm_tipo_prestacion == 4){
							        $aux_fecha_pedido =   globals.IntegerToDate($ds.getValue(i,5))
							        $aux_fecha_realizado =  globals.IntegerToDate($ds.getValue(i,5))
						       	}
						    }
					    }
					}
				    frm_ds2.addRow([$validado, frm_con_profesional, frm_prof_descripcion, $ds.getValue(i,3), $ds.getValue(i,4), $aux_fecha,
			                   $aux_hora, $ds.getValue(i,7), $ds.getValue(i,8), $ds.getValue(i,9), $ds.getValue(i,10),
							   $ds.getValue(i,11), $aux_iva, $ds.getValue(i,13), $ds.getValue(i,14), $ds.getValue(i,15),
							   $ds.getValue(i,16),$valor, $ds.getValue(i,20), $ds.getValue(i,6), $aux_iva_int,
							   $ds.getValue(i,20), $ds.getValue(i,14), $validado, $txt_nomencla, $ds.getValue(i,21),
							   $aux_fecha_pedido, $aux_fecha_realizado, $aux_remoto, $aux_urgente, $aux_pedido])
				}
			}
				
			var $tipos = [JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.DATETIME, 
			              JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, 
						  JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER,
						  JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, 
						  JSColumn.TEXT, JSColumn.TEXT, JSColumn.DATETIME, JSColumn.DATETIME, JSColumn.TEXT, JSColumn.TEXT, JSColumn.NUMBER]
			if(frm_tipo_prestacion == 1){			  
		        var $frm = solutionModel.getForm('frm_scr_liquid_prof_validacion')
		        $frm.dataSource = frm_ds2.createDataSource('Auxd_scr_liquid_prof_valida', $tipos)
		        forms.frm_scr_liquid_prof_validacion.controller.recreateUI()
				elements.tabless.tabIndex = 2
			}else{
				if(frm_tipo_prestacion == 2){
				    $frm = solutionModel.getForm('frm_scr_liquid_prof_validacion_practicas')
		            $frm.dataSource = frm_ds2.createDataSource('Auxd_scr_liquid_prof_valida_practicas', $tipos)
		            forms.frm_scr_liquid_prof_validacion_practicas.controller.recreateUI()
				    elements.tabless.tabIndex = 3
				}else{
					if(frm_tipo_prestacion == 3){
					    $frm = solutionModel.getForm('frm_scr_liquid_prof_validacion_intercons')
			            $frm.dataSource = frm_ds2.createDataSource('Auxd_scr_liquid_prof_valida_intercons', $tipos)
			            forms.frm_scr_liquid_prof_validacion_intercons.controller.recreateUI()
					    elements.tabless.tabIndex = 4
					}
					if(frm_tipo_prestacion == 4){
					    $frm = solutionModel.getForm('frm_scr_liquid_prof_validacion_seguimien')
			            $frm.dataSource = frm_ds2.createDataSource('Auxd_scr_liquid_prof_valida_seguimien', $tipos)
			            forms.frm_scr_liquid_prof_validacion_seguimien.controller.recreateUI()
					    elements.tabless.tabIndex = 5
					}else{
						if(frm_tipo_prestacion == 5){
						    $frm = solutionModel.getForm('frm_scr_liquid_prof_validacion_cirugias')
				            $frm.dataSource = frm_ds2.createDataSource('Auxd_scr_liquid_prof_valida_cirugias', $tipos)
				            forms.frm_scr_liquid_prof_validacion_cirugias.controller.recreateUI()
						    elements.tabless.tabIndex = 6
						}
					}
				}
			}			
			elements.btn_grabar.enabled = true
			elements.btn_imprimir.enabled = true
		}else{
			globals.DIALOGS.showWarningDialog('Atención','No hay datos para mostrar')
			 inicializa_campos()	
		}
	} 
		
	elements.lbl_procesando.visible = false	
}

/**
 * @AllowToRunInFind 
 * 
 * @param event
 *
 * @properties={typeid:24,uuid:"0C99A5C9-04A6-44B8-8103-E303ECE0A677"}
 */
function onAction_grabar(event) {
	if (frm_con_profesional == 0 || frm_fecha_desde == ''|| frm_fecha_desde == null){		
		globals.DIALOGS.showWarningDialog('Atención','No se puede procesar, faltan datos', 'Ok')
	    elements.con_profesional.requestFocus()
	}else{		
		elements.lbl_procesando.text = 'Procesando.....'
		elements.lbl_procesando.visible = true
		application.updateUI()
		
		var $OK = 'Si'
		$OK = globals.DIALOGS.showWarningDialog('Atención','Se procedera a generar un lote de liquidacion, conrfirma?', 'Si', 'No')
		if ($OK == 'Si'){
			elements.btn_grabar.enabled  = false
			var $frm_tipo_presta = ''
			switch (frm_tipo_prestacion){
				case 1: $frm_tipo_presta = 'frm_scr_liquid_prof_validacion';break
				case 2: $frm_tipo_presta = 'frm_scr_liquid_prof_validacion_practicas';break
				case 3: $frm_tipo_presta = 'frm_scr_liquid_prof_validacion_intercons';break
				case 4: $frm_tipo_presta = 'frm_scr_liquid_prof_validacion_seguimien';break
				case 5: $frm_tipo_presta = 'frm_scr_liquid_prof_validacion_cirugias';break
			} 
			
			// Filtra solos los seleccionados			
			forms[$frm_tipo_presta].foundset.addFoundSetFilterParam('enabled', '=', '1','filtro0')
		    forms[$frm_tipo_presta].foundset.addFoundSetFilterParam('res_validado', '=', '0','filtro')
			var $max = databaseManager.getFoundSetCount(forms[$frm_tipo_presta].foundset)
	     	// Buscar ultimo numero de lote
			if($max != 0){			     
				var fs = databaseManager.getFoundSet("desal","tbl_parametros")
				fs.find()
				fs['paramid']=25
				fs.search()
				if(fs.getSize()>0){
					var $lote = fs['contador_entero'] + 1;										
				}
			}
			//
			for (var j = 1; j <= $max; j++){
				forms[$frm_tipo_presta].foundset.setSelectedIndex(j)
				var frm_id = application.getUUID()
				buscar_id(frm_id)				
			    foundset.newRecord()
			    id               = frm_id 	
				empresa          = globals.gbl_con_empresa
				empresa_des      = application.getValueListDisplayValue('vl_empresa',globals.gbl_con_empresa)
  			    tipo_prestacion  = frm_tipo_prestacion
				   
				profesional      = forms[$frm_tipo_presta].foundset.res_cod_med
				especialidad     = forms[$frm_tipo_presta].foundset.res_cod_esp
				obra_social      = forms[$frm_tipo_presta].foundset.res_cod_obra
				fecha            = forms[$frm_tipo_presta].foundset.res_fecha
				fecha_pedido     = forms[$frm_tipo_presta].foundset.res_fecha_pedido
				fecha_realizado  = forms[$frm_tipo_presta].foundset.res_fecha_realizado
				hora             = forms[$frm_tipo_presta].foundset.res_hora_int
				obra_plan        = forms[$frm_tipo_presta].foundset.res_plan_obra
				grupo_nome       = forms[$frm_tipo_presta].foundset.res_grupo_nome
				nomenclador      = forms[$frm_tipo_presta].foundset.res_cod_nomencla
				nome_tipo        = forms[$frm_tipo_presta].foundset.res_tipo_nome
				hist_cli         = forms[$frm_tipo_presta].foundset.res_hist_cli
				afiliado         = forms[$frm_tipo_presta].foundset.res_afiliado
				iva_tipo         = forms[$frm_tipo_presta].foundset.res_iva_int				
				profesional_des  = forms[$frm_tipo_presta].foundset.res_des_med
				especialidad_des = forms[$frm_tipo_presta].foundset.res_des_esp
  				obra_social_des  = forms[$frm_tipo_presta].foundset.res_des_obra 
			    nomenclador_des  = forms[$frm_tipo_presta].foundset.res_des_nomencla
			    cantidad         = forms[$frm_tipo_presta].foundset.res_cantidad
			    imp_valor_u      = forms[$frm_tipo_presta].foundset.res_imp_valor
			    hist_cli_des     = forms[$frm_tipo_presta].foundset.res_des_hist_cli
			    pedido          = forms[$frm_tipo_presta].foundset.res_pedido
				grupo_nome_orig  = forms[$frm_tipo_presta].foundset.res_grupo_nome_orig
				nomenclador_orig = forms[$frm_tipo_presta].foundset.res_cod_nome_orig
				if(forms[$frm_tipo_presta].foundset.res_remoto == 'No'){
				    remoto = 0 
				}else{
					remoto = 1
				}
				if(frm_tipo_prestacion == 2){
					switch (forms[$frm_tipo_presta].foundset.res_urgente){
						case 'Servicio'  : urgente = 0;break;
						case 'Habitación': urgente = 1;break;
						case 'Quirófano' : urgente = 2;break;
					}
				}else{
				    if(forms[$frm_tipo_presta].foundset.res_urgente == 'Urgente'){
				        urgente = 1
				    }else{
					    urgente = 0
				    }
				}
				
				fecha_alta       = application.getServerTimeStamp()
				legajo_alta      = globals.vLega
				lote             = $lote
				graba_datos()					
			}
			// Actualiza ultimo numero de lote
			if($max != 0){
				graba_datos_cabezera()
				fs['contador_entero']=$lote				
				databaseManager.startTransaction()
				if(databaseManager.saveData(fs)){
					databaseManager.commitTransaction()
				}	
				globals.DIALOGS.showWarningDialog('Atención','Se generó el número de Lote ' + $lote,'Ok')
				var $Si = 'Si' 
				$Si = globals.DIALOGS.showInfoDialog('Generación de PDF','Desea crear un salidad en PDF del lote?','Si', 'No')
				if ($Si == 'Si'){
					frm_lote = $lote
					onAction_imprimir(event)
					var $Si_email = 'Si' 
					$Si_email = globals.DIALOGS.showInfoDialog('Envío de Email','Desea envíar por email la liquidación?','Si', 'No')
					if ($Si_email == 'Si'){
					    envio_correo()    
					}
				}
			}
			// Remueve Filtros
			if(frm_tipo_prestacion == 1){	            
			    forms[$frm_tipo_presta].foundset.removeFoundSetFilterParam('filtro0')
			    forms[$frm_tipo_presta].foundset.removeFoundSetFilterParam('filtro')
			}
			//		
		}
		if ($OK == 'Si'){
		    inicializa_campos()			
		}
		elements.lbl_procesando.visible = false
	}
}

/**
 * @param frm_id
 *
 * @properties={typeid:24,uuid:"3FFC9585-1463-4E02-BFBC-6C03EA65C09F"}
 */
function buscar_id(frm_id){
	//Verificando si existe clave primaria
    var sql = "SELECT EXISTS( SELECT id_conv_prof FROM tbl_conv_prof WHERE id_conv_prof ='" + frm_id + "')"
    var dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
    while(dsExists.getValue(1,1) == 1){
        frm_id = application.getUUID();
        sql = "SELECT EXISTS( SELECT id_conv_prof FROM tbl_conv_prof WHERE id_conv_prof ='" + frm_id + "')"
        dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
    } 
//

}

/**
 * @properties={typeid:24,uuid:"083C886E-54AE-400D-9558-C8E7AF2732C5"}
 */
function graba_datos(){      
	databaseManager.startTransaction()
    var result = databaseManager.saveData();
    if(result){
        databaseManager.commitTransaction();
    }else{
        var array = databaseManager.getFailedRecords()
        for (var i = 0; i < array.length; i++) {
            var record = array[i];
            var jstable = databaseManager.getTable(record);
            var tableSQLName = jstable.getSQLName();
            var error1='Error de Grabación en Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
            var error2='Error en grabación '+record.exception;
            if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {            
                var thrown = record.exception.getValue()
                plugins.dialogs.showErrorDialog("Error de grabación","Record validation failed: " + thrown)
            }
        }
        databaseManager.rollbackTransaction()
        if(error1!=''){
                globals.DIALOGS.showErrorDialog("Error de grabación","Record validation failed: " + thrown)
                globals.DIALOGS.showErrorDialog("Error en grabacion",error1,"Aceptar")
                globals.DIALOGS.showErrorDialog("Error en grabacion",error2,"Aceptar")
        }
        globals.DIALOGS.showErrorDialog("Error en grabación","Se ha producido un error de grabación. "+'\n'+"Avise a Sistemas, por favor.", "Aceptar")
    }
}
/**
 * @properties={typeid:24,uuid:"7DAD18E9-7B4E-498D-A8E4-F230DEEE51C4"}
 */
function graba_datos_cabezera(){
    // Grabar Cabecera
    var fs = databaseManager.getFoundSet("desal","tbl_liquid_hon_prof")
	fs.newRecord()
	
	fs['id']              =id;
	fs['profesional']     =profesional;
	fs['lote']            =lote;
	fs['tipo_prestacion'] =tipo_prestacion;
	fs['fecha_desde']     =frm_fecha_desde;
	fs['fecha_hasta']     =frm_fecha_hasta;			
	databaseManager.startTransaction()
	var result = databaseManager.saveData(fs);
	if(result){
		databaseManager.commitTransaction();
	}else{
		databaseManager.rollbackTransaction()	
	}	
}
/**
 * @properties={typeid:24,uuid:"49ADEC7D-B08E-46B9-A3A7-117317CB3CE2"}
 * @AllowToRunInFind
 */
function envio_correo(){
	if (gbl_prof_to_prof.prof26 == null || gbl_prof_to_prof.prof26 == ''){
		globals.DIALOGS.showWarningDialog('Atención','El profesional no posee correo electrónico')
		return
	}
	var fs_mail = databaseManager.getFoundSet("parametros","param_mail_autoriz")
	fs_mail.find()
	fs_mail['cuenta']= 'pmedicas'
	fs_mail.search()
	if(fs_mail.getSize()<1){
		globals.DIALOGS.showErrorDialog('Error','No se encontro cuenta de correo desde.')
		return
	}else{
		fs_mail.setSelectedIndex(1)
	}	
	var properties = new Array();	
    properties[0] = 'mail.smtp.host=' + fs_mail['mail_smtp_host'];
    properties[1] = 'mail.smtp.auth=true';
    properties[2] = 'mail.smtp.username=' + fs_mail['username'];
    properties[3] = 'mail.smtp.password=' + fs_mail['clave'];
    properties[4] = 'mail.smtp.port=25';
	var attachment= plugins.mail.createBinaryAttachment('Liquidación de honorarios médicos',plugins.file.readFile(frm_arch));
	var asunto    = "Liquidación de honorarios médicos - Profesional "+ frm_prof_descripcion  
	var bodymsg   = "<html><body>"+"Se adjunta liquidaci&#243;n en archivo pdf correspondiente al Lote Nro. " + frm_lote
	bodymsg += "<br>Sr. Profesional: <br>"
	bodymsg += "La factura correspondiente debe ser enviada a los siguientes correos electr&#243;nicos:<br>"
	bodymsg += "Para: lmunoz@sanatoriocolegiales.com.ar <br>"
	bodymsg += "Para: nfontan@sanatoriocolegiales.com.ar <br>"
	bodymsg += "CC: clausmocovich@sanatoriocolegiales.com.ar <br><br>"
	bodymsg += "Este correo se env&#237;a en forma autom&#225;tica, por favor no lo responda "+"</body></html>";
	var mail_para = gbl_prof_to_prof.prof26
	var mail_cc   = 'clausmocovich@sanatoriocolegiales.com.ar, clongo@sanatoriocolegiales.com.ar, lmunoz@sanatoriocolegiales.com.ar'
	var mail_cco  = 'fhuertas@cirendsa.com.ar'	
	var success = plugins.mail.sendMail(mail_para,  fs_mail['mail_origen'], asunto, bodymsg, mail_cc, mail_cco,[attachment], properties);
	
	// guardar log de mail
	var $id = application.getUUID();
	//Verificando si existe clave primaria
	var sql = "SELECT EXISTS( SELECT id FROM tbl_mail_liq_conv_prof WHERE id='" + $id + "')"
	var dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
	while(dsExists.getValue(1,1) == 1){
		$id = application.getUUID();
		sql = "SELECT EXISTS( SELECT id FROM tbl_mail_liq_conv_prof WHERE id='" + $id + "')"
		dsExists = databaseManager.getDataSetByQuery('desal',sql,null,-1);
	}	
	var fs = databaseManager.getFoundSet("desal","tbl_mail_liq_conv_prof")
	fs.newRecord()
	
	fs['id']         =$id;
	fs['fecha']      =globals.gbl_fecha_hoy;
	fs['hora']       =application.getServerTimeStamp();
	fs['profesional']=profesional;
	fs['lote']       =lote;
	fs['mail_para']  =mail_para;
	fs['mail_cc']    =mail_cc;
	fs['mail_cco']   =mail_cco;
	fs['pdf']        =plugins.file.readFile(frm_arch);
	if(!success){
		fs['estado']     =false;
    }else{
    	fs['estado']     =true;
    }
	fs['legajo']     =globals.vLega;
	databaseManager.startTransaction()
	var result = databaseManager.saveData(fs);
	if(result){
		databaseManager.commitTransaction();
	}else{
		databaseManager.rollbackTransaction()	
	}
	if (!success){
		globals.DIALOGS.showErrorDialog('Error','No se pudo enviar email, intentelo nuevamente.')
	}else{
	    globals.DIALOGS.showInfoDialog('Envío','El envío de correo se efectuo satifactoriamente.')
	}
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"8B08E35C-12B0-4778-B4FC-8CBB6291759E"}
 */
function onHide_consultaRegistro(event) {
	if(globals.gbl_cerrarConsultaRegistro){
		var $win = application.getWindow(application.getActiveWindow().getName());
		if($win != null){
			$win.hide();
			$win.destroy();
		}
	}
	return globals.gbl_cerrarConsultaRegistro;
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"26C11D8D-8272-4801-B773-1D62FA42CCCD"}
 */
function onAction_cerrar(event) {
	globals.gbl_cerrarConsultaRegistro = true;
	onHide_consultaRegistro(event);
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"2689D61B-6636-4A77-950F-1D59972DD9EF"}
 */
function onAction_seleccionar(event) {
	if(frm_tipo_prestacion == 1){
	    forms.frm_scr_liquid_prof_validacion.onAction_selec(event)
	}
	if(frm_tipo_prestacion == 2){
	    forms.frm_scr_liquid_prof_validacion_practicas.onAction_selec(event)
	}
	if(frm_tipo_prestacion == 3){
	    forms.frm_scr_liquid_prof_validacion_intercons.onAction_selec(event)
	}
	if(frm_tipo_prestacion == 4){
	    forms.frm_scr_liquid_prof_validacion_seguimien.onAction_selec(event)
	}
	if(frm_tipo_prestacion == 5){
	    forms.frm_scr_liquid_prof_validacion_cirugias.onAction_selec(event)
	}
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"8164A197-80C2-4C5F-96E7-5502DF3EC04F"}
 */
function onAction_deseleccionar(event) {
	if(frm_tipo_prestacion == 1){
	    forms.frm_scr_liquid_prof_validacion.onAction_desel(event)
	}
	if(frm_tipo_prestacion == 2){
	    forms.frm_scr_liquid_prof_validacion_practicas.onAction_desel(event)
	}
	if(frm_tipo_prestacion == 3){
	    forms.frm_scr_liquid_prof_validacion_intercons.onAction_desel(event)
	}
	if(frm_tipo_prestacion == 4){
	    forms.frm_scr_liquid_prof_validacion_seguimien.onAction_desel(event)
	}
	if(frm_tipo_prestacion == 5){
	    forms.frm_scr_liquid_prof_validacion_cirugias.onAction_desel(event)
	}
}

/**
 * @param event
 *
 * @properties={typeid:24,uuid:"29E1A8F1-16BE-4103-A135-6C674C81E896"}
 */
function onAction_tipo_prestacion(event) {
	elements.con_fecha_desde.requestFocus()
	if(frm_tipo_prestacion != 1){
		globals.gbl_con_especial = 9999
		frm_con_especialidad = 'TODAS'
		frm_espe_descripcion = ''		
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"BD1FF264-D3F7-464D-978C-4A3D0BC94D68"}
 */
function onAction_fecha_desde(event) {
	if(frm_fecha_desde > globals.gbl_fecha_hoy){
		globals.DIALOGS.showWarningDialog('Atención','la fecha no puede ser mayor a la fecha del día', 'Ok')
	    elements.con_fecha_desde.requestFocus()
	}else{
		elements.con_fecha_hasta.requestFocus()	
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"1A26C32E-BEE6-4FA0-A464-25AAAA9413C5"}
 */
function onAction_fecha_hasta(event) {
	if(frm_fecha_hasta > globals.gbl_fecha_hoy){
		globals.DIALOGS.showWarningDialog('Atención','la fecha no puede ser mayor a la fecha del día', 'Ok')
	    elements.con_fecha_hasta.requestFocus()
	}else{
		if(frm_fecha_hasta < frm_fecha_desde){
			globals.DIALOGS.showWarningDialog('Atención','la fecha hasta no puede ser menor a la fecha desde', 'Ok')
		    elements.con_fecha_hasta.requestFocus()
		}else{
	        elements.btn_procesar.requestFocus()
		}
	}
}

/**
 * @AllowToRunInFind 
 * 
 * @param event
 *
 * @properties={typeid:24,uuid:"B2DD1220-9154-4FDC-82FC-CA9F900DEC46"}
 */
function onAction_imprimir(event) {
	
	var nombres = globals.vOperador.split(' ');
	var operadorAbreviado  = ''
	var cantNombre = nombres.length>3?3:nombres.length
	for (var index = 0; index < cantNombre; index++) {
		if(index >0){
			operadorAbreviado = operadorAbreviado +' '+ globals.abreviarNombre(nombres[index])+'.'
			
		}else{
			operadorAbreviado = operadorAbreviado+ nombres[index];
		}
	}
	globals.gbl_operador = operadorAbreviado + ' LEG '+ globals.vLega
	
	
	if(frm_tipo_prestacion == 1){	
		var $frm = solutionModel.getForm('prn_liquid_prof_validacion')
	    var frm_ds2 = databaseManager.convertToDataSet (forms.frm_scr_liquid_prof_validacion.foundset,['enabled','res_cod_med',
	             'res_des_med', 'res_cod_esp','res_des_esp','res_fecha','res_hora','res_cod_obra','res_des_obra','res_plan_obra',
				 'res_hist_cli','res_afiliado','res_iva','res_tipo_nome','res_cod_nomencla','res_des_nomencla','res_cantidad',
				 'res_imp_valor','res_grupo_nome','res_hora_int','res_iva_int','res_grupo_nome_orig','res_cod_nome_orig',
				 'res_validado', 'res_txt_nomencla', 'res_des_hist_cli'])
		var $tipos = [JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.DATETIME, 
                  JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, 
	              JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER,
	              JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER,
				  JSColumn.TEXT, JSColumn.TEXT, JSColumn.TEXT]
		$frm.dataSource = frm_ds2.createDataSource('Auxd_prn_liquid_prof_valida', $tipos)
	}
	if(frm_tipo_prestacion == 2){
		$frm = solutionModel.getForm('prn_liquid_prof_validacion_practicas')
		frm_ds2 = databaseManager.convertToDataSet (forms.frm_scr_liquid_prof_validacion_practicas.foundset,['enabled','res_cod_med',
                 'res_des_med', 'res_cod_esp','res_des_esp','res_fecha','res_hora','res_cod_obra','res_des_obra','res_plan_obra',
		         'res_hist_cli','res_afiliado','res_iva','res_tipo_nome','res_cod_nomencla','res_des_nomencla','res_cantidad',
		         'res_imp_valor','res_grupo_nome','res_hora_int','res_iva_int','res_grupo_nome_orig','res_cod_nome_orig',
		         'res_validado', 'res_txt_nomencla', 'res_des_hist_cli', 'res_fecha_pedido', 'res_fecha_realizado', 'res_remoto',
				 'res_urgente', 'res_pedido'])	
	    $tipos = [JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.DATETIME, 
                  JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, 
	              JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER,
	              JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER,
				  JSColumn.TEXT, JSColumn.TEXT, JSColumn.DATETIME, JSColumn.DATETIME, JSColumn.TEXT, JSColumn.TEXT, JSColumn.NUMBER]
		$frm.dataSource = frm_ds2.createDataSource('Auxd_prn_liquid_prof_valida_practicas', $tipos)
	}
	if(frm_tipo_prestacion == 3){
		$frm = solutionModel.getForm('prn_liquid_prof_validacion_intercons')
		frm_ds2 = databaseManager.convertToDataSet (forms.frm_scr_liquid_prof_validacion_intercons.foundset,['enabled','res_cod_med',
                 'res_des_med', 'res_cod_esp','res_des_esp','res_fecha','res_hora','res_cod_obra','res_des_obra','res_plan_obra',
		         'res_hist_cli','res_afiliado','res_iva','res_tipo_nome','res_cod_nomencla','res_des_nomencla','res_cantidad',
		         'res_imp_valor','res_grupo_nome','res_hora_int','res_iva_int','res_grupo_nome_orig','res_cod_nome_orig',
		         'res_validado', 'res_txt_nomencla', 'res_des_hist_cli', 'res_fecha_pedido', 'res_fecha_realizado', 'res_remoto', 'res_urgente'])	
	    $tipos = [JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.DATETIME, 
                  JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, 
	              JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER,
	              JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER,
				  JSColumn.TEXT, JSColumn.TEXT, JSColumn.DATETIME, JSColumn.DATETIME, JSColumn.TEXT, JSColumn.TEXT]
		$frm.dataSource = frm_ds2.createDataSource('Auxd_prn_liquid_prof_valida_intercons', $tipos)
	}
	if(frm_tipo_prestacion == 4){
		$frm = solutionModel.getForm('prn_liquid_prof_validacion_seguimien')
		frm_ds2 = databaseManager.convertToDataSet (forms.frm_scr_liquid_prof_validacion_seguimien.foundset,['enabled','res_cod_med',
                 'res_des_med', 'res_cod_esp','res_des_esp','res_fecha','res_hora','res_cod_obra','res_des_obra','res_plan_obra',
		         'res_hist_cli','res_afiliado','res_iva','res_tipo_nome','res_cod_nomencla','res_des_nomencla','res_cantidad',
		         'res_imp_valor','res_grupo_nome','res_hora_int','res_iva_int','res_grupo_nome_orig','res_cod_nome_orig',
		         'res_validado', 'res_txt_nomencla', 'res_des_hist_cli', 'res_fecha_pedido', 'res_fecha_realizado', 'res_remoto', 'res_urgente'])	
	    $tipos = [JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.DATETIME, 
                  JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, 
	              JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER,
	              JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER,
				  JSColumn.TEXT, JSColumn.TEXT, JSColumn.DATETIME, JSColumn.DATETIME, JSColumn.TEXT, JSColumn.TEXT]
		$frm.dataSource = frm_ds2.createDataSource('Auxd_prn_liquid_prof_valida_seguimien', $tipos)
	}
	if(frm_tipo_prestacion == 5){
		$frm = solutionModel.getForm('prn_liquid_prof_validacion_cirugias')
		frm_ds2 = databaseManager.convertToDataSet (forms.frm_scr_liquid_prof_validacion_cirugias.foundset,['enabled','res_cod_med',
                 'res_des_med', 'res_cod_esp','res_des_esp','res_fecha','res_hora','res_cod_obra','res_des_obra','res_plan_obra',
		         'res_hist_cli','res_afiliado','res_iva','res_tipo_nome','res_cod_nomencla','res_des_nomencla','res_cantidad',
		         'res_imp_valor','res_grupo_nome','res_hora_int','res_iva_int','res_grupo_nome_orig','res_cod_nome_orig',
		         'res_validado', 'res_txt_nomencla', 'res_des_hist_cli', 'res_fecha_pedido', 'res_fecha_realizado', 'res_remoto', 'res_urgente'])	
	    $tipos = [JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.DATETIME, 
                  JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.TEXT, 
	              JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.TEXT, JSColumn.NUMBER, JSColumn.NUMBER,
	              JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER, JSColumn.NUMBER,
				  JSColumn.TEXT, JSColumn.TEXT, JSColumn.DATETIME, JSColumn.DATETIME, JSColumn.TEXT, JSColumn.TEXT]
		$frm.dataSource = frm_ds2.createDataSource('Auxd_prn_liquid_prof_valida_cirugias', $tipos)
	}
	if(frm_tipo_prestacion == 1){
        forms.prn_liquid_prof_validacion.controller.recreateUI()
		// Filtra solos los seleccionados
	    forms.prn_liquid_prof_validacion.foundset.addFoundSetFilterParam('res_validado', '=', '0','filtro2')
	    forms.prn_liquid_prof_validacion.foundset.addFoundSetFilterParam('enabled', '=', '1','filtro3')
	    var $max = databaseManager.getFoundSetCount(forms.prn_liquid_prof_validacion.foundset)				
	    //
	    if($max == 0 ){
  		    globals.DIALOGS.showWarningDialog('Atención','No hay datos para imprimir', 'Ok')
	    }else{
		    if (event.getElementName() == 'btn_imprimir') {  
	            globals.printRoutine('prn_liquid_prof_validacion', true, 0)
		    }else{
			    imprimir_pdf(frm_lote)
		    }
	    }
	    forms.prn_liquid_prof_validacion.foundset.removeFoundSetFilterParam('filtro3')
	    forms.prn_liquid_prof_validacion.foundset.removeFoundSetFilterParam('filtro2')
	}
	if(frm_tipo_prestacion == 2){
        forms.prn_liquid_prof_validacion_practicas.controller.recreateUI()
		// Filtra solos los seleccionados
	    forms.prn_liquid_prof_validacion_practicas.foundset.addFoundSetFilterParam('res_validado', '=', '0','filtro2')
	    forms.prn_liquid_prof_validacion_practicas.foundset.addFoundSetFilterParam('enabled', '=', '1','filtro3')
	    $max = databaseManager.getFoundSetCount(forms.prn_liquid_prof_validacion_practicas.foundset)				
	    //
	    if($max == 0 ){
  		    globals.DIALOGS.showWarningDialog('Atención','No hay datos para imprimir', 'Ok')
	    }else{
		    if (event.getElementName() == 'btn_imprimir') {  
	            globals.printRoutine('prn_liquid_prof_validacion_practicas', true, 0)
		    }else{
			    imprimir_pdf(frm_lote)
		    }
	    }
	    forms.prn_liquid_prof_validacion_practicas.foundset.removeFoundSetFilterParam('filtro3')
	    forms.prn_liquid_prof_validacion_practicas.foundset.removeFoundSetFilterParam('filtro2')
	}
	if(frm_tipo_prestacion == 3){
        forms.prn_liquid_prof_validacion_intercons.controller.recreateUI()
		// Filtra solos los seleccionados
	    forms.prn_liquid_prof_validacion_intercons.foundset.addFoundSetFilterParam('res_validado', '=', '0','filtro2')
	    forms.prn_liquid_prof_validacion_intercons.foundset.addFoundSetFilterParam('enabled', '=', '1','filtro3')
	    $max = databaseManager.getFoundSetCount(forms.prn_liquid_prof_validacion_intercons.foundset)				
	    //
	    if($max == 0 ){
  		    globals.DIALOGS.showWarningDialog('Atención','No hay datos para imprimir', 'Ok')
	    }else{
		    if (event.getElementName() == 'btn_imprimir') {  
	            globals.printRoutine('prn_liquid_prof_validacion_intercons', true, 0)
		    }else{
			    imprimir_pdf(frm_lote)
		    }
	    }
	    forms.prn_liquid_prof_validacion_intercons.foundset.removeFoundSetFilterParam('filtro3')
	    forms.prn_liquid_prof_validacion_intercons.foundset.removeFoundSetFilterParam('filtro2')
	}
	if(frm_tipo_prestacion == 4){
        forms.prn_liquid_prof_validacion_seguimien.controller.recreateUI()
		// Filtra solos los seleccionados
	    forms.prn_liquid_prof_validacion_seguimien.foundset.addFoundSetFilterParam('res_validado', '=', '0','filtro2')
	    forms.prn_liquid_prof_validacion_seguimien.foundset.addFoundSetFilterParam('enabled', '=', '1','filtro3')
	    $max = databaseManager.getFoundSetCount(forms.prn_liquid_prof_validacion_seguimien.foundset)				
	    //
	    if($max == 0 ){
  		    globals.DIALOGS.showWarningDialog('Atención','No hay datos para imprimir', 'Ok')
	    }else{
		    if (event.getElementName() == 'btn_imprimir') {  
	            globals.printRoutine('prn_liquid_prof_validacion_seguimien', true, 0)
		    }else{
			    imprimir_pdf(frm_lote)
		    }
	    }
	    forms.prn_liquid_prof_validacion_seguimien.foundset.removeFoundSetFilterParam('filtro3')
	    forms.prn_liquid_prof_validacion_seguimien.foundset.removeFoundSetFilterParam('filtro2')
	}
	if(frm_tipo_prestacion == 5){
        forms.prn_liquid_prof_validacion_cirugias.controller.recreateUI()
		// Filtra solos los seleccionados
	    forms.prn_liquid_prof_validacion_cirugias.foundset.addFoundSetFilterParam('res_validado', '=', '0','filtro2')
	    forms.prn_liquid_prof_validacion_cirugias.foundset.addFoundSetFilterParam('enabled', '=', '1','filtro3')
	    $max = databaseManager.getFoundSetCount(forms.prn_liquid_prof_validacion_cirugias.foundset)				
	    //
	    if($max == 0 ){
  		    globals.DIALOGS.showWarningDialog('Atención','No hay datos para imprimir', 'Ok')
	    }else{
		    if (event.getElementName() == 'btn_imprimir') {  
	            globals.printRoutine('prn_liquid_prof_validacion_cirugias', true, 0)
		    }else{
			    imprimir_pdf(frm_lote)
		    }
	    }
	    forms.prn_liquid_prof_validacion_cirugias.foundset.removeFoundSetFilterParam('filtro3')
	    forms.prn_liquid_prof_validacion_cirugias.foundset.removeFoundSetFilterParam('filtro2')
	}
}
/**
 * @properties={typeid:24,uuid:"F26A48C0-0267-4225-A705-78A2A96DD9D4"}
 */
function imprimir_pdf($lote){
	
	frm_arch = ''
	var $params = {		
		pr_img1:"media:///logo1.png", pr_img2:"media:///logo2.png",	pr_fecha_desde: frm_fecha_desde, pr_fecha_hasta: frm_fecha_hasta,
		pr_profesional: frm_prof_descripcion, pr_lote: $lote,  pr_operador: globals.gbl_operador,
		res_total_cant_1: frm_total_cant_pdf1, res_total_cant_2: frm_total_cant_pdf2, res_total_cant_3: frm_total_cant_pdf3, res_total_cant_4: frm_total_cant_pdf4, 
		res_total_valor_1 : frm_total_valor_1, res_total_valor_2 : frm_total_valor_2, res_total_valor_3 : frm_total_valor_3, res_total_valor_4 : frm_total_valor_4,              
		res_total_iva_1 : frm_total_iva_1, res_total_iva_2 : frm_total_iva_2, res_total_iva_3 : frm_total_iva_3, res_total_iva_4 : frm_total_iva_4,
		res_total_imp_1 : frm_total_imp_1, res_total_imp_2 : frm_total_imp_2, res_total_imp_3 : frm_total_imp_3, res_total_imp_4 : frm_total_imp_4		
	}
	
	var $arch = plugins.file.showFileSaveDialog('SQ-LIQUID-PROF' + application.getIPAddress() + '.pdf')
	frm_arch = $arch
	if ($arch){
		if(frm_tipo_prestacion == 1){
		    plugins.jasperPluginRMI.runReport(forms.prn_liquid_prof_validacion.foundset,'rp_liquid_prof.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		}
		if(frm_tipo_prestacion == 2){
		    plugins.jasperPluginRMI.runReport(forms.prn_liquid_prof_validacion_practicas.foundset,'rp_liquid_prof_practicas.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		}
		if(frm_tipo_prestacion == 3){
		    plugins.jasperPluginRMI.runReport(forms.prn_liquid_prof_validacion_intercons.foundset,'rp_liquid_prof_intercons.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		}
		if(frm_tipo_prestacion == 4){
		    plugins.jasperPluginRMI.runReport(forms.prn_liquid_prof_validacion_seguimien.foundset,'rp_liquid_prof_seguimien.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		}
		if(frm_tipo_prestacion == 5){
		    plugins.jasperPluginRMI.runReport(forms.prn_liquid_prof_validacion_seguimien.foundset,'rp_liquid_prof_cirugias.jasper' ,$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		}
		var $OS = application.getOSName();
		if (/Windows/.test($OS)) {
		    application.executeProgram("rundll32.exe", ["url.dll,FileProtocolHandler", $arch.getAbsolutePath()]);	      
	    } else if (/Linux|Freebsd/.test($OS)) {
	       application.executeProgram('xdg-open', $arch);
	    } else if (/Mac/.test($OS)) {
	       application.executeProgram('open', $arch);
	    }
	}	
}

/**
 * TODO generated, please specify type and doc for the params
 * @param prestacion
 * @param conveniosProfesional
 * @param indicePrestacion
 *
 * @properties={typeid:24,uuid:"51C6CDAE-3FAD-483E-8024-E48BA9DB2C2B"}
 */
function obtenerValorConvenio(prestacion, conveniosProfesional, indicePrestacion){
	 var convenioEncontrado = new Object()
	 var valorConvenio = 0
		if(frm_tipo_prestacion==1){
			convenioEncontrado = conveniosProfesional.filter(
			function(x){
				return x.conv_especialidad===prestacion.getValue(indicePrestacion,3) && 
				x.conv_obra_social ===prestacion.getValue(indicePrestacion,7) && 
				x.conv_tipo_nom  ===prestacion.getValue(indicePrestacion,13) &&
				x.conv_grupo_nom  === prestacion.getValue(indicePrestacion,20) &&
				x.conv_cod_nom === prestacion.getValue(indicePrestacion,14)
				}
			);
		}else{
			convenioEncontrado = conveniosProfesional.filter(
			function(x){
				return x.conv_obra_social ===prestacion.getValue(indicePrestacion,7) && 
				x.conv_tipo_nom  ===prestacion.getValue(indicePrestacion,13) &&
				x.conv_grupo_nom  === prestacion.getValue(indicePrestacion,20) &&
				x.conv_cod_nom === prestacion.getValue(indicePrestacion,14)
				}
			);
		}
		if(convenioEncontrado !=null && convenioEncontrado!=undefined && convenioEncontrado.length>0){
			if(convenioEncontrado.length>0){
				convenioEncontrado=convenioEncontrado.reduce(function(p,c){
					return p.conv_fecha_desde > c.conv_fecha_desde ? p:c
				})

				if (frm_tipo_prestacion == 2 && prestacion.getValue(indicePrestacion,25) == 1){
					valorConvenio = convenioEncontrado.conv_imp_valor2
				    if(convenioEncontrado.conv_tipo_valor == 2){
				    	valorConvenio = convenioEncontrado.conv_imp_valor2 * prestacion.getValue(indicePrestacion,26)
				    }
				}else{
					valorConvenio = convenioEncontrado.conv_imp_valor
				    if(convenioEncontrado.conv_tipo_valor == 2){
				    	valorConvenio = convenioEncontrado.conv_imp_valor * prestacion.getValue(indicePrestacion,26)
				    }
				}
				
			}
			}
		return valorConvenio
}
/**
 * @param event
 *
 * @properties={typeid:24,uuid:"8CA6A821-8335-4A01-A59B-50EE60721B6D"}
 */
function onAction_controlar_empresa(event) {
	switch (globals.gbl_con_empresa){
	    case 1: globals.gbl_catalogo = 'maestros';break;
	    case 11: globals.gbl_catalogo = 'cirendsa';break;	
	    default: globals.gbl_catalogo = 'maestros';break;	    
    }
  //Carga tabla de Profesionales
    frm_con_profesional         = ' ' 
	globals.gbl_con_profesional = ' '
    globals.gbl_profesional     = 0
    frm_prof_descripcion        = ''
	elements.lbl_procesando.text = 'Cargando Tabla Profesionales'
    elements.lbl_procesando.visible = true       
    forms.frm_tab_profesionales.cargar_tabla()
	
	//Carga tabla de Obras Sociales
	frm_con_cobertura         = ' '
	globals.gbl_con_cobertura = ' '
	globals.gbl_cobertura     = 0
	frm_obra_descripcion      = ''
	elements.lbl_procesando.text = 'Cargando Tabla Obras Sociales'        
    application.updateUI()        
    forms.frm_tab_coberturas_emp.cargar_tabla()
	elements.lbl_procesando.visible = false   	
}