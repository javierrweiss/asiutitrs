/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4E1B5C7F-6AB6-41BE-9717-5AF106FF08C6",variableType:8}
 */
var Hcipiso_histclinUnica = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7DDEBEE8-864B-403C-B0F5-4978C327880B",variableType:4}
 */
var Hcipiso_diagno1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E87E6A95-0363-499C-B3F4-2A6150416807",variableType:4}
 */
var Hcipiso_nrointercons = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0357A3B7-E415-4A41-AAC5-3A3C62DA1B24",variableType:4}
 */
var Hcipiso_grupoTxt = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C5902279-30D4-48F3-85C4-6ED43662293E",variableType:4}
 */
var Hcipiso_horaTxt = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"72E08A99-780E-4237-B500-5A92D1BCB9C3",variableType:4}
 */
var Hcipiso_fechaTxt = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A21F954E-2A90-4005-9361-5D9843E3B847",variableType:4}
 */
var Hcipiso_espCodi = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B10C051F-BB89-4FF6-9DE8-3649B8EDC0F6",variableType:4}
 */
var Hcipiso_wEquipo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"02860422-1D33-4006-9E4D-0BA23A96F247",variableType:4}
 */
var Hcipiso_nroHabi = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"855209CD-AD37-44FB-B473-CD46FF3F44C0",variableType:4}
 */
var Hcipiso_codAutoHist = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A61E209D-82E2-479C-B991-102A6A7F53C2",variableType:4}
 */
var Hcipiso_camHabita = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"061DF70E-DA63-44F0-88D0-74B229ABF97D"}
 */
var Hcipiso_camCama = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5D4F721C-4E2B-4E06-A67B-713E534CFD23",variableType:4}
 */
var Hcipiso_servCodigo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"577878E2-AB0B-47BF-8D35-AB509CA054AB",variableType:4}
 */
var Hcipiso_ipedPedido = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6116F782-29A2-4413-AB7D-CE3C459B536C",variableType:4}
 */
var Hcipiso_ipedServicio = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"27D45E89-D576-4E46-A9F8-4FCD41193F8B",variableType:4}
 */
var Hcipiso_horaHciint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C4A68F4F-8E7B-43E0-B571-00F42158C0ED",variableType:4}
 */
var Hcipiso_fechaHciint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5382ADB0-30AB-457E-829E-5BA45B4E9C3E",variableType:4}
 */
var Hcipiso_vEspeMed = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"346BEDAA-E00B-4CEF-8EF0-650C92ED3570"}
 */
var Hcipiso_vPassOperador = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"46326BC4-CA92-46FC-8BF8-8801F5E77A05",variableType:4}
 */
var Hcipiso_vTipoTecnico = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7A805BB2-0E02-4E1E-9F89-F4399FE42A10",variableType:4}
 */
var Hcipiso_vTipoOperador = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9B49745A-6E3C-4404-BE6F-648B7F8C32EA",variableType:8}
 */
var Hcipiso_digito_verificador = 0;

/**
 * @properties={typeid:35,uuid:"C2E64AF5-F350-4B49-98E1-4CF3FAE0CE56",variableType:-4}
 */
var Hcipiso_vDigVerif = false;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"095C4FD2-1D8A-48F9-8779-47C1273CFF05",variableType:8}
 */
var Hcipiso_vlargo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"30EFF13B-CD22-45A8-9A2C-3325034FB745",variableType:8}
 */
var Hcipiso_vClave = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"5D317F05-58E2-4EAE-A0E5-92A59EFF27E8"}
 */
var Hcipiso_vOperador = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1D2891EC-BB77-44E3-94F6-1CA824F1FD87",variableType:8}
 */
var Hcipiso_vLega = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"95B19ABE-2E87-4B5C-B35E-0427A7C3E270",variableType:8}
 */
var Hcipiso_vLegajo = 0;

/**
 * @properties={typeid:35,uuid:"0ED64074-A30B-4E4B-B342-C8A66950DA54",variableType:-4}
 */
var Hcipiso_esAnestesista = false;

/**
 * @properties={typeid:35,uuid:"B80952D7-EC9B-4A6F-8B64-48F07EDED026",variableType:-4}
 */
var Hcipiso_vSolomedicos = true;

/**
 * @properties={typeid:35,uuid:"EAE2A8B8-38ED-4ACE-9505-A1328A8E5D2D",variableType:-4}
 */
var Hcipiso_permisos = new Array();

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5AA9AC75-62DC-4516-96E0-A9ED3ECF7909",variableType:4}
 */
var Hcipiso_alerHistClinPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"85E34A24-9639-4CE0-9395-645CC6E5DF5D",variableType:4}
 */
var Hcipiso_patCodiPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1419CDC5-27C4-4552-8BB2-B8D09F5E96BE",variableType:4}
 */
var Hcipiso_horaIngresoPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"67AEE658-BFFD-4AE7-A5C4-0ABA5167308B",variableType:4}
 */
var Hcipiso_fechaIngresoPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"79330BE1-0537-48A2-8F18-5DE416234CC6",variableType:4}
 */
var Hcipiso_hcUnicaPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0B05933F-0C58-4CE6-8E78-36006C86E811",variableType:4}
 */
var Hcipiso_perLegajoPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5E1C4B82-5984-496A-BD53-2AAEDA4A57BA",variableType:4}
 */
var hcipiso_medCodigoPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5993B149-AC61-4308-B01A-0D8AD60CA04E",variableType:4}
 */
var Hcipiso_histClinAsist = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D434B821-204E-4D57-BBEA-74B7CC9BE77D",variableType:4}
 */
var Hcipiso_horaPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E238AD0E-E69E-49DE-A8A3-25D80AFC5A6C",variableType:4}
 */
var Hcipiso_fechaPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"497B9277-07B5-4DD2-942E-A854B5E3B489",variableType:4}
 */
var Hcipiso_histClinPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"27B74111-C7D3-4574-A1CA-16668A810991",variableType:4}
 */
var Hcipiso_itemTxt = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"F8C79BBF-9471-41C0-86AE-DC108D3205F4"}
 */
var Hcipiso_patDataProvider = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0F889E9E-BD15-44B9-995B-E0C86E3F283E",variableType:4}
 */
var Hcipiso_obrCodigo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2A1AACAA-4176-414D-B878-0D7482E13D08",variableType:4}
 */
var Hcipiso_hiiHisCli = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5ED19DD8-816C-45B2-848E-98EFC96DF07B",variableType:4}
 */
var Hcipiso_hisclin = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0A2B0F2C-5DFD-467F-94FB-2743F2734808",variableType:4}
 */
var Hcipiso_eventSourceButton = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A223AF52-94F8-4C08-8CAE-5F9B40E0660E"}
 */
var Hcipiso_hisclistrynro = '';

/**
 * @properties={typeid:24,uuid:"39C7BFC1-457B-4B60-A6B1-6F6DD233B1B4"}
 */
function onSolutionOpen_Hcipiso() {
	
	plugins.window.getMenuBar().setVisible(false)
    plugins.window.setToolBarAreaVisible(false)
    
    var names1 = plugins.window.getToolbarNames();
    for (var i = 0 ; i < names1.length ; i++) {
         plugins.window.removeToolBar(names1[i])
    }    
    plugins.window.setFullScreen(false)
    plugins.window.getMenuBar().setVisible(false)
    plugins.window.setToolBarAreaVisible(false)
	plugins.window.setStatusBarVisible(false);
    
    databaseManager.setAutoSave(false)
}

/**
 * TODO generated, please specify type and doc for the params
 * @param args
 *
 * @properties={typeid:24,uuid:"DB65340F-2E26-43AD-B007-5B1765B7BA3D"}
 */
function llamada_desde_Menu(args) {
	
	// Trae datos desde el Menu
	args = args.toString()
	args=args.split(';') 
	globals.vLegajo=utils.stringToNumber(args[0])
	globals.vLega=utils.stringToNumber(args[1])
	globals.vOperador=args[2]
	globals.vTipoOperador=utils.stringToNumber(args[3])
	globals.gbl_transacciones_1= 0 //args[4] 
	globals.vEmpresa=args[5]
	globals.gbl_expanding_Nodes=args[6]
	globals.gbl_title= 'Historia Clínica de Ingreso a Piso'
	forms.frm_menu.elements.frm_main.dividerLocation = 0.20	// divide ventana
	application.updateUI()
	
	//Cargar permisos
	var $ip         = application.getIPAddress()
	var $solucion   =  application.getSolutionName()	
	var $Args       = new Array()
	var $SQL ="select  PERF.codigo_perfil, PERF.codigo_solucion, PERF.codigo_formulario, PERF.codigo_elemento, " 
             +"PERF.visible, PERF.accesible "
	         +"from tbl_permiso "
             +"left join tbl_perfil_itm PERF on tbl_permiso.codigo_perfil = PERF.codigo_perfil "             
             +"where tbl_permiso.codigo_legajo = "
             + globals.vLega
			 if (globals.vLega == 0){
				 $SQL = $SQL + " and ip = '"
				 + $ip + "'"
			 }
			 $SQL = $SQL + " and PERF.codigo_solucion = '"
			 + $solucion
             +"' order by PERF.codigo_perfil asc, PERF.codigo_solucion asc, PERF.codigo_formulario asc, PERF.codigo_elemento asc"
    globals.Hcipiso_permisos = databaseManager.getDataSetByQuery("desal", $SQL, $Args, -1);	
    var $max = globals.Hcipiso_permisos.getMaxRowIndex()
	if(!$max){ return}
    
	//Pide legajo de medico para acceder al form
	globals.Hcipiso_vSolomedicos=true
	globals.Hcipiso_esAnestesista=false
	globals.Hcipiso_vLegajo=0
	globals.Hcipiso_vLega=0
	globals.Hcipiso_vOperador=''
	globals.Hcipiso_vClave=0
	globals.Hcipiso_vEspeMed = 0;
    var win = application.createWindow("legajo_medico",JSWindow.MODAL_DIALOG)	
    win.title= 'Ingrese Legajo del médico'
    win.setSize(570,260)
    win.resizable = false
    win.show(forms.Hcipiso_dlg_pideLegajoMedico)
	win.destroy()
	if(globals.Hcipiso_esAnestesista && globals.Hcipiso_vSolomedicos ){}
	else{return}

	//Muestra Formulario Principal
	win = application.createWindow("Menu_item",JSWindow.MODAL_DIALOG)	
    win.title= globals.gbl_title
    win.resizable = false	
    win.show(forms.Hcipiso_frm_hist_clin_ingreso_piso)
	win.destroy()
	
}

/**
 * @properties={typeid:24,uuid:"660A2D75-FE8F-499A-A605-BA6B64AC86A8"}
 */
function formatearHistclin() {
	var histClin = '';
	if(arguments[0] != undefined)
		histClin =  arguments[0].toString().substr(0,arguments[0].toString().length-1)+"/"+arguments[0].toString().substr(arguments[0].toString().length -1,1)	

	return histClin;
}

/**
 * TODO generated, please specify type and doc for the params
 * @param {String} realValue
 *
 * @properties={typeid:24,uuid:"FC363C9C-4E44-4FB2-BA26-3860510C4E19"}
 */
function Hcipiso_convertNumberToHour_HHMM(realValue) {
	
	var hora = "";
	if(realValue != null){
		var value = Number(realValue);
		if(value < 1){
			hora = "00:00";
		}
		else{
			if(value < 10){
				hora = "00:0" + value.toString().substr(0,1);
			}
			else{
				if(value < 100){
					hora = "00:" + value.toString().substr(0,2);
				}
				else{
					if(value < 1000){
						hora = "0" + value.toString().substr(0,1) + ":" + value.toString().substr(1,2);
					}
					else{
						if(value <= 2359){
							hora = value.toString().substr(0,2) + ":" + value.toString().substr(2,2);
						}
					}
				}
			}
		}
	}
	
	return hora;
}

/**
 * @properties={typeid:24,uuid:"04447184-0551-4B68-B050-9B96A45E1EA3"}
 */
function hcipiso_calculaDigitoVerificador() {
	var aux_dig = new Array(5);
	if(globals.Hcipiso_vlargo==2){
		aux_dig[0] = 0
		aux_dig[1] = 0
		aux_dig[2] = 0
		aux_dig[3] = globals.Hcipiso_vLega.toString().substr(0,1);
		aux_dig[4] = globals.Hcipiso_vLega.toString().substr(1,1);
	}else{
		if (globals.Hcipiso_vlargo==3){
			aux_dig[0] = 0
			aux_dig[1] = 0
			aux_dig[2] = globals.Hcipiso_vLega.toString().substr(0,1);
			aux_dig[3] = globals.Hcipiso_vLega.toString().substr(1,1);
			aux_dig[4] = globals.Hcipiso_vLega.toString().substr(2,1);
		}else{
			if(globals.Hcipiso_vlargo==4){
				aux_dig[0] = 0
				aux_dig[1] = globals.Hcipiso_vLega.toString().substr(0,1);
				aux_dig[2] = globals.Hcipiso_vLega.toString().substr(1,1);
				aux_dig[3] = globals.Hcipiso_vLega.toString().substr(2,1);
				aux_dig[4] = globals.Hcipiso_vLega.toString().substr(3,1);
			}else{
				if(globals.Hcipiso_vlargo==5){
					aux_dig[0] = globals.Hcipiso_vLega.toString().substr(0,1);
					aux_dig[1] = globals.Hcipiso_vLega.toString().substr(1,1);
					aux_dig[2] = globals.Hcipiso_vLega.toString().substr(2,1);
					aux_dig[3] = globals.Hcipiso_vLega.toString().substr(3,1);
					aux_dig[4] = globals.Hcipiso_vLega.toString().substr(4,1);
				}
			}
		}
	}
	var verificador = 0;
	verificador = utils.stringToNumber(aux_dig[1]) + utils.stringToNumber(aux_dig[2]) * 3 + utils.stringToNumber(aux_dig[3]) * 9 + utils.stringToNumber(aux_dig[4]) * 7;
	var larg = verificador.toString().length - 1;
	if(globals.Hcipiso_digito_verificador!=verificador.toString().substr(larg,1)){
		globals.Hcipiso_vDigVerif=false
	}

}

/**
 * Called for performing a conversion between a database value and a displayed value.
 *
 * @param databaseValue The database value.
 * @param {String} dbType The type of the database column. Can be one of "TEXT", "INTEGER", "NUMBER", "DATETIME" or "MEDIA".
 *
 * @returns {Object} the displayed value.
 *
 * @properties={typeid:24,uuid:"615D209F-636D-46F7-9971-704FA48EF727"}
 */
function Hcipiso_convertNumberToDate(databaseValue, dbType) {
	
	var fecha = "";
	 
	if(databaseValue > 0){
		
		var fechaAux = String(databaseValue);
		fecha = fechaAux.substr(6,2) + '/' + fechaAux.substr(4,2) + '/' + fechaAux.substr(0,4); 
	}
		 
	return fecha;
}
