/**
 * @properties={typeid:35,uuid:"4D7D8CC8-9C0C-43F2-9D7A-F83A7F7FFF21",variableType:-4}
 */
var vencontroCirugintDtl = false;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4E8CC7D4-8DDE-410C-A6D6-5ED262A0142F"}
 */
var vciricodmed_7 = '';

/**
 * @properties={typeid:35,uuid:"22155938-EB04-4126-949B-11B721D2EE01",variableType:-4}
 */
var vencontroNomencla = true;

/**
 * @properties={typeid:35,uuid:"3969FE02-4786-4B78-9F46-A3CC0571D8BC",variableType:-4}
 */
var vencontroProfe = true;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D00DEC1A-12F7-4000-95EC-855AC631463C",variableType:4}
 */
var vtipomed_7 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BDDE10FD-E25E-419A-A33C-1251C4EEFE8C",variableType:4}
 */
var vtipomed_6 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B8C485E6-91F6-4B05-BA2B-087265C0CC1C",variableType:4}
 */
var vtipomed_5 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3A453329-147A-4EDF-AAE5-49D3D04F1C76",variableType:4}
 */
var vtipomed_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8F5F1055-0EC9-4170-9D5F-47B014EBFDBB",variableType:4}
 */
var vtipomed_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"84742CA6-7782-4627-B32E-008C68662C07",variableType:4}
 */
var vtipomed_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4B2C8FDD-A7B8-419A-BC92-2C0CB1305A5C",variableType:4}
 */
var vtipomed_1 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8E740907-C5F0-425D-9F16-2BD3D5812F03"}
 */
var vApeynomCirujano = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B8AD1FBD-CCE8-4669-AA6F-91B15B82982A"}
 */
var vdescrimed_7 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"F905A27B-F887-4F60-AC8A-FD7414A5F303"}
 */
var vdescrimed_6 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2F8A18E1-5C81-4374-ACF7-5142348E020B"}
 */
var vdescrimed_5 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2291080A-FF1B-4962-B656-FDFCE199E3D7"}
 */
var vdescrimed_4 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A5FDCB38-096D-4943-8843-568C9D3FA1D8"}
 */
var vdescrimed_3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"5A09A08C-D459-49FD-B059-A1206BDE72E0"}
 */
var vdescrimed_2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"55E7F58C-71E0-43F2-A29A-E60E584F9B99"}
 */
var vdescrimed_1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A3E8C24C-5598-4925-A065-EF0908148F46"}
 */
var vdescrinome = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"ADF753AF-E534-417F-94D3-CDB092A80D69",variableType:4}
 */
var vciriporcen_8 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0DB9BCD1-4A22-406E-A188-26301C93CF2B",variableType:4}
 */
var vciriporcen_7 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"91967A7F-A7A8-405A-A967-A7CBC80ACC66",variableType:4}
 */
var vciriporcen_6 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"804EB249-B87F-4280-B4C8-3EB6C0E78118",variableType:4}
 */
var vciriporcen_5 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"09AD8114-A373-4743-A37A-E5198EC8BC93",variableType:4}
 */
var vciriporcen_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6248D02C-FAD3-415B-8CB4-2CFCEF7EE6EF",variableType:4}
 */
var vciriporcen_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2C701085-CDAA-4EBB-AFB7-B8BD6C6AAEF0",variableType:4}
 */
var vciriporcen_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F2B6AA85-2ED6-457C-A57E-F96E0C33316F",variableType:4}
 */
var vciriporcen_1 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"DE473279-BBA7-405D-BB1D-2344E0AA9CB7"}
 */
var vciricodmed_6 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"819414B6-AE86-4D66-8ABB-21913BF94D6A"}
 */
var vciricodmed_5 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"6F3392AC-00D0-403F-9DD7-392BB96975A9"}
 */
var vciricodmed_4 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"BB1B9D7F-D9D0-48ED-B4F3-FFD9A60E674E"}
 */
var vciricodmed_3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"247C1184-6BA4-46BD-B3AA-E6745EF47A41"}
 */
var vciricodmed_2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A9BC3E40-363F-49B9-83A0-3EF3B206F911"}
 */
var vciricodmed_1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"97FC95C4-4FDD-4150-8630-86E397FE2685"}
 */
var vciricodnome = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6D5DD4C0-7EFE-48A0-B4CF-367339C6E85F",variableType:4}
 */
var vciritipnome = 0;

/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"15B4B257-8F0B-49B2-9E7F-ACCEC9108B7F",variableType:-4}
 */
var camposObligatorios = false;

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B8057E18-D596-4081-A8A8-56C9D7A674AB"}
 */
function onAction_Save_tbc_cirugint_dtl(event) {
	validaCamposObligatorios()
	if (camposObligatorios){
		if(vciricodmed_1!=''&&vciricodmed_1!=null){
			foundset.vcircodespec=utils.stringToNumber(vciricodmed_1)
		}
		if(vciricodmed_2!=''&&vciricodmed_2!=null){	
			foundset.vcircodayud1=utils.stringToNumber(vciricodmed_2)
		}
		if(vciricodmed_3!=''&&vciricodmed_3!=null){
			foundset.vcircodayud2=utils.stringToNumber(vciricodmed_3)
		}
		
		if(vciricodmed_5!=''&&vciricodmed_5!=null){
			foundset.vcircodaneste=utils.stringToNumber(vciricodmed_5)
		}
		
		
		if(globals.protambu1400_vciricodmed_7!=''&&globals.protambu1400_vciricodmed_7!=null){
			foundset.vcircodinstru=utils.stringToNumber(globals.protambu1400_vciricodmed_7)
		}
		foundset.vcirtipespec=vtipomed_1
		foundset.vcirtipayud1=vtipomed_2
		foundset.vcirtipayud2=vtipomed_3
		foundset.vcirtipaneste=vtipomed_5
		foundset.vcirtipinstru=vtipomed_7
		foundset.vcirporespec=vciriporcen_1
		foundset.vcirporayud1=vciriporcen_2
		foundset.vcirporayud2=vciriporcen_3
		foundset.vcirporaneste=vciriporcen_5
		foundset.vcirporinstru=vciriporcen_7
		foundset.vcirporgastos=vciriporcen_8	
		
		try{
			databaseManager.saveData(foundset.getRecord(1))
			var error1=''
			var error2=''
			var array = databaseManager.getFailedRecords(foundset)
			for (var i = 0; i < array.length; i++) {
				var record = array[i];
				// find out the table of the record (similar to getEditedRecords)
				var jstable = databaseManager.getTable(record);
				var tableSQLName = jstable.getSQLName();
				error1+="Error de Grabación"+'Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + '\n';
				error2+="Error en grabación de tbc_val_ciru"+record.exception.getMessage()+'\n';
				plugins.dialogs.showErrorDialog("Error de Grabación",'Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!')
				plugins.dialogs.showErrorDialog("Error en grabación de tbc_val_ciru",record.exception.getMessage());
				if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
				// exception thrown in pre-insert/update/delete event method
					var thrown = record.exception.getValue()
					plugins.dialogs.showErrorDialog("Error de grabación","Record validation failed: " + thrown)
				}
			}
			if(array.length>0){
				return
			}
		}catch (msg){
			plugins.dialogs.showInfoDialog("No graba detalle de Cirugia",msg.toString(),"ok")
			return
		}
		forms.protambu_IngresoCirugia_tab.elements.btn_new.visible=true
		forms.protambu_IngresoCirugia_tab.elements.btn_ayuda.visible=true
		forms.protambu_frm_1400.elements.volver_form116.enabled=true
		foundset.loadAllRecords()
		//databaseManager.refreshRecordFromDatabase(foundset,1)
		vciricodmed_1=''
		vciricodmed_2=''
		vciricodmed_3=''
		vciricodmed_4=''
		vciricodmed_5=''
		vciricodmed_6=''
		vdescrimed_1=''
		vdescrimed_2=''
		vdescrimed_3=''
		vdescrimed_4=''
		vdescrimed_5=''
		vdescrimed_6=''
		vdescrimed_7=''
		vciriporcen_1=0
		vciriporcen_2=0
		vciriporcen_3=0
		vciriporcen_4=0
		vciriporcen_5=0
		vciriporcen_6=0
		vciriporcen_7=0
		vciriporcen_8=0
		vciricodnome=''
		vApeynomCirujano=''
		vciritipnome=0
		vtipomed_1=0
		vtipomed_2=0
		vtipomed_3=0
		vtipomed_4=0
		vtipomed_5=0
		vtipomed_6=0
		vtipomed_7=0
		vdescrinome=''
		globals.vNomencla=0
		globals.vNomenclaAlfa=''	
		globals.protambu1400_vciricodmed_7=0
		globals.protambu1400_vciricodmed_7descri=''
		globals.vTipoNome=1		
		forms.protambu_IngresoCirugia_tab.elements.tabless_ingreso_cirugia.tabIndex=1
	}
}

/**
 * @properties={typeid:24,uuid:"9B934462-2A39-4E71-9C06-C703FCE23516"}
 */
function validaCamposObligatorios() {
	camposObligatorios = true
	//}else{
		
		var err_ingreso_codigo_cirugia=''
		if (vciritipnome==0||vciricodnome==''){
			err_ingreso_codigo_cirugia+="Falta ingresar código de cirugía"+'\n'
			camposObligatorios = false
		}else{
			globals.vNomenclaAlfa=vciricodnome
			if(globals.vNomenclaAlfa!=''){
				if(!BuscaNomencla()){
					err_ingreso_codigo_cirugia+="Código de cirugía no validado"+'\n'
					camposObligatorios = false
				}
			}
		}
		if (vciricodmed_1==''){
			err_ingreso_codigo_cirugia+="Falta ingresar código del Especialista"+'\n'
			camposObligatorios = false
		}else{
			if(vdescrimed_1==''){
				err_ingreso_codigo_cirugia+="Campo del Especialista no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_1)){
					err_ingreso_codigo_cirugia+="Código del Especialista erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}
		if(vciriporcen_1==0){
			err_ingreso_codigo_cirugia+="Falta ingresar porcentaje correspondiente al Especialista"+'\n'
			camposObligatorios = false
		}
		if(vciriporcen_8==0){
			err_ingreso_codigo_cirugia+="Falta ingresar porcentaje de gastos"+'\n'
			camposObligatorios = false
		}
		if (vciricodmed_2!=''){
			if(vdescrimed_2==''){
				err_ingreso_codigo_cirugia+="Campo del 1er.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_2)){
					err_ingreso_codigo_cirugia+="Código del 1er.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_2!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 1er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		if (vciricodmed_3!=''){
			if(vdescrimed_3==''){
				err_ingreso_codigo_cirugia+="Campo del 2do.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_3)){
					err_ingreso_codigo_cirugia+="Código del 2do.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_3!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 2er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}	
		}
		
		if (vciricodmed_5!=''){
			if(vdescrimed_5==''){
				err_ingreso_codigo_cirugia+="Campo del Anestesiólogo no validado"+'\n'
				camposObligatorios = false
			}else{
				globals.protambu1400_vCodigoMedico=utils.stringToNumber(vciricodmed_5)
				vencontroProfe=true
				buscaAnestesista()
				if(!vencontroProfe){
					err_ingreso_codigo_cirugia+="Código del Anestesista erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_5!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar Anestesiólogo con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}	
		}
		
		if(globals.protambu1400_vciricodmed_7!=''){
			if(globals.protambu1400_vciricodmed_7descri==''){
				err_ingreso_codigo_cirugia+="Campo de la Instrumentadora no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!buscoInstrumentadora()){
					err_ingreso_codigo_cirugia+="Código de la Intrumentadora erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_7!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar Instrumentadora con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		
		if(!camposObligatorios){
			plugins.dialogs.showErrorDialog("Faltan Datos",err_ingreso_codigo_cirugia)
		}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"18CED63E-886D-47BD-B86A-E12070144F31"}
 */
function onAction_busco_Nomencla(event) {
	var win = application.createWindow("f",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Nomenclador";
	win.setSize(600,500)
	win.show(forms.protambu_frm_busqueda_nomenclador)
	if(globals.vNomencla!=0){
		vciricodnome=globals.vNomencla
		vdescrinome=globals.vNomenclaAlfa
		elements.ciri_porcen_8.requestFocus()
	}else{
		elements.ciri_codnome_codigo.requestFocus()
	}
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"5BF7249D-105E-4882-95BA-2A54F01983C8"}
 */
function onDataChange_tipo_nomencla(oldValue, newValue, event) {
	globals.vTipoNome=forms.protambu_Detalle_codigos_cirugia_dtl_edit.vcirtiponome
	return true
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"70B634D4-2B9D-453F-A1EA-A66C9DEED5A3"}
 */
function onAction_btn_Cancel_DetalleCirugia(event) {
	/*
	try{
		forms.tbc_cirugint_detalle_dtl.foundset.deleteRecord()
	}catch (msg){
		(plugins.dialogs.showInfoDialog("No borra detalle de Cirugia",msg.toString(),"ok"))
	}
	*/
	vciricodmed_1=''
	vciricodmed_2=''
	vciricodmed_3=''
	vciricodmed_4=''
	vciricodmed_5=''
	vciricodmed_6=''
	vdescrimed_1=''
	vdescrimed_2=''
	vdescrimed_3=''
	vdescrimed_4=''
	vdescrimed_5=''
	vdescrimed_6=''
	vdescrimed_7=''
	vciriporcen_1=0
	vciriporcen_2=0
	vciriporcen_3=0
	vciriporcen_4=0
	vciriporcen_5=0
	vciriporcen_6=0
	vciriporcen_7=0
	vciriporcen_8=0
	vciricodnome=''
	vApeynomCirujano=''
	vciritipnome=0
	vtipomed_1=0
	vtipomed_2=0
	vtipomed_3=0
	vtipomed_4=0
	vtipomed_5=0
	vtipomed_6=0
	vtipomed_7=0
	vdescrinome=''
	globals.vNomencla=0
	globals.vNomenclaAlfa=''
	globals.protambu1400_vciricodmed_7=0
	globals.protambu1400_vciricodmed_7descri=''
	globals.vTipoNome=1	
	forms.protambu_IngresoCirugia_tab.elements.btn_new.visible=true
	forms.protambu_IngresoCirugia_tab.elements.lbl_new.visible=true
	forms.protambu_IngresoCirugia_tab.elements.btn_ayuda.visible=true
	forms.protambu_frm_1400.elements.volver_form116.enabled=true
	forms.protambu_IngresoCirugia_tab.elements.tabless_ingreso_cirugia.tabIndex=1
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D03C0F0D-4C0C-4AE0-A275-0E08BB5D0DD0"}
 */
function onAction_busco_Especialista(event) {
	globals.vTipoMedico=1
	globals.protambu1400_vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Especialista";
	win.setSize(850,550)
	win.show(forms.protambu_frm_busqueda_medicos_personal)
	if(globals.protambu1400_vCodigoMedico!=0){
		vciricodmed_1=globals.protambu1400_vCodigoMedico
		var largo=vciricodmed_1.length
		if(vciricodmed_1.substr(0,largo)!=globals.vciri_legciru){
			plugins.dialogs.showWarningDialog("Error en código","Error en código de especialista. No coincide con el Cirujano","Ok")
			vdescrimed_1=''
			vtipomed_1=0
			vciricodmed_1=''
			elements.ciri_codimed_1_codigo.requestFocus()
		}else{
			vciricodmed_1=globals.protambu1400_vCodigoMedico
			vtipomed_1=globals.vtipo_ciru_ie
			vdescrimed_1=globals.protambu1400_vApeynomMedico
			elements.ciri_porcen_1.requestFocus()
		}
	}else{
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"1CB01DD7-54F4-4BD5-A60A-38DCBC8C8681"}
 */
function onAction_busca_Ayudante1(event) {
	globals.vTipoMedico=1
	globals.protambu1400_vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_1";
	win.setSize(850,550)
	win.show(forms.protambu_frm_busqueda_medicos_personal)
	if(globals.protambu1400_vCodigoMedico!=0){
		vciricodmed_2=globals.protambu1400_vCodigoMedico
		vtipomed_2=globals.vtipo_ciru_ie
		vdescrimed_2=globals.protambu1400_vApeynomMedico
		elements.ciri_porcen_2.requestFocus()
	}else{
		elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"FC4229CE-9E8E-4F0B-94CC-416253A2742C"}
 */
function onAction_busca_Ayudante2(event) {
	globals.vTipoMedico=1
	globals.protambu1400_vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_2";
	win.setSize(850,550)
	win.show(forms.protambu_frm_busqueda_medicos_personal)
	if(globals.protambu1400_vCodigoMedico!=0){
		vciricodmed_3=globals.protambu1400_vCodigoMedico
		vtipomed_3=globals.vtipo_ciru_ie
		vdescrimed_3=globals.protambu1400_vApeynomMedico
		elements.ciri_porcen_3.requestFocus()
	}else{
		elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"2588F9F5-91BE-44ED-AA5A-FAEA90ADE4BE"}
 */
function onAction_busca_Ayudante3(event) {
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"0F75A8CD-D6A3-4DB3-B82F-53F04B5414C0"}
 */
function onAction_busca_Perfusionista(event) {
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"3F4A4BB4-62C6-4154-8310-CCE651595E1A"}
 */
function onAction_busca_Instrumentista(event) {
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Instrumentadora";
	win.setSize(850,550)
	globals.protambu1400_vCodigoMedico=0
	win.show(forms.protambu_frm_busqueda_personal)
	if(globals.protambu1400_vCodigoMedico!=0){
		//application.output(globals.vCodigoMedico)
		vciricodmed_7=globals.protambu1400_vCodigoMedico
		//application.output(vciricodmed_7)
		vtipomed_7=globals.protambu1400_vTipoIntrumentadora
		globals.protambu1400_vciricodmed_7=globals.protambu1400_vCodigoMedico
		globals.protambu1400_vciricodmed_7descri=globals.protambu1400_vApeynomMedico
		elements.ciri_porcen_7.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"C04A6E4F-58CE-4B6D-B914-8AA4F9EDCB0E"}
 * @AllowToRunInFind
 */
function onAction_busca_Anestesista(event) {
	globals.protambu1400_vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Anestesiólogo";
	win.setSize(850,550)
	win.show(forms.protambu_frm_busqueda_medicos_personal)
	vciricodmed_5=globals.protambu1400_vCodigoMedico
	var fs5 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
	fs5.find()
	fs5['medpercod']=globals.protambu1400_vCodigoMedico
	fs5.search(true)
	if(fs5.getSize()>0){
		fs5.setSelectedIndex(1)
		vtipomed_5=fs5['medpertipoie']
		vdescrimed_5=fs5['medperapeynom']
		vencontroProfe=true
		buscaAnestesista()
		if(vencontroProfe){
			elements.ciri_porcen_5.requestFocus()
		}else{
			plugins.dialogs.showWarningDialog("Error en Médico Anestesista","El profesional seleccionado no es un Anestesiólogo","Ok")
			vdescrimed_5=''
			vtipomed_5=0
			vciricodmed_5=''
			elements.ciri_codimed_5_codigo.requestFocus()
		}
		elements.ciri_porcen_5.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"5519E086-615D-43C5-B83D-A3A2F2456E42"}
 */
function onAction_ciricodnome(event) {
	globals.vNomenclaAlfa=vciricodnome
	if(globals.vNomenclaAlfa!=''){
		vencontroNomencla=false
		BuscoNomenclador()
		if(vencontroNomencla){
			
			elements.ciri_porcen_8.requestFocus()
			
		}else{
			elements.ciri_codnome_codigo.requestFocus()
		}
	}else{
		elements.ciri_codnome_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"6F10F47D-8305-41EC-BDD9-F65E0B3F7ABD"}
 */
function onAction_ciriporcen8(event) {
	if(vciriporcen_8>0){
		if(vciriporcen_8>100){
			elements.ciri_porcen_8.requestFocus()
		}else{
			elements.ciri_codimed_1_codigo.requestFocus()
		}
	}else{
		elements.ciri_porcen_8.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4A8E7180-9307-4445-B50C-EFBC2472C8E1"}
 */
function onAction_ciricodimed1(event) {
	var largo = 0;
	globals.LegajoApeynomCiru=vciricodmed_1
	globals.vTipoMedico=1
	vencontroProfe=true
	BuscoProfesional()
	if(vencontroProfe){
		if(buscaProtocoloAbierto(globals.protambu1400_vCodigoMedico)){
			vdescrimed_1=vApeynomCirujano
			vtipomed_1=globals.vtipo_ciru_ie
			vciricodmed_1=globals.protambu1400_vCodigoMedico
			if(vciricodmed_1!=null){
				largo=vciricodmed_1.length
				if(vciricodmed_1.substr(0,largo)!=forms.protambu_frm_1400.fCirujano){
					plugins.dialogs.showWarningDialog("Error en código","Error en código de especialista. No coincide con el Cirujano","Ok")
					vdescrimed_1=''
					vtipomed_1=0
					vciricodmed_1=''
					elements.ciri_codimed_1_codigo.requestFocus()
					return
				}else{
					elements.ciri_porcen_1.requestFocus()
				}
			}else{
				vdescrimed_1=''
				vtipomed_1=0
				vciricodmed_1=''
				elements.ciri_codimed_1_codigo.requestFocus()
			}
			
		}else{
			vdescrimed_1=''
			vtipomed_1=0
			vciricodmed_1=''
			elements.ciri_codimed_1_codigo.requestFocus()
		}
	}else{
		vdescrimed_1=''
		vtipomed_1=0
		vciricodmed_1=''
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"280A5CB8-E0CA-456F-872C-A590CDD9380B"}
 * @AllowToRunInFind
 */
function onAction_ciricodmed_7(event) {
	if(globals.protambu1400_vciricodmed_7!=0&&globals.protambu1400_vciricodmed_7!=null){
		var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
		var largo_codigo = utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().length)
		fs.find()
		fs['per_legajo']=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			globals.protambu1400_vciricodmed_7descri=fs['per_apelnom']
			vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
			vtipomed_7=0
			globals.protambu1400_vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
			elements.ciri_porcen_7.requestFocus()
		}else{
			var fs1 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
			fs1.find()
			fs1['medpercod']=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				globals.protambu1400_vciricodmed_7descri=fs1['medperapeynom']
				vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
				globals.protambu1400_vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
				vtipomed_7=fs1['medpertipoie']
				elements.ciri_porcen_7.requestFocus()
			}else{
				elements.ciri_codimed_7_codigo.requestFocus()
			}
		}
		
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"AB0AB77A-5CCB-45CC-8F3E-A7AE17D3B869"}
 */
function onAction_codimed5(event) {
	//foundset.ciritipmed_5=ciricodmed5_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_5
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			vdescrimed_5=vApeynomCirujano
			vtipomed_5=globals.vtipo_ciru_ie
			vciricodmed_5=globals.protambu1400_vCodigoMedico
			buscaAnestesista()
			if(vencontroProfe){
				elements.ciri_porcen_5.requestFocus()
			}else{
				plugins.dialogs.showWarningDialog("Error en Médico Anestesista","El profesional ingresado no es un Anestesiólogo","Ok")
				vdescrimed_5=''
				vtipomed_5=0
				vciricodmed_5=''
				elements.ciri_codimed_5_codigo.requestFocus()
			}
		}else{
			vdescrimed_5=''
			vtipomed_5=0
			vciricodmed_5=''
			elements.ciri_codimed_5_codigo.requestFocus()
		}
	}else{
		vdescrimed_5=''
		vtipomed_5=0
		vciricodmed_5=''
		elements.btn_graba.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B1DED07E-E599-4AE8-9FE2-00B692893A29"}
 */
function onAction_codimed6(event) {

}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D28363AD-A14B-439F-8CE3-3BCB93099AFC"}
 */
function onAction_codimed4(event) {

}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"17717B57-2CBC-4848-AE0F-D5E9369BECC8"}
 */
function onAction_codimed3(event) {
	//foundset.ciritipmed_3=ciricodmed3_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_3
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.protambu1400_vCodigoMedico)){
				vdescrimed_3=vApeynomCirujano
				vtipomed_3=globals.vtipo_ciru_ie
				vciricodmed_3=globals.protambu1400_vCodigoMedico
				elements.ciri_porcen_3.requestFocus()
			}else{
				vdescrimed_3=''
				vtipomed_3=0
				vciricodmed_3=0
				elements.ciri_codimed_3_codigo.requestFocus()
			}
		}else{
			vdescrimed_3=''
			vtipomed_3=0
			vciricodmed_3=0
			elements.ciri_codimed_3_codigo.requestFocus()
		}
	}else{
		vdescrimed_3=''
		vtipomed_3=0
		vciricodmed_3=''
		elements.ciri_codimed_7_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"7BF3FAA9-37A8-474D-8AA8-9612C541C491"}
 */
function onAction_codimed2(event) {
	//foundset.ciritipmed_2=ciricodmed2_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_2
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.protambu1400_vCodigoMedico)){
				vdescrimed_2=vApeynomCirujano
				vtipomed_2=globals.vtipo_ciru_ie
				vciricodmed_2=globals.protambu1400_vCodigoMedico
				elements.ciri_porcen_2.requestFocus()
			}else{
				vdescrimed_2=''
				vtipomed_2=0
				vciricodmed_2=''
				elements.ciri_codimed_2_codigo.requestFocus()
			}
		}else{
			vdescrimed_2=''
			vtipomed_2=0
			vciricodmed_2=''
			elements.ciri_codimed_2_codigo.requestFocus()
		}
	}else{
		vdescrimed_2=''
		vtipomed_2=0
		vciricodmed_2=''
		elements.ciri_codimed_3_codigo.requestFocus()		
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"DCBCB4B3-602B-421B-950C-E9393F339ED2"}
 */
function onAction_ciriporcen_2(event) {
	if(vciriporcen_2>100){
		elements.ciri_porcen_2.requestFocus()
	}else{
		elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"DE7E8A22-1F45-4B33-BCA4-1959C016DDE0"}
 */
function onAction_ciriporcen_3(event) {
	if(vciriporcen_3>100){
		elements.ciri_porcen_3.requestFocus()
	}else{
		elements.ciri_codimed_7_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B006B49B-FB69-437F-8290-B1916867022D"}
 */
function onAction_ciriporcen_4(event) {
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"CCBDD57E-9F7A-454F-B0D5-074C7F973293"}
 */
function onAction_ciriporcen_6(event) {
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"9E2314E1-63EC-4C1E-BB02-02322E537EF8"}
 */
function onAction_ciriporcen_7(event) {
	if(vciriporcen_7>100){
		elements.ciri_porcen_7.requestFocus()
	}else{
		elements.ciri_codimed_5_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"E8136595-6F6E-40CC-82CF-48F433B0E690"}
 */
function onAction_ciriporcen_5(event) {
	if(vciriporcen_5>100){
		elements.ciri_porcen_5.requestFocus()
	}else{
		elements.btn_graba.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"99A52146-3522-4342-B534-F2B17B7D8FA2"}
 */
function onAction_ayuda_tbc_cirugint_dtl(event) {
	//globals.textoAyuda='AYUDA-14'
	var win = application.createWindow("p",JSWindow.MODAL_DIALOG)
	win.title = "Ayuda en Ingreso de Código de Cirugía según Nomenclador";
	win.setLocation(810,300)
	win.setSize(500,350)
	//win.show(forms.frm_ayuda_gral_Z)
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"AFE071F8-8BDF-4A88-A9A9-9730A7879F2E"}
 */
function onAction_ciri_porcen_1(event) {
	if(vciriporcen_1>100){
		elements.ciri_porcen_1.requestFocus()
	}else{
		elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"E989622C-E88A-4078-9082-F2A3E73A958E"}
 * @AllowToRunInFind
 */
function onShow_tbc_cirugint_detalle_dtl(firstShow, event) {
	/*
	vciricodmed_1=''
	vciricodmed_2=''
	vciricodmed_3=''
	vciricodmed_4=''
	vciricodmed_5=''
	vciricodmed_6=''
	vdescrimed_1=''
	vdescrimed_2=''
	vdescrimed_3=''
	vdescrimed_4=''
	vdescrimed_5=''
	vdescrimed_6=''
	vdescrimed_7=''
	vciriporcen_1=0
	vciriporcen_2=0
	vciriporcen_3=0
	vciriporcen_4=0
	vciriporcen_5=0
	vciriporcen_6=0
	vciriporcen_7=0
	vciriporcen_8=0
	vciricodnome=''
	vApeynomCirujano=''
	vtipomed_1=0
	vtipomed_2=0
	vtipomed_3=0
	vtipomed_4=0
	vtipomed_5=0
	vtipomed_6=0
	vtipomed_7=0
	vdescrinome=''
	globals.vciricodmed_7=0
	globals.vciricodmed_7descri=''
	*/
	globals.vTipoNome=1
	vciritipnome=1
	var fs1 = databaseManager.getFoundSet('maestros','tbc_nomencla')
	if(fs1.find()){
		fs1['nome_tipo']=foundset.vcirtiponome
		fs1['nome_codigo']=foundset.vcircodnome
		fs1.search()
		if(fs1.getSize()>0){
			fs1.setSelectedIndex(1)
			vdescrinome=fs1['nome_descr']
			vciricodnome=foundset.vcircodnome
		}else{
			vdescrinome='Código Nomenclador Inexistente'
			globals.vNomenclaAlfa=''
			
		}
	}
	var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
	fs.find()
	fs['per_legajo']=foundset.vcircodinstru
	fs.search()
	if(fs.getSize()>0){
		fs.setSelectedIndex(1)
		globals.protambu1400_vciricodmed_7descri=fs['per_apelnom']
		globals.protambu1400_vciricodmed_7=foundset.vcircodinstru
		vtipomed_7=foundset.vcirtipinstru
	}else{
		var fs2 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
		fs2.find()
		fs2['medpercod']=foundset.vcircodinstru
		fs2.search()
		if(fs2.getSize()>0){
			fs2.setSelectedIndex(1)
			globals.protambu1400_vciricodmed_7descri=fs2['medperapeynom']
			globals.protambu1400_vciricodmed_7=foundset.vcircodinstru
			foundset.vcirtipinstru=fs2['medpertipoie']
			vtipomed_7=foundset.vcirtipinstru
		}
	}
	var fs3 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
	if(foundset.vcircodespec!=0&&foundset.vcircodespec!=null){
		fs3.find()
		fs3['medpercod']=foundset.vcircodespec
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_1=fs3['medperapeynom']
			vciricodmed_1=foundset.vcircodespec
			foundset.vcirtipespec=fs3['medpertipoie']
			vtipomed_1=foundset.vcirtipespec
		}
	}
	if(foundset.vcircodayud1!=0&&foundset.vcircodayud1!=null){
		fs3.find()
		fs3['medpercod']=foundset.vcircodayud1
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_2=fs3['medperapeynom']
			vciricodmed_2=foundset.vcircodayud1
			foundset.vcirtipayud1=fs3['medpertipoie']
			vtipomed_2=foundset.vcirtipayud1
		}
	}
	if(foundset.vcircodayud2!=0&&foundset.vcircodayud2!=null){
		fs3.find()
		fs3['medpercod']=foundset.vcircodayud2
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_3=fs3['medperapeynom']
			vciricodmed_3=foundset.vcircodayud2
			foundset.vcirtipayud2=fs3['medpertipoie']
			vtipomed_3=foundset.vcirtipayud2
		}
	}
	
	if(foundset.vcircodaneste!=0&&foundset.vcircodaneste!=null){
		fs3.find()
		fs3['medpercod']=foundset.vcircodaneste
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_5=fs3['medperapeynom']
			vciricodmed_5=foundset.vcircodaneste
			foundset.vcirtipaneste=fs3['medpertipoie']
			vtipomed_5=foundset.vcirtipaneste
		}
	}
	
	vciriporcen_1=foundset.vcirporespec
	vciriporcen_2=foundset.vcirporayud1
	vciriporcen_3=foundset.vcirporayud2
	vciriporcen_5=foundset.vcirporaneste
	vciriporcen_7=foundset.vcirporinstru
	vciriporcen_8=foundset.vcirporgastos
	controller.focusFirstField()
	//elements.ciri_codnome_codigo.requestFocus()
	
	//forms.tbc_cirugint_detalle_dtl.foundset.newRecord()
	//globals.InicializarDatos('tbc_cirugint_detalle_dtl','asistencial','tbc_cirugint_dtl')
}

/**
 * @properties={typeid:24,uuid:"BC0A0E17-80DD-4A00-ADA7-917CCBD45703"}
 * @AllowToRunInFind
 */
function BuscoProfesional() {
	var largo = globals.LegajoApeynomCiru.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero == true; i++){
		if (globals.LegajoApeynomCiru.charCodeAt(i)< 48 || globals.LegajoApeynomCiru.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_medicos_personal')
		if(fs.find()){
			fs['medpercod']=utils.stringToNumber(globals.LegajoApeynomCiru.substr(0,largo-1))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				vApeynomCirujano=fs['medperapeynom']
				globals.vtipo_ciru_ie=fs['medpertipoie']
				globals.protambu1400_vCodigoMedico=fs['medpercod']
				globals.LegajoApeynomCiru=''
				vencontroProfe=true
			}else{
				vApeynomCirujano='Profesional Inexistente'
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
    }else{
        globals.vProfeAlfa = globals.LegajoApeynomCiru.toLocaleUpperCase()
 	    var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
		win.title = "Búsqueda de Código de Cirujano";
		win.setSize(850,550)
		win.show(forms.protambu_frm_busqueda_medicos_personal)
		vApeynomCirujano=globals.protambu1400_vApeynomMedico
		globals.LegajoApeynomCiru=''
		vencontroProfe=true	
    }
}

/**
 * @properties={typeid:24,uuid:"64A52F1C-F87F-418E-B321-261D66D0019B"}
 * @AllowToRunInFind
 */
function BuscoNomenclador() {
	var largo = globals.vNomenclaAlfa.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero; i++){
		if (globals.vNomenclaAlfa.charCodeAt(i)< 48 || globals.vNomenclaAlfa.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_nomencla')
		if(fs.find()){
			fs['nome_tipo']=vciritipnome
			fs['nome_codigo']=utils.stringToNumber(globals.vNomenclaAlfa.substr(0,largo))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				vdescrinome=fs['nome_descr']
				globals.vNomencla=fs['nome_codigo']
				vciricodnome=globals.vNomencla
				vencontroNomencla=true
			}else{
				vdescrinome='Código Nomenclador Inexistente'
				globals.vNomenclaAlfa=''
				vciricodnome=''	
				vencontroNomencla=false
			}
		}
    }else{
    	globals.vNomencla=0
        globals.vNomenclaAlfa = globals.vNomenclaAlfa.toLocaleUpperCase()
 	    var win = application.createWindow("f",JSWindow.MODAL_DIALOG)
 	    win.title = "Búsqueda de Código de Nomenclador";
 	    win.setSize(600,500)
 	    win.show(forms.protambu_frm_busqueda_nomenclador)
		if(globals.vNomencla>0){
			vciricodnome=globals.vNomencla
			vdescrinome=globals.vNomenclaAlfa
			vencontroNomencla=true
		}else{
			vencontroNomencla=false
		}
    }
}

/**
 * @returns {Boolean} successfull or not
 *
 * @properties={typeid:24,uuid:"501BD34B-4A95-4211-9DDF-17F843AE4020"}
 * @AllowToRunInFind
 */
function BuscoCirugintDtl() {
	var fs = databaseManager.getFoundSet('asistencial','tbc_cirugint_dtl')
	if(fs.find()){
		fs['cirihistcl']=globals.vHiscli
		fs['cirifechacarga']=globals.vFechaCarga
		fs['cirihoracarga']=globals.vHoraCarga
		fs['ciricodnome']=utils.stringToNumber(vciricodnome)
		fs['ciritiponome']=vciritipnome
		fs.search()
		if(fs.getSize()>0){
			return true
		}else{
			return false
		}
	}else{
		return false
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"20E64DAC-E7D4-46D9-B3C0-181A34E17C17"}
 */
function buscaAnestesista() {
	if(globals.vtipo_ciru_ie==0){
		var fs = databaseManager.getFoundSet('maestros','tbc_personal')
		if(fs.find()){
			fs['per_legajo']=globals.protambu1400_vCodigoMedico
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				if(fs['per_espemed']==24){
					globals.LegajoApeynomCiru=fs['per_apellnom']
					vencontroProfe=true
				}else{
					globals.LegajoApeynomCiru=''
					vencontroProfe=false
				}
			}else{
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
	}else{
		var fs1 = databaseManager.getFoundSet('maestros','tbc_medicos')
		if(fs1.find()){
			fs1['med_codigo']=globals.protambu1400_vCodigoMedico
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				if(fs1['med_espemed']==24){
					globals.LegajoApeynomCiru=fs1['med_apenom']
					vencontroProfe=true
				}else{
					globals.LegajoApeynomCiru=''
					vencontroProfe=false
				}
			}else{
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
	}
}

/**
 * @properties={typeid:24,uuid:"E984906A-00BD-4EDE-90E2-4953299DA02E"}
 */
function buscaProtocoloAbierto(codigo) {
	var fecha_ingreso_tope = ''
	var anio_ingreso_tope = utils.stringToNumber(globals.protambu1400_fechaingreso.toString().substr(0,4))
	var mes_ingreso_tope = utils.stringToNumber(globals.protambu1400_fechaingreso.toString().substr(4,2))
	if(mes_ingreso_tope==1){
		mes_ingreso_tope = 12
		anio_ingreso_tope--
	}else{
		mes_ingreso_tope--
	}
	var mes_ingreso_tope_ed = ' '	
	if(mes_ingreso_tope<10){
		mes_ingreso_tope_ed = '0' + mes_ingreso_tope
	}else{
		mes_ingreso_tope_ed = mes_ingreso_tope
	}
	fecha_ingreso_tope = anio_ingreso_tope +''+mes_ingreso_tope_ed+'01'
	var protocolo_abierto='';
	var kant_protocolos_abiertos=0;
	if(codigo==0||codigo==null||codigo==''){
		return true
	}else{
		var sql = "select guar_histclinica, guar_fechaingreso, guar_horaingreso from tbc_guardia where Guar_Especialidad=5 and Guar_Estado<4 and Guar_FechaIngreso1>="+fecha_ingreso_tope
		var dataset = databaseManager.getDataSetByQuery("asistencial",sql,null,-1)
		var kanti = dataset.getMaxRowIndex()
		if(kanti>0){
			for(var i=1;i<=kanti;i++){
				if(dataset.getValue(i,1)!=globals.vHiscli&&dataset.getValue(i,2)!=globals.protambu1400_fechaingreso&&dataset.getValue(i,3)!=globals.protambu1400_hora_ingreso){
					var sql2 = "select vcircodespec, vcircodayud1, vcircodayud2, vcircodaneste from tbc_val_ciru where vcirhistclinica="+dataset.getValue(i,1)+" and vcirfechaingreso="+dataset.getValue(i,2)+" and vcirhoraingreso="+dataset.getValue(i,3)
					var dataset2 = databaseManager.getDataSetByQuery("asistencial",sql2,null,-1)
					var kanti2 = dataset2.getMaxRowIndex()
					if(kanti2>0){
						for(var j=1;j<=kanti2;j++){
							for(var k=1;k<=4;k++){
								if(codigo==dataset2.getValue(j,k)){
									kant_protocolos_abiertos++
									protocolo_abierto+=dataset.getValue(i,1)
								}
							}
						}
					}
				}	
			}
			if(kant_protocolos_abiertos>0){
				plugins.dialogs.showWarningDialog("Protocolo sin Cerrar","El Profesional tiene el protocolo "+protocolo_abierto+" sin cerrar","Ok")
				return false
			}else{
				return true
			}
		}else{
			return true
		}
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"CC873F30-58DB-46CD-86F8-AF6E1DE75A3C"}
 */
function onFocusLost_codimed(event) {
	if(!buscaProtocoloAbierto(vciricodmed_1)){
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param codigo
 * @param codimed
 *
 * @properties={typeid:24,uuid:"9054ED2B-8CF5-4F7B-9967-B9B3FDE52694"}
 */
function lost_codimed(codigo,codimed){
	if(buscaProtocoloAbierto(codigo)){
		return true
	}else{
		elements['ciri_codimed_'+codimed+'_codigo'].requestFocus()
		return false
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"CA10D205-4197-4D1E-8E28-11391FC2563D"}
 */
function onFocusLost_ciricodmed2(event) {
	if(!buscaProtocoloAbierto(vciricodmed_2)){
		elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D3F92581-7E12-4CA6-AFE5-7FA452303E24"}
 */
function onFocusLost_ciricodmed3(event) {
	if(!buscaProtocoloAbierto(vciricodmed_3)){
		elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"E2B05474-7497-43FF-A445-38D547190013"}
 */
function onFocusLost_ciricodmed4(event) {
	
}

/**
 * @AllowToRunInFind
 * 
 * TODO generated, please specify type and doc for the params
 * @param codigo
 *
 * @properties={typeid:24,uuid:"82129A12-2FAD-4C46-B4F9-EA87986F2827"}
 */
function validoProfesional(codigo) {
	var fs = databaseManager.getFoundSet('maestros','tbc_medicos_personal')
	//var largo = codigo.length
	if(fs.find()){
		fs['medpercod']=utils.stringToNumber(codigo)
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			if(buscaProtocoloAbierto(fs['medpercod'])){
				return true
			}else{
				return false
			}
		}else{
				return false
		}
	}else{
		return false
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"42E1A074-726F-410A-AC00-A5D3AC75D01E"}
 */
function BuscaNomencla() {
	var largo = globals.vNomenclaAlfa.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero; i++){
		if (globals.vNomenclaAlfa.charCodeAt(i)< 48 || globals.vNomenclaAlfa.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_nomencla')
		if(fs.find()){
			fs['nome_tipo']=vciritipnome
			fs['nome_codigo']=utils.stringToNumber(globals.vNomenclaAlfa.substr(0,largo))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				vdescrinome=fs['nome_descr']
				globals.vNomencla=fs['nome_codigo']
				vciricodnome=globals.vNomencla
				return true
			}else{
				vdescrinome='Código Nomenclador Inexistente'
				globals.vNomenclaAlfa=''
				vciricodnome=''	
				return false
			}
		}else{
			return false
		}
    }else{
    	return false
    }
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"28A5994E-C37A-4A4A-A686-A40410CEC14F"}
 */
function buscoInstrumentadora() {
	if(globals.protambu1400_vciricodmed_7!=0&&globals.protambu1400_vciricodmed_7!=null){
		var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
		var largo_codigo = utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().length)
		fs.find()
		fs['per_legajo']=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo))
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			globals.protambu1400_vciricodmed_7descri=fs['per_apelnom']
			vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo))
			return true
		}else{
			var fs1 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
			fs1.find()
			fs1['medpercod']=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo))
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				globals.protambu1400_vciricodmed_7descri=fs1['medperapeynom']
				vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo))
				vtipomed_7=fs1['medpertipoie']
				return true
			}else{
				return false
			}
		}
		
	}else{
		return false
	}
}
