/**
 * @properties={typeid:35,uuid:"268B661D-BD73-4032-8676-460DB0F1B9C0",variableType:-4}
 */
var vencontroCirugintDtl = false;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"1FD52C19-30E1-47A8-A36F-EF30ACD8A27B"}
 */
var vciricodmed_7 = '';

/**
 * @properties={typeid:35,uuid:"C5C8449C-23C7-4B98-BF2B-6598514F2C84",variableType:-4}
 */
var vencontroNomencla = true;

/**
 * @properties={typeid:35,uuid:"35B9C733-9BBA-4586-A9B1-710C4851EEF2",variableType:-4}
 */
var vencontroProfe = true;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"22ACE2FA-5E26-4EC0-A0E4-3FC102707605",variableType:4}
 */
var vtipomed_7 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2C34A072-7B98-47F6-A885-1FD4A0ADE795",variableType:4}
 */
var vtipomed_6 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"45A51CB3-88E2-4487-B1BA-88183F028890",variableType:4}
 */
var vtipomed_5 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"21490E4D-FD51-4780-BEF6-715A11166E1D",variableType:4}
 */
var vtipomed_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BCE832AE-CCBF-4D81-91FE-D0FD5D833F6E",variableType:4}
 */
var vtipomed_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9550D1BF-18E7-479C-80B7-398412EB3884",variableType:4}
 */
var vtipomed_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"182C9354-4AD1-4A01-AEF0-5B8390ED77CC",variableType:4}
 */
var vtipomed_1 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"01C76173-1860-496A-8F3C-4C847DA835B5"}
 */
var vApeynomCirujano = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"D4746321-D376-4FC8-B6EA-A891A7DDE7A6"}
 */
var vdescrimed_7 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"78DE826F-38F4-4639-A6E2-47B58E890969"}
 */
var vdescrimed_6 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"16C30238-62A2-4DB5-9342-5DB7D5D21FD0"}
 */
var vdescrimed_5 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4B2597DE-04F7-4346-BA7A-B4204CA5890F"}
 */
var vdescrimed_4 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"BAC249D2-C050-469E-9CA3-615DDECE1DEB"}
 */
var vdescrimed_3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"10E63069-CE37-4A3E-98A1-8780D108EE3C"}
 */
var vdescrimed_2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"72DCA2F5-0452-4E66-9CAB-64D089C6E552"}
 */
var vdescrimed_1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"AA486DE8-E881-40EE-9F69-45EF4A26A0B3"}
 */
var vdescrinome = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"59E687AC-2B8F-474E-A4AB-D9C1B840C767",variableType:4}
 */
var vciriporcen_8 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5E10AB81-633A-4777-9F82-E3CA606FA147",variableType:4}
 */
var vciriporcen_7 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"24AF2D67-857B-4E34-BCE5-25AF6F6C3BCA",variableType:4}
 */
var vciriporcen_6 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C5D3B308-6236-4025-9E86-0820194CC584",variableType:4}
 */
var vciriporcen_5 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"35EE5894-7965-4110-ACE0-4B99F5D1EDA6",variableType:4}
 */
var vciriporcen_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"77A5C632-62F2-433D-B9CC-ED9CC0053BFC",variableType:4}
 */
var vciriporcen_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"178086FC-845E-4EC9-9A95-C4579B0D835E",variableType:4}
 */
var vciriporcen_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"66B9A1E0-DC96-44C7-A8AA-CFFD476D2BAB",variableType:4}
 */
var vciriporcen_1 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9AC63219-87D4-4F25-8F1F-73559FED5DF9"}
 */
var vciricodmed_6 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"EE634C8B-F105-441A-9CA3-3DBA8EE15C99"}
 */
var vciricodmed_5 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"AE9695C3-9D62-41D0-8E7A-8B2981D74569"}
 */
var vciricodmed_4 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"55521CBF-3CA6-4B7D-8D4D-22D824865158"}
 */
var vciricodmed_3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"199078DD-DD5F-465E-A072-EAD714FE8243"}
 */
var vciricodmed_2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"F79B3BBE-8491-471F-9611-D39B5C5B5DEA"}
 */
var vciricodmed_1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3E077EE7-901D-4466-805E-EE17B142E1A0"}
 */
var vciricodnome = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"96293B5F-4D1D-4E0D-B601-C3E90932D19F",variableType:4}
 */
var vciritipnome = 0;

/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"EE9283E1-5725-488B-888F-E5BEF580AFA9",variableType:-4}
 */
var camposObligatorios = false;

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"AF416EFC-A7D1-4B59-B6D6-F8F54056DD10"}
 * @AllowToRunInFind
 */
function onAction_Save_tbc_val_ciru(event) {
	validaCamposObligatorios()
	if (camposObligatorios){
		
		//var fs_prestguar = databaseManager.getFoundSet("asistencial","tbc_prest_guar")
		globals.protambu1400_codnome=utils.stringToNumber(vciricodnome)
		globals.protambu1400_tiponome=vciritipnome
		var secuencia = 0
		var largo_prest_guar=protambu1400_vs_to_tbc_prest_guar.getSize()
		if(largo_prest_guar>0){
			secuencia=protambu1400_vs_to_tbc_prest_guar.pregsecuencia
		}
		secuencia++
		protambu1400_vs_to_tbc_prest_guar.newRecord()
		scopes.globals.InicializarDatosDeRelacion(protambu1400_vs_to_tbc_prest_guar, "asistencial", "tbc_prest_guar")
		protambu1400_vs_to_tbc_prest_guar.preghistclinica=globals.vHiscli
		protambu1400_vs_to_tbc_prest_guar.pregfechaingreso=globals.protambu1400_fechaingreso
		protambu1400_vs_to_tbc_prest_guar.preghoraingreso=globals.protambu1400_hora_ingreso
		protambu1400_vs_to_tbc_prest_guar.pregcodnome=globals.protambu1400_codnome
		protambu1400_vs_to_tbc_prest_guar.pregtiponome=globals.protambu1400_tiponome
		protambu1400_vs_to_tbc_prest_guar.pregsecuencia=secuencia 
		protambu1400_vs_to_tbc_prest_guar.pregtipoprest=protambu1400_vnomencla_to_tbc_nomencla.nome_pantalla
		protambu1400_vs_to_tbc_prest_guar.pregmedico=protambul1400_vhiscli_to_tbc_guardia.guar_medico
		protambu1400_vs_to_tbc_prest_guar.pregtipomed=protambul1400_vhiscli_to_tbc_guardia.guar_tipomed
		protambu1400_vs_to_tbc_prest_guar.pregcantidad=1
		protambu1400_vs_to_tbc_prest_guar.pregestado=0
		protambu1400_vs_to_tbc_prest_guar.pregpasehistpac=0
		protambu1400_vs_to_tbc_prest_guar.pregpedido='000000'
		protambu1400_vs_to_tbc_prest_guar.preghorapedido=globals.CapturaHoraSistema("HHMM")
		protambu1400_vs_to_tbc_prest_guar.pregtipoestu2='05'
		protambu1400_vs_to_tbc_prest_guar.pregservicio2='00'
		protambu1400_vs_to_tbc_prest_guar.pregpedido2='000000'
		protambu1400_vs_to_tbc_prest_guar.pregletrafc=' '
		protambu1400_vs_to_tbc_prest_guar.pregnumefc='000000'
		
		/*
		application.output(protambu1400_vs_to_tbc_prest_guar.preghistclinica)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregfechaingreso)
		application.output(protambu1400_vs_to_tbc_prest_guar.preghoraingreso)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregcodnome)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregtiponome)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregsecuencia) 
		application.output(protambu1400_vs_to_tbc_prest_guar.pregtipoprest)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregmedico)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregtipomed)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregcantidad)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregestado)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregpasehistpac)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregpedido)
		application.output(protambu1400_vs_to_tbc_prest_guar.preghorapedido)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregtipoestu2)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregservicio2)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregpedido2)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregletrafc)
		application.output(protambu1400_vs_to_tbc_prest_guar.pregnumefc)
		*/
		try{
			databaseManager.saveData(protambu1400_vs_to_tbc_prest_guar.getRecord(1))
			var error1=''
			var error2=''
			var array1 = databaseManager.getFailedRecords(protambu1400_vs_to_tbc_prest_guar)
			for (var j = 0; j < array1.length; j++) {
				var record1 = array1[j];
				// find out the table of the record (similar to getEditedRecords)
				var jstable1 = databaseManager.getTable(record1);
				var tableSQLName1 = jstable1.getSQLName();
				error1+="Error de Grabación"+'Tabla:' + tableSQLName1 + ' en server:' + jstable1.getServerName() + '\n';
				error2+="Error en grabación de tbc_prestguar"+record1.exception+'\n';
				if (record1.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
				// exception thrown in pre-insert/update/delete event method
					var thrown1 = record1.exception.getValue()
					plugins.dialogs.showErrorDialog("Error de grabación","Record validation failed: " + thrown1)
				}
			}
			if(array1.length>0){
				globals.DIALOGS.showErrorDialog("Error de Grabación",error1,"Ok")
				globals.DIALOGS.showErrorDialog("Error de Grabación",error2,"Ok")
				return
			}
		}catch (msg){
			globals.DIALOGS.showErrorDialog("No graba PREST-GUAR",msg.toString(),"ok")
			return
		}
		
		foundset.newRecord()
		globals.InicializarDatos('protambu_Detalle_codigos_cirugia_dtl','asistencial','tbc_val_ciru')
		foundset.vcirhistclinica=globals.vHiscli
		foundset.vcirfechaingreso=globals.protambu1400_fechaingreso
		foundset.vcirhoraingreso=globals.protambu1400_hora_ingreso
		foundset.vcirtiponome=vciritipnome
		foundset.vcircodnome=utils.stringToNumber(vciricodnome)
		foundset.vcirsecuencia=secuencia
		
		if(vciricodmed_1!=''&&vciricodmed_1!=null){
			foundset.vcircodespec=utils.stringToNumber(vciricodmed_1)
		}
		if(vciricodmed_2!=''&&vciricodmed_2!=null){	
			foundset.vcircodayud1=utils.stringToNumber(vciricodmed_2)
		}
		if(vciricodmed_3!=''&&vciricodmed_3!=null){
			foundset.vcircodayud2=utils.stringToNumber(vciricodmed_3)
		}
		if(vciricodmed_5!=''&&vciricodmed_5!=null){
			foundset.vcircodaneste=utils.stringToNumber(vciricodmed_5)
		}
		if(globals.protambu1400_vciricodmed_7!=''&&globals.protambu1400_vciricodmed_7!=null){
			foundset.vcircodinstru=utils.stringToNumber(globals.protambu1400_vciricodmed_7)
		}
		foundset.vcirtipespec=vtipomed_1
		foundset.vcirtipayud1=vtipomed_2
		foundset.vcirtipayud2=vtipomed_3
		foundset.vcirtipaneste=vtipomed_5
		foundset.vcirtipinstru=vtipomed_7
		foundset.vcirporespec=vciriporcen_1
		foundset.vcirporayud1=vciriporcen_2
		foundset.vcirporayud2=vciriporcen_3
		foundset.vcirporaneste=vciriporcen_5
		foundset.vcirporinstru=vciriporcen_7
		foundset.vcirporgastos=vciriporcen_8
		
		try{
			databaseManager.saveData(foundset.getRecord(1))
			var error3='';
			var error4=';'
			var array = databaseManager.getFailedRecords(foundset)
			for (var i = 0; i < array.length; i++) {
				var record = array[i];
				// find out the table of the record (similar to getEditedRecords)
				var jstable = databaseManager.getTable(record);
				var tableSQLName = jstable.getSQLName();
				error3+="Error de Grabación"+'Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación.'+'\n';
				error4+="Error en grabación de tbc_cirugint_dtl"+record.exception+'\n';
				if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
				// exception thrown in pre-insert/update/delete event method
					var thrown = record.exception.getValue()
					plugins.dialogs.showErrorDialog("Error de grabación","Record validation failed: " + thrown)
				}
			}
			if(array.length>0){
				globals.DIALOGS.showErrorDialog("Error de Grabación",error3,"Ok")
				globals.DIALOGS.showErrorDialog("Error de Grabación",error4,"Ok")
				return
			}
		}catch (msg){
			globals.DIALOGS.showErrorDialog("No graba PREST-GUAR",msg.toString(),"ok")
			return
		}
		forms.protambu_IngresoCirugia_tab.elements.btn_new.visible=true
		forms.protambu_IngresoCirugia_tab.elements.lbl_new.visible=true
		forms.protambu_IngresoCirugia_tab.elements.btn_ayuda.visible=true
		forms.protambu_frm_1400.elements.volver_form116.enabled=true
		foundset.loadAllRecords()
		//databaseManager.refreshRecordFromDatabase(foundset,1)
		vciricodmed_1=''
		vciricodmed_2=''
		vciricodmed_3=''
		vciricodmed_4=''
		vciricodmed_5=''
		vciricodmed_6=''
		vdescrimed_1=''
		vdescrimed_2=''
		vdescrimed_3=''
		vdescrimed_4=''
		vdescrimed_5=''
		vdescrimed_6=''
		vdescrimed_7=''
		vciriporcen_1=0
		vciriporcen_2=0
		vciriporcen_3=0
		vciriporcen_4=0
		vciriporcen_5=0
		vciriporcen_6=0
		vciriporcen_7=0
		vciriporcen_8=0
		vciricodnome=''
		vApeynomCirujano=''
		vciritipnome=0
		vtipomed_1=0
		vtipomed_2=0
		vtipomed_3=0
		vtipomed_4=0
		vtipomed_5=0
		vtipomed_6=0
		vtipomed_7=0
		vdescrinome=''
		globals.vNomencla=0
		globals.vNomenclaAlfa=''	
		globals.protambu1400_vciricodmed_7=0
		globals.protambu1400_vciricodmed_7descri=''
		globals.vTipoNome=1		
		forms.protambu_IngresoCirugia_tab.elements.tabless_ingreso_cirugia.tabIndex=1
	}
}

/**
 * @properties={typeid:24,uuid:"B327A944-B035-453D-A534-F231ECB0BC4D"}
 */
function validaCamposObligatorios() {
	
	//if(vciritipnome!=0&&vciricodnome!=''&&vciricodmed_1!=''&&vciriporcen_1!=0&&vciriporcen_8!=0){
		camposObligatorios = true
	//}else{
		
		var err_ingreso_codigo_cirugia=''
		if (vciritipnome==0||vciricodnome==''){
			err_ingreso_codigo_cirugia+="Falta ingresar código de cirugía"+'\n'
			camposObligatorios = false
		}else{
			if(vdescrinome==''){
				err_ingreso_codigo_cirugia+="Código de cirugía no validado"+'\n'
				camposObligatorios = false
			}else{
				globals.vNomenclaAlfa=vciricodnome
				if(globals.vNomenclaAlfa!=''){
					if(!BuscaNomencla()){
						err_ingreso_codigo_cirugia+="Código de cirugía no validado"+'\n'
						camposObligatorios = false
					}
				}
			}
		}
		if (vciricodmed_1==''){
			err_ingreso_codigo_cirugia+="Falta ingresar código del Especialista"+'\n'
			camposObligatorios = false
		}else{
			if(vdescrimed_1==''){
				err_ingreso_codigo_cirugia+="Campo del Especialista no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_1)){
					err_ingreso_codigo_cirugia+="Código del Especialista erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}
		if(vciriporcen_1==0){
			err_ingreso_codigo_cirugia+="Falta ingresar porcentaje correspondiente al Especialista"+'\n'
			camposObligatorios = false
		}
		if(vciriporcen_8==0){
			err_ingreso_codigo_cirugia+="Falta ingresar porcentaje de gastos"+'\n'
			camposObligatorios = false
		}
		if (vciricodmed_2!=''){
			if(vdescrimed_2==''){
				err_ingreso_codigo_cirugia+="Campo del 1er.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_2)){
					err_ingreso_codigo_cirugia+="Código del 1er.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_2!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 1er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		if (vciricodmed_3!=''){
			if(vdescrimed_3==''){
				err_ingreso_codigo_cirugia+="Campo del 2do.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_3)){
					err_ingreso_codigo_cirugia+="Código del 2do.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_3!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 2er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}	
		}
		
		if (vciricodmed_5!=''){
			if(vdescrimed_5==''){
				err_ingreso_codigo_cirugia+="Campo del Anestesiólogo no validado"+'\n'
				camposObligatorios = false
			}else{
				globals.protambu1400_vCodigoMedico=utils.stringToNumber(vciricodmed_5)
				globals.vtipo_ciru_ie=vtipomed_5
				vencontroProfe=true
				buscaAnestesista()
				if(!vencontroProfe){
					err_ingreso_codigo_cirugia+="Código del Anestesista erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_5!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar Anestesiólogo con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}	
		}
		if(globals.protambu1400_vciricodmed_7!=''){
			if(globals.protambu1400_vciricodmed_7descri==''){
				err_ingreso_codigo_cirugia+="Campo de la Instrumentadora no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!buscoInstrumentadora()){
					err_ingreso_codigo_cirugia+="Código de la Intrumentadora erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_7!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar Instrumentadora con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		
		if(!camposObligatorios){
			plugins.dialogs.showErrorDialog("Faltan Datos",err_ingreso_codigo_cirugia)
		}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B16C755E-50E1-47BB-8FEE-2588841BE5D1"}
 */
function onAction_busco_Nomencla(event) {
	var win = application.createWindow("f",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Nomenclador";
	win.setSize(600,500)
	win.show(forms.protambu_frm_busqueda_nomenclador)
	if(globals.vNomencla!=0){
		vciricodnome=globals.vNomencla
		vdescrinome=globals.vNomenclaAlfa
		elements.ciri_porcen_8.requestFocus()
	}else{
		elements.ciri_codnome_codigo.requestFocus()
	}
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"AD22922A-4AE8-4887-87FF-117990AFFE28"}
 */
function onDataChange_tipo_nomencla(oldValue, newValue, event) {
	globals.vTipoNome=foundset.vcirtiponome
	return true
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D7A495FF-77B2-4BBE-A186-6E5FB920F074"}
 */
function onAction_btn_Cancel_DetalleCirugia(event) {
	/*
	try{
		forms.tbc_cirugint_detalle_dtl.foundset.deleteRecord()
	}catch (msg){
		(plugins.dialogs.showInfoDialog("No borra detalle de Cirugia",msg.toString(),"ok"))
	}
	*/
	vciricodmed_1=''
	vciricodmed_2=''
	vciricodmed_3=''
	vciricodmed_4=''
	vciricodmed_5=''
	vciricodmed_6=''
	vdescrimed_1=''
	vdescrimed_2=''
	vdescrimed_3=''
	vdescrimed_4=''
	vdescrimed_5=''
	vdescrimed_6=''
	vdescrimed_7=''
	vciriporcen_1=0
	vciriporcen_2=0
	vciriporcen_3=0
	vciriporcen_4=0
	vciriporcen_5=0
	vciriporcen_6=0
	vciriporcen_7=0
	vciriporcen_8=0
	vciricodnome=''
	vApeynomCirujano=''
	vciritipnome=0
	vtipomed_1=0
	vtipomed_2=0
	vtipomed_3=0
	vtipomed_4=0
	vtipomed_5=0
	vtipomed_6=0
	vtipomed_7=0
	vdescrinome=''
	globals.vNomencla=0
	globals.vNomenclaAlfa=''
	globals.protambu1400_vciricodmed_7=0
	globals.protambu1400_vciricodmed_7descri=''
	globals.vTipoNome=1	
	forms.protambu_IngresoCirugia_tab.elements.btn_new.visible=true
	forms.protambu_IngresoCirugia_tab.elements.lbl_new.visible=true
	forms.protambu_IngresoCirugia_tab.elements.btn_ayuda.visible=true
	forms.protambu_frm_1400.elements.volver_form116.enabled=true
	forms.protambu_IngresoCirugia_tab.elements.tabless_ingreso_cirugia.tabIndex=1
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"8C44F1BD-1424-44F4-B84A-0E4338CCD6A2"}
 */
function onAction_busco_Especialista(event) {
	globals.vTipoMedico=1
	globals.protambu1400_vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Especialista";
	win.setSize(850,550)
	win.show(forms.protambu_frm_busqueda_medicos_personal)
	if(globals.protambu1400_vCodigoMedico!=0){
		vciricodmed_1=globals.protambu1400_vCodigoMedico
		var largo=vciricodmed_1.length
		if(vciricodmed_1.substr(0,largo)!=forms.protambu_frm_1400.fCirujano){
			plugins.dialogs.showWarningDialog("Error en código","Error en código de especialista. No coincide con el Cirujano","Ok")
			vdescrimed_1=''
			vtipomed_1=0
			vciricodmed_1=''
			elements.ciri_codimed_1_codigo.requestFocus()
		}else{
			vciricodmed_1=globals.protambu1400_vCodigoMedico
			vtipomed_1=globals.vtipo_ciru_ie
			vdescrimed_1=globals.protambu1400_vApeynomMedico
			elements.ciri_porcen_1.requestFocus()
		}
	}else{
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4C9BE9C2-F0BE-4D8C-B5C9-D97A16948D4D"}
 */
function onAction_busca_Ayudante1(event) {
	globals.vTipoMedico=1
	globals.protambu1400_vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_1";
	win.setSize(850,550)
	win.show(forms.protambu_frm_busqueda_medicos_personal)
	if(globals.protambu1400_vCodigoMedico!=0){
		vciricodmed_2=globals.protambu1400_vCodigoMedico
		vtipomed_2=globals.vtipo_ciru_ie
		vdescrimed_2=globals.protambu1400_vApeynomMedico
		elements.ciri_porcen_2.requestFocus()
	}else{
		elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"61B1A3CA-437F-418A-A4AB-E3A6E0F10453"}
 */
function onAction_busca_Ayudante2(event) {
	globals.vTipoMedico=1
	globals.protambu1400_vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_2";
	win.setSize(850,550)
	win.show(forms.protambu_frm_busqueda_medicos_personal)
	if(globals.protambu1400_vCodigoMedico!=0){
		vciricodmed_3=globals.protambu1400_vCodigoMedico
		vtipomed_3=globals.vtipo_ciru_ie
		vdescrimed_3=globals.protambu1400_vApeynomMedico
		elements.ciri_porcen_3.requestFocus()
	}else{
		elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B143086F-03D8-4620-9851-927847A47977"}
 */
function onAction_busca_Ayudante3(event) {
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4AF731C3-B273-427E-AD54-F7E87221585C"}
 */
function onAction_busca_Perfusionista(event) {
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"29A95855-2EF5-4416-8E32-D2EBA04EFFE7"}
 */
function onAction_busca_Instrumentista(event) {
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Instrumentadora";
	win.setSize(850,550)
	globals.protambu1400_vCodigoMedico=0
	win.show(forms.protambu_frm_busqueda_personal)
	if(globals.protambu1400_vCodigoMedico!=0){
		vciricodmed_7=globals.protambu1400_vCodigoMedico
		vtipomed_7=globals.protambu1400_vTipoIntrumentadora
		globals.protambu1400_vciricodmed_7=globals.protambu1400_vCodigoMedico
		globals.protambu1400_vciricodmed_7descri=globals.protambu1400_vApeynomMedico
		elements.ciri_porcen_7.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"7EDAD8E2-AFAD-4993-B51B-11E4D65DCEDC"}
 * @AllowToRunInFind
 */
function onAction_busca_Anestesista(event) {
	globals.protambu1400_vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Anestesiólogo";
	win.setSize(850,550)
	win.show(forms.protambu_frm_busqueda_medicos_personal)
	if(globals.protambu1400_vCodigoMedico!=0){
		vciricodmed_5=globals.protambu1400_vCodigoMedico
		var fs5 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
		fs5.find()
		fs5['medpercod']=globals.protambu1400_vCodigoMedico
		fs5.search(true)
		if(fs5.getSize()>0){
			fs5.setSelectedIndex(1)
			vtipomed_5=fs5['medpertipoie']
			vdescrimed_5=fs5['medperapeynom']
			vencontroProfe=true
			buscaAnestesista()
			if(vencontroProfe){
				elements.ciri_porcen_5.requestFocus()
			}else{
				plugins.dialogs.showWarningDialog("Error en Médico Anestesista","El profesional seleccionado no es un Anestesiólogo","Ok")
				vdescrimed_5=''
				vtipomed_5=0
				vciricodmed_5=''
				elements.ciri_codimed_5_codigo.requestFocus()
			}
		}
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"83ABF719-C7E5-4F75-ADF7-F138C7908AE9"}
 */
function onAction_ciricodnome(event) {
	globals.vNomenclaAlfa=vciricodnome
	if(globals.vNomenclaAlfa!=''){
		vencontroNomencla=false
		BuscoNomenclador()
		if(vencontroNomencla){
			
			elements.ciri_porcen_8.requestFocus()
			
		}else{
			elements.ciri_codnome_codigo.requestFocus()
		}
	}else{
		elements.ciri_codnome_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"3DC26541-7348-47AD-9CFB-DB7184E694E4"}
 */
function onAction_ciriporcen8(event) {
	if(vciriporcen_8>0){
		if(vciriporcen_8>100){
			elements.ciri_porcen_8.requestFocus()
		}else{
			elements.ciri_codimed_1_codigo.requestFocus()
		}
	}else{
		elements.ciri_porcen_8.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"358D568A-8A69-486C-B7FD-D4A9EC548C48"}
 */
function onAction_ciricodimed1(event) {
	//foundset.ciritipmed_1=ciricodmed1_to_tbc_medicos_personal.medpertipoie
	var largo = 0;
	globals.LegajoApeynomCiru=vciricodmed_1
	globals.vTipoMedico=1
	vencontroProfe=true
	BuscoProfesional()
	if(vencontroProfe){
		if(buscaProtocoloAbierto(globals.protambu1400_vCodigoMedico)){
			vdescrimed_1=vApeynomCirujano
			vtipomed_1=globals.vtipo_ciru_ie
			vciricodmed_1=globals.protambu1400_vCodigoMedico
			if(vciricodmed_1!=null){
				largo=vciricodmed_1.length
				if(vciricodmed_1.substr(0,largo)!=forms.protambu_frm_1400.fCirujano){
					plugins.dialogs.showWarningDialog("Error en código","Error en código de especialista. No coincide con el Cirujano","Ok")
					vdescrimed_1=''
					vtipomed_1=0
					vciricodmed_1=''
					elements.ciri_codimed_1_codigo.requestFocus()
					return
				}else{
					elements.ciri_porcen_1.requestFocus()
				}
			}else{
				vdescrimed_1=''
				vtipomed_1=0
				vciricodmed_1=''
				elements.ciri_codimed_1_codigo.requestFocus()
			}
			
		}else{
			vdescrimed_1=''
			vtipomed_1=0
			vciricodmed_1=''
			elements.ciri_codimed_1_codigo.requestFocus()
		}
	}else{
		vdescrimed_1=''
		vtipomed_1=0
		vciricodmed_1=''
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"A4E1AFD3-A05E-4D50-896B-4BDB96F9D82D"}
 * @AllowToRunInFind
 */
function onAction_ciricodmed_7(event) {
	if(globals.protambu1400_vciricodmed_7!=0&&globals.protambu1400_vciricodmed_7!=null){
		var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
		var largo_codigo = utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().length)
		fs.find()
		fs['per_legajo']=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			globals.protambu1400_vciricodmed_7descri=fs['per_apelnom']
			vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
			vtipomed_7=0
			globals.protambu1400_vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
			elements.ciri_porcen_7.requestFocus()
		}else{
			var fs1 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
			fs1.find()
			fs1['medpercod']=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				globals.protambu1400_vciricodmed_7descri=fs1['medperapeynom']
				vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
				globals.protambu1400_vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo-1))
				vtipomed_7=fs1['medpertipoie']
				elements.ciri_porcen_7.requestFocus()
			}else{
				elements.ciri_codimed_7_codigo.requestFocus()
			}
		}
		
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"9541E49A-11A1-4BE7-A23C-89AEB304D4B7"}
 * @AllowToRunInFind
 */
function onAction_codimed5(event) {
	//foundset.ciritipmed_5=ciricodmed5_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_5
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			vdescrimed_5=vApeynomCirujano
			vtipomed_5=globals.vtipo_ciru_ie
			vciricodmed_5=globals.protambu1400_vCodigoMedico
			buscaAnestesista()
			if(vencontroProfe){
				elements.ciri_porcen_5.requestFocus()
			}else{
				plugins.dialogs.showWarningDialog("Error en Médico Anestesista","El profesional ingresado no es un Anestesiólogo","Ok")
				vdescrimed_5=''
				vtipomed_5=0
				vciricodmed_5=''
				elements.ciri_codimed_5_codigo.requestFocus()
			}
		}else{
			vdescrimed_5=''
			vtipomed_5=0
			vciricodmed_5=''
			elements.ciri_codimed_5_codigo.requestFocus()
		}
	}else{
		vdescrimed_5=''
		vtipomed_5=0
		vciricodmed_5=''
		elements.btn_graba.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"516649B5-DFD1-4A8A-B86F-87D10731FC5E"}
 */
function onAction_codimed6(event) {
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"5E590C0D-0EB9-4F4D-9E31-AD2041AB1CFF"}
 */
function onAction_codimed4(event) {

}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"93AC2AC3-79D9-4B75-BDDA-B5EEF3A7EDF5"}
 */
function onAction_codimed3(event) {
	//foundset.ciritipmed_3=ciricodmed3_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_3
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.protambu1400_vCodigoMedico)){
				vdescrimed_3=vApeynomCirujano
				vtipomed_3=globals.vtipo_ciru_ie
				vciricodmed_3=globals.protambu1400_vCodigoMedico
				elements.ciri_porcen_3.requestFocus()
			}else{
				vdescrimed_3=''
				vtipomed_3=0
				vciricodmed_3=0
				elements.ciri_codimed_3_codigo.requestFocus()
			}
		}else{
			vdescrimed_3=''
			vtipomed_3=0
			vciricodmed_3=0
			forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_codimed_3_codigo.requestFocus()
		}
	}else{
		vdescrimed_3=''
		vtipomed_3=0
		vciricodmed_3=''
		forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_codimed_7_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"FDFF827F-CB05-49FD-BF47-AAA1D3878013"}
 */
function onAction_codimed2(event) {
	//foundset.ciritipmed_2=ciricodmed2_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_2
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.protambu1400_vCodigoMedico)){
				vdescrimed_2=vApeynomCirujano
				vtipomed_2=globals.vtipo_ciru_ie
				vciricodmed_2=globals.protambu1400_vCodigoMedico
				forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_porcen_2.requestFocus()
			}else{
				vdescrimed_2=''
				vtipomed_2=0
				vciricodmed_2=''
				forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_codimed_2_codigo.requestFocus()
			}
		}else{
			vdescrimed_2=''
			vtipomed_2=0
			vciricodmed_2=''
			forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_codimed_2_codigo.requestFocus()
		}
	}else{
		vdescrimed_2=''
		vtipomed_2=0
		vciricodmed_2=''
		forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_codimed_3_codigo.requestFocus()		
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"A911790E-72D6-4FAD-8027-3494452951B3"}
 */
function onAction_ciriporcen_2(event) {
	if(vciriporcen_2>100){
		elements.ciri_porcen_2.requestFocus()
	}else{
		forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"9B081F62-AC18-4BFB-80DE-FB57410A4592"}
 */
function onAction_ciriporcen_3(event) {
	if(vciriporcen_3>100){
		elements.ciri_porcen_3.requestFocus()
	}else{
		forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_codimed_7_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"E3298F8A-B69C-4C98-BE48-F58CC024D00A"}
 */
function onAction_ciriporcen_4(event) {
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"7D7F9C7F-A5B2-4ED0-A5BD-1F9DFC9409CF"}
 */
function onAction_ciriporcen_6(event) {
	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"9DED52FA-0B3B-4A9B-8C3B-DDB06E12D731"}
 */
function onAction_ciriporcen_7(event) {
	if(vciriporcen_7>100){
		elements.ciri_porcen_7.requestFocus()
	}else{
		forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_codimed_5_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"C44978ED-E436-4EE1-AB14-048586362B81"}
 */
function onAction_ciriporcen_5(event) {
	if(vciriporcen_5>100){
		elements.ciri_porcen_5.requestFocus()
	}else{
		forms.protambu_Detalle_codigos_cirugia_dtl.elements.btn_graba.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"0697901B-69CD-4C34-99EE-D2FCD9AD404D"}
 */
function onAction_ayuda_tbc_cirugint_dtl(event) {
	//globals.textoAyuda='AYUDA-14'
	var win = application.createWindow("p",JSWindow.MODAL_DIALOG)
	win.title = "Ayuda en Ingreso de Código de Cirugía según Nomenclador";
	win.setLocation(810,300)
	win.setSize(500,350)
	//win.show(forms.frm_ayuda_gral_Z)
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"910C84C0-A629-40A7-B4B4-C7A30FE6F75E"}
 */
function onAction_ciri_porcen_1(event) {
	if(vciriporcen_1>100){
		elements.ciri_porcen_1.requestFocus()
	}else{
		forms.protambu_Detalle_codigos_cirugia_dtl.elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"60E4EF7C-425E-4242-8E44-F45B272B9A70"}
 */
function onShow_tbc_cirugint_detalle_dtl(firstShow, event) {
	/*
	vciricodmed_1=''
	vciricodmed_2=''
	vciricodmed_3=''
	vciricodmed_4=''
	vciricodmed_5=''
	vciricodmed_6=''
	vdescrimed_1=''
	vdescrimed_2=''
	vdescrimed_3=''
	vdescrimed_4=''
	vdescrimed_5=''
	vdescrimed_6=''
	vdescrimed_7=''
	vciriporcen_1=0
	vciriporcen_2=0
	vciriporcen_3=0
	vciriporcen_4=0
	vciriporcen_5=0
	vciriporcen_6=0
	vciriporcen_7=0
	vciriporcen_8=0
	vciricodnome=''
	vApeynomCirujano=''
	vtipomed_1=0
	vtipomed_2=0
	vtipomed_3=0
	vtipomed_4=0
	vtipomed_5=0
	vtipomed_6=0
	vtipomed_7=0
	vdescrinome=''
	globals.vciricodmed_7=0
	globals.vciricodmed_7descri=''
	*/
	globals.vTipoNome=1
	vciritipnome=1
	elements.ciri_codnome_codigo.requestFocus()
	
	//forms.tbc_cirugint_detalle_dtl.foundset.newRecord()
	//globals.InicializarDatos('tbc_cirugint_detalle_dtl','asistencial','tbc_cirugint_dtl')
}

/**
 * @properties={typeid:24,uuid:"25E5E898-9436-493F-87B0-2115CB210557"}
 * @AllowToRunInFind
 */
function BuscoProfesional() {
	var largo = globals.LegajoApeynomCiru.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero == true; i++){
		if (globals.LegajoApeynomCiru.charCodeAt(i)< 48 || globals.LegajoApeynomCiru.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_medicos_personal')
		if(fs.find()){
			fs['medpercod']=utils.stringToNumber(globals.LegajoApeynomCiru.substr(0,largo-1))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				vApeynomCirujano=fs['medperapeynom']
				globals.vtipo_ciru_ie=fs['medpertipoie']
				globals.protambu1400_vCodigoMedico=fs['medpercod']
				globals.LegajoApeynomCiru=''
				vencontroProfe=true
			}else{
				vApeynomCirujano='Profesional Inexistente'
				globals.protambu1400_vCodigoMedico=0
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
    }else{
        globals.vProfeAlfa = globals.LegajoApeynomCiru.toLocaleUpperCase()
		globals.protambu1400_cirujanoalf=globals.LegajoApeynomCiru.toLocaleUpperCase()
 	    var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
		win.title = "Búsqueda de Código de Cirujano";
		win.setSize(850,550)
		win.show(forms.protambu_frm_busqueda_medicos_personal)
		vApeynomCirujano=globals.protambu1400_vApeynomMedico
		globals.LegajoApeynomCiru=''
		vencontroProfe=true	
    }
}

/**
 * @properties={typeid:24,uuid:"20CCDFF3-6048-4C31-BF9E-D282750508B3"}
 * @AllowToRunInFind
 */
function BuscoNomenclador() {
	var largo = globals.vNomenclaAlfa.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero; i++){
		if (globals.vNomenclaAlfa.charCodeAt(i)< 48 || globals.vNomenclaAlfa.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_nomencla')
		if(fs.find()){
			fs['nome_tipo']=vciritipnome
			fs['nome_codigo']=utils.stringToNumber(globals.vNomenclaAlfa.substr(0,largo))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				if(fs['nome_pantalla']==1||fs['nome_pantalla']==3||fs['nome_pantalla']==7||fs['nome_pantalla']==8||fs['nome_pantalla']==9){
					vdescrinome=fs['nome_descr']
					globals.vNomencla=fs['nome_codigo']
					vciricodnome=globals.vNomencla
					vencontroNomencla=true
				}else{
					vdescrinome='Código Nomenclador no pertenece a Cirugía'
					globals.vNomenclaAlfa=''
					vciricodnome=''	
					vencontroNomencla=false
				}
			}else{
				vdescrinome='Código Nomenclador Inexistente'
				globals.vNomenclaAlfa=''
				vciricodnome=''	
				vencontroNomencla=false
			}
		}
    }else{
    	globals.vNomencla=0
        globals.vNomenclaAlfa = globals.vNomenclaAlfa.toLocaleUpperCase()
 	    var win = application.createWindow("f",JSWindow.MODAL_DIALOG)
 	    win.title = "Búsqueda de Código de Nomenclador";
 	    win.setSize(600,500)
 	    win.show(forms.protambu_frm_busqueda_nomenclador)
		if(globals.vNomencla>0){
			vciricodnome=globals.vNomencla
			vdescrinome=globals.vNomenclaAlfa
			vencontroNomencla=true
		}else{
			vencontroNomencla=false
		}
    }
}

/**
 * @returns {Boolean} successfull or not
 *
 * @properties={typeid:24,uuid:"9653C2AB-A289-43DC-991E-43AAAAB530B1"}
 * @AllowToRunInFind
 */
function BuscoCirugintDtl() {
	var fs = databaseManager.getFoundSet('asistencial','tbc_cirugint_dtl')
	if(fs.find()){
		fs['cirihistcl']=globals.vHiscli
		fs['cirifechacarga']=globals.vFechaCarga
		fs['cirihoracarga']=globals.vHoraCarga
		fs['ciricodnome']=utils.stringToNumber(vciricodnome)
		fs['ciritiponome']=vciritipnome
		fs.search()
		if(fs.getSize()>0){
			return true
		}else{
			return false
		}
	}else{
		return false
	}
}

/**
 * @properties={typeid:24,uuid:"A8ABE694-2B6F-436E-A35B-2565A46AD11F"}
 * @AllowToRunInFind
 */
function buscaAnestesista() {
	if(globals.vtipo_ciru_ie==0){
		var fs = databaseManager.getFoundSet('maestros','tbc_personal')
		if(fs.find()){
			fs['per_legajo']=globals.protambu1400_vCodigoMedico
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				if(fs['per_espemed']==24){
					globals.LegajoApeynomCiru=fs['per_apellnom']
					vencontroProfe=true
				}else{
					globals.LegajoApeynomCiru=''
					vencontroProfe=false
				}
			}else{
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
	}else{
		var fs1 = databaseManager.getFoundSet('maestros','tbc_medicos')
		if(fs1.find()){
			fs1['med_codigo']=globals.protambu1400_vCodigoMedico
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				if(fs1['med_espemed']==24){
					globals.LegajoApeynomCiru=fs1['med_apenom']
					vencontroProfe=true
				}else{
					globals.LegajoApeynomCiru=''
					vencontroProfe=false
				}
			}else{
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
	}
}

/**
 * @properties={typeid:24,uuid:"77501712-77E7-461A-B3FA-5677FB530DD6"}
 */
function buscaProtocoloAbierto(codigo) {
	var fecha_ingreso_tope = ''
	var anio_ingreso_tope = utils.stringToNumber(globals.protambu1400_fechaingreso.toString().substr(0,4))
	var mes_ingreso_tope = utils.stringToNumber(globals.protambu1400_fechaingreso.toString().substr(4,2))
	if(mes_ingreso_tope==1){
		mes_ingreso_tope = 12
		anio_ingreso_tope--
	}else{
		mes_ingreso_tope--
	}
	var mes_ingreso_tope_ed = ' '	
	if(mes_ingreso_tope<10){
		mes_ingreso_tope_ed = '0' + mes_ingreso_tope
	}else{
		mes_ingreso_tope_ed = mes_ingreso_tope
	}
	fecha_ingreso_tope = anio_ingreso_tope +''+mes_ingreso_tope_ed+'01'
	var protocolo_abierto='';
	var kant_protocolos_abiertos=0;
	if(codigo==0||codigo==null||codigo==''){
		return true
	}else{
		var sql = "select guar_histclinica, guar_fechaingreso, guar_horaingreso from tbc_guardia where Guar_Especialidad=5 and Guar_Estado<4 and Guar_FechaIngreso1>="+fecha_ingreso_tope
		var dataset = databaseManager.getDataSetByQuery("asistencial",sql,null,-1)
		var kanti = dataset.getMaxRowIndex()
		if(kanti>0){
			for(var i=1;i<=kanti;i++){
				if(dataset.getValue(i,1)!=globals.vHiscli&&dataset.getValue(i,2)!=globals.protambu1400_fechaingreso&&dataset.getValue(i,3)!=globals.protambu1400_hora_ingreso){
					var sql2 = "select vcircodespec, vcircodayud1, vcircodayud2, vcircodaneste from tbc_val_ciru where vcirhistclinica="+dataset.getValue(i,1)+" and vcirfechaingreso="+dataset.getValue(i,2)+" and vcirhoraingreso="+dataset.getValue(i,3)
					var dataset2 = databaseManager.getDataSetByQuery("asistencial",sql2,null,-1)
					var kanti2 = dataset2.getMaxRowIndex()
					if(kanti2>0){
						for(var j=1;j<=kanti2;j++){
							for(var k=1;k<=4;k++){
								if(codigo==dataset2.getValue(j,k)){
									kant_protocolos_abiertos++
									protocolo_abierto+=dataset.getValue(i,1)
								}
							}
						}
					}
				}	
			}
			if(kant_protocolos_abiertos>0){
				plugins.dialogs.showWarningDialog("Protocolo sin Cerrar","El Profesional con código "+codigo+" tiene el protocolo "+protocolo_abierto+" sin cerrar","Ok")
				return false
			}else{
				return true
			}
		}else{
			return true
		}
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"8D35F183-D804-4CA6-98DB-9366E5BEC24F"}
 */
function onFocusLost_codimed(event) {
	if(!buscaProtocoloAbierto(vciricodmed_1)){
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param codigo
 * @param codimed
 *
 * @properties={typeid:24,uuid:"D7098265-BFED-4117-9F8D-6EF48CBE8261"}
 */
function lost_codimed(codigo,codimed){
	if(buscaProtocoloAbierto(codigo)){
		return true
	}else{
		elements['ciri_codimed_'+codimed+'_codigo'].requestFocus()
		return false
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"8F41AA24-027E-4AA4-85A8-81819159B336"}
 */
function onFocusLost_ciricodmed2(event) {
	onAction_codimed2(event)
	//if(!buscaProtocoloAbierto(vciricodmed_2)){
		//elements.ciri_codimed_2_codigo.requestFocus()
	//}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4B34A155-04C3-4122-A0C8-A94CCAA41603"}
 */
function onFocusLost_ciricodmed3(event) {
	if(!buscaProtocoloAbierto(vciricodmed_3)){
		elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"2FFB7EAA-9BCF-4D65-AD64-E203E4917FF2"}
 */
function onFocusLost_ciricodmed4(event) {
	
}

/**
 * @properties={typeid:24,uuid:"BD80E7FE-B18F-415D-AAF2-1E7191931D95"}
 * @AllowToRunInFind
 */
function validoProfesional(codigo) {
	var fs = databaseManager.getFoundSet('maestros','tbc_medicos_personal')
	//var largo = codigo.length
	if(fs.find()){
		fs['medpercod']=utils.stringToNumber(codigo)
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			if(buscaProtocoloAbierto(fs['medpercod'])){
				return true
			}else{
				return false
			}
		}else{
				return false
		}
	}else{
		return false
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"90EE52F5-640D-4AC0-8DD3-33C779780798"}
 */
function BuscaNomencla() {
	var largo = globals.vNomenclaAlfa.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero; i++){
		if (globals.vNomenclaAlfa.charCodeAt(i)< 48 || globals.vNomenclaAlfa.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_nomencla')
		if(fs.find()){
			fs['nome_tipo']=vciritipnome
			fs['nome_codigo']=utils.stringToNumber(globals.vNomenclaAlfa.substr(0,largo))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				if(fs['nome_pantalla']==1||fs['nome_pantalla']==3||fs['nome_pantalla']==7||fs['nome_pantalla']==8||fs['nome_pantalla']==9){
					vdescrinome=fs['nome_descr']
					globals.vNomencla=fs['nome_codigo']
					vciricodnome=globals.vNomencla
					return true
				}else{
					vdescrinome='Código Nomenclador no pertenece a Cirugía'
					globals.vNomenclaAlfa=''
					vciricodnome=''	
					return false
				}
			}else{
				vdescrinome='Código Nomenclador Inexistente'
				globals.vNomenclaAlfa=''
				vciricodnome=''	
				return false
			}
		}else{
			return false
		}
    }else{
    	return false
    }
}

/**
 * @properties={typeid:24,uuid:"5FD14BBE-1F99-40B0-8B2F-DE5EEF4FF330"}
 * @AllowToRunInFind
 */
function buscoInstrumentadora() {
	if(globals.protambu1400_vciricodmed_7!=0&&globals.protambu1400_vciricodmed_7!=null){
		var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
		var largo_codigo = utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().length)
		fs.find()
		fs['per_legajo']=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo))
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			globals.protambu1400_vciricodmed_7descri=fs['per_apelnom']
			vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo))
			return true
		}else{
			var fs1 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
			fs1.find()
			fs1['medpercod']=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo))
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				globals.protambu1400_vciricodmed_7descri=fs1['medperapeynom']
				vciricodmed_7=utils.stringToNumber(globals.protambu1400_vciricodmed_7.toString().substr(0,largo_codigo))
				vtipomed_7=fs1['medpertipoie']
				return true
			}else{
				return false
			}
		}
		
	}else{
		return false
	}
}

/**
 * Handle changed data.
 *
 * @param {String} oldValue old value
 * @param {String} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"C1931959-4237-493B-91D7-DD5987F06301"}
 */
function onDataChange_ciricodnome(oldValue, newValue, event) {
	globals.vNomenclaAlfa=vciricodnome
	if(globals.vNomenclaAlfa!=''){
		vencontroNomencla=false
		BuscoNomenclador()
		if(vencontroNomencla){
			
			return true
			
		}else{
			return false
		}
	}else{
		return false
	}
}
