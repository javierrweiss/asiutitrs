/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A0719BFA-93AE-46A6-94A8-BC709534087A"}
 */
var cron_kine_hiscli = ' ';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"016E1B29-6934-4EB6-8402-B3436B71E035",variableType:4}
 */
var cron_kine_rend_nome_panta = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E7B147D7-229C-4BB1-B5B1-3A46C41175C7",variableType:4}
 */
var cron_kine_rend_tiponom = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"75807A8F-6CF4-42B6-8CD8-2961042ED401",variableType:4}
 */
var cron_kine_rend_codinom = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"370CB9B5-6DCD-4306-94DB-668603D97A40",variableType:4}
 */
var cron_kine_rend_hora = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5F9EB83F-DB50-409F-B13E-29144F059A55",variableType:4}
 */
var cron_kine_rend_fech = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F7E92748-0F90-434C-B722-D5F4DDB10174",variableType:4}
 */
var cron_kine_rend_periodo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"56125723-C327-481F-904F-A34759496B56",variableType:4}
 */
var cron_kine_rend_cierre = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D3D52463-6C6C-4AF6-8CEC-FD38A1878FAE",variableType:4}
 */
var cron_kine_estadtur_med = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3E60F8D3-819F-48A5-8651-7BB8D0BAA93C",variableType:4}
 */
var cron_kine_tipomed = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"54ACEF78-C875-4023-BE4A-8E7C3A28F1E9"}
 */
var cron_kine_obrades = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C29C3755-D71E-4224-BC33-42F32AD68BB6"}
 */
var cron_kine_mednya = ' ';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F03C302C-0C40-456D-A2C1-A086B28C39DE",variableType:4}
 */
var cron_kine_nropedidounico = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6B81AA3D-EFF8-4A69-AC54-83EC6329F42C",variableType:4}
 */
var cron_kine_horaguar = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D6357075-9515-44D8-A1D3-07830AE64378",variableType:4}
 */
var cron_kine_fechguar = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"960A57D5-E299-4EFB-BB9B-851C405D14F1"}
 */
var cron_kine_condicioniva = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"85B5219F-0B45-44DF-BD44-884DF70040F4"}
 */
var cron_kine_nroorden = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"AF282610-5C01-44FB-A4DF-5248DF8C8200"}
 */
var cron_kine_tiposol = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0367ACF8-4509-4DBB-8354-0D37641008F6"}
 */
var cron_kine_nrodocumento = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A936CCFF-ED0C-49F8-8040-065D572B1F3F"}
 */
var cron_kine_tipodocumento = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0E340E1E-33B6-4EE6-A346-A229E9D75732"}
 */
var cron_kine_errores = ' ';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BCA7563A-144E-4C47-B70F-BA45AA1D4E24",variableType:4}
 */
var cron_idmensaje_requesteg = 0;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"D9B8812E-B210-4C2F-A3A1-E76DB698611B",variableType:93}
 */
var cron_kine_fechamensaje = new Date();

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"28EB34E1-73B3-41EB-9470-D09C3C068682"}
 */
var cron_kine_estadomensaje = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"1B347400-1228-4500-896A-82F9BE060EFF"}
 */
var cron_mensaje = 'null';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3929BCBD-0224-4B0D-83EA-DCD12534FCAF"}
 */
var cron_error_msa = ' ';

/**
 * @properties={typeid:35,uuid:"166D6A4F-7632-4F67-9E21-9FC15BD0E8BD",variableType:-4}
 */
var cron_retorno_msa = false;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C36F108B-087C-471D-AB0F-CF430C5685A4"}
 */
var cron_kine_pv1tipoturno = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"F9E0EA3B-2EA0-4FE3-896C-DC1E5BE2E0F1"}
 */
var cron_kine_pv1hora = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"FE165853-03D2-4B51-8C40-01A836CC5C45"}
 */
var cron_kine_pv1fecha = ' ';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5D2DF25B-A034-4E65-B0D6-B8E6D285A2E2",variableType:4}
 */
var cron_kine_idmensaje = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5AFD5FF8-069D-441F-9171-D0B25F98F34C",variableType:4}
 */
var cron_kine_matricula = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7D971688-291B-446A-98D0-2149CD6C94DE",variableType:4}
 */
var cron_kine_resecoddiag = 0;

/**
 * @properties={typeid:35,uuid:"8F414B5C-C01F-436C-BE74-C6688CC915ED",variableType:-4}
 */
var cron_kine_resecodl = new Array();

/**
 * @properties={typeid:35,uuid:"00476099-5587-40C3-9A13-A4E255723655",variableType:-4}
 */
var cron_kine_resecodcantid = new Array();

/**
 * @properties={typeid:35,uuid:"1DFDDA14-2C8F-4703-A102-8AE7987A960B",variableType:-4}
 */
var cron_kine_resecodnumcod = new Array();

/**
 * @properties={typeid:35,uuid:"6EA1EA8F-857C-4592-9797-731FF5B287AC",variableType:-4}
 */
var cron_kine_resecodtipcod = new Array();

/**
 * @properties={typeid:35,uuid:"9CFD2FC5-1A6E-43BE-A463-BBAB5CD59F63",variableType:-4}
 */
var cron_kine_resecoditem = new Array();

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B8CA2CC2-A193-4B58-8A1F-A3714037DC1E",variableType:4}
 */
var cron_kine_resecodhora = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2C7F74C1-40DD-49D1-9FA4-D16B9BC95073",variableType:4}
 */
var cron_kine_resecodfech = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E9AEC9B8-1179-48B1-8275-784E5728EAE3",variableType:4}
 */
var cron_kine_resecodmed = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E10713C4-D34E-4B7C-90B3-721746BCC0C3",variableType:4}
 */
var cron_kine_resecodesp = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"981B2C08-9E12-44E0-BD15-1A2336B009B4",variableType:4}
 */
var cron_kine_tip_servicio = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9A282372-9740-4591-8CCA-65B9C9F774A6",variableType:4}
 */
var cron_kine_servicio = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2FB9A621-12BD-4AB1-8B72-E4F9F7E2D040",variableType:4}
 */
var cron_kine_sexo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"06851E45-D01E-4805-A5FE-7A898E650FD2",variableType:4}
 */
var cron_kine_tip_opera = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"45C34D80-87E7-4717-BCC9-F475AF9A7833",variableType:4}
 */
var cron_kine_operador = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A9365519-8574-4626-9275-191B2C25696A"}
 */
var cron_kine_benef = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"32C44A07-DB7E-48CE-BAA1-A1FC7D886A35"}
 */
var cron_kine_obrpla = ' ';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1054A99B-62C8-44BB-8881-32A327AFE80A",variableType:4}
 */
var cron_kine_obra = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1418D7A8-DCD7-458A-BD72-DB9879CEFBEB",variableType:4}
 */
var cron_kine_consul = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FE40D106-0511-49A9-AABD-DE964F0BAB08",variableType:4}
 */
var cron_kine_hora = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"DE5EBE00-47D1-4A66-BE19-B2ED0D96A51B",variableType:4}
 */
var cron_kine_fech = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"76170A55-B177-4C7B-A4CE-B78A04E2C962",variableType:4}
 */
var cron_kine_med = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"18584ACF-E127-4E2A-A9FF-4193224ED2AB",variableType:4}
 */
var cron_kine_esp = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"894974B0-B86C-416F-BD29-CBF1EA3E6855"}
 */
var cron_vacio = '  ';

/**
 * @properties={typeid:35,uuid:"B37B8076-11F7-4AEE-8F68-EEFCE98A724B",variableType:-4}
 */
var cron_fecha_dia = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"37605017-D4FC-4B64-8375-BC36B750BB8F",variableType:4}
 */
var cron_hubo_turno = 0;

/**
 * @properties={typeid:35,uuid:"BD37BBA3-4FF0-4D8D-B5E3-F4EAB3ED5384",variableType:-4}
 */
var cron_kine_imacodidescod = new Array();

/**
 * @properties={typeid:24,uuid:"A160C920-DC4B-4D6C-ACD0-2B7D24190DD2"}
 */
function cronObtenerKinesiologiaEges() {
	cron_mensaje=''
	var sql = "select mensaje1, mensaje2, mensaje3, mensaje4, mensaje5, mensaje6, mensaje7, mensaje8, estadomensaje, fechamensaje, idmensaje from requesteg where estadomensaje='R' and tipomsj='ORM_O01'"
	//var sql = "select mensaje1, mensaje2, mensaje3, mensaje4, mensaje5, mensaje6, mensaje7, mensaje8 from requesteg where estadomensaje=0 and tipomsj='ORM'"
	var dataset = new Array() 
	//if(databaseManager.getDataSetByQuery("validaciones",sql,null,-1)!=null){
		dataset=databaseManager.getDataSetByQuery("validaciones",sql,null,-1)
	//}else{
		//return
	//}
	var kanti = dataset.getMaxRowIndex()
	var resultado=false
	var $plan = new Array();
	cron_retorno_msa=true
	cron_error_msa=''
	if(kanti>0){
		var $fecha=0
		for(var i=1;i<=kanti;i++){
			cron_mensaje=dataset.getValue(i,1)+dataset.getValue(i,2)+dataset.getValue(i,3)+dataset.getValue(i,4)+dataset.getValue(i,5)+dataset.getValue(i,6)+dataset.getValue(i,7)+dataset.getValue(i,8)
			cron_kine_estadomensaje=dataset.getValue(i,9)
			cron_kine_fechamensaje=dataset.getValue(i,10)
			cron_idmensaje_requesteg=dataset.getValue(i,11)
			
			if(cron_parseo_xml_Eges(cron_mensaje)){
				$fecha=cron_kine_pv1fecha.substr(6,4)+''+cron_kine_pv1fecha.substr(3,2)+''+cron_kine_pv1fecha.substr(0,2)
				$plan=cron_kine_obrpla.toString().split('-')
				if($plan[1]=="General"){
					cron_kine_obrpla=' '
				}else{
					cron_kine_obrpla=obtenerPlan(cron_kine_obra, $plan[1])
				}
				if(cron_filtra_campos_clave_Reservas(cron_kine_esp, $fecha)){
					if(cron_valida_turno_en_Reservas()){
						if(cron_valida_hiscli()){
							if(cron_insertar_turno()){
								if(cron_insertar_resecod()){
									cron_actualiza_requesteg()
								}
								cron_kine_insertar_kinesio()
								graba_estadtur(true)
							}
						}
					}
					/*else{
						if(cron_valida_hiscli()){
							if(cron_regrabar_turno()){
								if(cron_insertar_guardia()){
									if(cron_insertar_resecod()){
										cron_insertar_pracquiro()
										globals.GenerarTXTInterfaseVisualMedica(3, 6, 0, utils.stringToNumber(cron_kine_hiscli), cron_kine_fechguar, 0, cron_kine_horaguar)
									}
									cron_actualiza_requesteg()
								}
								graba_estadtur(false)
							}
						}
					}
					*/
					cron_insertar_responseeg()
				}
			}
		}
	}
	
}

/**
 * TODO generated, please specify type and doc for the params
 * @param mensaje
 *
 * @properties={typeid:24,uuid:"5103F9DB-0E9C-429D-8815-EFF18F37F08C"}
 */
function cron_parseo_xml_Eges(mensaje){
	var nodes = plugins.XmlReader.readXmlDocumentFromString(mensaje);
	var childs = new Array()
	var subChilds = new Array()
	var subChilds2 = new Array()
	var ii = 0
	var jj = 0
	var ll = 0
	var xx = 0
	var $efector=false
	cron_kine_matricula=null
	cron_kine_esp=null
	cron_kine_pv1fecha=null
	cron_kine_pv1hora=null
	cron_kine_servicio=null
	cron_kine_hiscli=null
	cron_kine_condicioniva=null
	cron_kine_resecodtipcod=new Array()
	cron_kine_resecodnumcod=new Array()
	cron_kine_resecodl=new Array()
	cron_kine_resecoditem=new Array()
	cron_kine_resecodcantid=new Array()
	cron_kine_imacodidescod=new Array()
	
	var xml_valido = true
						
	childs = nodes[0].getChildNodes()
	
	for(ii=0;ii<childs.length&&xml_valido;ii++){
		if(childs[ii].getName().substr(0,3)=="MSH"){
			cron_kine_idmensaje=childs[ii].getAttributeValue("IDMensaje")
		}
		switch (childs[ii].getName()){
			case 'Efector':$efector=true;break;
			case 'MSA':break;
			case 'MatriculaNumero':if($efector){cron_kine_matricula=childs[ii].getTextValue(); $efector=false;}break;
			case 'IDEspecialidad':cron_kine_esp=childs[ii].getTextValue();break;
			case 'PV1Fecha':cron_kine_pv1fecha=childs[ii].getTextValue();break;
			case 'PV1Hora':cron_kine_pv1hora=childs[ii].getTextValue();break;
			case 'Servicio':cron_kine_servicio=childs[ii].getTextValue();break;
			case 'PV1Servicio':break;
			case 'PV1TipoTurno':break;
			case 'NroHistoriaClinica':cron_kine_hiscli=childs[ii].getTextValue();break;
			case 'Sexo':break;
			case 'Cobertura':cron_kine_obra=utils.stringToNumber(childs[ii].getTextValue());break;
			case 'Plan':cron_kine_obrpla=childs[ii].getTextValue();break;
			case 'Afiliado':cron_kine_benef=childs[ii].getTextValue();break;
			case 'CondicionIVA':cron_kine_condicioniva=childs[ii].getTextValue();break;
			case 'PRIS':break;
			case 'PR1':break;
			case 'SET_ID':break;
			case 'ID':cron_kine_nroorden=childs[ii].getTextValue();break;
			case 'NOMENCLADOR':break;
			case 'CANTIDAD':break;
		}
		if (cron_kine_servicio!=null&&cron_kine_servicio!=31){
			xml_valido=false
		}else{
			subChilds = childs[ii].getChildNodes()
			if(subChilds.length>0){
				for(jj=0;jj<subChilds.length;jj++){
					switch (subChilds[jj].getName()){
					case 'Efector':$efector=true;break;
					case 'MatriculaNumero':if($efector){cron_kine_matricula=subChilds[jj].getTextValue(); $efector=false;}break;
					case 'IDEspecialidad':cron_kine_esp=utils.stringToNumber(subChilds[jj].getTextValue());break;
					case 'PV1Fecha':cron_kine_pv1fecha=subChilds[jj].getTextValue();break;
					case 'PV1Hora':cron_kine_pv1hora=subChilds[jj].getTextValue();break;
					case 'Servicio':cron_kine_servicio=subChilds[jj].getTextValue();break;
					case 'PV1Servicio':break;
					case 'LUGAR_ATENCION':cron_kine_consul=utils.stringToNumber(subChilds[jj].getTextValue());break;
					case 'PV1TipoTurno':cron_kine_pv1tipoturno=subChilds[jj].getTextValue();break;
					case 'NroHistoriaClinica':cron_kine_hiscli=subChilds[jj].getTextValue();break;
					case 'NroDocumento':cron_kine_nrodocumento=subChilds[jj].getTextValue();break;
					case 'TipoDocumento':cron_kine_tipodocumento=subChilds[jj].getTextValue();break;
					case 'Sexo':break;
					case 'Cobertura':cron_kine_obra=utils.stringToNumber(subChilds[jj].getTextValue());break;
					case 'Plan':cron_kine_obrpla=subChilds[jj].getTextValue();break;
					case 'Afiliado':cron_kine_benef=subChilds[jj].getTextValue();break;
					case 'CondicionIVA':cron_kine_condicioniva=subChilds[jj].getTextValue();break;
					case 'PRIS':break;
					case 'PR1':break;
					case 'SET_ID':break;
					case 'ID':cron_kine_resecodnumcod[xx]=subChilds[jj].getTextValue();break;
					case 'DESCRIPCION_PRESTACION':cron_kine_imacodidescod[xx]=subChilds[jj].getTextValue();break;
					case 'NOMENCLADOR':cron_kine_resecodtipcod[xx]=subChilds[jj].getTextValue();break;
					case 'CANTIDAD':cron_kine_resecodcantid[xx]=subChilds[jj].getTextValue();xx++;break;
					}
					
					subChilds2 = subChilds[jj].getChildNodes()
					if(subChilds2.length>0){
					
						for(ll=0;ll<subChilds2.length;ll++){
							
							switch (subChilds2[ll].getName()){
							case 'Efector':$efector=true;break;
							case 'MatriculaTipo':break;
							case 'MatriculaNumero':if($efector){cron_kine_matricula=subChilds2[ll].getTextValue(); $efector=false;};break;
							case 'IDEspecialidad':cron_kine_esp=utils.stringToNumber(subChilds2[ll].getTextValue());break;
							case 'PV1Fecha':cron_kine_pv1fecha=subChilds2[ll].getTextValue();break;
							case 'PV1Hora':cron_kine_pv1hora=subChilds2[ll].getTextValue();break;
							case 'Servicio':cron_kine_servicio=subChilds2[ll].getTextValue();break;
							case 'PV1Servicio':break;
							case 'LUGAR_ATENCION':cron_kine_consul=utils.stringToNumber(subChilds2[ll].getTextValue());break;
							case 'PV1TipoTurno':cron_kine_pv1tipoturno=subChilds2[ll].getTextValue();break;
							case 'NroHistoriaClinica':cron_kine_hiscli=subChilds2[ll].getTextValue();break;
							case 'NroDocumento':cron_kine_nrodocumento=subChilds2[ll].getTextValue();break;
							case 'TipoDocumento':cron_kine_tipodocumento=subChilds2[ll].getTextValue();break;
							case 'Sexo':break;
							case 'Cobertura':cron_kine_obra=utils.stringToNumber(subChilds2[ll].getTextValue());break;
							case 'Plan':cron_kine_obrpla=subChilds2[ll].getTextValue();break;
							case 'Afiliado':cron_kine_benef=subChilds2[ll].getTextValue();break;
							case 'CondicionIVA':cron_kine_condicioniva=subChilds2[ll].getTextValue();break;
							case 'PRIS':break;
							case 'PR1':break;
							case 'SET_ID':break;
							case 'ID':cron_kine_resecodnumcod[xx]=subChilds2[ll].getTextValue();break;
							case 'DESCRIPCION_PRESTACION':cron_kine_imacodidescod[xx]=subChilds2[ll].getTextValue();break;
							case 'NOMENCLADOR':cron_kine_resecodtipcod[xx]=subChilds2[ll].getTextValue();break;
							case 'CANTIDAD':cron_kine_resecodcantid[xx]=subChilds2[ll].getTextValue();xx++;break;
							}
						}
					}
				}
			}
		}
	}
	
	if(cron_kine_hiscli==null||cron_kine_esp==null||cron_kine_matricula==null||cron_kine_pv1fecha==null||cron_kine_pv1hora==null||cron_kine_servicio==null){
		return false
	}else{
		return true
	}
}

/**
 * @AllowToRunInFind
 * 
 * TODO generated, please specify type and doc for the params
 * @param especialidad
 * @param fecha
 *
 * @properties={typeid:24,uuid:"83E4167A-5A3E-48C9-86D6-A519D6F72620"}
 */
function cron_filtra_campos_clave_Reservas(especialidad, fecha){
	if(cron_kine_servicio!=31){
		return false
	}
	if(cron_kine_pv1fecha==null||cron_kine_pv1hora==null){
		return false
	}
	if(cron_kine_esp!=especialidad){
		return false
	}
	var i=0
	var $codigo_med=0
	var fin_matricula=false
	var fs_medper = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
	var fs_medtur = databaseManager.getFoundSet("asistencial","tbc_medtur")
	var fin_especialidad=false
	cron_kine_med=null
	cron_kine_estadtur_med=null
	var fs_especialidad = databaseManager.getFoundSet("maestros","tbc_especial")
	fs_especialidad.find()
	fs_especialidad['esp_codi']=cron_kine_esp
	fs_especialidad.search()
	if(fs_especialidad.getSize()>0){
		fin_especialidad=true
	}
	fs_medper.find()
	fs_medper['medpermatricun']=cron_kine_matricula
	fs_medper.search()
	if(fs_medper.getSize()>0){
		for(i=1;i<=fs_medper.getSize()&&!fin_matricula&&fin_especialidad;i++){
			fs_medper.setSelectedIndex(i)
			for(var j=0;j<=9&&!fin_matricula;j++){
				$codigo_med=fs_medper['medpercod']+''+j
				fs_medtur.find()
				fs_medtur['medturcod']=$codigo_med
				fs_medtur['medturesp']=cron_kine_esp
				fs_medtur.search()
				if(fs_medtur.getSize()>0){
					if(fs_medtur['medturbaja']==0){
						cron_kine_med=fs_medtur['medturcod']
						cron_kine_estadtur_med=fs_medper['medpercod']
						if(fs_medper['medpertipoie']==0){
							cron_kine_tiposol='I'
						}else{
							cron_kine_tiposol='E'
						}
						cron_kine_tipomed=fs_medper['medpertipoie']
						cron_kine_mednya=fs_medper['medperapeynom']
						fin_matricula=true
					}
				}
			}
		}
	}
	cron_kine_hora=cron_kine_pv1hora+"0000"
	cron_kine_fech=cron_kine_pv1fecha.substr(6,4)+cron_kine_pv1fecha.substr(3,2)+cron_kine_pv1fecha.substr(0,2)
	
	if(cron_kine_fech!=utils.stringToNumber(fecha)){
		return false
	}
	
	if(!fin_especialidad||!fin_matricula){
		return false
	}else{
		return true
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"E39416FE-B7A7-4735-A21E-F41AA24E9B02"}
 */
function cron_valida_turno_en_Reservas(){
	var fs_reservas = databaseManager.getFoundSet("asistencial","tbc_reservas")
	fs_reservas.clear()
	fs_reservas.find()
	fs_reservas['reservasesp']=cron_kine_esp
	fs_reservas['reservasmed']=cron_kine_med
	fs_reservas['reservasfech']=cron_kine_fech
	fs_reservas['reservashora']=cron_kine_hora
	fs_reservas.search()
	if (fs_reservas.getSize()>0){
		cron_retorno_msa=false
		cron_error_msa='Turno Existente'
		while (!cron_retorno_msa){
			cron_kine_hora=cron_kine_hora+10000
			fs_reservas.find()
			fs_reservas['reservasesp']=cron_kine_esp
			fs_reservas['reservasmed']=cron_kine_med
			fs_reservas['reservasfech']=cron_kine_fech
			fs_reservas['reservashora']=cron_kine_hora
			fs_reservas.search()
			if (fs_reservas.getSize()<1){
				cron_retorno_msa=true
			}
		}
		return true	
	}else{
		cron_retorno_msa=true
		cron_error_msa=''
		return true
	}
}

/**
 * @properties={typeid:24,uuid:"E245971A-996B-4C10-9399-6B93731336D4"}
 */
function cron_insertar_turno(){
	var fs = databaseManager.getFoundSet("asistencial","tbc_reservas")
	fs.newRecord()
	//globals.InicializarDatos("AtCons_reservas","asistencial","tbc_reservas")
	//mover campos
	//
	//
	
	var $dia_hora_actual=application.getServerTimeStamp()
	var $anio=$dia_hora_actual.getFullYear()
	var $mes=$dia_hora_actual.getMonth()+1
	var $hora_ped=$dia_hora_actual.getHours()
	var $min_ped=$dia_hora_actual.getMinutes()
	var $dia=$dia_hora_actual.getDate()
	var $ed_mes=''
	var $ed_dia=''
	var $ed_min=''
	var $ed_hora=''
	if($mes>=10){
		$ed_mes=$mes
	}else{
		$ed_mes='0'+$mes
	}
	if($dia>=10){
		$ed_dia=$dia
	}else{
		$ed_dia='0'+$dia
	}
	if($min_ped>=10){
		$ed_min=$min_ped
	}else{
		$ed_min='0'+$min_ped
	}
	if($hora_ped<10){
		$ed_hora='0'+$hora_ped
	}else{
		$ed_hora=$hora_ped
	}
	fs.reservasatendi=0
	fs.reservasatendicef=0
	//fs.reservasconsu=cron_kine_consul
	fs.reservasesp1=cron_kine_esp
	fs.reservasesp2=cron_kine_esp
	fs.reservasesp3=cron_kine_esp
	fs.reservasesp6=cron_kine_esp
	fs.reservasesp=cron_kine_esp
	fs.reservasesta=1
	fs.reservasestacef=1
	fs.reservasfech1=cron_kine_fech
	fs.reservasfech2=cron_kine_fech
	fs.reservasfech3=cron_kine_fech
	fs.reservasfech5=cron_kine_fech
	fs.reservasfech6=cron_kine_fech
	fs.reservasfech=cron_kine_fech
	fs.reservasfechaconf=$anio+$ed_mes+$ed_dia
	fs.reservasfechaped=$anio+$ed_mes+$ed_dia
	fs.reservashiscli=utils.stringToNumber(cron_kine_hiscli)
	fs.reservashora1=cron_kine_hora
	fs.reservashora2=cron_kine_hora
	fs.reservashora3=cron_kine_hora
	fs.reservashora5=cron_kine_hora
	fs.reservashora6=cron_kine_hora
	fs.reservashora=cron_kine_hora
	fs.reservashoraatenc=cron_kine_hora
	fs.reservashoracef=cron_kine_hora
	fs.reservashoraconf=$ed_hora+$ed_min
	fs.reservashoraped=$ed_hora+$ed_min
	fs.reservasmed1=cron_kine_med
	fs.reservasmed2=cron_kine_med
	fs.reservasmed3=cron_kine_med
	fs.reservasmed6=cron_kine_med
	fs.reservasmed=cron_kine_med
	fs.reservasnroben=cron_kine_benef.toString()
	fs.reservasobra=cron_kine_obra
	fs.reservasobrpla=cron_kine_obrpla.toString()
	fs.reservasopera=cron_kine_operador
	fs.reservasoperaconf=cron_kine_operador
	fs.reservasservicio=cron_kine_servicio
	fs.reservassexo=cron_kine_sexo
	fs.reservastipo='P'
	fs.reservastipoopera=cron_kine_tip_opera
	fs.reservastipooperaconf=cron_kine_tip_opera
	fs.reservastipser=cron_kine_tip_servicio
	fs.reservastipsercef=cron_kine_tip_servicio
	//fs.reservastipsol=cron_kine_tiposol
	switch (cron_kine_condicioniva){
	case 'O':fs.reservasiva=1;break;
	case 'V':fs.reservasiva=3;break;
	default:fs.reservasiva=2;break;
	}
	fs.reservasnumerofc=0
	fs.reservasletrafc=' '	 
	fs.reservasmedsol=0	
	fs.reservastipsol=' '	 
	fs.reservasprimeravez=0
	fs.reservasipedido=0
	fs.reservashorasobre=0
	fs.reservassexo=0	
	fs.reservascron=0	
	fs.reservasllamadaestado=' ' 
	fs.reservasllamadadestino=0	
	fs.reservasfechcef=cron_kine_fech
	fs.reservasmedicab=' '	             
	fs.reservasautoriza=' '	            
	fs.reservasconsu=0
	fs.reservaspartespe=0
	fs.reservasconestudio=0
	fs.reservasetipoestudio_10=0
	fs.reservasetipoestudio_9=0
	fs.reservasetipoestudio_8=0
	fs.reservasetipoestudio_7=0
	fs.reservasetipoestudio_6=0
	fs.reservasetipoestudio_5=0
	fs.reservasetipoestudio_4=0
	fs.reservasetipoestudio_3=0
	fs.reservasetipoestudio_2=0
	fs.reservasetipoestudio_1=0
	fs.reservaspamifup=0
	fs.reservasmarcapasos=' '	          
	fs.reservaspvezxesp=0
	fs.reservasmenoracom=0	
		
	
	try{
		databaseManager.saveData(fs.getRecord(1))
	}catch(msg){
		application.output(msg.message)
	}
	var error1=''
	var error2=''
	var i = 0
	var array = databaseManager.getFailedRecords(fs)
	for (i = 0; i < array.length; i++) {
		var record = array[i];
		var jstable = databaseManager.getTable(record);
		var tableSQLName = jstable.getSQLName();
		error1='Error de Grabación en Tabla: ' + tableSQLName + ' en server: ' + jstable.getServerName() + ' falló la grabación. Avise a Sistemas, por favor!'
		error2='Error en grabación '+record.exception;
		if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
			var thrown = record.exception.getValue()
		}
	}
	if(error1!=''){
		application.output(error1)
		application.output(error2)
		cron_retorno_msa=false
		cron_error_msa+=' - No se pudo grabar el turno en RESERVAS' 
	}else{
		cron_retorno_msa=true
		cron_error_msa+=' ' 
	}
	return cron_retorno_msa
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"0A1BB57D-256B-42BE-AEB6-7D2BF8B724FA"}
 */
function cron_regrabar_turno(){
	
	var $dia_hora_actual=application.getServerTimeStamp()
	var $anio=$dia_hora_actual.getFullYear()
	var $mes=$dia_hora_actual.getMonth()+1
	var $hora_ped=$dia_hora_actual.getHours()
	var $min_ped=$dia_hora_actual.getMinutes()
	var $dia=$dia_hora_actual.getDate()
	var $ed_mes=''
	var $ed_dia=''
	var $ed_min=''
	var $ed_hora=''
	if($mes>=10){
		$ed_mes=$mes
	}else{
		$ed_mes='0'+$mes
	}
	if($dia>=10){
		$ed_dia=$dia
	}else{
		$ed_dia='0'+$dia
	}
	if($min_ped>=10){
		$ed_min=$min_ped
	}else{
		$ed_min='0'+$min_ped
	}
	if($hora_ped<10){
		$ed_hora='0'+$hora_ped
	}else{
		$ed_hora=$hora_ped
	}
	cron_retorno_msa=false
	var fs = databaseManager.getFoundSet("asistencial","tbc_reservas")
	fs.find()
	fs.reservasesp=cron_kine_esp             
	fs.reservasfech=cron_kine_fech           
	fs.reservashora=cron_kine_hora           
	fs.reservasmed=cron_kine_med 
	fs.search()
	if(fs.getSize()>0){
		fs.reservasatendi=0
		fs.reservasatendicef=0
		fs.reservasconsu=cron_kine_consul
		fs.reservasesta=1
		fs.reservasestacef=1
		fs.reservasfechaconf=$anio+$ed_mes+$ed_dia
		fs.reservasfechaped=$anio+$ed_mes+$ed_dia
		fs.reservashiscli=utils.stringToNumber(cron_kine_hiscli)
		fs.reservashoraconf=$ed_hora+$ed_min
		fs.reservashoraped=$ed_hora+$ed_min
		fs.reservasnroben=cron_kine_benef
		fs.reservasobra=cron_kine_obra
		fs.reservasobrpla=cron_kine_obrpla
		fs.reservasopera=cron_kine_operador
		fs.reservasoperaconf=cron_kine_operador
		fs.reservasservicio=cron_kine_servicio
		fs.reservassexo=cron_kine_sexo
		fs.reservastipo="P"
		fs.reservastipoopera=cron_kine_tip_opera
		fs.reservastipooperaconf=cron_kine_tip_opera
		fs.reservastipser=cron_kine_tip_servicio
		fs.reservastipsercef=cron_kine_tip_servicio
		fs.reservastipsol=cron_kine_tiposol
		switch (cron_kine_condicioniva){
		case 'O':fs.reservasiva=1;break;
		case 'V':fs.reservasiva=3;break;
		default:fs.reservasiva=2;break;
		}
		
		try{
			databaseManager.saveData(fs.getRecord(1))
		}catch(msg){
			application.output(msg.message)
		}
		var error1=''
		var error2=''
		var i = 0
		var array = databaseManager.getFailedRecords(fs)
		for (i = 0; i < array.length; i++) {
			var record = array[i];
			var jstable = databaseManager.getTable(record);
			var tableSQLName = jstable.getSQLName();
			error1='Error de Grabación en Tabla: ' + tableSQLName + ' en server: ' + jstable.getServerName() + ' falló la grabación. Avise a Sistemas, por favor!'
			error2='Error en grabación '+record.exception;
			if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
				var thrown = record.exception.getValue()
			}
		}
		if(error1!=''){
			application.output(error1)
			application.output(error2)
			cron_retorno_msa=false
			cron_error_msa+=' - No se pudo regrabar el turno en RESERVAS' 
		}else{
			cron_retorno_msa=true
			cron_error_msa+=' ' 
		}
	}
	return cron_retorno_msa
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"8FA4ABB5-1F09-40C5-9E4A-F7A01DF537E3"}
 */
function cron_valida_hiscli(){
	var $hiscli=0
	$hiscli=utils.stringToNumber(cron_kine_hiscli)
	if($hiscli>2000000){
		$hiscli=cron_busca_hiscli_x_documento()
	}else{
		$hiscli=utils.stringToNumber(cron_kine_hiscli)
	}
	var fs = databaseManager.getFoundSet("asistencial","tbc_hist_cab")
	fs.clear()
	fs.find()
	fs['histcab_nrounico']=$hiscli
	fs.search()
	if(fs.getSize()>0){
		fs.setSelectedIndex(1)
		if(cron_kine_obra!=fs['histcab_obra']||cron_kine_obrpla!=fs['histcab_planx']||cron_kine_benef!=fs['histcab_nrobenef']){
			actualiza_histcab()
		}
		cron_retorno_msa=true
		cron_error_msa+=' ' 
		return true
	}else{
		cron_retorno_msa=false
		cron_error_msa+=' - No se encontro Historia Clinica' 
		return false
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"EC3AE604-EB8B-461F-8F4D-D4AA702D9713"}
 */
function cron_busca_hiscli_x_documento(){
	var $hiscli1=0
	var $encontrado=false
	var fs = databaseManager.getFoundSet("asistencial","tbc_hist_cab")
	fs.clear()
	fs.find()
	fs['histcab_tipdoc']=cron_kine_tipodocumento
	fs['histcab_nrodoc']=cron_kine_nrodocumento
	fs.search()
	if(fs.getSize()>0){
		for(var i=1;i<=fs.getSize();i++){
			fs.setSelectedIndex(i)
			$hiscli1=fs['histcab_nrounico']
		}
	}else{
		for(var j=1;j<=5&&!$encontrado;j++){
			fs.find()
			fs['histcab_tipdoc']=j
			fs['histcab_nrodoc']=cron_kine_nrodocumento
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				$hiscli1=fs['histcab_nrounico']
				$encontrado=true
			}
		}
	}
	return $hiscli1
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"E7214ECC-229D-4053-B6F8-B679809C64B1"}
 */
function cron_insertar_responseeg(){
	var $posicion_estado=cron_mensaje.indexOf("</Estado>")
	var $posicion_idida=cron_mensaje.indexOf("</IDMensajeIda>")
	var $posicion_iErrores=cron_mensaje.indexOf("<Errores>")
	var $posicion_fErrores=cron_mensaje.indexOf("</Errores>")
	var $estado_ida=''
	if(cron_retorno_msa){
		$estado_ida="AA"
	}else{
		$estado_ida="AE"
	}
	var $mensaje=cron_mensaje.substr(0,$posicion_estado-5)+$estado_ida+cron_mensaje.substr($posicion_estado,$posicion_idida-$posicion_estado-6)+cron_kine_idmensaje+cron_mensaje.substr($posicion_idida,$posicion_iErrores-$posicion_idida+9)+cron_error_msa+cron_mensaje.substr($posicion_fErrores,cron_mensaje.length-$posicion_fErrores)
	var fs = databaseManager.getFoundSet("validaciones","responseeg")
	
	fs.clear()
	fs.find()
	fs['idmensaje']=cron_idmensaje_requesteg
	fs.search()
	if(fs.getSize()<1){
		fs.newRecord()
		fs['idmensaje']=cron_idmensaje_requesteg
	}
	fs['mensaje']=$mensaje
	fs['estadomensaje']=cron_kine_estadomensaje
	fs['fechamensaje']=cron_kine_fechamensaje
	fs['codigo']=0
		
	try{
		databaseManager.saveData(fs)
	}catch(msg){
		application.output(msg.message)
	}
	var error1=''
	var error2=''
	var i = 0
	var array = databaseManager.getFailedRecords(fs)
	for (i = 0; i < array.length; i++) {
		var record = array[i];
		var jstable = databaseManager.getTable(record);
		var tableSQLName = jstable.getSQLName();
		error1='Error de Grabación en Tabla: ' + tableSQLName + ' en server: ' + jstable.getServerName() + ' falló la grabación. Avise a Sistemas, por favor!'
		error2='Error en grabación '+record.exception;
		if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
			var thrown = record.exception.getValue()
		}
	}
	if(error1!=''){
		application.output(error1)
		application.output(error2)
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"CDE52BEA-67EC-4113-988A-64BD5210ACE7"}
 */
function cron_actualiza_requesteg(){
	var fs = databaseManager.getFoundSet("validaciones","requesteg")
	fs.find()
	fs['idmensaje']=cron_idmensaje_requesteg
	fs.search()
	//fs.search(true,false)
	if(fs.getSize()>0){
		fs['estadomensaje']= 'P'
		try{
			databaseManager.saveData(fs)
		}catch(msg){
			application.output(msg.message)
		}
		var error1=''
		var error2=''
		var i = 0
		var array = databaseManager.getFailedRecords(fs)
		for (i = 0; i < array.length; i++) {
			var record = array[i];
			var jstable = databaseManager.getTable(record);
			var tableSQLName = jstable.getSQLName();
			error1='Error de Grabación en Tabla: ' + tableSQLName + ' en server: ' + jstable.getServerName() + ' falló la grabación. Avise a Sistemas, por favor!'
			error2='Error en grabación '+record.exception;
			if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
				var thrown = record.exception.getValue()
			}
		}
		if(error1!=''){
			application.output(error1)
			application.output(error2)
		}
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"EF142FC6-FFB0-42C1-B4B4-B629C46B42B7"}
 */
function cron_insertar_resecod(){
	cron_kine_resecodesp=cron_kine_esp
	cron_kine_resecodmed=cron_kine_med
	cron_kine_resecodfech=cron_kine_fech
	cron_kine_resecodhora=cron_kine_hora
	var $item=0
	var fs = databaseManager.getFoundSet("asistencial","tbc_resecod")
	var largo_resecod = cron_kine_resecodnumcod.length
	if(largo_resecod > 0){
		for(var ii=0;ii<largo_resecod;ii++){
			$item++
			fs.find()
			fs['resecodesp']=cron_kine_resecodesp
			fs['resecodmed']=cron_kine_resecodmed
			fs['resecodfech']=cron_kine_resecodfech
			fs['resecodhora']=cron_kine_resecodhora
			fs['resecoditem']=$item
			fs.search()
			if(fs.getSize()<1){
				fs.newRecord()
				fs['resecodesp']=cron_kine_resecodesp
				fs['resecodmed']=cron_kine_resecodmed
				fs['resecodfech']=cron_kine_resecodfech
				fs['resecodhora']=cron_kine_resecodhora
				fs['resecoditem']=$item
				fs['resecodtipcod']=cron_kine_resecodtipcod[ii]
				fs['resecodnumcod']=cron_kine_resecodnumcod[ii]
				fs['resecodcantid']=cron_kine_resecodcantid[ii]
				fs['resecodl']=0
				fs['resecoddiag']=cron_kine_resecoddiag
				
				try{
					databaseManager.saveData(fs)
				}catch(msg){
					application.output(msg.message)
				}
				var error1=''
				var error2=''
				var i = 0
				var array = databaseManager.getFailedRecords(fs)
				for (i = 0; i < array.length; i++) {
					var record = array[i];
					var jstable = databaseManager.getTable(record);
					var tableSQLName = jstable.getSQLName();
					error1='Error de Grabación en Tabla: ' + tableSQLName + ' en server: ' + jstable.getServerName() + ' falló la grabación. Avise a Sistemas, por favor!'
					error2='Error en grabación '+record.exception;
					if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
						var thrown = record.exception.getValue()
						
					}
				}
				if(error1!=''){
					application.output(error1)
					application.output(error2)
					cron_retorno_msa=false
					cron_error_msa+=' - No se pudo grabar el registro en RESECOD' 
				}else{
					cron_retorno_msa=true
					cron_error_msa+=' ' 
				}
				cron_kine_graba_rendicion(ii)
			}else{
				cron_retorno_msa=true
				cron_error_msa+=' ' 
			}
		}
	}else{
		cron_retorno_msa=false
		cron_error_msa+=' - No se pudo grabar el registro en RESECOD'
	}
	return cron_retorno_msa
}

/**
 * @properties={typeid:24,uuid:"EE12348D-FBD6-4DE9-BCD2-A78BECB41E2F"}
 */
function onSolutionOpen_cronTurnosKinesiologia() {
	plugins.scheduler.addCronJob('cron_kinesiologia', '0 0/2 * * * ?', cronObtenerKinesiologiaEges)
}

/**
 * TODO generated, please specify type and doc for the params
 * @param force
 *
 * @properties={typeid:24,uuid:"F5250A50-B46D-4198-9E11-50E8904F6B98"}
 */
function onSolutionClose_cronTurnosKinesiologia(force) {
	plugins.scheduler.removeJob('cron_kinesiologia')
	return true
}

/**
 * TODO generated, please specify type and doc for the params
 * @param $insertar
 *
 * @properties={typeid:24,uuid:"5D372A0E-4998-4118-8301-525F549BA794"}
 */
function graba_estadtur($insertar){
	var fs = databaseManager.getFoundSet("asistencial","tbc_estadtur")
	
	if($insertar){
		fs.newRecord()
	}
	fs.estadturfecha=cron_kine_fech
	fs.estadturfecha1=cron_kine_fech
	fs.estadturhora=cron_kine_hora
	fs.estadturhora1=cron_kine_hora
	fs.estadturmed=cron_kine_med
	fs.estadturesp=cron_kine_esp
	fs.estadturmednya=cron_kine_mednya
	fs.estadturobr=cron_kine_obra
	fs.estadturobrdes=cron_kine_obrades
	fs.estadturtipomed=cron_kine_tipomed
	fs.estadturtipotur="P"
	fs.estadturplan=cron_kine_obrpla
	fs.estadturconsulta=0
	fs.estadturentro=0
	fs.estadturaten=2
	fs.estadturtipserv=10
	fs.estadturservicio=0
	fs.estadturausente=0
	
	try{
		databaseManager.saveData(fs.getRecord(1));
		
	} catch(msg){
		application.output("Se ha producido un error de grabación. " + '\n' + "Avise a Sistemas, por favor.")
	}
	var error3 = ''
	var error4 = ''
	var array1 = databaseManager.getFailedRecords(fs)
	for (var j = 0; j < array1.length; j++) {
		var record1 = array1[j];
		var jstable1 = databaseManager.getTable(record1);
		var tableSQLName1 = jstable1.getSQLName();
		error3 = 'Error de Grabación en Tabla:' + tableSQLName1 + ' en server:' + jstable1.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
		error4 = 'Error en grabación ' + record1.exception;
		if (record1.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
			// exception thrown in pre-insert/update/delete event method
			var thrown1 = record1.exception.getValue()

		}
	}

	if(error3!=''){
		//cron_retorno_msa=false
		application.output(error3)
		application.output(error4)
		cron_error_msa+=' - No se pudo grabar el registro en ESTADTUR' 
	}else{
		//cron_retorno_msa=true
		cron_error_msa+=' ' 
	}
}

/**
 * @AllowToRunInFind
 * 
 * TODO generated, please specify type and doc for the params
 * @param indice
 *
 * @properties={typeid:24,uuid:"9B308C37-2050-4CBC-A363-213D884FE36C"}
 */
function cron_kine_graba_rendicion(indice){
	var fs = databaseManager.getFoundSet("asistencial","tbc_rend_cab")
	var fs_obra = databaseManager.getFoundSet("maestros","tbc_obras")
	var fs_histcab = databaseManager.getFoundSet("asistencial","tbc_hist_cab")
	var fs_planobra = databaseManager.getFoundSet("maestros","tbc_plan_obra")
	var $fecha_actual = application.getServerTimeStamp()
	var $anio=0
	$anio=$fecha_actual.getFullYear()
	var $mes = 0
	var $mes_ed = ' '
	var $dia = 0
	var $dia_ed = ' '
	var $hora = 0
	var $min = 0
	var $hora_ed = ' '
	var $min_ed = ' '
	var $planX=' '
	var $condiva=0;
	$dia=$fecha_actual.getDate()
	$mes=$fecha_actual.getMonth()+1
	$hora=$fecha_actual.getHours()
	$min=$fecha_actual.getMinutes()
	if($mes<10){
		$mes_ed='0'+$mes
	}else{
		$mes_ed=$mes
	}
	if($dia<10){
		$dia_ed='0'+$dia
	}else{
		$dia_ed=$dia
	}
	if($hora<10){
		$hora_ed='0'+$hora
	}else{
		$hora_ed=$hora
	}
	if($min<10){
		$min_ed='0'+$min
	}else{
		$min_ed=$min
	}
	fs_obra.find()
	fs_obra['obr_codigo']=cron_kine_obra
	fs_obra.search()
	if(fs_obra.getSize()>0){
		cron_kine_obrades=fs_obra['obr_razonsoc']
		if(fs_obra['obr_cantcierres']==4){
			if($dia>=22){
				cron_kine_rend_cierre=4
			}else{
				if($dia>=15){
					cron_kine_rend_cierre=3
				}else{
					if($dia>=8){
						cron_kine_rend_cierre=2
					}else{
						if($dia>=1){
							cron_kine_rend_cierre=1
						}
					}
				}
			}
		}else{
			if(fs_obra['obr_cantcierres']==3){
				if($dia>=21){
					cron_kine_rend_cierre=3
				}else{
					if($dia>=11){
						cron_kine_rend_cierre=2
					}else{
						if($dia>=1){
							cron_kine_rend_cierre=1
						}
					}
				}
			}else{
				if(fs_obra['obr_cantcierres']==2){
					if($dia>=16){
						cron_kine_rend_cierre=2
					}else{
						if($dia>=1){
							cron_kine_rend_cierre=1
						}
					}
				}else{
					cron_kine_rend_cierre=1
				}
			}
		}
	}
	fs_histcab.find()
	fs_histcab['histcab_nrounico']=utils.stringToNumber(cron_kine_hiscli)
	fs_histcab.search()
	/*
	if(fs_histcab.getSize()>0){
		cron_kine_benef=fs_histcab['histcab_nrobenef']
	}else{
		cron_kine_benef=' '
	}
	*/
	fs_planobra.find()
	fs_planobra['plo_obra1']=cron_kine_obra
	fs_planobra['plo_planx10']=cron_kine_obrpla
	fs_planobra.search()
	if(fs_planobra.getSize()>0){
		if(fs_planobra['plo_planx']!=null){
			$planX=fs_planobra['plo_planx']
		}else{
			$planX=' '
		}
	}else{
		$planX=' '
	}
	cron_kine_rend_periodo=$anio+''+$mes_ed;
	if(cron_kine_condicioniva=='O'){
		$condiva=1
	}else{
		if(cron_kine_condicioniva=='V'){
			$condiva=3
		}else{
			$condiva=2
		}
	}
	fs.find()
	fs.rcadmision=2
	fs.rcempresa=1
	fs.rchclinica=utils.stringToNumber(cron_kine_hiscli)
	fs.rcperiodo=cron_kine_rend_periodo
	fs.rccierre=cron_kine_rend_cierre
	fs.search()
	if(fs.getSize()<1){
		fs.newRecord()
		fs.rcadmision1=2
		fs.rcadmision2=2
		fs.rcadmision3=2
		fs.rcadmision4=2
		fs.rcadmision=2
		fs.rcempresa1=1
		fs.rcempresa2=1
		fs.rcempresa3=1
		fs.rcempresa4=1
		fs.rcempresa5=1
		fs.rcempresa=1
		fs.rchclinica2=utils.stringToNumber(cron_kine_hiscli)
		fs.rchclinica3=utils.stringToNumber(cron_kine_hiscli)
		fs.rchclinica5=utils.stringToNumber(cron_kine_hiscli)
		fs.rchclinica=utils.stringToNumber(cron_kine_hiscli)
		fs.rccierre2=cron_kine_rend_cierre
		fs.rccierre3=cron_kine_rend_cierre
		fs.rccierre=cron_kine_rend_cierre
		fs.rcperiodo2=cron_kine_rend_periodo
		fs.rcperiodo6=cron_kine_rend_periodo
		fs.rcperiodo=cron_kine_rend_periodo
		fs.rcperiodo3=cron_kine_rend_periodo
		fs.rcestado5=0
		fs.rcestado=0
		fs.rcobra5=cron_kine_obra
		fs.rcobra=cron_kine_obra
		fs.rcfactura=0
		fs.rctipograb=2
		fs.rciva=$condiva
		fs.rcpaciente=fs_histcab['histcab_apellnom']
		fs.rcfecha = $anio+''+$mes_ed+''+$dia_ed;
		fs.rchora = $hora_ed+''+$min_ed;
		fs.rcimpobra = 0;
		fs.rcimppaciente1 = 0;
		fs.rcimppaciente2 = 0;
		fs.rcimpfiller = 0;
		fs.rcplan = $planX;
		fs.rcafiliado = cron_kine_benef;
		fs.rcfechaemision = $anio+''+$mes_ed+''+$dia_ed;
		fs.rchoraemision = $hora_ed+''+$min_ed;
		fs.rcatencion = 1;
		fs.libre=0;
		fs.rchcturnos=0;
		fs.rcperiodofact=0;
		fs.rcultfechapac=0;
		fs.rctipooperador=0;
		fs.rcoperador=0;
		fs.rcmarca=0;
		fs.rcletrafc=' ';
		fs.rcptovtafc=0;
		fs.rcquienfac=0;
		fs.rcsecuencia = globals.cron_kine_numeracion_txt(40)
		
		if(fs.rcsecuencia > 0){
			try{
				databaseManager.saveData(fs.getRecord(1));
				
			} catch(msg){
				application.output("error en grabacion rend-cab")
			}
			var error3 = ''
			var error4 = ''
			var array1 = databaseManager.getFailedRecords(fs)
			for (var j = 0; j < array1.length; j++) {
				var record1 = array1[j];
				var jstable1 = databaseManager.getTable(record1);
				var tableSQLName1 = jstable1.getSQLName();
				error3 = 'Error de Grabación en Tabla:' + tableSQLName1 + ' en server:' + jstable1.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
				error4 = 'Error en grabación ' + record1.exception;
				if (record1.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
					// exception thrown in pre-insert/update/delete event method
					var thrown1 = record1.exception.getValue()

				}
			}
			if(error3!=''){
				//cron_retorno_msa=false
				application.output(error3)
				application.output(error4)
				cron_error_msa+=' - No se pudo grabar el registro en REND-CAB' 
			}else{
				//cron_retorno_msa=true
				cron_error_msa+=' ' 
			}
		}
	}
	cron_kine_rend_fech=$anio+''+$mes_ed+''+$dia_ed;
	cron_kine_rend_hora=$hora_ed+''+$min_ed;
	cron_kine_rend_codinom=cron_kine_resecodnumcod[indice];
	cron_kine_rend_tiponom=cron_kine_resecodtipcod[indice];
	try{
		insertaRegistroRendDet()
		
	}catch(msg){
		application.output("error al insertaRegistroRendDet()")
	}
	
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"3C58D457-73A8-4D55-A60D-2948967ECEAD"}
 */
function insertaRegistroRendDet(){
	var fs = databaseManager.getFoundSet("asistencial","tbc_rend_det")
	var fs_nomencla = databaseManager.getFoundSet("maestros","tbc_nomencla")
	fs_nomencla.find()
	fs_nomencla['nome_tipo']=1
	fs_nomencla['nome_codigo']=cron_kine_rend_codinom;
	fs_nomencla.search()
	if(fs_nomencla.getSize()>0){
		cron_kine_rend_nome_panta=fs_nomencla['nome_pantalla']
	}else{
		cron_kine_rend_nome_panta=10
	}
	fs.find()
	fs.rdempresa = 1;
	fs.rdadmision = 2;
	fs.rdadmision1 = 2;
	fs.rdhclinica = utils.stringToNumber(cron_kine_hiscli);
	fs.rdperiodo = cron_kine_rend_periodo;
	fs.rdcierre = cron_kine_rend_cierre;
	fs.rdpantalla = cron_kine_rend_nome_panta;
	fs.rdfecha = cron_kine_rend_fech;
	fs.rdhora = cron_kine_rend_hora;
	fs.rdtipo = 1;
	fs.rdcodnom = cron_kine_rend_codinom;
	fs.rdmodalidad = 4;
	fs.search()
	if(fs.getSize()<1){
		fs.newRecord()
	}
		
	fs.rdempresa = 1;
	fs.rdadmision = 2;
	fs.rdadmision1 = 2;
	fs.rdhclinica = utils.stringToNumber(cron_kine_hiscli);
	fs.rdperiodo = cron_kine_rend_periodo;
	fs.rdcierre = cron_kine_rend_cierre;
	fs.rdpantalla = cron_kine_rend_nome_panta;
	fs.rdfecha = cron_kine_rend_fech;
	fs.rdhora = cron_kine_rend_hora;
	fs.rdtipo = 1;
	fs.rdcodnom = cron_kine_rend_codinom;
	fs.rdmodalidad = 4;
	fs.rdfechahasta = 0;
	fs.rdduracion = 0;
	fs.rddias = 10;
	fs.rdcantmod = 1;
	fs.rdespec=cron_kine_esp;
	fs.rdmed=cron_kine_med;
	fs.rdtipomed=cron_kine_tipomed
	fs.rdhon=0;
	fs.rdgto=0;
	fs.rdedcodigo=0;
	fs.rdnivelpami=0;
	fs.rdordencarga=0;
	fs.rdmarca=0;
	fs.rdopetipo=0;
	fs.rdopelega=0;
	fs.rdimpo=0;
	fs.rdunit=0;
	fs.rdpaso=0;
	
	
	try{
		databaseManager.saveData(fs.getRecord(1));
		
	} catch(msg){
		application.output("error en grabacion rend-det")
	}
	var error3 = ''
	var error4 = ''
	var array1 = databaseManager.getFailedRecords(fs)
	for (var j = 0; j < array1.length; j++) {
		var record1 = array1[j];
		var jstable1 = databaseManager.getTable(record1);
		var tableSQLName1 = jstable1.getSQLName();
		error3 = 'Error de Grabación en Tabla:' + tableSQLName1 + ' en server:' + jstable1.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
		error4 = 'Error en grabación ' + record1.exception;
		if (record1.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
			// exception thrown in pre-insert/update/delete event method
			var thrown1 = record1.exception.getValue()

		}
	}

	if(error3!=''){
		//cron_retorno_msa=false
		application.output(error3)
		application.output(error4)
		cron_error_msa+=' - No se pudo grabar el registro en REND-DET' 
	}else{
		//cron_retorno_msa=true
		cron_error_msa+=' ' 
	}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param $paramid
 *
 * @properties={typeid:24,uuid:"2DFD6AF2-5BEB-4945-A227-EB6FFCD570AB"}
 */
function cron_kine_numeracion_txt($paramid) {
	var nro_tomado = null;
	var done0 = plugins.rawSQL.executeSQL("desal", "tbl_parametros", "begin; lock table tbl_parametros in row exclusive mode;")
	if (!done0) {
		var msg0 = plugins.rawSQL.getException().getMessage(); //see exception node for more info about the exception obj
		application.output('SQL exception: ' + msg0);
	}
	var done = plugins.rawSQL.executeSQL("desal", "tbl_parametros", "select * from tbl_parametros where paramid = " + $paramid + "for update;");
	if (!done) {
		var msg = plugins.rawSQL.getException().getMessage(); //see exception node for more info about the exception obj
		application.output('SQL exception: ' + msg);
	}

	var vQuery = " SELECT contador_entero FROM tbl_parametros WHERE paramid = " + $paramid;
	var vDataset = databaseManager.getDataSetByQuery("desal", vQuery, null, 1);
	
	var done1 = plugins.rawSQL.executeSQL("desal", "tbl_parametros", "update tbl_parametros set contador_entero = contador_entero + 1 where paramid = " + $paramid + "; commit;")
	if (done1) {
		
		nro_tomado = vDataset.getValue(1,1) + 1;
	}
	else{
		var msg1 = plugins.rawSQL.getException().getMessage(); //see exception node for more info about the exception obj
		application.output('SQL exception: ' + msg1)
	}
	return nro_tomado
}

/**
 * @AllowToRunInFind
 * 
 * TODO generated, please specify type and doc for the params
 * @param $obra
 * @param $plan
 *
 * @properties={typeid:24,uuid:"BB56A17E-0956-4ED3-AC17-BCBBB5C762B2"}
 */
function obtenerPlan($obra, $plan){
	var $plan_retorno=" ";
	var $fs_planobra=databaseManager.getFoundSet("maestros","tbc_plan_obra")
	$fs_planobra.clear()
	$fs_planobra.find()
	$fs_planobra['plo_obra']=$obra
	$fs_planobra['plo_planx']=$plan
	$fs_planobra.search()
	if($fs_planobra.getSize()>0){
		$plan_retorno=$fs_planobra['plo_planx10']
	}
	return $plan_retorno;
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"846DCCC2-57A1-47F1-877A-4AF13214A9C4"}
 */
function actualiza_histcab(){
	var fs_histcab = databaseManager.getFoundSet("asistencial","tbc_hist_cab")
	fs_histcab.clear()
	fs_histcab.find()
	fs_histcab['histcab_nrounico']=utils.stringToNumber(cron_kine_hiscli)
	fs_histcab.search()
	if(fs_histcab.getSize()>0){
		fs_histcab['histcab_obra']=cron_kine_obra
		fs_histcab['histcab_planx']=cron_kine_obrpla
		fs_histcab['histcab_nrobenef']=cron_kine_benef
		try{
			databaseManager.saveData(fs_histcab.getRecord(1))
		}catch(msg){
			application.output("Error grabacion HIST-CAB "+msg.message)
		}
		var error1=''
		var error2=''
		var i = 0
		var array = databaseManager.getFailedRecords(fs_histcab)
		for (i = 0; i < array.length; i++) {
			var record = array[i];
			var jstable = databaseManager.getTable(record);
			var tableSQLName = jstable.getSQLName();
			error1='Error de Grabación en Tabla: ' + tableSQLName + ' en server: ' + jstable.getServerName() + ' falló la grabación. Avise a Sistemas, por favor!'
			error2='Error en grabación '+record.exception;
			if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
				var thrown = record.exception.getValue()
			}
		}
		if(error1!=''){
			application.output(error1)
			application.output(error2)
			//cron_retorno_msa=false
			cron_error_msa+=' - No se pudo regrabar la cobertura en HIST-CAB' 
		}else{
			//cron_retorno_msa=true
			cron_error_msa+=' '
			actualiza_histcab_obras()
		}
		
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"8008039E-61DA-4967-BDDA-2D0A5EB39125"}
 */
function actualiza_histcab_obras(){
	var $sec=0
	var $largo=0
	var $encontrado=false
	var fs_histcab_obras = databaseManager.getFoundSet("asistencial","tbc_hist_cab_obras")
	fs_histcab_obras.clear()
	fs_histcab_obras.find()
	fs_histcab_obras['histcabobrasnrounico']=utils.stringToNumber(cron_kine_hiscli)
	fs_histcab_obras.search()
	if(fs_histcab_obras.getSize()>0){
		$largo=fs_histcab_obras.getSize()
		for(var i=1;i<=$largo&&!$encontrado;i++){
			fs_histcab_obras.setSelectedIndex(i)
			if(fs_histcab_obras['histcabobrasobra']==cron_kine_obra&&fs_histcab_obras['histcabobrasplanx']==cron_kine_obrpla&&fs_histcab_obras['histcabobrasnrobenef']==cron_kine_benef){
				$encontrado=true
			}
			$sec=fs_histcab_obras['histcabobrassec']
		}
	}
	if(!$encontrado){
		$sec++
		fs_histcab_obras.newRecord()
		fs_histcab_obras['histcabobrasnrounico']=utils.stringToNumber(cron_kine_hiscli)
		fs_histcab_obras['histcabobrassec']=$sec
		fs_histcab_obras['histcabobrasobra']=cron_kine_obra
		fs_histcab_obras['histcabobrasplanx']=cron_kine_obrpla
		fs_histcab_obras['histcabobrasnrobenef']=cron_kine_benef
		fs_histcab_obras['histcabobrasstado']=0
		fs_histcab_obras['histcabtipolegajo']=0
		fs_histcab_obras['histcablegajo']=0
		fs_histcab_obras['histcabfechacarga']=cron_kine_fech
		try{
			databaseManager.saveData(fs_histcab_obras.getRecord(1))
		}catch(msg){
			application.output("Error grabacion HIST-CAB-OBRAS "+msg.message)
		}
		var error1=''
		var error2=''
		var i = 0
		var array = databaseManager.getFailedRecords(fs_histcab_obras)
		for (i = 0; i < array.length; i++) {
			var record = array[i];
			var jstable = databaseManager.getTable(record);
			var tableSQLName = jstable.getSQLName();
			error1='Error de Grabación en Tabla: ' + tableSQLName + ' en server: ' + jstable.getServerName() + ' falló la grabación. Avise a Sistemas, por favor!'
			error2='Error en grabación '+record.exception;
			if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
				var thrown = record.exception.getValue()
			}
		}
		if(error1!=''){
			application.output(error1)
			application.output(error2)
			//cron_retorno_msa=false
			cron_error_msa+=' - No se pudo regrabar la cobertura en HIST-CAB-OBRAS' 
		}else{
			//cron_retorno_msa=true
			cron_error_msa+=' ' 
		}
	}
}

/**
 * @properties={typeid:24,uuid:"72424D32-EB0E-496C-9C69-4E40F26E71A3"}
 */
function cron_kine_insertar_kinesio(){
var fs_kinesio = databaseManager.getFoundSet("asistencial","tbc_kinesio")
	
	fs_kinesio.newRecord()
	fs_kinesio.kinesiofech=cron_kine_fech
	fs_kinesio.kinesiohora=cron_kine_hora
	fs_kinesio.kinesiomed=cron_kine_med
	fs_kinesio.kinesioesp=cron_kine_esp
	fs_kinesio.kinesiohisto=utils.stringToNumber(cron_kine_hiscli)
	fs_kinesio.kinesioorden=1
	fs_kinesio.kinesioestado=0
	fs_kinesio.kinesiosesion=1
	fs_kinesio.kinesiopvezxesp=0
	//fs_kinesio.kinesioultnro=1
	
	try{
		databaseManager.saveData(fs_kinesio.getRecord(1));
		
	} catch(msg){
		application.output("Se ha producido un error de grabación. " + '\n' + "Avise a Sistemas, por favor.")
	}
	var error3 = ''
	var error4 = ''
	var array1 = databaseManager.getFailedRecords(fs_kinesio)
	for (var j = 0; j < array1.length; j++) {
		var record1 = array1[j];
		var jstable1 = databaseManager.getTable(record1);
		var tableSQLName1 = jstable1.getSQLName();
		error3 = 'Error de Grabación en Tabla:' + tableSQLName1 + ' en server:' + jstable1.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
		error4 = 'Error en grabación ' + record1.exception;
		if (record1.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
			// exception thrown in pre-insert/update/delete event method
			var thrown1 = record1.exception.getValue()

		}
	}

	if(error3!=''){
		//cron_retorno_msa=false
		application.output(error3)
		application.output(error4)
		cron_error_msa+=' - No se pudo grabar el registro en KINESIO' 
	}else{
		//cron_retorno_msa=true
		cron_error_msa+=' ' 
	}
	
}
