/**
 * @properties={typeid:35,uuid:"81F349FE-7E28-4483-ADAC-905E59046669",variableType:-4}
 */
var $_wHayArm = false;


/**
 * @properties={typeid:35,uuid:"B49D09E8-90BE-4211-B1DB-039C7A4F41AA",variableType:-4}
 */
var isValid = true;

/**
 * @properties={typeid:35,uuid:"F1761A35-BC97-4205-9B9F-40B7A423BFD2",variableType:-4}
 */
var f_aislado_paciente = false;

/**
 * @properties={typeid:35,uuid:"C4BC48BA-8167-4285-BD15-F8BAD6D97934",variableType:-4}
 */
var f_analgésicos = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"D2A56CC0-C547-408B-8974-086B0F67243C"}
 */
var f_antecedentes = '';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C2FC25C8-3095-4B83-92D6-77CC93FC78FA"}
 */
var f_observaciones = "";



/**
 * @properties={typeid:35,uuid:"B955757F-2323-4171-A271-6FBBE69FF671",variableType:-4}
 */
var f_mecanica = null;


///**
// * @properties={typeid:35,uuid:"1D49E550-BA75-4BC0-9AF7-F2267CE59981",variableType:-4}
// */
//var f_bloqueantes_neuromsuculares = null;



/**
 * @properties={typeid:35,uuid:"35F539A6-0E4E-43FF-86F8-7F30A10F7A5D",variableType:-4}
 */
var f_cam_icu = null;


/**
 * @properties={typeid:35,uuid:"024638C6-5A43-4497-9E1E-BBEA20575178",variableType:-4}
 */
var f_sedación = null;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"93BDA05C-FBF1-414B-91F1-C59ADF38E83A",variableType:4}
 */
var f_sobrevida = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4693605A-99F6-4CF8-B44C-9A1CD2E1436F",variableType:4}
 */
var f_score_charlson = 0;



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"150575EA-4318-4071-AECE-A59D1A640B59",variableType:4}
 */
var f_mortalidad_predicha_saps_II = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6C6298B2-5C69-4C35-B445-5877099F7660",variableType:4}
 */
var f_saps_II = 0;



/**
 * @properties={typeid:35,uuid:"4442DAA4-101B-49D3-BD58-FC5E7030A2E5",variableType:-4}
 */
var bloqueado = false;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C31C4609-3882-4E1C-9780-D54D38992717"}
 */
var messageError = '';


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1D11C528-F2BC-4C7B-9BCE-9CC7F6303EA7",variableType:4}
 */
var f_arm = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1816FE63-CF57-4B67-97D7-22D0C4D0ADF5",variableType:4}
 */
var AsiVm_grupoTxt = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D0F5398C-BB89-4FC3-AB8A-789E36C8C06E",variableType:4}
 */
var AsiVm_lineaTxt = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FF432BE6-D1B2-4209-A9F6-19AFE99E9067",variableType:4}
 */
var AsiVm_horaTxt = 0;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"FD2DDF91-F5CE-4396-AAD6-4A683E5342A1"}
 */
var f_derivado = null;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B6497E74-41AA-4F73-9482-20B390131EE6"}
 */
var f_ingresoUco = null;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"D9B5044B-EE0D-443C-8727-0ED817930454"}
 */
var f_ingresoSanatorio = null;



/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"42D6C605-220B-4C49-83B1-5ED566D6533C"}
 */
var $_msgSMS = '';



/**
 * @properties={typeid:35,uuid:"1CE8C87B-9054-47C1-B661-345B83021853",variableType:-4}
 */
var $_listNumberSMS = new Array();



/**
 * @properties={typeid:35,uuid:"400E7E34-112A-471F-8A0C-38BF1BCF9C39",variableType:-4}
 */
var $_wtrau = false;


/**
 * @properties={typeid:35,uuid:"A422C801-5E2F-40BE-9480-C7F7E66DD12C",variableType:-4}
 */
var $_wsele = false;


/**
 * @properties={typeid:35,uuid:"3F2DD52F-18B2-4D3E-9CF0-A231F0A67DA8",variableType:-4}
 */
var $_isUserOSTEE = false;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6AFA5390-8221-487D-9995-9DE729219C7C",variableType:4}
 */
var $_countChange = 1;



/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2321806E-5C38-4B01-BA98-FE5E1F81876C"}
 */
var f_habita = null;



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A7EFF59B-B60A-4F42-B412-627416A11580",variableType:4}
 */
var f_lugar_internacion = 0;



/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"CD45E2D3-DF0E-4D12-B200-6EF5E1F24DAF"}
 */
var f_cama = null;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A0821986-2B3B-43FD-9ED0-C3B5765B5FE2",variableType:4}
 */
var f_sexo = null;


/**
 * @properties={typeid:35,uuid:"26C94C7B-910F-4C9A-AC2B-F7BF4A221283",variableType:-4}
 */
var f_soporte_ventilatorio = null;



/**
 * @properties={typeid:35,uuid:"E7BF7CE6-905A-413F-A990-DBBED40F8B2A",variableType:-4}
 */
var f_modo_ventilatorio = null;


/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"E7EF124D-FBAC-4002-8963-7E692B9ABC29",variableType:93}
 */
var f_ingreso_uci = null;



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4FB5CDB5-0FA7-4CEA-8207-B84171272B49",variableType:4}
 */
var f_inicio_vm = 0;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"5422F6CC-AEDA-4DC8-917A-DADFF6D61421"}
 */
var f_motivo = '';



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A57459E0-586F-4688-A2A5-9FF916D1F6F0",variableType:4}
 */
var f_pulso_frecuencia = 0;



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"61A9654B-D3FA-41AC-A84E-B8479EF19B2B",variableType:4}
 */
var f_altura = 0;



/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"17CFE6FA-C462-4187-8AC4-9C55704C0ACE"}
 */
var f_paciente_grilla = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D8C5B1F1-B44B-463D-8875-D08C03B8B502",variableType:4}
 */
var f_id_ficha = 0
/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"3E3749D9-0494-4D3D-85BE-4F715728A3A3",variableType:93}
 */
var f_fecha_grilla = null;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"27B58096-544F-4BA7-AB28-9A294C3608E7",variableType:4}
 */
var f_legajo_mec_grilla = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"CBE0FB4F-0E1E-44CC-9493-FB0352815444",variableType:4}
 */
var f_hisclin_unic_grilla = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F40C870F-1E87-4D6F-9D73-6B439DBAB852",variableType:4}
 */
var f_histclin_grilla = 0;




/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A3014495-3A28-4F82-94E1-D6C4F5496763",variableType:4}
 */
var f_con_soporte_grilla = 0



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FF9B8F2D-F440-4A9B-86ED-8E565C230058",variableType:4}
 */
var f_prestacion_grilla = 0


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"924A94E6-9B08-4596-8571-AF3CF1676CC5"}
 */
var f_equipo_grilla = '';


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C1CDC05F-B541-43ED-BC4A-73A361C91362",variableType:4}
 */
var f_tipo_grilla = 0;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"70332067-B856-4CFF-8515-AE555FE20564"}
 */
var f_marca_grilla = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A2CB9102-62D4-4076-806A-059D06A0381C"}
 */
var f_modelo_grilla = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2D0C2596-9561-41B9-BA3A-1D3EFD8E124E"}
 */
var f_en_uso_grilla = '';


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"DFEA7EE0-9828-466F-B5D7-330C523F68F8",variableType:4}
 */
var f_filtro_con_soporte = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E04285EC-99C5-49D6-AA88-781D79377D89",variableType:4}
 */
var f_filtro_mostrar_ficha_con_cierre = 0
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"11E282E0-BDA7-47BB-AB1A-A0CD8CF7634B",variableType:4}
 */
var f_peso_predicho = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FC645315-653B-40E7-9DE5-691AD8D1C356",variableType:4}
 */
var f_peso_estimado = 0;



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E0233AF8-B127-4C7A-8B46-34696FB7DCEA",variableType:4}
 */
var f_tension_arterial_min = 0;



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A7BCCEEC-706A-49BA-9FF0-A666507DC533",variableType:4}
 */
var f_tension_arterial_max = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"43876615-0957-4992-9BD5-64DF44D1ACF1",variableType:4}
 */
var f_frecuencia_cardiaca = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"90FEC065-C8AF-4345-81B3-B1737D8A8620",variableType:4}
 */
var f_rass = 0;



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BAB94709-D5BA-4B75-93D3-51CE6107C26B",variableType:4}
 */
var f_frecuencia_respiratoria = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C54E922F-C971-45A1-8828-0F8AD5573E35",variableType:4}
 */
var f_cpot = 0;


/**
 * @properties={typeid:35,uuid:"98D5252A-8B0A-4819-AC81-82B2B4A03FCB",variableType:-4}
 */
var f_soporte = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"47FEB5E7-D028-4790-A5D9-946759FB8731"}
 */
var f_diagnostico = '';


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"EBE470B7-F434-4667-8028-7CD4EA5D22BB",variableType:4}
 */
var f_temperatura = 0;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"79923B07-4A4C-405A-81DC-BC90A1DD6765"}
 */
var f_tipo_temperatura = ' ';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8FD88F5D-0066-4EDB-820C-EE169B7BB516"}
 */
var f_tipo_sonda = ' ';



/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8B57803D-57E7-4DE1-B0BF-B321DD428AB8"}
 */
var f_patologia1 = '';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"35A14ECA-DCFF-4627-8439-53F58B785421"}
 */
var f_patologia2 = '';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9165D832-0731-4761-8E79-E3A2E9AF9426"}
 */
var f_patologia3 = '';



/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"11FA59A2-E416-4089-AED9-2AB51A21D75C"}
 */
var f_patologia = '';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"420B3C3C-78F7-43FD-B4A2-D6C833FE1327"}
 */
var f_descripcion_patologia1 = '';



/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"32E6078A-B233-40FD-B561-7E0645ADA905"}
 */
var f_descripcion_patologia2 = '';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"18BEBB2D-F4F2-4D4C-AC8F-355F17180E8E"}
 */
var f_descripcion_patologia3 = '';



/**
 * @properties={typeid:35,uuid:"A2293FE7-485B-4042-942C-75C0E041B145",variableType:-4}
 */
var f_cerrarForm = false;


/**
 * @properties={typeid:35,uuid:"AEC05BA5-64D4-4CC8-B48D-18AB635A13D8",variableType:-4}
 */
var $isDirty = false;

//var isView

/**
 * @properties={typeid:35,uuid:"BED0B5C1-B610-49E1-8B8A-6A2126443B92",variableType:-4}
 */
var isCloseAnestheticCardVisible = false;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BAAF1D7F-36EC-42E6-A507-89172B3D5D8F",variableType:4}
 */
var f_protocolo = null;



/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"699F77CE-4D2F-48A2-9728-E0E273A52FD8"}
 */
var $messageErrorInter = null;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9AEF98E6-6CBD-41D7-BB0D-35351470C7D1"}
 */
var f_medico = null;



/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"607F0D7B-0943-4E32-A7DD-FF4CE7545E24"}
 */
var f_edad = null;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2E6DFCAD-0B2A-4127-A686-C3E7D3C8C14C"}
 */
var f_cobertura = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"A8D84F36-187B-4DCC-AB78-5FF5B3F6D2DD"}
 */
var f_histClinUnica = null;


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"AEEE9A33-C5B6-4B8D-8633-5F31B25A118C"}
 */
var f_paciente = null;


/**
 * @properties={typeid:35,uuid:"14383B0A-B568-4947-91BE-1670EF306FC0",variableType:-4}
 */
var $_AsiVm_READ_ONLY = false;


/**
 * @properties={typeid:35,uuid:"FC86495A-6448-4D21-A88D-97D360866F1A",variableType:-4}
 */
var $_AsiVm_Recurso_Tomado = false;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BE105F89-4748-4BDC-8FE5-4FF6CE8351DD",variableType:4}
 */
var fcual_es = null;


/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"5DE8F2CF-2219-45AF-84D4-B3F9BD84119D",variableType:93}
 */
var ffechaHasta = null;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7A9F83F9-846B-40B5-A783-623CF624BB6B",variableType:4}
 */
var festado = 1;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3CAF73DE-65B6-4E37-A8AB-78E2FBC20193",variableType:4}
 */
var fhiscli_unico = null;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"EF9F1D93-7575-4D97-A533-0AF903075E95",variableType:93}
 */
var ffecha_desde = null;


/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"8ABF09DD-6A36-4E70-AB7A-A473CDFD8095",variableType:93}
 */
var ffecha_hasta = null;

/**
 * TODO generated, please specify type and doc for the params
 * @param event
 *
 * @properties={typeid:24,uuid:"53F317A9-1649-429F-A8C7-56A0AEE45AA2"}
 */
function onAction_limpiar(event) {
//event.getElementName()
/*if (event.getElementName() == 'limp_fecha')
	{ffecha = null}

if (event.getElementName() == 'limp_fhiscli_unico')
	{fhiscli_unico = null}
	
if (event.getElementName() == 'limp_estado')
	{festado = null}*/
	f_paciente = ''
	f_edad = ''
//	histcli = 0 //genera ruido.
	forms.AsiVm_ficha_kine.foundset.clear()
	elements.btn_generar_ficha.visible=false
	isCloseAnestheticCardVisible = false
	f_filtro_mostrar_ficha_con_cierre=0
	f_sexo = 0
	f_ingreso_uci = null
	f_histClinUnica = null
	globals.AsiVm_adm_HistClin = 0
	scopes.globals.AsiVm_hisclin= 0
	ffecha_desde=application.getServerTimeStamp()
	ffecha_hasta=application.getServerTimeStamp()
	ffecha_hasta = new Date(ffecha_hasta.getFullYear(), ffecha_hasta.getMonth(), ffecha_hasta.getDate(), 23,59,59,0)
	ffecha_desde = new Date(ffecha_desde.getFullYear(), ffecha_desde.getMonth(), ffecha_desde.getDate(), 0,0,0,0)
	ffecha_desde = ffecha_desde.setDate(ffecha_desde.getDate() - 20);
	ffecha_desde = ffecha_desde.setMonth(ffecha_desde.getMonth() - 2)
}


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7A5B1F5E-F6D8-4D6D-BF44-37717896D615"}
 */
var f_vm_txt_histclin = '';

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B934497B-8BF9-413E-B81B-93F4183328F1"}
 * @AllowToRunInFind
 */
function onAction_buscar(event) {
	
//	if(isCloseAnestheticCardVisible==true){
//		databaseManager.addTableFilterParam("admisionscroll","tbc_admision_scroll","adm_fecaltaefec",'!=',0);
//	}else{
//		databaseManager.addTableFilterParam("admisionscroll","tbc_admision_scroll","adm_fecaltaefec","=",0);
//	}
	globals.AsiVm_paciente = f_paciente;
	if (globals.AsiVm_paciente != '' && globals.AsiVm_paciente != null) {
		globals.AsiVm_eventSourceButton = 0;
		openSearch();
		//$isDirty = true;
	} else {
		//globals.DIALOGS.showWarningDialog("Atención", 'Debe ingresar Nro. de paciente o apellido.', "Aceptar")
		forms.AsiVm_ficha_kine.cargarDatosPaciente(); 
	}

	
	return true
}

/**
 * TODO generated, please specify type and doc for the params
 * @param event
 *
 * @properties={typeid:24,uuid:"DCF5925A-BDB7-469D-9B07-7D0834869454"}
 */
function onAction_imprimir(event) {
//	elements.lbl_procesando2.visible = true 

	
	//sacar estadisticas
	/*var sqlMax = "select MIN() FROM tbl_ficha_kine where fecha_inicio!=null";
	var ds_info_max = databaseManager.getDataSetByQuery('desal',sqlMax,null,-1)
	*/
//	select fk.histcli, max(fk.fecha_inicio)
//	from tbl_ficha_kine fk  
//	full JOIN tbl_ficha_cierre_kine fck 
//	on fk.histcli_unico=fck.histcli_unico  group by fk.histcli
	
	var sqlSeguimiento = "select fk.histcli, max(fk.fecha_inicio) from tbl_ficha_kine fk ";
	sqlSeguimiento = sqlSeguimiento+" full JOIN tbl_ficha_cierre_kine fck on fk.histcli_unico=fck.histcli_unico where fck.fecha_fin_ventilacion is null group by fk.histcli";
	var ds_segui = databaseManager.getDataSetByQuery('desal',sqlSeguimiento,null,-1)
	
    application.updateUI()
//	var $params = {
//		titulo : 'EN SEGUIMIENTO'
//	}
//	var fileName = "c:/temp/RP-SEGUIMIENTO-VM";
	
    var $ds2 = databaseManager.createEmptyDataSet()
	$ds2.addColumn('nombre',1,JSColumn.TEXT)
//	$ds2.addColumn('nombre',1,JSColumn.TEXT)
	
	$ds2.addColumn('prestacion',2,JSColumn.TEXT)
	$ds2.addColumn('fecha',3,JSColumn.TEXT)
	$ds2.addColumn('histclinica',4,JSColumn.NUMBER)
	$ds2.addColumn('cod_int',5,JSColumn.NUMBER)
	

	//var fileNameJasper = 'LB-CIRUAMBU.jasper';
	// Generando PDF
	//plugins.jasperPluginRMI.compileReport("intervencion_quirurgica_lst.jrxml");			
//    plugins.jasperPluginRMI.runReport(dsExport,'LB-CIRUAMBU.jasper', fileName + '.pdf',plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
	var pacientesEnArm = 0
	for (var index = 1; index <= ds_segui.getMaxRowIndex(); index++) {
	
		globals.AsiVm_adm_HistClinPrin =ds_segui.getValue(index,1)
		scopes.globals.AsiVm_adm_HistClinResp=ds_segui.getValue(index,1)
		scopes.globals.AsiVm_histClinPrint=ds_segui.getValue(index,1)
//		asivm_rel_respirador
		scopes.globals.AsiVm_fechaPrint = ds_segui.getValue(index,2)
		scopes.globals.AsiVm_histcli_resp = ds_segui.getValue(index,1)
		if(asivm_rel_buscar_admision_print.adm_fecepic==0 && asivm_rel_buscar_admision_print.adm_fecaltaefec==0 && asivm_rel_join_respirador_seguimiento.rsp_enuso==1){ // si tiene epicris y la ficha no se cerro, no deberia aparecer como paciente en seguimiento. Tampoco si no tiene equipo asignado.
			pacientesEnArm++
			var nombre = utils.stringTrim(asivm_rel_buscar_admision_print.adm_apelnom);
			var prestacionValor = ''
			switch (asivm_rel_buscar_fichavm_print.prestacion) {
			case 1:
			prestacionValor = 'VM'
				break;
			case 2:
			prestacionValor = 'VNI'
			break;
			case 3:
			prestacionValor = 'CAF'
			break;
			} 
			$ds2.addRow([nombre,prestacionValor,utils.dateFormat(asivm_rel_buscar_fichavm_print.fecha_inicio_ventilacion,'dd/MM/yyyy hh:mm:ss'),ds_segui.getValue(index,1),asivm_rel_join_respirador.rsp_codint==undefined?"":asivm_rel_join_respirador.rsp_codint])
					
		}
	
	}
    
	// imprimir en excel
//	var csv = $ds2.getAsText(',','\n','"',true);
//	var js = plugins.file.showFileSaveDialog('seguimiento.xls', 'Select location to save export file');
//	if (!js) return;
//	var success = plugins.file.writeTXTFile(js, csv, 'UTF8', 'application/vnd.ms-excel')
	
	//imprimir en jasper
	var $params = {
		titulo: 'Seguimientos',
		param_cant_pacientes_arm: asivm_rel_join_respirador_en_uso.getSize(),
		param_cant_equipos_disponibles: asivm_rel_join_respirador_sin_uso.getSize()
	}
	var fecha_reporte = utils.dateFormat(application.getTimeStamp(),'dd-MM-yyyy')
	var $arch = plugins.file.showFileSaveDialog(('SEGUIMIENTO-KINE_'+fecha_reporte+'.pdf'))
	if($arch){
		plugins.jasperPluginRMI.runReport($ds2,'SEGUIMIENTO_KINE_RP.jasper',$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.PDF,$params)
		//	elements.lbl_procesando2.visible = false
	}
	else{
		//application.output("return 8")
		return
	}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param event
 *
 * @properties={typeid:24,uuid:"3F3E62D9-9935-4B52-87D4-723BD7FB981D"}
 */
function onAction_exportar_excel(event) {
//	elements.lbl_procesando2.visible = true
	application.updateUI() 

	var asc = function asc(arr) {
	  return arr.sort(function (a, b) {
	    return a - b;
	  });
	};
	
	var sum = function sum(arr) {
	  return arr.reduce(function (a, b) {
	    return a + b;
	  }, 0);
	};
	
	var mean = function mean(arr) {
	  return sum(arr) / arr.length;
	}; // sample standard deviation
	
	
	var quantile = function quantile(arr, q) {
	  var sorted = asc(arr);
	  var pos = (sorted.length - 1) * q;
	  var base = Math.floor(pos);
	  var rest = pos - base;
	
	  if (sorted[base + 1] !== undefined) {
//	    return sorted[base] + rest * (sorted[base + 1] - sorted[base]);
		return sorted[base] + rest * (sorted[base] - sorted[base]);
	  } else {
	    return sorted[base];
	  }
	};


//	elements.lbl_procesando2.visible = true
	application.updateUI() 

	//min
	var estadis = "	select min(edad), min(altura), min(sexo), min(lugar_internacion), min(con_soporte_ventilatorio), min(prestacion), min(peso_corporal_predicho),min(peso_estimado), min(sap2), min(mortalidad_predicha_sap2), min(score_charlson), min(sobrevida_diez_anio), min(derivacion), min(vm_tqt), min(vm_tqt_decanulacion), min(paliativos), min(complicaciones_sdra), min(complicaciones_pao2_fio2), min(complicaciones_shock) FROM tbl_ficha_kine";
	var ds_estadis = databaseManager.getDataSetByQuery('desal',estadis,null,-1)
	
	
	//MAX
	var estadisMax = "	select max(edad), max(altura), max(sexo), max(lugar_internacion), max(con_soporte_ventilatorio), max(prestacion), max(peso_corporal_predicho),max(peso_estimado), max(sap2), max(mortalidad_predicha_sap2), max(score_charlson), max(sobrevida_diez_anio), max(derivacion), max(vm_tqt), max(vm_tqt_decanulacion), max(paliativos), max(complicaciones_sdra), max(complicaciones_pao2_fio2), max(complicaciones_shock) FROM tbl_ficha_kine";
	var ds_estadisMax = databaseManager.getDataSetByQuery('desal',estadisMax,null,-1)
	
	
	//MEDIA
	var estadisMedia = "select AVG(edad), AVG(altura), AVG(sexo), AVG(lugar_internacion), AVG(con_soporte_ventilatorio), AVG(prestacion), AVG(peso_corporal_predicho),AVG(peso_estimado), AVG(sap2), AVG(mortalidad_predicha_sap2), AVG(score_charlson), AVG(sobrevida_diez_anio), 0 as derivacion, AVG(vm_tqt), AVG(vm_tqt_decanulacion), AVG(paliativos), AVG(complicaciones_sdra), AVG(complicaciones_pao2_fio2), AVG(complicaciones_shock) FROM tbl_ficha_kine";	
	var ds_estadisMedia = databaseManager.getDataSetByQuery('desal',estadisMedia,null,-1)
	//MEDIAN
	var estadisMediana = "select median(edad), median(altura), median(sexo), median(lugar_internacion), median(con_soporte_ventilatorio), median(prestacion), median(peso_corporal_predicho),median(peso_estimado), median(sap2), median(mortalidad_predicha_sap2), median(score_charlson), median(sobrevida_diez_anio), 0 as derivacion, median(vm_tqt), median(vm_tqt_decanulacion), median(paliativos), median(complicaciones_sdra), median(complicaciones_pao2_fio2), median(complicaciones_shock) FROM tbl_ficha_kine";
	var ds_estadisMediana = databaseManager.getDataSetByQuery('desal',estadisMediana,null,-1)
	
	
	//MEDIAN
	var allField = "select edad, altura, sexo, lugar_internacion, con_soporte_ventilatorio, prestacion, peso_corporal_predicho,peso_estimado, sap2, mortalidad_predicha_sap2, score_charlson, sobrevida_diez_anio, derivacion, vm_tqt, vm_tqt_decanulacion, paliativos, complicaciones_sdra, complicaciones_pao2_fio2, complicaciones_shock FROM tbl_ficha_kine";

	var ds_allField = databaseManager.getDataSetByQuery('desal',allField,null,-1)
	var obj = new Object();
	for (var p = 1; p <= ds_allField.getMaxColumnIndex(); p++) {
		obj[ds_allField.getColumnName(p)] = quantile(ds_allField.getColumnAsArray(p),.75);
	
	}
	
	//cuartil inclusivo
//	var array5 = new Array;
//	array5.push('QUARTILE 3') 
//	
//	var arrayend = Object.keys(obj).map(function (k) {
//	  return obj[k];
//	});
//	var union = array5.concat(arrayend)	
//	
		
//	var columnasExcel  = ['edad','altura', 'sexo', 'area',
//	'con soporte', 'prestacion', 'p. predicho', 'p. estimado', 
//	'sap2', 
//	'mortilidad predicha',
//	'mortalidad esperada por sapsii', 'charlson', 'sobrevida 10 años', 'derviacion', 'tqt', 
//	'tqt decanulación', 'paliativos', 'complicaciones sdra', 'complicaciones pao2 fio2'];
//	
	 var $ds2 = databaseManager.createEmptyDataSet()
	 	$ds2.addColumn('operacion',1,JSColumn.TEXT)   
		$ds2.addColumn('edad',2,JSColumn.INTEGER)   
		$ds2.addColumn('altura',3,JSColumn.INTEGER)
		$ds2.addColumn('sexo',4,JSColumn.INTEGER)
		$ds2.addColumn('area',5,JSColumn.INTEGER)
		$ds2.addColumn('con soporte',6,JSColumn.NUMBER)
		$ds2.addColumn('prestacion',7,JSColumn.NUMBER)
		$ds2.addColumn('p. predicho',8,JSColumn.NUMBER)
		$ds2.addColumn('p. estimado',9,JSColumn.NUMBER)
		$ds2.addColumn('sap2',10,JSColumn.NUMBER)
		$ds2.addColumn('mortalidad predicha',11,JSColumn.NUMBER)
		$ds2.addColumn('mortalidad sap2',12,JSColumn.NUMBER)
		$ds2.addColumn('charlson',13,JSColumn.NUMBER)
		$ds2.addColumn('sobrevida',14,JSColumn.NUMBER)
		$ds2.addColumn('derivacion',15,JSColumn.NUMBER)
		$ds2.addColumn('tqt',16,JSColumn.NUMBER)
		$ds2.addColumn('decanulacion',17,JSColumn.NUMBER)
		$ds2.addColumn('paliativos',18,JSColumn.NUMBER)
		$ds2.addColumn('sdra',19,JSColumn.NUMBER)
		$ds2.addColumn('pao2',20,JSColumn.NUMBER)
		
		//campos sin calcular.
		$ds2.addColumn('diasalsdra',21,JSColumn.NUMBER)
    $ds2.addColumn('PAFiO2',22,JSColumn.NUMBER)
    $ds2.addColumn('barotrauma',23,JSColumn.NUMBER)
    $ds2.addColumn('shock',24,JSColumn.NUMBER)
    $ds2.addColumn('diasdeshock',25,JSColumn.NUMBER)
    $ds2.addColumn('coma',26,JSColumn.NUMBER)
    $ds2.addColumn('diascoma',27,JSColumn.NUMBER)
    $ds2.addColumn('delirium',28,JSColumn.NUMBER)
    $ds2.addColumn('diasdelirium',29,JSColumn.NUMBER)
    $ds2.addColumn('fecha',30,JSColumn.NUMBER)
    $ds2.addColumn('1sat',31,JSColumn.NUMBER)
    $ds2.addColumn('diashasta1sat',32,JSColumn.NUMBER)
    $ds2.addColumn('cant.sat',33,JSColumn.NUMBER)
    $ds2.addColumn('analgesia',34,JSColumn.NUMBER)
    $ds2.addColumn('dias',35,JSColumn.NUMBER)
    $ds2.addColumn('sedacion',36,JSColumn.NUMBER)
    $ds2.addColumn('diaspropofol',37,JSColumn.NUMBER)
    $ds2.addColumn('diasbzdcp',38,JSColumn.NUMBER)
    $ds2.addColumn('bnm',39,JSColumn.NUMBER)
    $ds2.addColumn('diasbnm',40,JSColumn.NUMBER)
    $ds2.addColumn('modovmdia0',41,JSColumn.NUMBER)
    $ds2.addColumn('modovmdia1',42,JSColumn.NUMBER)
    $ds2.addColumn('modovmdia3',43,JSColumn.NUMBER)
    $ds2.addColumn('modovmdia7',44,JSColumn.NUMBER)
    $ds2.addColumn('modovmdia10',45,JSColumn.NUMBER)
    $ds2.addColumn('PEEPdia0',46,JSColumn.NUMBER)
    $ds2.addColumn('PEEPdia1',47,JSColumn.NUMBER)
    $ds2.addColumn('PEEPdia3',48,JSColumn.NUMBER)
    $ds2.addColumn('PEEPdia7',49,JSColumn.NUMBER)
    $ds2.addColumn('modovmdia7',50,JSColumn.NUMBER)
    $ds2.addColumn('PEEPdia10',51,JSColumn.NUMBER)
    $ds2.addColumn('PEEPtotdia0',52,JSColumn.NUMBER)
    $ds2.addColumn('PEEPtotdia1',53,JSColumn.NUMBER)
    $ds2.addColumn('PEEPtotdia3',54,JSColumn.NUMBER)
    $ds2.addColumn('PEEPtotdia7',55,JSColumn.NUMBER)
    $ds2.addColumn('PEEPtotdia10',56,JSColumn.NUMBER)
    $ds2.addColumn('Platdia0',57,JSColumn.NUMBER)
    $ds2.addColumn('Platdia1',58,JSColumn.NUMBER)
    $ds2.addColumn('Platdia3',59,JSColumn.NUMBER)
    $ds2.addColumn('Platdia7',60,JSColumn.NUMBER)
    $ds2.addColumn('Platdia10',61,JSColumn.NUMBER)
    $ds2.addColumn('DPdia0',62,JSColumn.NUMBER)
    $ds2.addColumn('DPdia1',63,JSColumn.NUMBER)
    $ds2.addColumn('DPdia3',64,JSColumn.NUMBER)
    $ds2.addColumn('DPdia7',65,JSColumn.NUMBER)
    $ds2.addColumn('DPdia10',66,JSColumn.NUMBER)
    $ds2.addColumn('Vtdia0',67,JSColumn.NUMBER)
    $ds2.addColumn('Vtdia1',68,JSColumn.NUMBER)
    $ds2.addColumn('Vtdia3',69,JSColumn.NUMBER)
    $ds2.addColumn('Vtdia7',70,JSColumn.NUMBER)
    $ds2.addColumn('Vtdia10',71,JSColumn.NUMBER)
    $ds2.addColumn('CRSdía0',72,JSColumn.NUMBER)
    $ds2.addColumn('CRSdía1',73,JSColumn.NUMBER)
    $ds2.addColumn('CRSdía3',74,JSColumn.NUMBER)
    $ds2.addColumn('CRSdía7',75,JSColumn.NUMBER)
    $ds2.addColumn('CRSdía10',76,JSColumn.NUMBER)
    $ds2.addColumn('Vt/PCPdia0',77,JSColumn.NUMBER)
    $ds2.addColumn('Vt/PCPdia1',78,JSColumn.NUMBER)
    $ds2.addColumn('Vt/PCPdia3',79,JSColumn.NUMBER)
    $ds2.addColumn('Vt/PCPdia7',80,JSColumn.NUMBER)
    $ds2.addColumn('Vt/PCPdia10',81,JSColumn.NUMBER)
    $ds2.addColumn('FRdia0',82,JSColumn.NUMBER)
    $ds2.addColumn('FR día 1',83,JSColumn.NUMBER)
    $ds2.addColumn('FR día 3',84,JSColumn.NUMBER)
    $ds2.addColumn('FR día 7',85,JSColumn.NUMBER)
	
	
	 $ds2.addColumn('FR dia 10',86,JSColumn.NUMBER)
    $ds2.addColumn('CO2dia0',87,JSColumn.NUMBER)
    $ds2.addColumn('CO2 dia 1',88,JSColumn.NUMBER)
    $ds2.addColumn('CO2 dia 3',89,JSColumn.NUMBER)
    $ds2.addColumn('CO2 dia 7',90,JSColumn.NUMBER)
    $ds2.addColumn('CO2 dia 10',91,JSColumn.NUMBER)
    $ds2.addColumn('Ratiodia0',92,JSColumn.NUMBER)
    $ds2.addColumn('Ratio dia 1',93,JSColumn.NUMBER)
    $ds2.addColumn('Ratio dia 3',94,JSColumn.NUMBER)
		
	$ds2.addColumn('Ratio dia 7	',95,JSColumn.NUMBER)
    $ds2.addColumn('Ratio dia 10',96,JSColumn.NUMBER)
    $ds2.addColumn('dialisis',97,JSColumn.NUMBER)
    $ds2.addColumn('balancedia0',98,JSColumn.NUMBER)
    $ds2.addColumn('balancedia1',99,JSColumn.NUMBER)
    $ds2.addColumn('balancedia2	',100,JSColumn.NUMBER)
    $ds2.addColumn('balancedia3',101,JSColumn.NUMBER)
    $ds2.addColumn('balancedia4',102,JSColumn.NUMBER)								
    			
  	$ds2.addColumn('balancedia5',103,JSColumn.NUMBER)
    $ds2.addColumn('balancedia6',104,JSColumn.NUMBER)
    $ds2.addColumn('balancedia7',105,JSColumn.NUMBER)
    $ds2.addColumn('balancedia8',106,JSColumn.NUMBER)
    $ds2.addColumn('balancedia9',107,JSColumn.NUMBER)
    $ds2.addColumn('balancedia10',108,JSColumn.NUMBER)
    $ds2.addColumn('balancetot',109,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia0',110,JSColumn.NUMBER)

   	$ds2.addColumn('SOFAdia1',111,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia2',112,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia3',113,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia4',114,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia5',115,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia6',116,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia7',117,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia8',118,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia9',119,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia10',120,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia11',121,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia12',122,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia13',123,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia14',124,JSColumn.NUMBER)
    $ds2.addColumn('SOFAdia15',125,JSColumn.NUMBER)
	
		
		for (var index = 1; index <= ds_estadis.getMaxRowIndex(); index++) {
			
			var array = new Array;
			array.push('MIN') 
			var array2 = new Array;
			array2.push('MAX') 
			var array3 = new Array;
			array3.push('MEDIA') 
			var array4 = new Array;
			array4.push('MEDIANA') 
			
			for (var j = 1; j < 20; j++) {
				array.push(ds_estadis.getValue(index,j)) 
				array2.push(ds_estadisMax.getValue(index,j)) 
				array3.push(ds_estadisMedia.getValue(index,j)) 
				array4.push(ds_estadisMediana.getValue(index,j)) 
			}
			$ds2.addRow(array)
//			application.output(array);
			$ds2.addRow(array2)
			$ds2.addRow(array3)
			$ds2.addRow(array4)
//			$ds2.addRow(union)
//			application.output(union);
//			[ds_segui.getValue(index,col)]
		}
	
	//	foundset.loadRecords(dataset);				
	//	 var bytes  = plugins.excelxport.excelExport($ds2,columnasExcel)
		// plugins.file.writeFile("estadistica.xls",bytes);
		
	
	/*var $arch = plugins.file.showFileSaveDialog('stadistics_vm-' + application.getIPAddress() + '.xls')
	if ($arch){
		plugins.jasperPluginRMI.runReport($ds2,'stadistics_vm.jasper',$arch.getAbsolutePath(),plugins.jasperPluginRMI.OUTPUT_FORMAT.XLS_1_SHEET,null)
		
		var $OS = application.getOSName();
		if (/Windows/.test($OS)) {
		    application.executeProgram("rundll32.exe", ["url.dll,FileProtocolHandler", $arch.getAbsolutePath()]);	      
	    } else if (/Linux|Freebsd/.test($OS)) {
	       application.executeProgram('xdg-open', $arch);
	    } else if (/Mac/.test($OS)) {
	       application.executeProgram('open', $arch);
	    }
	}*/
		
		var csv = $ds2.getAsText(',','\n','"',true);
//		var $arch = plugins.file.showFileSaveDialog('stadistics_vm-' + application.getIPAddress() + '.xls')
		var js = plugins.file.showFileSaveDialog('estadisticas_vm.xls', 'Select location to save export file');
		if (!js) return;

//		var success = plugins.file.writeTXTFile($arch.getAbsolutePath(),csv);
		var success = plugins.file.writeTXTFile(js, csv, 'UTF8', 'application/vnd.ms-excel');
		
	
		
		
		
	
	
//	elements.lbl_procesando2.visible = false

}


/**
 * @properties={typeid:24,uuid:"7A5682E0-5001-4796-B11C-5FA524BEE0B9"}
 * @AllowToRunInFind
 */
function cargarDatosPaciente(){
	//carga paciente en cabacera.
	
//	var buscarAdmision = "";
//	var ds_admision = databaseManager.getDataSetByQuery('desal',buscarAdmision,null,-1)

	if(scopes.globals.AsiVm_adm_HistClin!=0 && !globals.IsBlank(scopes.globals.AsiVm_adm_HistClin.toString())){
		var relacionBuscarPaciente = isCloseAnestheticCardVisible==1?asivm_rel_buscar_admision_con_alta:asivm_rel_buscar_admision
		if(relacionBuscarPaciente!=null && relacionBuscarPaciente.getSize()>0){
		elements.btn_generar_ficha.visible=true
		f_paciente = formatear_HistClinInter(relacionBuscarPaciente.adm_histclin) + ' ' + utils.stringTrim(relacionBuscarPaciente.adm_apelnom);
		f_histClinUnica = relacionBuscarPaciente.adm_histclinuni;
		globals.AsiVm_histClinUnica  = relacionBuscarPaciente.adm_histclinuni;
		f_sexo = relacionBuscarPaciente.adm_sexo;
		f_edad = globals.CalculoEdad(relacionBuscarPaciente.adm_fecnac) + ' ' + globals.vTipoEdad;
		
		var sqlDetalle = "select Det2,Det3,Det9 from tbc_detalle" //det2 y 3 //fecha y hora de ingreso
			   + " where Det1 = " + relacionBuscarPaciente.adm_histclin
			   + " and (Det8=2 or Det8=4)"
			   + " order by Det2 asc,Det3 asc";
			   
		var dsDetalle = databaseManager.getDataSetByQuery('asistencial',sqlDetalle,null,-1);
			if(dsDetalle.getMaxRowIndex()>0){
				var fechaIngresoUCI = globals.IntegerToDate(dsDetalle.getValue(1,1)); //hora
				var horaIngresoUCI = globals.AsiVm_convertNumberToHour_HHMM(dsDetalle.getValue(1,2)); //fecha			
				if(fechaIngresoUCI!=null  && !globals.IsBlank(horaIngresoUCI)){
					var horaAux = horaIngresoUCI.split(':')
					fechaIngresoUCI.setHours(Number(horaAux[0]), Number(horaAux[1]))
					f_ingreso_uci = fechaIngresoUCI
				}
				
			}
		
			
			

		realizarBusquedaGrilla();
		elements.btn_generar_ficha.visible=true
		elements.btn_generar_ficha.enabled=true
		}else{
			globals.DIALOGS.showWarningDialog("¡Aviso!", "El paciente no se encuentra en el sanatorio", "Aceptar")
		}
	}else{
//		elements.btn_generar_ficha.visible=false
		realizarBusquedaGrilla();
	}


}


/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"698CBF6A-79A9-4C3D-94BA-64F5106AF90B"}
 */
function realizarBusquedaGrilla(){
	//histcli=utils.numberFormat(globals.AsiVm_adm_HistClin, '#');
	
//	if(ffecha_desde>ffecha_hasta){
//		globals.DIALOGS.showWarningDialog("¡Error de Filtro!", "La fecha desde, no debe ser menor a la fecha actual", "Aceptar")
//		return true;
//	}
//	databaseManager.revertEditedRecords(foundset)
////	 asivm_rel_buscar_ficha_kine.find();
//	if(f_filtro_con_soporte!=null && f_filtro_con_soporte!=0 && f_filtro_con_soporte!=3){
//		foundset.con_soporte_ventilatorio=f_filtro_con_soporte
//	}
//	if(globals.AsiVm_adm_HistClin!=0){
//		asivm_rel_buscar_ficha_kine.histcli =  globals.AsiVm_adm_HistClin
//		 foundset.loadRecords(foundset)
//	}
//	    
//	if (ffecha_desde != null)
//		{forms.AsiVm_ficha_kine.foundset.fecha = '>=' + utils.dateFormat(ffecha_desde,'dd-MM-yyyy') +  '|dd-MM-yyyy'
//		
//		}  
			
			var sqlFicha =""
			var whereIs = false;
//			var cardCloseVisible = "";
//			if(!isCloseAnestheticCardVisible){
//				cardCloseVisible = "fecha_fin is null"
//			}else{
//				cardCloseVisible = "fecha_fin is not null"
//			}
			if(ffecha_desde!=null){
				sqlFicha = "select fk.ficha_id, fk.nombre_paciente, fk.fecha, fk.kinesiologo_lega, fk.histcli_unico, fk.histcli, fk.con_soporte_ventilatorio, fk.prestacion, fk.soporte_ventilatorio from tbl_ficha_kine fk left join tbl_ficha_cierre_kine fkc on(fkc.histcli=fk.histcli) where fk.fecha>='"+utils.dateFormat(ffecha_desde,'yyyy-MM-dd')+"'";
				whereIs=true
			}else{
				sqlFicha = "select fk.ficha_id, fk.nombre_paciente, fk.fecha, fk.kinesiologo_lega, fk.histcli_unico, fk.histcli, fk.con_soporte_ventilatorio, fk.prestacion, fk.soporte_ventilatorio from tbl_ficha_kine fk left join tbl_ficha_cierre_kine fkc on(fkc.histcli=fk.histcli) "
			}
			if(f_filtro_mostrar_ficha_con_cierre==1){
				sqlFicha=sqlFicha + " and fkc.histcli is not null "
			}else{
				sqlFicha=sqlFicha + " and fkc.histcli is null "
			}
			
			if(globals.AsiVm_adm_HistClin!=0){
				sqlFicha=whereIs==true?(sqlFicha+" and fk.histcli_unico="+globals.AsiVm_histClinUnica): (sqlFicha+" where fk.histcli_unico="+globals.AsiVm_adm_HistClin)
			}
			if(f_filtro_con_soporte!=0){
				if(f_filtro_con_soporte==3){
					sqlFicha=whereIs==true?(sqlFicha+" and fk.con_soporte_ventilatorio!="+f_filtro_con_soporte):(sqlFicha+" where fk.con_soporte_ventilatorio!="+f_filtro_con_soporte)
				}else{
					sqlFicha=whereIs==true?(sqlFicha+" and fk.con_soporte_ventilatorio="+f_filtro_con_soporte):(sqlFicha+" where fk.con_soporte_ventilatorio="+f_filtro_con_soporte)
				}
				
			}
			sqlFicha=sqlFicha + " order by fk.fecha desc"
	var dsFicha = databaseManager.getDataSetByQuery('desal',sqlFicha,null,-1);

//	var relacion = asivm_rel_buscar_ficha_kine.getSize()>0?asivm_rel_buscar_ficha_kine:asivm_rel_fichas_kine
			if(dsFicha.getMaxRowIndex()>0){
				
				var fichas = databaseManager.createEmptyDataSet();
				fichas.addColumn('f_id_ficha');
				fichas.addColumn('f_paciente_grilla');
				fichas.addColumn('f_fecha_grilla');

				fichas.addColumn('f_legajo_mec_grilla');
				fichas.addColumn('f_hisclin_unic_grilla');
				fichas.addColumn('f_histclin_grilla');
				fichas.addColumn('f_con_soporte_grilla');
				fichas.addColumn('f_prestacion_grilla');
			
				fichas.addColumn('f_tipo_grilla');
//				fichas.addColumn('f_equipo_grilla');
//				fichas.addColumn('f_marca_grilla');
//				fichas.addColumn('f_modelo_grilla');
//				fichas.addColumn('f_en_uso_grilla');
				for(var j=1; j<=dsFicha.getMaxRowIndex(); j++){
					scopes.globals.AsiVm_histcli_resp = dsFicha.getValue(j,6) 
					fichas.addRow([dsFicha.getValue(j,1) 
					,dsFicha.getValue(j,2) 
										,dsFicha.getValue(j,3) 
										,dsFicha.getValue(j,4) 
										,dsFicha.getValue(j,5) 
										,dsFicha.getValue(j,6) 
										,dsFicha.getValue(j,7) 
										,dsFicha.getValue(j,8) 
										,dsFicha.getValue(j,9) 
//										,asivm_rel_join_respirador.rsp_codint==undefined?"":asivm_rel_join_respirador.rsp_codint
//										,asivm_rel_join_respirador.rsp_marca==undefined?"":asivm_rel_join_respirador.rsp_marca
//										,asivm_rel_join_respirador.rsp_modelo==undefined?"":asivm_rel_join_respirador.rsp_modelo
//										,(asivm_rel_join_respirador.rsp_enuso==undefined)?"NO":(asivm_rel_join_respirador.rsp_enuso==1)?'SI':'NO'
										
										]);
				}
				//if(wCerrada == 1 && wImpresa == 0)
				//fichas.addRow([0,null,0,'NUEVA']);
					
//				var $tipos = [JSColumn.NUMBER,JSColumn.TEXT,JSColumn.DATETIME,JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.INTEGER,JSColumn.INTEGER,JSColumn.TEXT,JSColumn.TEXT,JSColumn.TEXT,JSColumn.TEXT];
				var $tipos = [JSColumn.NUMBER,
				JSColumn.TEXT,
				JSColumn.DATETIME,
				JSColumn.NUMBER,
				JSColumn.NUMBER,
				JSColumn.NUMBER,
				JSColumn.INTEGER,
				JSColumn.INTEGER,
				JSColumn.INTEGER,
				];
				//var $tipos = [JSColumn.TEXT,JSColumn.DATETIME,JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.NUMBER, JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.TEXT,JSColumn.TEXT,JSColumn.TEXT,JSColumn.TEXT];
				//forms.AsiVm_ficha_kine.foundset.clear()
				//forms.AsiVm_ficha_kine.foundset.find();
				
				var $frm = solutionModel.getForm('AsiVm_ficha_kine');
				$frm.dataSource = fichas.createDataSource('ds_kine2', $tipos);
				forms.AsiVm_ficha_kine.controller.recreateUI();
				forms.AsiVm_ficha_kine.controller.loadAllRecords()

}else
//	var $cuantos = asivm_rel_buscar_ficha_kine.search()
//	if ($cuantos < 1)	
	{
//		plugins.dialogs.showInfoDialog('Aviso', 'No hay Fichas en el rango solicitado', 'Aceptar');
		//siempre es posible agrega evoluciones
		forms.AsiVm_ficha_kine.foundset.clear()
	}
/*	fecha_inicio_vm timestamp,
	fecha_inicio_vni timestamp,
	fecha_inicio_caf timestamp,*/
		//foundset.sort('fecha desc')
}

/**
 * @properties={typeid:24,uuid:"77A9D4EF-B398-4E26-B557-E0FDBE119364"}
 */
function openSearch() {

	var win2 = application.createWindow("seleccion_internado", JSWindow.MODAL_DIALOG);
	win2.title = 'Búsqueda de Pacientes Internados';
	win2.resizable = false;
	win2.show(forms.AsiVm_dlg_buscar_internado);

}


/**
 * TODO generated, please specify type and doc for the params
 * @param event
 *
 * @properties={typeid:24,uuid:"FD923FA2-F44D-4BFE-8D19-D4C0242599CF"}
 */
function onAction_ver_detalle(event) {
	
	//selecciono ficha elegida
	scopes.globals.AsiVm_hisclin = foundset['f_histclin_grilla'];
	scopes.globals.AsiVm_adm_HistClin = foundset['f_histclin_grilla'];
//	scopes.globals.AsiVm_histClinPrint = foundset['f_histclin_grilla'];
	globals.AsiVm_fecha_Ficha = foundset['f_fecha_grilla'];
//	scopes.globals.AsiVm_fechaPrint = foundset['f_fecha_grilla'];
	globals.AsiVm_ficha_id =  foundset['f_id_ficha'];
//	scopes.globals.AsiVm_adm_HistClin = foundset['f_histclin_grilla'];
//	globals.AsiVm_ficha_id = asivm_fichakine.tbl_ficha_kine_id
	/*if(asivm_fichakine_detalle.getSize() > 0){
		
		
	}*/
	/*if(){
		
		
	}else{//ficha nueva
		
	}*/
	/*if (estado != 1){
		scopes.globals.fichaaneste_vmensaje = 'Ficha Anestésica abierta - No se permite la consulta.'
		//globals.DIALOGS.showInfoDialog('Aviso',scopes.globals.fichaaneste_vmensaje,"Aceptar")	
		plugins.dialogs.showInfoDialog('Aviso',scopes.globals.fichaaneste_vmensaje,"Aceptar")
		return}
	// las variables se usan en el form de armado de la grilla para mostrar y pra imprimir
	scopes.globals.fichaaneste_cab_id  = fichaaneste_cab_id
	scopes.globals.fichaaneste_vfecha_inicial = fecha_inicio
	scopes.globals.fichaaneste_pasomin = grilla_pasomin
	scopes.globals.fichaaneste_horas   = grilla_horas
	// para relacion vs_ficha_to_fichaaneste_cab_fechcarga
	scopes.globals.fichaaneste_histcliuni       = histcli_unico
	scopes.globals.fichaaneste_anes_carga_fecha = tbc_anest_carga_fecha
	scopes.globals.fichaaneste_anes_carga_hora  = tbc_anest_carga_hora
	
	fcual_es = foundset.getSelectedIndex()
	elements.esperando.visible =  true*/
	///application.updateUI()

	var $win3 = application.createWindow("consulta_ficha_kine",JSWindow.MODAL_DIALOG)
    $win3.title = " Ficha kinesiologica - Consulta "
    //$win.setSize(990,700)  
    $win3.show(forms.AsiVm_Ficha_Inicio)
	//$win3.hide() 
	$win3.destroy()	
	/*
	onAction_buscar(event)
	foundset.setSelectedIndex(fcual_es)
	*/
//	elements.esperando.visible =  false
//	application.updateUI()

	var t = 1  // solo para debugger, sacar luego
}



/**
 * @properties={typeid:24,uuid:"72B58F58-B526-40FA-9E0C-6CD086538391"}
 */
function cerrar_window() {
	/*
	var $win = application.getWindow(application.getActiveWindow().getName());
	if($win != null){
		$win.hide()
		$win.destroy*/
}


/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"450A1515-9B55-4977-B281-7213F4FC8B36"}
 */
function onShow(firstShow, event) {
	// control del elemento por perfil	
//	var $form = controller.getName()
	//globals.controlar_elementos($form)	
	// fin control del elemento por perfil
	
	scopes.globals.AsiVm_Fecha_dia = utils.dateFormat(application.getServerTimeStamp(),"dd/MM/yyyy")
//	scopes.globals.fichaaneste_modificacion = 0
	forms.AsiVm_ficha_kine.foundset.clear()
	ffecha_desde = null
	ffecha_hasta = null
	globals.AsiVm_equipos_disponibles = asivm_rel_join_respirador_disponibles.getSize()
	f_filtro_mostrar_ficha_con_cierre=0
	ffecha_desde = application.getServerTimeStamp() 
	//scopes.globals.fichaaneste_vfecha = ffecha
	ffecha_desde = new Date(ffecha_desde.getFullYear(), ffecha_desde.getMonth(), ffecha_desde.getDate(), 0,0,0,0)	
	ffecha_desde = ffecha_desde.setDate(ffecha_desde.getDate() - 20);
	ffecha_desde = ffecha_desde.setMonth(ffecha_desde.getMonth() - 2)
	ffecha_hasta  = application.getServerTimeStamp() 
	fhiscli_unico = null
	festado = null  // 02-08-2019  mostrar todos en la lista pero solo ver detalle su estado = 1
	application.updateUI();
//	// Inicializando impresion
//	forms.AsiVm_Print.onShow_inicializarForm(true,null);
	// TODO 08-08-2019
	//*//*onAction_buscar(event)
	
}


/**
 * Called before the form component is rendered.
 *
 * @param {JSRenderEvent} event the render event
 *
 * @properties={typeid:24,uuid:"4393EEA5-554D-4399-8A85-197809838428"}
 */
function onRender_estado(event) {

	var $reg = event.getRecord()
	if($reg.estado == 0)
		{event.getRenderable().fgcolor = '#ff0000'}
	else
		{event.getRenderable().fgcolor = '#000080'}
		//{event.getRenderable().fgcolor = '#00ff00'}
}

/**
 * Handle changed data.
 *
 * @param {Date} oldValue old value
 * @param {Date} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"ED8196D9-AF49-477D-A66C-6DFB49125FBE"}
 */
function onDataChange_ffecha(oldValue, newValue, event) {
	if (ffecha_desde == null || ffecha_desde == 0)
		return true;

	ffecha_desde = new Date(ffecha_desde.getFullYear(), ffecha_desde.getMonth(), ffecha_desde.getDate(), 0,0,0,0)
//	ffecha_hasta = new Date(ffecha_hasta.getFullYear(), ffecha_hasta.getMonth(), ffecha_hasta.getDate(), 23,59,59,0)
	
	realizarBusquedaGrilla()
	return true
}


/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D2E60940-8E4A-47B1-BE83-9BB0E1FB3998"}
 */
function onAction_refresh(event) {
	var indice = foundset.getSelectedIndex()
	var hay = foundset.getSize()
	for (var i = 1 ; i < hay + 1 ; i++)  
	{
		foundset.setSelectedIndex(i)
		foundset.getSelectedIndex()
		databaseManager.refreshRecordFromDatabase(foundset,i)
	}
	if (indice > 0) 
		{foundset.setSelectedIndex(indice)}
	else
		{foundset.setSelectedIndex(1)}
}


/**
 * TODO generated, please specify type and doc for the params
 * @param value
 *
 * @properties={typeid:24,uuid:"5081047F-2986-44F1-8973-A7339C51C0B3"}
 */
function formatear_HistClinInter(value)
{
	var hiscli1 = value.toString();
	switch (hiscli1.length){
		case 2:	hiscli1 = hiscli1.substr(0,1)+'/'+hiscli1.substr(1,1);break;
		case 3:	hiscli1 = hiscli1.substr(0,2)+'/'+hiscli1.substr(2,1);break;
		case 4:	hiscli1 = hiscli1.substr(0,3)+'/'+hiscli1.substr(3,1);break;
		case 5:	hiscli1 = hiscli1.substr(0,4)+'/'+hiscli1.substr(4,1);break;
		case 6:	hiscli1 = hiscli1.substr(0,5)+'/'+hiscli1.substr(5,1);break;
		case 7:	hiscli1 = hiscli1.substr(0,6)+'/'+hiscli1.substr(6,1);break;
		case 8:	hiscli1 = hiscli1.substr(0,7)+'/'+hiscli1.substr(7,1);break;
	}	
	return hiscli1;
}


/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"62701761-CCAF-42B7-8E42-88B12F2E15F8"}
 */
function onActionGenerarFicha(event) {
	// TODO Auto-generated method stub
	/*var histClinFicha = 0;
	if(f_vm_txt_histclin)
		if(isNaN(f_vm_txt_histclin)){ //Si no es numero es true!!
				//esnumero=false
			scopes.globals.AsiVm_apellido = f_vm_txt_histclin;
			histClinFicha = asivm_apellido_to_tbc_admision_scroll.adm_histclin
		}else{
			//asivm_numero_to_asistencial_admision.h
			histClinFicha = f_vm_txt_histclin
		}
		asivm_fichakine.newRecord();
		asivm_fichakine.histcli = histClinFicha;*/
		
	//forms.tbl_ficha_kine_carga.c
	
		// var $cab = vs_ficha_to_fichaaneste_cab_unico
		/*var $cab = asivm_fichakine;
	 	forms.tbl_ficha_kine_carga.*/
	
	
//		globals.AsiVm_hisclin = 0
		globals.AsiVm_fecha_Ficha = null
		
		if(globals.AsiVm_adm_HistClin==0){
			globals.DIALOGS.showInfoDialog('Atención','Debe elegir un paciente','Aceptar')
			return
		}{
			var win2 = application.createWindow("ficha inicio", JSWindow.MODAL_DIALOG);
			win2.title = 'Ficha inicio';
			win2.resizable = false;
			win2.show(forms.AsiVm_Ficha_Inicio);
		}
	
		
		
		
		
	
	//if (vs_ficha_to_fichaaneste_cab_unico) {  // estado = 0  no srive =asi puede abrir mas de una
		//scopes.globals.fichaaneste_modificacion = 0
	/*	$cab.newRecord()
		$cab.histcli       = scopes.globals.AsiVm_adm_HistClin
		$cab.histcli_unico = scopes.globals.AsiVm_histClinUnica;
//		$cab.estado        = 0
		$cab.anestesiologo_legajo = scopes.globals.fichaaneste_anestesiologo_legajo
		$cab.anestesiologo_lega   = globals.vLega
		//$cab.anestesiologo_tipo   = scopes.globals.vTipoMedico
		$cab.anestesiologo_tipo   = globals.vTipoOperador
		forms.fichaaneste_encabezado.fanestesiologo = scopes.globals.fichaaneste_anestesiologo_nombre
		$cab.cirujano_legajo      = null  // se debe ingresar
		$cab.edad        = scopes.globals.CalculoEdad(scopes.globals.fichaaneste_vfecnac)
		$cab.sexo        = scopes.globals.vSexo 
		$cab.habitacion  = scopes.globals.fichaaneste_vhabita
		$cab.piso        = null*/
				
		
	
	
}


/**
 * @properties={typeid:24,uuid:"D752E06D-AC9C-4EDB-9587-96C61E5C72E0"}
 */
function pacienteSeleccionadoInter() {

	globals.AsiVm_nroHabi = asivm_rel_buscar_admision.adm_habita;
	//globals.AsiVm_alerHistClin = asivm_rel_buscar_admision.adm_histclin;
	
	//ACC-HCL
	if(isValidDatosPacienteInter()){
		
		//CARGO-ADMISION
		editablePaciente(false);
		$isDirty = true;
		f_paciente = formatear_HistClinInter(asivm_rel_buscar_admision.adm_histclin) + ' ' + utils.stringTrim(asivm_rel_buscar_admision.adm_apelnom);
		f_histClinUnica = asivm_rel_buscar_admision.adm_histclinuni;
		f_sexo = asivm_rel_buscar_admision.adm_sexo;
		f_edad = globals.CalculoEdad(asivm_rel_buscar_admision.adm_fecnac) + ' ' + globals.vTipoEdad;
		f_habita = asivm_rel_buscar_admision.adm_habita;
		f_cama = asivm_rel_buscar_admision.adm_cama;
		globals.AsiVm_obrCodigo = asivm_rel_buscar_admision.adm_obrsoc;
		//f_cobertura = utils.stringTrim(asivm_rel_buscar_obrasocial.obr_razonsoc);
		//f_derivado = '';
		
		// Fecha de ingreso a Sanatorio
		var fechaIngreso = asivm_rel_buscar_admision.adm_fecing.toString().substr(6, 2) + "/" + asivm_rel_buscar_admision.adm_fecing.toString().substr(4, 2) + "/" + asivm_rel_buscar_admision.adm_fecing.toString().substr(0, 4);
		var hora = convertNumberToHour_HHMM(asivm_rel_buscar_admision.adm_horing);
		var horaAux = hora.split(':')
		var fechaDesde = globals.IntegerToDate(asivm_rel_buscar_admision.adm_fecing);
		fechaDesde.setHours(Number(horaAux[0]), Number(horaAux[1]));
		//var fechaActual = utils.timestampToDate(application.getServerTimeStamp());
		var fechaActual = application.getServerTimeStamp();
		var dias = contar_dias(fechaDesde, fechaActual);
		
		var fechaHora = fechaIngreso + "  " + convertNumberToHour_HHMM(asivm_rel_buscar_admision.adm_horing);
		f_ingresoSanatorio = fechaHora;
		var info = "Ingresó al Sanatorio : " + fechaHora + " Hrs." + "   " + dias + " días de Internado";

		//BUSCO-DETALLE-UCO
		//var wAmdEgr = 0;
		var wAmdIng = 0;
		var wHorIng = 0;
		var wCerrada = 0;
		var sqlDetalle = "select Det2,Det3,Det9 from tbc_detalle"
					   + " where Det1 = " + asivm_rel_buscar_admision.adm_histclin
					   + " and Det8 in (4,5)"
					   + " order by Det2,Det3";
					   
		var dsDetalle = databaseManager.getDataSetByQuery('asistencial',sqlDetalle,null,-1);
		for(var i= 1; i<=dsDetalle.getMaxRowIndex(); i++){
			
			if(dsDetalle.getValue(i,3) > 0)
				wCerrada = 1;
			
			//wAmdEgr = dsDetalle.getValue(i,3);
			wAmdIng = dsDetalle.getValue(i,1);
			wHorIng = dsDetalle.getValue(i,2);
		}
		
		//Fecha de ingreso a UCO
		fechaIngreso = wAmdIng.toString().substr(6, 2) + "/" + wAmdIng.toString().substr(4, 2) + "/" + wAmdIng.toString().substr(0, 4);
		hora = convertNumberToHour_HHMM(wHorIng);
		horaAux = hora.split(':')
		fechaDesde = globals.IntegerToDate(asivm_rel_buscar_admision.adm_fecing);
		fechaDesde.setHours(Number(horaAux[0]), Number(horaAux[1]));
		dias = contar_dias(fechaDesde, fechaActual);
		
		fechaHora = fechaIngreso + "  " + convertNumberToHour_HHMM(asivm_rel_buscar_admision.adm_horing);
		f_ingresoUco = fechaHora;
		
		info +=  "\n" + "Ingresó al Serv. UCO : " + fechaIngreso + "  " + convertNumberToHour_HHMM(asivm_rel_buscar_admision.adm_horing) + " Hrs." + "   " + dias + " días en Serv. UCO";
		info += "\n\n" + "Domicilio : " + utils.stringTrim(asivm_rel_buscar_admision.adm_domicilio) + "  T.E. : " + utils.stringTrim(asivm_rel_buscar_admision.adm_telefefono);
		info += "\n" + "Resp.Solidario : " + utils.stringTrim(asivm_rel_buscar_admision.adm_nomrespon) + "  T.E. : " + utils.stringTrim(asivm_rel_buscar_admision.adm_telefrespon);
		
		globals.DIALOGS.showInfoDialog('Atención',info,'Aceptar')
	
		//BUSCO- FICHAS
		var wImpresa = 0;
		var histclin = asivm_rel_buscar_admision.adm_histclin;
		var sqlHojaUco = "select HucFecha,HucHora,HucImpresa from tbc_hojauco"
					  + " where  HucHiscli = " + histclin
					  + " and HucFecha >= " + asivm_rel_buscar_admision.adm_fecing
					  + " order by HucFecha,HucHora";
		var dsHojaUco = databaseManager.getDataSetByQuery('asistencial',sqlHojaUco,null,-1);
		
		if(dsHojaUco.getMaxRowIndex() >= 1){ //|| (dsHojaUco.getMaxRowIndex() == 1 && wCerrada == 1)
			
			//siempre es posible agrega evoluciones
			var dsHojaUcoAux = databaseManager.createEmptyDataSet();
			dsHojaUcoAux.addColumn('id');
			dsHojaUcoAux.addColumn('fecha');
			dsHojaUcoAux.addColumn('hora');
			dsHojaUcoAux.addColumn('texto');
			
			for(var j=1; j<=dsHojaUco.getMaxRowIndex(); j++){
				
				if(dsHojaUco.getValue(j,3) == 0)
					wImpresa = 1;
				
				fechaIngreso = dsHojaUco.getValue(j,1);
				dsHojaUcoAux.addRow([histclin
									,dsHojaUco.getValue(j,1)
									,dsHojaUco.getValue(j,2)
									,fechaIngreso.toString().substr(6, 2) + "/" + fechaIngreso.toString().substr(4, 2) + "/" + fechaIngreso.toString().substr(0, 4) + "  " + convertNumberToHour_HHMM(dsHojaUco.getValue(j,2))
									]);
			}
			
			//if(wCerrada == 1 && wImpresa == 0)
			dsHojaUcoAux.addRow([0,0,0,'NUEVA']);
				
			var $tipos = [JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.TEXT];
			var $frm = solutionModel.getForm('AsiVm_tbl_hciuco');
			$frm.dataSource = dsHojaUcoAux.createDataSource('ds_hciuco', $tipos);
			forms.AsiVm_tbl_hciuco.controller.recreateUI();
			
			var win2 = application.createWindow("seleccion_hciuco", JSWindow.MODAL_DIALOG);
			win2.title = 'Evolución de servicio UCO';
			win2.resizable = false;
			win2.show(forms.AsiVm_tbl_hciuco);
		}
		else{
			
			//hci a uco sin cerrar
			/*if(dsHojaUco.getMaxRowIndex() == 1){
				
				globals.AsiVm_hiuFecha = dsHojaUco.getValue(1,1);
				globals.AsiVm_hiuHora = dsHojaUco.getValue(1,2);
				globals.AsiVm_hiuHisCli = histclin;
			}*/
			
			loadData();
		}
	}
	else{
		
		elements.txt_paciente.requestFocus();
	}
}


/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"2DC52C63-AEB3-4210-BC6A-9619FCB61665"}
 */
function onActionBuscarPaciente(event) {
	// TODO Auto-generated method stub
	elements.btn_buscar.requestFocus();
}


/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"81E4EB4E-743B-4577-BB79-652A762DD946"}
 */
function onFocusLostBuscarPaciente(event) {
	// TODO Auto-generated method stub
	onAction_buscar()
}


/**
 * Handle changed data.
 *
 * @param {Number} oldValue old value
 * @param {Number} newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"CD1E926C-C91C-453E-B993-3746734D739C"}
 */
function onDataChangeFiltroSoporte(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	
	realizarBusquedaGrilla()
	return true
}


/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"0C93BF20-0DF4-41EE-B43A-E0562EED6F1D"}
 */
function onActionResetDateDesde(event) {
	// TODO Auto-generated method stub
	ffecha_desde = new Date(ffecha_desde.getFullYear(), ffecha_desde.getMonth(), ffecha_desde.getDate(), 0,0,0,0)
	ffecha_desde = ffecha_desde.setDate(ffecha_desde.getDate() - 20);
	ffecha_desde = ffecha_desde.setMonth(ffecha_desde.getMonth() - 2)
	realizarBusquedaGrilla()
	
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"1734E4B0-D3C5-4350-89D8-13EA9BD2EAD4"}
 */
function onDataChangeVerFichaCerrada(oldValue, newValue, event) {
	// TODO Auto-generated method stub
	if(newValue==1){
		elements.btn_generar_ficha.enabled=false
		f_filtro_mostrar_ficha_con_cierre = newValue
	}else{
		elements.btn_generar_ficha.enabled=true
		f_filtro_mostrar_ficha_con_cierre = newValue
	}
	realizarBusquedaGrilla()
	return true
}
