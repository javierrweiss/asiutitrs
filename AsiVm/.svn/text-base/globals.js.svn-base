/**
 * @properties={typeid:35,uuid:"82A8F5BA-ED75-44E2-884C-A52ABEA1D328",variableType:-4}
 */
var AsiVm_bloqueado = false;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"54CF65F0-0FD0-4763-BB78-CFF7C851C59A",variableType:4}
 */
var AsiVm_codAutoHist = 0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D8560FD1-BCEF-4DBD-A194-077C0B23BBF1",variableType:4}
 */
var AsiVm_histcli_resp = 0
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5F4A95A1-1B1E-4D14-BAA9-169F5B67D49D",variableType:8}
 */
var AsiVm_alerHistClin = 0;

/**
 * @properties={typeid:35,uuid:"215D9E7B-19E1-47E5-9046-A50C4087501B",variableType:-4}
 */
var errorDato = true


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6B64F1BE-E642-4596-BB3A-AE89DC192E8F",variableType:4}
 */
var AsiVm_estado_uso_equipo = 0
//CAMPOS PARA IMPRIMIR
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6B3737B4-9937-4EE0-865F-41A15F55DC26",variableType:4}
 */
var AsiVm_histClinPrint = 0

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"C8394C22-B6ED-4D21-A9AE-C382FE14966E"}
 */
var AsiVm_fecha_null_con_soporte = ''

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"46C36496-6B54-480B-8371-FB2A5C9B74E7",variableType:4}
 */
var AsiVm_medCodigoPrint=0
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"86B12E10-A0AA-4A73-BDD3-CF9BAB166AEA",variableType:4}
 */
var AsiVm_perLegajoPrint = 0
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"DFF7CCCC-B879-422D-920D-B89D0E0A455F",variableType:4}
 */
var AsiVm_hcUnicaPrint=0
/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"FACCA525-9BC3-4D3B-920D-418A9D85EF49",variableType:93}
 */
var AsiVm_fechaPrint = null

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5735D789-61DB-4D49-8CD0-F315DE54FF5E",variableType:4}
 */
var AsiVm_ficha_id = 0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6DE660BB-C530-4FB8-96B9-55FB1209D9F3",variableType:4}
 */
var AsiVm_tipo = 0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5F6F7E0F-62FC-409B-A954-6D9E9D46FC6D",variableType:4}
 */
var AsiVm_observacion_id = 0;
/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"D15EE133-F5A1-4E4F-9F92-23E9ADB34BA8",variableType:93}
 */
var AsiVm_fecha_observacion = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"58EFB68D-3A31-4D01-9BDC-22630ED992D3"}
 */
var AsiVm_fecha_obs = ''
/**
 * @properties={typeid:35,uuid:"A48F4186-C2F3-40FD-9676-D03717AB7D42",variableType:-4}
 */
var AsiVm_Monitoreo_bloqueado= false;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4A726568-8F26-4AC1-8737-EAAF87E83757",variableType:4}
 */
var AsiVm_monitoreo_id=0



/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"758B297A-8F1A-40D0-9C4A-7A4AB0027A61",variableType:93}
 */
var AsiVm_fecha_monitoreo= null

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"189D1B9B-DDB2-4923-BD0D-153BAB1A7D71",variableType:4}
 */
var AsiVm_Estado_Aislamiento=0;



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A5ABD39C-8558-4E4E-9693-DCAA28892A73",variableType:4}
 */
var AsiVm_diagnostico_aislamiento = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4F9A7E81-3BFF-4132-B94A-675EAB353EA1",variableType:4}
 */
var AsiVm_histClinAsist = 0

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"FE906B7D-EB6A-4DD7-B4A3-BC26570C9103"}
 */
var AsiVm_apellido = ''
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7257F982-E237-4EA1-8FFE-60D97AEF9A47",variableType:4}
 */
var AsiVm_txtItem = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1DF3D33F-92DE-4D7E-A111-DE7AF1BD8370",variableType:4}
 */
var AsiVm_txtHora = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"35A96376-CD35-4AC8-98D0-0166703055F0",variableType:4}
 */
var AsiVm_txtGrupo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6689D0F6-008C-41B0-8976-ECD985040A2F",variableType:4}
 */
var AsiVm_txtFecha = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"001A1BA7-7FB3-438E-9F8F-E870D442E09F",variableType:8}
 */
var AsiVm_txtHistClinica = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"EE5BCC44-A1E3-435A-994B-BCF8226BAE4D"}
 */
var AsiVm_patDataProvider = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D11E64AC-07C9-4015-80EE-E706BD67ED93",variableType:8}
 */
var AsiVm_hiuHisCli_scroll = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9428877D-D748-4614-BE85-69ECCC8E0D71",variableType:4}
 */
var AsiVm_hiuHora = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6AEE4B3C-2C48-411C-AC72-96FB8B7CE04E",variableType:4}
 */
var AsiVm_hiuFecha = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2E98F29D-FFDC-4DB6-9B91-79F20D3177B8",variableType:8}
 */
var AsiVm_hiuHisCli = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"48725B57-95A0-4D9B-85AD-F024CB8C1286",variableType:8}
 */
var AsiVm_adm_HistClin = 0;



/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"680BC422-BF28-4C91-AA26-34C4651230DE",variableType:93}
 */
var AsiVm_fecha_null =null

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6B5A55A8-F7C3-499C-A6FE-388F76E95CAE",variableType:4}
 */
var AsiVm_adm_HistClinResp = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9E3BC704-C624-4167-A2AB-051840363A57",variableType:4}
 */
var AsiVm_adm_HistClinPrin = 0;

/**
 * @properties={typeid:35,uuid:"6C2EB0A6-606A-4AB0-8E42-491D073005A8",variableType:-4}
 */
var AsiVm_Ficha_Inicio_bloqueado = false

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E2746FC6-1048-4FD2-B6E6-12BE9DA8941E",variableType:4}
 */
var AsiVm_histClinUnica = 0;


/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"6F6C3161-336F-4F52-AED3-34375297FD7E",variableType:93}
 */
var AsiVm_fecha_inicio_seguimiento = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"58E719A5-C7EE-48F2-B583-99CF149023DF",variableType:4}
 */
var AsiVm_nroHabi = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F22E2229-14AD-4C2C-94E1-1080769944EE",variableType:4}
 */
var AsiVm_obrCodigo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"69B87E8F-657A-4604-BD0A-54BD2B36D45E",variableType:4}
 */
var AsiVm_hisclin = 0;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"D1902A07-CC39-4615-8ABB-2D84B157B624",variableType:93}
 */
var AsiVm_fecha_Ficha = null

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"B01A896D-272F-4635-A5BE-0080049FB30C",variableType:93}
 */
var AsiVm_fecha_monitoreo_print = null

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4F78D68E-2C37-475C-99EF-FF01FCFB72CB",variableType:4}
 */
var AsiVm_hisclin_monitoreo_print= 0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F578C7BC-5433-485C-9BE4-862F5B64627F",variableType:4}
 */
var AsiVm_eventSourceButton = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"58D28FDA-B3BF-44D0-942C-5159B76553BC"}
 */
var AsiVm_paciente = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"35A0D2BE-2B70-4C28-A462-74B5F9859817",variableType:4}
 */
var AsiVm_vTipoTecnico = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"09DAF1C2-CF3E-4A1A-BF51-197A359FBE6D"}
 */
var AsiVm_Fecha_dia = ''


/**
 * @properties={typeid:35,uuid:"C7BDC16D-CD7B-4AB7-BC93-322B50FB0CE4",variableType:-4}
 */
var AsiVm_Ficha_Cerrada = false
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F60A2A3F-4400-4367-993C-006CD9053D63",variableType:4}
 */
var AsiVm_fechaTxt = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"83F25E36-2787-4409-9EB6-04585EFE7B46",variableType:4}
 */
var AsiVm_lineaTxt = 0;



/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B74BE239-A006-4A49-ABB1-585296A82055",variableType:4}
 */
var AsiVm_horaTxt = 0;


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C62702FB-3381-46FA-AFB5-C93A649ABA79",variableType:4}
 */
var AsiVm_grupoTxt = 0;







/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B463AEF8-505E-4BA2-AD5B-BA6EA356C1DE",variableType:4}
 */
var Asivm_prestacion = 0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"69ECC324-78DB-458C-A049-F99CB95E9BC7",variableType:4}
 */
var AsiVm_equipos_disponibles = 0
/**
 * @properties={typeid:24,uuid:"1151BBFF-7DE5-445B-87D7-4658303AEECF"}
 */
function onSolutionOpen_AsiVm() {
	//application.setNumpadEnterAsFocusNextEnabled(true)
	plugins.window.getMenuBar().setVisible(false)
    plugins.window.setToolBarAreaVisible(false)
    
    var names1 = plugins.window.getToolbarNames();
    for (var i = 0 ; i < names1.length ; i++) {
         plugins.window.removeToolBar(names1[i])
    }    
    plugins.window.setFullScreen(false)
    plugins.window.getMenuBar().setVisible(false)
    plugins.window.setToolBarAreaVisible(false)
	plugins.window.setStatusBarVisible(false);
    
//    databaseManager.addTableFilterParam("desal","tbl_ficha_kine","fecha_fin","=",null);
//    databaseManager.addTableFilterParam("admisionscroll","tbc_admision_scroll","adm_fecaltaefec","=",0);
    
    databaseManager.setAutoSave(false)
}

/**
 * TODO generated, please specify type and doc for the params
 * @param args
 *
 * @properties={typeid:24,uuid:"B1467B12-B766-4E00-8ED2-04A0365B5E29"}
 */
function llamada_desde_Menu(args) {
	try {
		// Trae datos desde el Menu
		args = args.toString()
		args=args.split(';') 
		globals.vLegajo=utils.stringToNumber(args[0])
		globals.vLega=utils.stringToNumber(args[1])
		globals.vOperador=args[2]
		globals.vTipoOperador=utils.stringToNumber(args[3])
		globals.gbl_transacciones_1= 0 //args[4] 
		globals.vEmpresa=args[5]
		globals.gbl_expanding_Nodes=args[6]
		globals.gbl_title= 'Ventilación Mecánica'
		globals.Srv_Login_Sanatorio_Titulo_Login_Profesional="Ingrese Legajo del kinesiologo"
		forms.frm_menu.elements.frm_main.dividerLocation = 0.20	// divide ventana
		//SI no se agrega codigo, toma codigo harcodeado por defecto del modulo.
		globals.Srv_Login_Sanatorio_Codigo_Especialidad = 5 //kinesiologo
//		globals.AsiVm_vSolomedicos=false
		globals.Srv_Login_Sanatorio_vSolomedicos=false
		application.updateUI()
		
		globals.loginSolution();
		//Cargar permisos
		/*var $ip         = application.getIPAddress()
		var $solucion   =  application.getSolutionName()	
		var $Args       = new Array()
		var $SQL ="select  PERF.codigo_perfil, PERF.codigo_solucion, PERF.codigo_formulario, PERF.codigo_elemento, " 
	             +"PERF.visible, PERF.accesible "
		         +"from tbl_permiso "
	             +"left join tbl_perfil_itm PERF on tbl_permiso.codigo_perfil = PERF.codigo_perfil "             
	             +"where tbl_permiso.codigo_legajo = "
	             + globals.vLega
				 if (globals.vLega == 0){
					 $SQL = $SQL + " and ip = '"
					 + $ip + "'"
				 }
				 $SQL = $SQL + " and PERF.codigo_solucion = '"
				 + $solucion
	             +"' order by PERF.codigo_perfil asc, PERF.codigo_solucion asc, PERF.codigo_formulario asc, PERF.codigo_elemento asc"
	    globals.AsiVm_permisos = databaseManager.getDataSetByQuery("desal", $SQL, $Args, -1);	
	    var $max = globals.AsiVm_permisos.getMaxRowIndex()
		if(!$max){ return}*/
	    
		//Pide legajo de medico para acceder al form
	/*	globals.AsiVm_vSolomedicos=true
		globals.AsiVm_esAnestesista=false
		globals.Srv_Login_Sanatorio_vLegajo=0
		globals.Srv_Login_Sanatorio_vLega=0
		globals.AsiVm_vOperador=''
		globals.AsiVm_vClave=0
		globals.AsiVm_vEspeMed = 0;*/
		
		
	 /*   var win = application.createWindow("legajo_medico",JSWindow.MODAL_DIALOG)	
	    win.title= 'Ingrese Legajo del médico'
	    win.setSize(570,260)
	    win.resizable = false
	    win.show(forms.AsiVm_dlg_pideLegajoMedico)
		win.destroy()
		if(globals.AsiVm_esAnestesista && globals.AsiVm_vSolomedicos ){}
		else{return}*/
	
		//Muestra Formulario Principal
		
		if(globals.Srv_Login_Sanatorio_esDelaEspecialidadMedica && globals.Srv_Login_Sanatorio_vSolomedicos ){}
		else{return}
		
//		//siempre es posible agrega evoluciones
//		var fichas = databaseManager.createEmptyDataSet();
//		fichas.addColumn('f_id_ficha');
//		fichas.addColumn('f_paciente_grilla');
//		fichas.addColumn('f_fecha_grilla');
//		fichas.addColumn('f_legajo_mec_grilla');
//		fichas.addColumn('f_hisclin_unic_grilla');
//		fichas.addColumn('f_histclin_grilla');
//		fichas.addColumn('f_con_soporte_grilla');
//		fichas.addColumn('f_prestacion_grilla');
//		fichas.addColumn('f_equipo_grilla');
//		fichas.addColumn('f_marca_grilla');
//		fichas.addColumn('f_modelo_grilla');
//		fichas.addColumn('f_en_uso_grilla');
//		for(var j=1; j<=asivm_rel_fichas_kine.getSize(); j++){
//			scopes.globals.AsiVm_histcli_resp = asivm_rel_fichas_kine.getRecord(j).histcli
//			fichas.addRow([asivm_rel_fichas_kine.getRecord(j).ficha_id
//			,asivm_rel_fichas_kine.getRecord(j).nombre_paciente
//								,asivm_rel_fichas_kine.getRecord(j).fecha
//								,asivm_rel_fichas_kine.getRecord(j).kinesiologo_lega
//								,asivm_rel_fichas_kine.getRecord(j).histcli_unico
//								,asivm_rel_fichas_kine.getRecord(j).histcli
//								,asivm_rel_fichas_kine.getRecord(j).con_soporte_ventilatorio
//								,asivm_rel_fichas_kine.getRecord(j).prestacion
//								,asivm_rel_join_respirador.rsp_codint==undefined?"":asivm_rel_join_respirador.rsp_codint
//								,asivm_rel_join_respirador.rsp_marca==undefined?"":asivm_rel_join_respirador.rsp_marca
//								,asivm_rel_join_respirador.rsp_modelo==undefined?"":asivm_rel_join_respirador.rsp_modelo
//								,(asivm_rel_join_respirador.rsp_enuso==undefined)?"NO":(asivm_rel_join_respirador.rsp_enuso==1)?'SI':'NO'
//								
//								]);
//		}
//			
//		var $tipos = [JSColumn.NUMBER,JSColumn.TEXT,JSColumn.DATETIME,JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.NUMBER,JSColumn.TEXT,JSColumn.TEXT,JSColumn.TEXT,JSColumn.TEXT];
//		
//		var $frm = solutionModel.getForm('AsiVm_ficha_kine');
//		$frm.dataSource = fichas.createDataSource('ds_kine2', $tipos);
//		forms.AsiVm_ficha_kine.controller.recreateUI();
		
		var win = application.createWindow("Menu_item",JSWindow.MODAL_DIALOG)	
	    win.title= globals.gbl_title
	    win.resizable = false	
	    win.show(forms.AsiVm_ficha_kine)
		win.destroy()
	
	} catch (e) {
		plugins.dialogs.showInfoDialog("Error al procesar su pedido. Avise a Sistemas, por favor!",e.toString(),"ok")
		/*if(forms.AsiVm_Evolucion_Uco.$_AsiVm_Recurso_Tomado !=null && forms.AsiVm_Evolucion_Uco.$_AsiVm_Recurso_Tomado){
			if(asiucotrs_hoja_numero_to_tbc_admision.getSize()==1 && globals.Srv_Login_Sanatorio_vLega!=0 ){
				globals.AsistFunciones_unLockRegisterTable(application.getSolutionName(),'AsiVm_Evolucion_Uco',asiucotrs_hoja_numero_to_tbc_admision.adm_histclin.toString(),globals.Srv_Login_Sanatorio_vLega.toString(),"Hoja de Servicio Uco");
			}
			
		}
		forms.AsiVm_Evolucion_Uco.limpiarForm();
		databaseManager.revertEditedRecords();*/
		
	}/*finally{
			if(globals.AsiVm_bloqueado){
					globals.AsistFunciones_unLockRegisterTable(application.getSolutionName(),forms.AsiVm_Evolucion_Uco.controller.getName(),asiucotrs_hoja_rel_buscar_admision.adm_histclin.toString(),globals.Srv_Login_Sanatorio_vLega.toString(),'Historia Clinica de Ingreso a UCO');
			}
		
	}*/
	
}

/**
 * @properties={typeid:24,uuid:"B69698B4-B2F6-49AB-85D3-69B63DC4FD61"}
 */
function AsiVm_formatearHistclin() {
	var histClin = '';
	if(arguments[0] != undefined)
		histClin =  arguments[0].toString().substr(0,arguments[0].toString().length-1)+"/"+arguments[0].toString().substr(arguments[0].toString().length -1,1)	

	return histClin;
}

/**
 * TODO generated, please specify type and doc for the params
 * @param realValue
 *
 * @properties={typeid:24,uuid:"FCF376B4-2B14-4D46-A576-164F07B4019F"}
 */
function AsiVm_convertNumberToHour_HHMM(realValue) {
	
	var hora = "";
	if(realValue != null){
		var value = Number(realValue);
		if(value < 1){
			hora = "00:00";
		}
		else{
			if(value < 10){
				hora = "00:0" + value.toString().substr(0,1);
			}
			else{
				if(value < 100){
					hora = "00:" + value.toString().substr(0,2);
				}
				else{
					if(value < 1000){
						hora = "0" + value.toString().substr(0,1) + ":" + value.toString().substr(1,2);
					}
					else{
						if(value <= 2359){
							hora = value.toString().substr(0,2) + ":" + value.toString().substr(2,2);
						}
					}
				}
			}
		}
	}
	
	return hora;
}

/**
 * TODO generated, please specify type and doc for the params
 * @param min
 * @param max
 * @param ingreso
 * @param old_valor
 * @param evento
 * @param tipo
 *
 * @properties={typeid:24,uuid:"CCC16F17-BD10-45C5-9637-16ED13D701C3"}
 */
function valida_rango_campo(min, max, ingreso, old_valor, evento, tipo) {
	if (ingreso<min || ingreso > max){
		plugins.dialogs.showWarningDialog("Dato Erróneo","Dato con valor fuera del Rango: "+min+" - "+max,"Ok")
		globals.errorDato=false
	}else{
		if (ingreso==0){
			var thePressedButton = plugins.dialogs.showQuestionDialog('Valor '+tipo, '¿Está seguro de ingresar '+tipo+'?', 'Si', 'No');
			if(thePressedButton=='Si'){
				globals.errorDato=true
			}else{
				if (evento.getType() == JSEvent.ACTION) {
					!evento
				}
				globals.errorDato=false
			}
			thePressedButton = ''
		}else{
			globals.errorDato=true
		}
	}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param Fecha_Desde
 * @param Fecha_Hasta
 *
 * @properties={typeid:24,uuid:"E96A0B5B-65B3-431E-8A05-282613852F6E"}
 */
//function contar_dias(Fecha_Desde, Fecha_Hasta) {
//	// El hasta dede ser mayor al desde
//	var $contar = 0;
//
//	var $x = Fecha_Hasta - Fecha_Desde//diferencias entre dos dias y lo muestra en milisegundos
//	var $un_dia = 1000 * 60 * 60 * 24 //ms * sec * min * hrs de un día
//	var $dif_dias = $x / $un_dia //calcula la diferencia en días
//		//$contar = Math.ceil($dif_dias )   //redondea
//	//$contar = Math.round($dif_dias)
//	$contar = Math.floor($dif_dias) //redondea
//
//	return $contar
//}

/**
 * @AllowToRunInFind
 * 
 * TODO generated, please specify type and doc for the params
 * @param formname
 * @param rec
 *
 * @properties={typeid:24,uuid:"7CBA7D31-BA7A-4DEB-BF0F-781A3941862D"}
 */
function printRoutine(formname, rec) {
	var frm = formname;
	var oneRecord = rec;

	if(!oneRecord) 
	{
	    oneRecord = false
	}	

	if(!frm) return;
	forms[frm].controller.setPageFormat(210,297,10,10,10,10,1,0)
	//forms[frm].controller.showPrintPreview(oneRecord)
	//var destino = 'c:/temp/out'+utils.numberFormat(globals.numeroJobs,0)+'.pdf'
	//plugins.dialogs.showInfoDialog("",destino)
	//forms[frm].controller.print(false,false)
	
	
	
	//combine muliple pdf docs into one.
	forms[frm].foundset.find()
	forms[frm].foundset['tipo']='talon-3'
	forms[frm].foundset.search()
//	forms[frm].foundset.loadRecords(forms.AsiVm_Template_print.dsAux)
//	forms.AsiVm_Template_print.foundset.loadRecords(forms.AsiVm_Template_print.dsAux)
//	forms.AsiVm_Template_print.controller.print(false,false);
//	forms.AsiVm_Print.controller.print(false,false)
//	forms[frm].foundset.loadRecords(forms.AsiVm_Template_print.dsAux)
//	forms.AsiVm_Template_print.controller.recreateUI();
//	forms[frm].controller.print(false,false)
	//forms[frm].controller.showPrintPreview(oneRecord)
	//forms[frm].controller.print(false,false,plugins.pdf_output.getPDFPrinter())
}
/**
 * @properties={typeid:24,uuid:"835CFFD6-9CB5-4FA0-9E5D-21814BDBA5BB"}
 * @AllowToRunInFind
 */
function AsiVm_calculaDigitoVerificador() {
	var aux_dig = new Array(5);
	if(globals.Srv_Login_Sanatorio_vlargo==2){
		aux_dig[0] = 0
		aux_dig[1] = 0
		aux_dig[2] = 0
		aux_dig[3] = globals.Srv_Login_Sanatorio_vLega.toString().substr(0,1);
		aux_dig[4] = globals.Srv_Login_Sanatorio_vLega.toString().substr(1,1);
	}else{
		if (globals.Srv_Login_Sanatorio_vlargo==3){
			aux_dig[0] = 0
			aux_dig[1] = 0
			aux_dig[2] = globals.Srv_Login_Sanatorio_vLega.toString().substr(0,1);
			aux_dig[3] = globals.Srv_Login_Sanatorio_vLega.toString().substr(1,1);
			aux_dig[4] = globals.Srv_Login_Sanatorio_vLega.toString().substr(2,1);
		}else{
			if(globals.Srv_Login_Sanatorio_vlargo==4){
				aux_dig[0] = 0
				aux_dig[1] = globals.Srv_Login_Sanatorio_vLega.toString().substr(0,1);
				aux_dig[2] = globals.Srv_Login_Sanatorio_vLega.toString().substr(1,1);
				aux_dig[3] = globals.Srv_Login_Sanatorio_vLega.toString().substr(2,1);
				aux_dig[4] = globals.Srv_Login_Sanatorio_vLega.toString().substr(3,1);
			}else{
				if(globals.Srv_Login_Sanatorio_vlargo==5){
					aux_dig[0] = globals.Srv_Login_Sanatorio_vLega.toString().substr(0,1);
					aux_dig[1] = globals.Srv_Login_Sanatorio_vLega.toString().substr(1,1);
					aux_dig[2] = globals.Srv_Login_Sanatorio_vLega.toString().substr(2,1);
					aux_dig[3] = globals.Srv_Login_Sanatorio_vLega.toString().substr(3,1);
					aux_dig[4] = globals.Srv_Login_Sanatorio_vLega.toString().substr(4,1);
				}
			}
		}
	}
	var verificador = 0;
	verificador = utils.stringToNumber(aux_dig[1]) + utils.stringToNumber(aux_dig[2]) * 3 + utils.stringToNumber(aux_dig[3]) * 9 + utils.stringToNumber(aux_dig[4]) * 7;
	var larg = verificador.toString().length - 1;
	if(globals.Srv_Login_Sanatorio_digito_verificador!=verificador.toString().substr(larg,1)){
		globals.Srv_Login_Sanatorio_vDigVerif=false
	}
	
}

//METODOS PARA ARM

/**
 * TODO generated, please specify type and doc for the params
 * @param marcaArm
 *
 * @properties={typeid:24,uuid:"42AABB8F-1E3C-422C-AEE2-A795E2E27111"}
 */
function saveMarcaArmAdmision(marcaArm){
	
	asivm_rel_admision_arm.admarm=marcaArm
	if(asivm_rel_admision_arm.getSize()==1){
		try {
			var isSaveMarcaArm = databaseManager.saveData(asivm_rel_admision_arm.getRecord(1));
		} catch (e) {
			// TODO: handle exception
			globals.DIALOGS.showErrorDialog("Error en grabación", "\nSe ha producido un error de grabación. " + '\n' + "Avise a Sistemas, por favor.", "Aceptar")
		}
		if(isSaveMarcaArm==false){
			var error1 = ''
			var error2 = ''
			var array = databaseManager.getFailedRecords(asivm_rel_admision_arm)
			for (var ii = 0; ii < array.length; ii++) {
				var record = array[ii];
				var jstable = databaseManager.getTable(record);
				var tableSQLName = jstable.getSQLName();
				error1 = 'Error de Grabación en Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
				error2 = 'Error en grabación ' + record.exception;
				if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
					var thrown = record.exception.getValue()

				}
			}
		}
	}
	return isSaveMarcaArm

	
}


/**
 * TODO generated, please specify type and doc for the params
 * @param armHistcli
 * @param date
 *
 * @properties={typeid:24,uuid:"9FF15D75-AB03-47A7-8762-EC24700A4FAF"}
 */
function saveArmUsoInicio(armHistcli, date){
//	if(asivm_rel_asistencial_arm_uso){
//		
//	}
//	
	var isSaveArmUso =false
	var fechaIngresoArmExistente;
	var horaIngresoArmExistente;
	if(asivm_rel_asistencial_arm_uso_new.getSize()>0){
		fechaIngresoArmExistente = asivm_rel_asistencial_arm_uso_new.getRecord(1).armusofecing
		horaIngresoArmExistente= asivm_rel_asistencial_arm_uso_new.getRecord(1).armusohoring
	}
	if(fechaIngresoArmExistente==utils.dateFormat(date,'yyyyMMdd') && horaIngresoArmExistente==utils.dateFormat(date,'HHmm')){
		globals.DIALOGS.showErrorDialog("Error", "\n No puede generar un nuevo ARM con una fecha de inicio de ventilación existente(Cambie la fecha). \nRecuerde cada vez que cambie estado del ARM se informará y sera inmodificable" , "Aceptar")
		return false
	}
	
		asivm_rel_asistencial_arm_uso_new.newRecord()
		scopes.globals.InicializarDatosDeRelacion(asivm_rel_asistencial_arm_uso_new, "asistencial", "tbc_arm_uso")
		asivm_rel_asistencial_arm_uso_new.armusohcli=asivm_rel_buscar_admision.adm_histclin
		asivm_rel_asistencial_arm_uso_new.armusofecing=utils.dateFormat(date,'yyyyMMdd')
		asivm_rel_asistencial_arm_uso_new.armusohoring=utils.dateFormat(date,'HHmm')
//		var isResult = databaseManager.saveData(asivm_rel_asistencial_arm_uso_new.getRecord(1));

		try {
			isSaveArmUso = databaseManager.saveData(asivm_rel_asistencial_arm_uso_new.getRecord(1));
		} catch (e) {
			// TODO: handle exception
//			globals.DIALOGS.showErrorDialog("Error en grabación", "\nSe ha producido un error de grabación. " + '\n' + "Avise a Sistemas, por favor.", "Aceptar")
			globals.DIALOGS.showErrorDialog("Error en grabación", "\n Al modificar la Ficha Esta iniciando un ARM con una fecha de inicio de ventilacion que ya existe.. " + '\n' + "Avise a Sistemas, por favor.", "Aceptar")
		}
		if(isSaveArmUso==false){
			var error1 = ''
			var error2 = ''
			var array = databaseManager.getFailedRecords(asivm_rel_asistencial_arm_uso)
			for (var ii = 0; ii < array.length; ii++) {
				isSaveArmUso=false
				var record = array[ii];
				var jstable = databaseManager.getTable(record);
				var tableSQLName = jstable.getSQLName();
				error1 = 'Error de Grabación en Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
				error2 = 'Error en grabación ' + record.exception;
				if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
					var thrown = record.exception.getValue()
		
				}
			}
		}

	

	return isSaveArmUso
}

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"39376040-566C-475D-8F75-4207FB6334B9",variableType:4}
 */
var AsiVm_Mod_rcHClinica=0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"51834F00-210B-4239-B021-661C6D1CB073",variableType:4}
 */
var AsiVm_Mod_rcPeriodo=0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B07999CD-E4C6-4076-B65E-4F928870E81C",variableType:4}
 */
var AsiVm_Mod_rcCierre=0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"933A039F-D5E1-4320-8AB1-9D2155E9DBFF",variableType:4}
 */
var AsiVm_Mod_rcAdmision=0

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C0D60C58-9228-4D3A-BFEC-C1E81ADEAFAD",variableType:4}
 */
var AsiVm_Mod_rcEmpresa=0


/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"CE542537-1EA3-47CA-B694-401806F061E8",variableType:4}
 */
var AsiVm_Mod_ploObra = 0

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8813C5EB-CC21-41A2-A76A-71321D0F56DA"}
 */
var AsiVm_Mod_ploPlanx10 = null




/**
 * TODO generated, please specify type and doc for the params
 * @param armHistcli
 * @param date
 * @param fechaIngresoArm
 * @param horaIngresoArm
 *
 * @properties={typeid:24,uuid:"E1FEFC85-1036-413D-A090-46EF4D2B98AE"}
 */
function saveRendDet(armHistcli, date, fechaIngresoArm, horaIngresoArm){
//	var ultimoArmUso=null
//	if(asivm_rel_asistencial_arm_uso_abierta_update>0 && asivm_rel_asistencial_arm_uso.getSize()>0){
//	ultimoArmUso = asivm_rel_asistencial_arm_uso_new.getRecord(1)
	
	var sqlHabita = "select h.Hab_TipHabi from tbc_ADMISION a"
	  + " inner join Maestros.tbc_habita h on h.Hab_NroHabi = a.Adm_Habita"
	  + " where Adm_HistClin = " + armHistcli;
	var dsHabita = databaseManager.getDataSetByQuery('asistencial',sqlHabita,null,-1);
	var tipoHabi = (dsHabita.getMaxRowIndex() > 0 ? dsHabita.getValue(1,1) : 2);

	
	asivm_rel_rend_det.newRecord();
//	inicializarRelacionRendDet();
	globals.InicializarDatosDeRelacion(asivm_rel_rend_det,"asistencial","tbc_rend_det")
	asivm_rel_rend_det.rdempresa = globals.AsiVm_Mod_rcEmpresa
	asivm_rel_rend_det.rdadmision = 0; //internados
	asivm_rel_rend_det.rdadmision1 = 0;
	asivm_rel_rend_det.rdhclinica = globals.AsiVm_Mod_rcHClinica;
//	asivm_rel_rend_det.rdperiodo = ultimoArmUso.armusohoregr 
	asivm_rel_rend_det.rdperiodo = utils.dateFormat(date,'yyyyMM')
	//globals.AsiVm_Mod_rcPeriodo; aaaamm
//	asivm_rel_asistencial_arm_uso.armusofecing=utils.dateFormat(date,'yyyyMMdd')
//	asivm_rel_asistencial_arm_uso.armusohoring=utils.dateFormat(date,'HHMM')

	asivm_rel_rend_det.rdcierre = globals.AsiVm_Mod_rcCierre
	asivm_rel_rend_det.rdpantalla = 2;
	asivm_rel_rend_det.rdfecha = fechaIngresoArm
	asivm_rel_rend_det.rdhora =  horaIngresoArm
//	asivm_rel_rend_det.rdfecha = ultimoArmUso.armusofecing
//	asivm_rel_rend_det.rdhora =  ultimoArmUso.armusohoregr
//	asivm_rel_rend_det.rdhora =  utils.dateFormat(date,'HHMM')
	asivm_rel_rend_det.rdtipo = 1;
	asivm_rel_rend_det.rdcodnom = 431103;
	asivm_rel_rend_det.rdmodalidad = tipoHabi; // que pongo aca?
//	asivm_rel_rend_det.rdfechahasta = ultimoArmUso.armusofecegr
	asivm_rel_rend_det.rdfechahasta =utils.dateFormat(date,'yyyyMMdd')
	
	var fechaIngreso = utils.parseDate(fechaIngresoArm,'yyyyMMdd')
	var fechaEgreso= date
	var dias = contar_dias(fechaIngreso,fechaEgreso)
	asivm_rel_rend_det.rdduracion = dias;
	asivm_rel_rend_det.rddias = 1;
	asivm_rel_rend_det.rdcantmod = 1;
	
	var result = databaseManager.saveData(asivm_rel_rend_det.getRecord(1));
	
	if(!result){
		messageError += '\nRendicion detalle: ' + obtenerMessageError(asivm_rel_rend_det);
		plugins.Log.error(messageError)
		return false;
	}else{
		return true
	}
//	}
	return false
}

/**
 * TODO generated, please specify type and doc for the params
 * @param armHistcli
 * @param date
 *
 * @properties={typeid:24,uuid:"2D856C56-4042-4A00-9E5D-2F6841FD374A"}
 */
function saveRendCab(armHistcli, date){
	
	scopes.globals.AsiVm_Mod_rcAdmision=0 // internados
	var $fecha_actual = application.getServerTimeStamp()
	var $anio=0
	$anio=$fecha_actual.getFullYear()
	var $mes = 0
	var $mes_ed = ' '
	var $dia = 0
	var $dia_ed = ' '
	var $hora = 0
	var $min = 0
	var $hora_ed = ' '
	var $min_ed = ' '
	var $planX=' '
	$dia=$fecha_actual.getDate()
	$mes=$fecha_actual.getMonth()+1
	$hora=$fecha_actual.getHours()
	$min=$fecha_actual.getMinutes()
	if($mes<10){
		$mes_ed='0'+$mes
	}else{
		$mes_ed=$mes
	}
	if($dia<10){
		$dia_ed='0'+$dia
	}else{
		$dia_ed=$dia
	}
	if($hora<10){
		$hora_ed='0'+$hora
	}else{
		$hora_ed=$hora
	}
	if($min<10){
		$min_ed='0'+$min
	}else{
		$min_ed=$min
	}
	globals.AsiVm_Mod_rcPeriodo=$anio+''+$mes_ed
	if(asivm_rel_obra_to_tbc_obras.obr_cantcierres==4){
		if($dia>=22){
			globals.AsiVm_Mod_rcCierre=4
		}else{
			if($dia>=15){
				globals.AsiVm_Mod_rcCierre=3
			}else{
				if($dia>=8){
					globals.AsiVm_Mod_rcCierre=2
				}else{
					if($dia>=1){
						globals.AsiVm_Mod_rcCierre=1
					}
				}
			}
		}
	}else{
		if(asivm_rel_obra_to_tbc_obras.obr_cantcierres==3){
			if($dia>=21){
				globals.AsiVm_Mod_rcCierre=3
			}else{
				if($dia>=11){
					globals.AsiVm_Mod_rcCierre=2
				}else{
					if($dia>=1){
						globals.AsiVm_Mod_rcCierre=1
					}
				}
			}
		}else{
			if(asivm_rel_obra_to_tbc_obras.obr_cantcierres==2){
				if($dia>=16){
					globals.AsiVm_Mod_rcCierre=2
				}else{
					if($dia>=1){
						globals.AsiVm_Mod_rcCierre=1
					}
				}
			}else{
				globals.AsiVm_Mod_rcCierre=1
			}
		}
	}
	if(asivm_to_tbc_rend_cab.getSize()<1){
		asivm_to_tbc_rend_cab.newRecord()
		globals.InicializarDatosDeRelacion(asivm_to_tbc_rend_cab,"asistencial","tbc_rend_cab")
		//inicializar_rend_cab()
		asivm_to_tbc_rend_cab.rcadmision1=0
		asivm_to_tbc_rend_cab.rcadmision2=0
		asivm_to_tbc_rend_cab.rcadmision3=0
		asivm_to_tbc_rend_cab.rcadmision4=0
		asivm_to_tbc_rend_cab.rcadmision=0
		
		asivm_to_tbc_rend_cab.rcempresa1=1
		asivm_to_tbc_rend_cab.rcempresa2=1
		asivm_to_tbc_rend_cab.rcempresa3=1
		asivm_to_tbc_rend_cab.rcempresa4=1
		asivm_to_tbc_rend_cab.rcempresa5=1
		asivm_to_tbc_rend_cab.rcempresa=1
		
		asivm_to_tbc_rend_cab.rchclinica2=globals.AsiVm_Mod_rcHClinica
		asivm_to_tbc_rend_cab.rchclinica3=globals.AsiVm_Mod_rcHClinica
		asivm_to_tbc_rend_cab.rchclinica5=globals.AsiVm_Mod_rcHClinica
		asivm_to_tbc_rend_cab.rchclinica=globals.AsiVm_Mod_rcHClinica
		
		asivm_to_tbc_rend_cab.rccierre2=globals.AsiVm_Mod_rcCierre 
		asivm_to_tbc_rend_cab.rccierre3=globals.AsiVm_Mod_rcCierre
		asivm_to_tbc_rend_cab.rccierre=globals.AsiVm_Mod_rcCierre
		
		asivm_to_tbc_rend_cab.rcperiodo2=globals.AsiVm_Mod_rcPeriodo
		asivm_to_tbc_rend_cab.rcperiodo6=globals.AsiVm_Mod_rcPeriodo
		asivm_to_tbc_rend_cab.rcperiodo=globals.AsiVm_Mod_rcPeriodo
		asivm_to_tbc_rend_cab.rcperiodo3=globals.AsiVm_Mod_rcPeriodo
		
		asivm_to_tbc_rend_cab.rcestado5=0
		asivm_to_tbc_rend_cab.rcestado=0
		asivm_to_tbc_rend_cab.rcobra5=globals.AsiVm_obrCodigo
		asivm_to_tbc_rend_cab.rcobra=globals.AsiVm_obrCodigo
		asivm_to_tbc_rend_cab.rcfactura=0
		asivm_to_tbc_rend_cab.rctipograb=2
		
//		asivm_to_tbc_rend_cab.rciva=foundset.reservasiva
		
//		globals.AtCons_hiscli=globals.AsiVm_Mod_rcHClinica
		
		if(asvim_buscar_plan.getSize()>0){
			if(asvim_buscar_plan.plo_planx!=null){
				$planX=asvim_buscar_plan.plo_planx
			}else{
				$planX=' '
			}
		}else{
			$planX=' '
		}
		asivm_to_tbc_rend_cab.rcfecha = $anio+''+$mes_ed+''+$dia_ed;
		asivm_to_tbc_rend_cab.rchora = $hora_ed+''+$min_ed;
		asivm_to_tbc_rend_cab.rcimpobra = 0;
		asivm_to_tbc_rend_cab.rcimppaciente1 = 0;
		asivm_to_tbc_rend_cab.rcimppaciente2 = 0;
		asivm_to_tbc_rend_cab.rcimpfiller = 0;
		asivm_to_tbc_rend_cab.rcplan = $planX;
//		asivm_to_tbc_rend_cab.
//		asivm_to_tbc_rend_cab.rcafiliado = atcons_vhistcli_to_tbc_hist_cab.histcab_nrobenef;
		asivm_to_tbc_rend_cab.rcafiliado = asivm_rel_admision_arm.adm_nrobenef;
		asivm_to_tbc_rend_cab.rcfechaemision = $anio+''+$mes_ed+''+$dia_ed;
		asivm_to_tbc_rend_cab.rchoraemision = $hora_ed+''+$min_ed;
		asivm_to_tbc_rend_cab.rcatencion = 1;
//		asivm_to_tbc_rend_cab.rcsecuencia = scopes.globals.numeracion_txt(27)
		
		asivm_to_tbc_rend_cab.rcsecuencia = obtenerNumerador("desal","tbl_parametros","contador_entero","paramid",27);
		if(asivm_to_tbc_rend_cab.rcsecuencia > 0){
			try{
				databaseManager.saveData(asivm_to_tbc_rend_cab.getRecord(1));
				
			} catch(msg){
				globals.DIALOGS.showErrorDialog("Error en grabación", "\nSe ha producido un error de grabación. " + '\n' + "Avise a Sistemas, por favor.", "Aceptar")
			}
			var error3 = ''
			var error4 = ''
			var array1 = databaseManager.getFailedRecords(asivm_to_tbc_rend_cab)
			for (var j = 0; j < array1.length; j++) {
				var record1 = array1[j];
				var jstable1 = databaseManager.getTable(record1);
				var tableSQLName1 = jstable1.getSQLName();
				error3 = 'Error de Grabación en Tabla:' + tableSQLName1 + ' en server:' + jstable1.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
				error4 = 'Error en grabación ' + record1.exception;
				if (record1.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
					// exception thrown in pre-insert/update/delete event method
					var thrown1 = record1.exception.getValue()

				}
			}

			if (error3 != '') {
				globals.DIALOGS.showErrorDialog("Error de grabación", "Record validation failed: " + thrown1)
				globals.DIALOGS.showErrorDialog("Error en grabacion ", error3, "Aceptar")
				globals.DIALOGS.showErrorDialog("Error en grabacion ", error4, "Aceptar")
			}
		}
	}
}


/**
 * TODO generated, please specify type and doc for the params
 * @param serverName
 * @param tableName
 * @param columnName
 * @param primaryKey
 * @param keyValue
 *
 * @properties={typeid:24,uuid:"D31EA23C-367B-40B4-84BD-FCB7C5C52145"}
 */
function obtenerNumerador (serverName,tableName,columnName,primaryKey,keyValue) {
	
	var numero = 0;
	
	var msg = '';
	var msgEn = '';
	
	var sql = "begin; lock table " + tableName + " in row exclusive mode;";
   var done = plugins.rawSQL.executeSQL(serverName,tableName,sql);
	if (done) {
		
		// Lock de registros
		sql = "select * from " + tableName + " where " + primaryKey + " = " + keyValue + " for update;";
		done = plugins.rawSQL.executeSQL(serverName,tableName,sql);
		if (done) {
			
			sql = "SELECT " + columnName + " FROM " + tableName + " WHERE " + primaryKey + " = " + keyValue;
			var vDataset = databaseManager.getDataSetByQuery(serverName, sql, null, 1);
			
			if(vDataset.getMaxRowIndex() > 0){
				
				sql = "update " + tableName + " set " + columnName + " = " + columnName + " + 1 where " + primaryKey + " = " + keyValue + "; commit;";
				done = plugins.rawSQL.executeSQL(serverName, tableName, sql);
				if(done){
					
					numero = vDataset.getValue(1,1) + 1;
				}
				else{
					
					plugins.rawSQL.executeSQL(serverName, tableName, "end;");
					globals.DIALOGS.showWarningDialog("¡Atencion!", "No ha sido posible actualizar el numerador : \n" + msgEn, "Aceptar");
				}
			}
			else{
				
				plugins.rawSQL.executeSQL(serverName, tableName, "end;");
				globals.DIALOGS.showWarningDialog("¡Atencion!", "No existe el numerador : \n" + msgEn, "Aceptar");
			}
		}
		else{
			
			plugins.rawSQL.executeSQL(serverName, tableName, "end;");
			globals.DIALOGS.showWarningDialog("¡Atencion!", "Error al consultar tabla de numerador :\n" + msgEn + "Error en Select for update" , 'Aceptar');
		}
	}
	else{
		
		msg = plugins.rawSQL.getException().getMessage(); //see exception node for more info about the exception obj
		globals.DIALOGS.showWarningDialog("¡Atencion!", "Error al consultar tabla de numerador :\n" + msgEn + "\nSQL exception:" + msg, 'Aceptar');
	}
	
	return numero;
}



/**
 * TODO generated, please specify type and doc for the params
 * @param foundsetData
 *
 * @properties={typeid:24,uuid:"555F27A8-5CD1-47CE-A9FD-184135AB634C"}
 */
function obtenerMessageError(foundsetData){
	
	var errorMessage = '';
	var array = databaseManager.getFailedRecords(foundsetData);
	
	for (var i = 0; i < array.length; i++) {
		
		var record = array[i];
		var jstable = databaseManager.getTable(record);
		var tableSQLName = jstable.getSQLName();
		
		errorMessage += '\nTabla: ' + jstable.getServerName() + '.' + tableSQLName + ' [' + record.exception + ']';
		if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
			// exception thrown in pre-insert/update/delete event method
			errorMessage += '\nError de validacion [' + record.exception.getMessage() + ']'
		}
	}

	 return errorMessage;
}


/**
 * TODO generated, please specify type and doc for the params
 * @param armHistcli
 * @param date
 *
 * @properties={typeid:24,uuid:"460A620B-ECC6-452C-B578-B888D6B6E473"}
 */
function saveArmUsoFin(armHistcli, date){
//	if(asivm_rel_asistencial_arm_uso){
//		
//	}
//	
	var isSaveArmUso =false
//	asivm_rel_asistencial_arm_uso.newRecord()
//	scopes.globals.InicializarDatosDeRelacion(asivm_rel_asistencial_arm_uso, "asistencial", "tbc_arm_uso")
	if(asivm_rel_asistencial_arm_uso_abierta.getSize()>0){
		asivm_rel_asistencial_arm_uso_abierta_update.armusohcli=asivm_rel_buscar_admision.adm_histclin
		asivm_rel_asistencial_arm_uso_abierta_update.armusofecegr=utils.dateFormat(date,'yyyyMMdd')
		asivm_rel_asistencial_arm_uso_abierta_update.armusohoregr=utils.dateFormat(date,'HHmm')
		
		try {
		isSaveArmUso = databaseManager.saveData(asivm_rel_asistencial_arm_uso_abierta_update.getRecord(1));
		
		} catch (e) {
				globals.DIALOGS.showErrorDialog("Error en grabación", "\nSe ha producido un error de grabación. " + '\n' + "Avise a Sistemas, por favor.", "Aceptar")
		}
		
		if(isSaveArmUso==false){
			var error1 = ''
			var error2 = ''
			var array = databaseManager.getFailedRecords(asivm_rel_asistencial_arm_uso_abierta_update)
			for (var ii = 0; ii < array.length; ii++) {
				var record = array[ii];
				var jstable = databaseManager.getTable(record);
				var tableSQLName = jstable.getSQLName();
				error1 = 'Error de Grabación en Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!'
				error2 = 'Error en grabación ' + record.exception;
				if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
					var thrown = record.exception.getValue()
		
				}
			}
		}
		return isSaveArmUso
	}else{
		return false
	}

//	var isResult = databaseManager.saveData(asivm_rel_asistencial_arm_uso.getRecord(1));


	

	
	return isSaveArmUso
}

/**
 * TODO generated, please specify type and doc for the params
 * @param Fecha_Desde
 * @param Fecha_Hasta
 *
 * @properties={typeid:24,uuid:"E96A0B5B-65B3-431E-8A05-282613852F6E"}
 */
function contar_dias(Fecha_Desde, Fecha_Hasta) {
	// El hasta dede ser mayor al desde
	var $contar = 0;

	var $x = Fecha_Hasta - Fecha_Desde//diferencias entre dos dias y lo muestra en milisegundos
	var $un_dia = 1000 * 60 * 60 * 24 //ms * sec * min * hrs de un día
	var $dif_dias = $x / $un_dia //calcula la diferencia en días
		//$contar = Math.ceil($dif_dias )   //redondea
	//$contar = Math.round($dif_dias)
	$contar = Math.floor($dif_dias) //redondea

	return $contar
}
