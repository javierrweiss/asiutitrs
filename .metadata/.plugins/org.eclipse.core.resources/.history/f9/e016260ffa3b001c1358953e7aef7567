/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D08F9FCC-9D84-4B2C-9EBC-3685CF7F726E",variableType:4}
 */
var AsiUtiTrs_utiliza = 0;
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"CB24DBC2-55D6-47D0-866F-681DAD1622E3"}
 */
var AsiUtiTrs_IpUsuario = application.getIPAddress();

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"14CE3AE1-7F9D-4715-B7F8-4D6045D666B0"}
 */
var AsiUtiTrs_Usuario = application.getHostName();

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3BF0B6E6-229F-4D25-8112-00CF19E1016D"}
 */
var cerrarBloqueo = 'SI';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"FE29CAB4-5321-4D3D-A91A-2A70F6AB3114"}
 */
var AsiUtiTrs_apellido = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"369AE241-AC06-4651-A57A-1E211B467886"}
 */
var AsiUtiTrs_vPatalogia1 = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"37942C39-F6DC-4F1B-BE19-35E462DC64AD",variableType:4}
 */
var AsiUtiTrs_grupoTxt = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F2891E4D-6131-4D43-BB85-48D86CB5CF43",variableType:4}
 */
var AsiUtiTrs_horaTxt = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"975F6F1C-7A49-479F-BBCD-743E0849FF0E",variableType:4}
 */
var AsiUtiTrs_fechaTxt = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2ABC6F05-BB0E-4A53-911E-BED336C8F253",variableType:4}
 */
var AsiUtiTrs_ppcTxt = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F7E18D37-9CB0-4C65-87F0-A70E464C63EB",variableType:4}
 */
var AsiUtiTrs_espCodi = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5670FD5B-C037-4CA8-AD45-A365C9C88E4C",variableType:4}
 */
var AsiUtiTrs_wEquipo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"CAA8F521-0935-4F56-BB20-25CD8914B6B3",variableType:4}
 */
var AsiUtiTrs_nroHabi = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"868C2780-4D75-48E9-92E4-ADB013AA4A59",variableType:4}
 */
var AsiUtiTrs_codAutoHist = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"DB6A3B86-55B3-4B75-A311-5A9FDDE3C3DF",variableType:4}
 */
var AsiUtiTrs_camHabita = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"EBA518CE-7E6B-4A9E-8197-FCD2DC9697B7"}
 */
var AsiUtiTrs_camCama = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A82950D0-8D4F-453E-A61F-1840A13B92A3",variableType:4}
 */
var AsiUtiTrs_servCodigo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"544F8C9B-503D-4532-9F37-828BAD8C04B5",variableType:4}
 */
var AsiUtiTrs_ipedPedido = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A40EEDB8-9E78-435A-87B0-6AADAFC4C34B",variableType:4}
 */
var AsiUtiTrs_ipedServicio = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3198FBE3-BA47-4C6B-BE51-AF6A9BE714B5",variableType:4}
 */
var AsiUtiTrs_horaHciint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3F0415D3-D7C6-4E5A-A14B-D1E0654345FD",variableType:4}
 */
var AsiUtiTrs_fechaHciint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4DD6D8D9-75E8-4A19-9003-137B99A087A7",variableType:4}
 */
var AsiUtiTrs_vEspeMed = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"DD352A4C-3FF2-4466-BE70-77310934CAE2"}
 */
var AsiUtiTrs_vPassOperador = '';


/**
 * @properties={typeid:35,uuid:"6E3AB5AE-2973-405A-8538-1B840FEF3DBE",variableType:-4}
 */
var AsiUtiTrs_permiso_especial = false;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"97A7B145-6956-467D-948B-5B5C40307C4E",variableType:4}
 */
var AsiUtiTrs_vTipoTecnico = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A3C9622E-E676-466A-9A5B-2B1065DF2C09",variableType:4}
 */
var AsiUtiTrs_vTipoOperador = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C3D4154D-5863-4004-8A17-D1E7F6DEA04F",variableType:8}
 */
var AsiUtiTrs_digito_verificador = 0;

/**
 * @properties={typeid:35,uuid:"C8E9DC05-F467-4102-9424-CFA87B42AC53",variableType:-4}
 */
var AsiUtiTrs_vDigVerif = false;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1A0DD2F7-B4E3-44C5-A83E-218CAF537B0D",variableType:8}
 */
var AsiUtiTrs_vlargo = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"E9E0D9BC-9023-46D4-B83F-FA63A8EED977"}
 */
var AsiUtiTrs_vClave = ' ';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"254C95B6-9711-446E-9D26-39776F261E83"}
 */
var AsiUtiTrs_vOperador = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FD099D9B-44B0-4033-9710-01E93F8C1844",variableType:8}
 */
var AsiUtiTrs_vLega = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"73C460B4-F585-47D2-A7B9-4449803CC60B",variableType:8}
 */
var AsiUtiTrs_vLegajo = 0;

/**
 * @properties={typeid:35,uuid:"3C255FA3-E8B0-4C82-979F-DD08A05439CB",variableType:-4}
 */
var AsiUtiTrs_esAnestesista = false;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"8BC09204-CC9E-4EDB-BD0E-29270739C2BE",variableType:93}
 */
var fechaIngresoTerapia = new Date();

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9D72F60F-EBE0-493B-BA05-97BFB04AEC04"}
 */
var horaIngresoTerapia = "";

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"33C62E7B-CA08-40A0-980D-24E8B7DE0F1D"}
 */
var minIngresoTerapia = "";

/**
 * @properties={typeid:35,uuid:"04EB010C-DD89-4B1D-BF46-95E675723334",variableType:-4}
 */
var fechaIngresadaTerapia = false;

/**
 * @properties={typeid:35,uuid:"4DC4CFAF-591C-4F20-9088-3E8BF20D1F74",variableType:-4}
 */
var confirmaFechaIngresoTerapia = false;

/**
 * @properties={typeid:35,uuid:"D1511917-2D14-4B99-9D61-ED5CE6D8A78F",variableType:-4}
 */
var closeFechaIngresoTerapia = false;

/**
 * @properties={typeid:35,uuid:"44F86D23-0E70-41E3-853A-EB3A53DCDFCD",variableType:-4}
 */
var AsiUtiTrs_vSolomedicos = true;

/**
 * @properties={typeid:35,uuid:"5000F022-D926-48D1-98BB-49FAB7C9B72F",variableType:-4}
 */
var AsiUtiTrs_permisos = new Array();

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8B6B7873-CA06-4FF7-9DC7-19E0B97D9B1F",variableType:4}
 */
var AsiUtiTrs_alerHistClinPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"65C64338-CDEF-4AC7-82CC-EB541D6D97EB",variableType:4}
 */
var AsiUtiTrs_patCodiPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"79BBE436-C405-4048-91D3-B176B69AF34A",variableType:4}
 */
var AsiUtiTrs_horaIngresoPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"AE26FAA4-8006-4CC8-8705-3EB2D0E18CA6",variableType:4}
 */
var AsiUtiTrs_fechaIngresoPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"ACCD351A-0C2D-4731-B2AA-3470B32E601D",variableType:4}
 */
var AsiUtiTrs_hcUnicaPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"64261486-58C4-4394-9A02-690E8BEAC2E2",variableType:4}
 */
var AsiUtiTrs_perLegajoPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E31F2B95-8355-48F1-AB09-E5A5EA76E1BD",variableType:4}
 */
var AsiUtiTrs_medCodigoPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"557B6A58-E58D-481D-AAE0-BCC202B62CCD",variableType:4}
 */
var AsiUtiTrs_histClinAsist = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3C8178E7-BE56-4F4F-A5C5-62EC04B12EA0",variableType:4}
 */
var AsiUtiTrs_horaPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F8FF37A4-302A-468A-9560-625DA19D5D63",variableType:4}
 */
var AsiUtiTrs_fechaPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"56FA24DE-3B79-4DD9-9524-837F8C8CA134",variableType:4}
 */
var AsiUtiTrs_histClinPrint = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B0B86F52-A954-445C-A57C-F6023F51716C",variableType:4}
 */
var AsiUtiTrs_itemTxt = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B324C8B0-41EB-40D8-85F4-CDC34F80DE30"}
 */
var AsiUtiTrs_patDataProvider = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"EC0CCAC2-E503-4CBF-8B54-F59245A0501B",variableType:4}
 */
var AsiUtiTrs_obrCodigo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D5EDE887-2797-42BF-8E33-B7030F0E9DF0",variableType:4}
 */
var AsiUtiTrs_hiiHisCli = 0;


/**
 * @properties={typeid:35,uuid:"7062FDE1-6E0D-42BF-98A9-464D7F44BB48",variableType:-4}
 */
var AsiUtiTrs_soloLectura=false;

/**
 * @properties={typeid:35,uuid:"B5EDEF9F-5605-4B26-B6BF-B6A6345843CF",variableType:-4}
 */
var AsiUtiTrs_recursoObtenido = false;
/**
 * @properties={typeid:35,uuid:"17575C72-1907-45D6-B13B-473D934FD9D6",variableType:-4}
 */
var AsiUtiTrs_ultimaHisCli=true;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"D9F9FCB0-9266-4211-A7DA-915311027E58"}
 */
var AsiUtiTrs_fechaHisclin='';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"511BE0B5-7EA1-4961-8202-064F11D35E35",variableType:4}
 */
var AsiUtiTrs_hisclin = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8E1E9C1F-2A1D-4C0C-A3E1-A67752E4DD24",variableType:4}
 */
var AsiUtiTrs_sinFechaEgreso = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E15DC57D-9E49-4534-B3E3-67138CC11B01",variableType:4}
 */
var AsiUtiTrs_eventSourceButton = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9237A82E-2989-436C-B6D5-EA8769845C73"}
 */
var AsiUtiTrs_hisclistrynro = '';

/**
 * @properties={typeid:35,uuid:"A19B02BE-78EE-4C1B-B551-CDC1D39944B9",variableType:-4}
 */
var filtroPacientesEnTI = databaseManager.addTableFilterParam('admisionscroll','tbc_admision_scroll','adm_utiliza','in', [2,10,12]);

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"69099C29-2CA8-4474-A89E-AE6D2DC85A85"}
 */
var horaContador= '18000000';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"762B72A9-5BB6-4CF8-BD57-FCED2ECC7027"}
 */
var tiempoRestante="05:00";
/**
 * TODO generated, please specify type and doc for the params
 * @param args
 *
 * @properties={typeid:24,uuid:"F544A3B0-89A0-4E7B-A015-1696D84890A5"}
 */
function llamada_desde_Menu(args) {
	
	plugins.window.getMenuBar().setVisible(false)
    plugins.window.setToolBarAreaVisible(false)
    
    if(application.getApplicationType()==APPLICATION_TYPES.SMART_CLIENT){
    	var names1 = plugins.window.getToolbarNames();
    	for (var i = 0 ; i < names1.length ; i++) {
        	 plugins.window.removeToolBar(names1[i])
    	}  
    }  
    plugins.window.setFullScreen(false)
    plugins.window.getMenuBar().setVisible(false)
    plugins.window.setToolBarAreaVisible(false)
	plugins.window.setStatusBarVisible(false);
    databaseManager.addTableFilterParam("admisionscroll","tbc_admision_scroll","adm_fecaltaefec","=",0);
    databaseManager.setAutoSave(false)
    
	// Trae datos desde el Menu
	args = args.toString()
	args=args.split(';') 
	globals.vLegajo=utils.stringToNumber(args[0])
	globals.vLega=utils.stringToNumber(args[1])
	globals.vOperador=args[2]
	globals.vTipoOperador=utils.stringToNumber(args[3])
	globals.gbl_transacciones_1= 0 //args[4] 
	globals.vEmpresa=args[5]
	globals.gbl_expanding_Nodes=args[6]
	globals.gbl_title= 'Historia Clínica de Terapia Intensiva'
	forms.frm_menu.elements.frm_main.dividerLocation = 0.20	// divide ventana
	application.updateUI()
	
	//Cargar permisos
	var $ip         = application.getIPAddress()
	var $solucion   =  application.getSolutionName()	
	var $Args       = new Array()
	var $SQL ="select  PERF.codigo_perfil, PERF.codigo_solucion, PERF.codigo_formulario, PERF.codigo_elemento, " 
             +"PERF.visible, PERF.accesible "
	         +"from tbl_permiso "
             +"left join tbl_perfil_itm PERF on tbl_permiso.codigo_perfil = PERF.codigo_perfil " 
			 +"left join tbl_elemento ELEM on ELEM.codigo_solucion = PERF.codigo_solucion "
             +"where tbl_permiso.codigo_legajo = "
             + globals.vLega
			 if (globals.vLega == 0){
				 $SQL = $SQL + " and ip = '"
				 + $ip + "'"
			 }
			 $SQL = $SQL + " and PERF.codigo_solucion = '"
			 + $solucion
             +"' order by PERF.codigo_perfil asc, PERF.codigo_solucion asc, PERF.codigo_formulario asc, PERF.codigo_elemento asc"
    globals.AsiUtiTrs_permisos = databaseManager.getDataSetByQuery("desal", $SQL, $Args, -1);	
    var $max = globals.AsiUtiTrs_permisos.getMaxRowIndex()
	if(!$max){ return}
    
	//Pide legajo de medico para acceder al form
	globals.AsiUtiTrs_vSolomedicos=true
	globals.AsiUtiTrs_esAnestesista=false
	globals.AsiUtiTrs_vLegajo=0
	globals.AsiUtiTrs_vLega=0
	globals.AsiUtiTrs_vOperador=''
	globals.AsiUtiTrs_vClave=0
	globals.AsiUtiTrs_vEspeMed = 0;
	globals.AsiUtiTrs_permiso_especial=false;
	if(['Computos_Admin','DireccionMedica_Director'].indexOf(globals.AsiUtiTrs_permisos.getValue(1,1))!=-1){
		globals.AsiUtiTrs_permiso_especial=true;
	}
	
	forms.frm_menu.Armar_item();
    var win = application.createWindow("legajo_medico",JSWindow.MODAL_DIALOG)	
    win.title= 'Ingrese Legajo del médico'
    win.setSize(570,260)
    win.resizable = false
    win.show(forms.AsiUtiTrs_dlg_pideLegajoMedico)
	/*win.destroy()
	if(globals.AsiUtiTrs_esAnestesista && globals.AsiUtiTrs_vSolomedicos ){}
	else{return}

	//Muestra Formulario Principal
	win = application.createWindow("Menu_item",JSWindow.MODAL_DIALOG)	
    win.title= globals.gbl_title
    win.resizable = false	
    win.show(forms.HciutiTrs_frm_hist_clin_ingreso_utiTrs)
	win.destroy()*/
	
}

/**
 * TODO generated, please specify type and doc for the params
 * @param {String} realValue
 *
 * @properties={typeid:24,uuid:"6B6ABEFC-F77E-4E17-8132-907E1CB208DA"}
 */
function AsiUtiTrs_convertNumberToHour_HHMM(realValue) {
	
	var hora = "";
	if(realValue != null){
		var value = Number(realValue);
		if(value < 1){
			hora = "00:00";
		}
		else{
			if(value < 10){
				hora = "00:0" + value.toString().substr(0,1);
			}
			else{
				if(value < 100){
					hora = "00:" + value.toString().substr(0,2);
				}
				else{
					if(value < 1000){
						hora = "0" + value.toString().substr(0,1) + ":" + value.toString().substr(1,2);
					}
					else{
						if(value <= 2359){
							hora = value.toString().substr(0,2) + ":" + value.toString().substr(2,2);
						}
					}
				}
			}
		}
	}
	
	return hora;
}

/**
 * @properties={typeid:24,uuid:"D0E1B7B1-3CD2-4A5C-8BBC-FC0555DF94EF"}
 */
function formatearHistclin() {
	var histClin = '';
	if(arguments[0] != undefined)
		histClin =  arguments[0].toString().substr(0,arguments[0].toString().length-1)+"/"+arguments[0].toString().substr(arguments[0].toString().length -1,1)	

	return histClin;
}

/**
 * @properties={typeid:24,uuid:"70A18539-5E4D-47A0-8C96-28EBF2C71800"}
 */
function AsiUtiTrs_calculaDigitoVerificador() {
	var aux_dig = new Array(5);
	if(globals.AsiUtiTrs_vlargo==2){
		aux_dig[0] = 0
		aux_dig[1] = 0
		aux_dig[2] = 0
		aux_dig[3] = globals.AsiUtiTrs_vLega.toString().substr(0,1);
		aux_dig[4] = globals.AsiUtiTrs_vLega.toString().substr(1,1);
	}else{
		if (globals.AsiUtiTrs_vlargo==3){
			aux_dig[0] = 0
			aux_dig[1] = 0
			aux_dig[2] = globals.AsiUtiTrs_vLega.toString().substr(0,1);
			aux_dig[3] = globals.AsiUtiTrs_vLega.toString().substr(1,1);
			aux_dig[4] = globals.AsiUtiTrs_vLega.toString().substr(2,1);
		}else{
			if(globals.AsiUtiTrs_vlargo==4){
				aux_dig[0] = 0
				aux_dig[1] = globals.AsiUtiTrs_vLega.toString().substr(0,1);
				aux_dig[2] = globals.AsiUtiTrs_vLega.toString().substr(1,1);
				aux_dig[3] = globals.AsiUtiTrs_vLega.toString().substr(2,1);
				aux_dig[4] = globals.AsiUtiTrs_vLega.toString().substr(3,1);
			}else{
				if(globals.AsiUtiTrs_vlargo==5){
					aux_dig[0] = globals.AsiUtiTrs_vLega.toString().substr(0,1);
					aux_dig[1] = globals.AsiUtiTrs_vLega.toString().substr(1,1);
					aux_dig[2] = globals.AsiUtiTrs_vLega.toString().substr(2,1);
					aux_dig[3] = globals.AsiUtiTrs_vLega.toString().substr(3,1);
					aux_dig[4] = globals.AsiUtiTrs_vLega.toString().substr(4,1);
				}
			}
		}
	}
	var verificador = 0;
	verificador = utils.stringToNumber(aux_dig[1]) + utils.stringToNumber(aux_dig[2]) * 3 + utils.stringToNumber(aux_dig[3]) * 9 + utils.stringToNumber(aux_dig[4]) * 7;
	var larg = verificador.toString().length - 1;
	if(globals.AsiUtiTrs_digito_verificador!=verificador.toString().substr(larg,1)){
		globals.AsiUtiTrs_vDigVerif=false
	}

}

/**
 * Called for performing a conversion between a database value and a displayed value.
 *
 * @param databaseValue The database value.
 * @param {String} dbType The type of the database column. Can be one of "TEXT", "INTEGER", "NUMBER", "DATETIME" or "MEDIA".
 *
 * @returns {Object} the displayed value.
 *
 * @properties={typeid:24,uuid:"37D09B1F-71B9-4137-B655-469732608BE6"}
 */
function AsiUtiTrs_convertNumberToDate(databaseValue, dbType) {
	
	var fecha = "";
	 
	if(databaseValue > 0){
		
		var fechaAux = String(databaseValue);
		fecha = fechaAux.substr(6,2) + '/' + fechaAux.substr(4,2) + '/' + fechaAux.substr(0,4); 
	}
		 
	return fecha;
}

/**
 * Callback method for when solution is closed, force boolean argument tells if this is a force (not stopable) close or not.
 *
 * @param {Boolean} force if false then solution close can be stopped by returning false
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"E02FBBA5-836B-47A1-9DCB-860F21E2EC96"}
 */
function onCloseSolution(force) {
//	plugins.Log.debugLevel = 'INFO';
//	plugins.Log.logFilePath = 'C:\\bloqueos.log';
//	plugins.Log.outputPattern = '%s %p %d{HH:mm:ss.S}: %m%n';
//	plugins.Log.info('CloseSolution: '+application.getSolutionName()+ 'hisClin:' + asiutitrs_numero_to_tbc_admision.adm_histclin.toString()+','+globals.AsiUtiTrs_vLega.toString()+','+ "Historia Clinica" + "IP: "+application.getIPAddress() );
	
}

//Esta función probablemente se solapa con AsistFunciones_isLockRegisterTable()
/**
 * TODO generated, please specify type and doc for the params
 * @param solucion
 * @param formulario
 * @param id
 *
 * @properties={typeid:24,uuid:"B483B7D5-E3D3-4657-98BE-2F235B11CAD2"}
 */
function isLocked(solucion,formulario,id){
	var fecha = application.getServerTimeStamp();
	var dia = fecha.getDate();
	var mes = fecha.getMonth();
	var ano = fecha.getFullYear();
	var sql = "SELECT bloqueado "+
	          "FROM asi_bloqueos "+
			  "WHERE solucion = ? AND formulario = ? " 
			  +"AND identificador = ? AND EXTRACT(Day from fecha)= ? "+
			  +"AND EXTRACT(Month from fecha) = ? AND EXTRACT(Year from fecha)= ?";
			  var args = ['AsiUtiTrs', 'HciutiTrs_frm_hist_clin_ingreso_utiTrs', id, dia, mes, ano]
		var vDataset = databaseManager.getDataSetByQuery("desal", sql, args, 1);
		if (vDataset.getMaxRowIndex()>0 && vDataset.getValue(1,5)==true){
			return true;			
		} else {
			return false;
		}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param histclin
 * @param bool
 * @properties={typeid:24,uuid:"5F405BD4-7F81-4964-9702-E681AA3F9FD6"}
 * @AllowToRunInFind
 */
function bloquearHistClin(histclin, bool){
	try{	
		var $url = application.getServerURL().length
		var fs = databaseManager.getFoundSet('desal','asi_bloqueos')
		var fecha = application.getServerTimeStamp();
		var dia = fecha.getDate();
		var mes = fecha.getMonth();
		var ano = fecha.getFullYear();
		
		if(!fs.find()){
			globals.DIALOGS.showWarningDialog('Aviso', 'Error en modo búsqueda. Hay modificaciones sin guardar','OK')
			return
		}
		fs.solucion = application.getSolutionName();
		fs.identificador = histclin
		fs.formulario = 'HciutiTrs_frm_hist_clin_ingreso_utiTrs';
		fs.fecha = '#'+ano+mes+dia+'|yyyy/MM/dd'
		if (fs.search() == 0){
			
			//Si no encuentra da de alta un registro en la tabla con los datos necesarios
			fs.newRecord()
			fs.solucion = application.getSolutionName();
			fs.formulario = 'HciutiTrs_frm_hist_clin_ingreso_utiTrs';
			fs.identificador = histclin;
		}
		// Sea porque encontro el registro en la busqueda o porque lo di de alta modifico el "bloqueo"
		fs.bloqueado = bool;
		fs.legajo = AsiUtiTrs_vLegajo;
		fs.equipo = AsiUtiTrs_Usuario;
		fs.ip = AsiUtiTrs_IpUsuario;
		fs.fecha = application.getServerTimeStamp();
		fs.usuario = $url < 24 ? 'developer' : plugins.UserManager.Client().userName;
		databaseManager.startTransaction()
		var save = databaseManager.saveData(fs)
		if (save){
			application.output("Éxito")
			databaseManager.commitTransaction()
		} 
	} catch(ServoyException){
		ServoyException.message
		databaseManager.rollbackTransaction()
	}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param nombreForm
 * @param funcComportamiento
 * @param elementos
 *
 * @properties={typeid:24,uuid:"F981AE77-2A4B-4CC3-8C50-0E2ED1B0A3AB"}
 */
//function modificarCampos(nombreForm, funcComportamiento, elementos){
//	  var flds = forms[nombreForm].elements;
//	  var itemForm;
//	    for (itemForm in flds) {
//	        var elmForm = flds[itemForm];
//	        if(elmForm!=null){
//	        	try { //cannot find fuction??? in object??? al editar?
//	        	    var nameField= elmForm.getName();
//	 		    	if(elementos!=null && utils.stringTrim(elementos)!=""){
//	 		    		var arrayElementos = elementos.split(',');
//	 		    		for (var indiceElementos = 0; indiceElementos < arrayElementos.length; indiceElementos++) {
//	 		    			 if(funcComportamiento!=null && nameField.indexOf(arrayElementos[indiceElementos])!=-1){
//	 	 	 		    		funcComportamiento(nombreForm,nameField);
//	 	 		    		 }
//	 		    		}
//	 		    		
//	 		    	}
//	 		    	else if(funcComportamiento!=null && nameField.indexOf('txt')!=-1 || nameField.indexOf('cbo')!=-1 || nameField.indexOf('grp')!=-1 || nameField.indexOf('chk')!=-1){
//	 		    		funcComportamiento(nombreForm,nameField)
//	 		    	}
//	        	} catch (e) {
//	        		// TODO: handle exception
//	        		
//	        	}
//		    	
//	        }
//	 
//	    }
//}



/**
 * @properties={typeid:35,uuid:"D21EE4C4-D297-424E-A752-8A919D433012",variableType:-4}
 */
//var setearEnModoLecturaCampos=function(nombreForm,nameField ){
//	if(nombreForm!=null && nameField!=null ){
//		  forms[nombreForm].elements[nameField].readOnly = true;
//	}
//}

/**
 * @properties={typeid:24,uuid:"9E2DDEB9-E8C8-4FF2-B78F-9FFA9134B1C7"}
 */
function onAfterImportSolutionOpen() {
    plugins.maintenance.setMaintenanceMode(false);
}


/**
 * @properties={typeid:24,uuid:"DB7A9389-6D79-4D10-BA22-93561B00AF41"}
 */
function onBeforeImportSolutionOpen() {
	// TODO Auto-generated method stub
    plugins.maintenance.setMaintenanceMode(true);
    plugins.maintenance.sendMessageToAllClients("Aviso de Sistemas: Se estará realizando una actualización de una solución. Serás desconectado en 2 minutos. Disculpe la molestias ocasionadas.");
    application.sleep(2 * 60 * 1000);
    plugins.maintenance.sendMessageToAllClients("Se realizará la actualización. Estarás desconectado ahora");
    plugins.maintenance.shutDownAllClients();
}





/**
 * @properties={typeid:24,uuid:"53A5C1D0-FD91-4D67-8560-B907D827082F"}
 */
function modificarCampos(form) {
	// TODO Auto-generated method stub
	for (var i = 0; i < forms[form].elements.allnames.length-1; i++) {

        var name = forms[form].elements.allnames[i];   // nombre de el elemento

        forms[form].elements[name].bgcolor ="#ffffff";         // propiedades del elemento
        
	}
}
