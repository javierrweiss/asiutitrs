/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"AC94EA36-2B5F-42D0-938C-A233489250F2",variableType:4}
 */
var AtCons_vespecial_rel = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"75D4A0F7-841A-4A5A-84D4-154CE7380E8A"}
 */
var AtCons_planx = ' ';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6F61E0B3-A84C-44BE-9A40-606BC28DFB33",variableType:4}
 */
var Atcons_obrax = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"CD8AB59A-9FDB-44E0-BD85-48AA45FE9A1B",variableType:4}
 */
var AtCons_tiponom = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8BC8FE1A-4A47-4A4D-9CA0-AF2103AFDB6C",variableType:4}
 */
var Atcons_modo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E61FE3E3-95C0-48EC-AD0D-D484B2C7A19A",variableType:4}
 */
var AtCons_codart_rend = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F4EB9402-88F2-41BA-961B-9D4455632179",variableType:4}
 */
var AtCons_hora_rend = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FB855EF1-FF3C-43BC-9C01-80E962D5734E",variableType:4}
 */
var AtCons_fecha_rend = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"89074C8D-ED9B-4D58-89DA-A8204F4AEA2E",variableType:4}
 */
var AtCons_nome_panta = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D8389468-7164-4363-A25A-4DF6413E7E6D",variableType:4}
 */
var AtCons_cierre = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"99BBD94A-3A77-43DA-A05A-3755BD7811B6",variableType:4}
 */
var AtCons_periodo = 0;

/**
 * @properties={typeid:35,uuid:"818C660F-2828-4878-9D1A-F965E8FB87A5",variableType:-4}
 */
var AtCons_entrega_medicam = false;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5FCF0B23-E7A6-4992-8C23-13AC581AAEDB",variableType:4}
 */
var AtCons_obra = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8041DC6C-40CF-4950-A052-D15A99031F68",variableType:4}
 */
var atcons_especial = 0;

/**
 * @properties={typeid:35,uuid:"87905AB6-41CB-48F1-8BF1-E3B5ABD5A90C",variableType:-4}
 */
var AtCons_tiene_consulta = false;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"07D00451-D1B5-451D-9E95-8866641D996C",variableType:8}
 */
var AtCons_hiscli = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"ECD334FC-B237-465F-B8DE-EEA014BD5D03",variableType:4}
 */
var AtCons_patologico = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1E2239C3-28FC-41BB-9312-77D154D870EF",variableType:4}
 */
var AtCons_nroinforme = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3B492F46-C3C3-4E44-8694-27A1EB9B54DC",variableType:4}
 */
var AtCons_grupo = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"081D14C4-AE3E-4FBF-98DA-7218EFD4DE90"}
 */
var AtCons_codinom_ed = ' ';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4D94415B-DBEE-41D9-ADDB-7D3845DCE916",variableType:4}
 */
var AtCons_codinom = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"56EF184B-64D0-4FA0-9B7D-7CCBA39F59B0"}
 */
var AtCons_modalidad = ' ';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5FC6716E-6191-47E6-9463-B750BF67FFDB",variableType:4}
 */
var AtCons_nroPedidoUnico = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1B494797-A5CE-4537-B1A7-6D16C831A3B0",variableType:4}
 */
var AtCons_nroPedido = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BAD3155E-DE67-4665-84EB-07B106967A36",variableType:4}
 */
var AtCons_servicio = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0C98DBA0-FF70-4C66-870E-DF249C8A0D70",variableType:4}
 */
var AtCons_renglon = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"82228901-2D27-4373-A34C-25C2FF0D47D8",variableType:4}
 */
var AtCons_histcli_disponible = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A3075577-1EA3-487E-BB95-63AC15C1307E",variableType:4}
 */
var Atcons_vreservashora = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"36AFBEAE-1E02-4AA8-9655-0B613DCAEFF2"}
 */
var AtCons_vdiagnos = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"64296A21-6CA8-4F53-ABF7-D511583E9AB4",variableType:4}
 */
var AtCons_eventSourceButton = 0;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"C9D2D53C-AF8C-4688-8844-7DD8D18CC9C7",variableType:93}
 */
var fecha_desde = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"CC6FC797-97F9-4536-927A-29C372EE115A",variableType:4}
 */
var AtCons_vmedico_tipo = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"20690081-8B7A-44AC-8655-5D681AD4C715"}
 */
var Atcons_paciente_obra_plan = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"FA6B68C2-E0D9-4172-9F83-30921DB830BD"}
 */
var Atcons_paciente_obra_descr = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"53F944AD-CDA2-47D9-952A-843E8387F55B",variableType:4}
 */
var AtCons_vmedico_mat = null;

/**
 * @properties={typeid:35,uuid:"4E50AF61-7981-4AC7-A435-8E4782A4EC33",variableType:-4}
 */
var AtCons_permisos = new Array();

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D416BE8B-B4DE-4086-8C3C-DF1E59F45205",variableType:4}
 */
var Atcons_paciente_edad = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"438FF02C-6176-47A2-B51A-533E23AFC611",variableType:4}
 */
var Atcons_paciente_sexo = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2AB07573-6400-4AA5-BF28-D5ECE579EA5A"}
 */
var Atcons_paciente_nro_afil = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"AD54558E-4C02-4E47-A4EA-852F4DE7D3F0",variableType:4}
 */
var Atcons_paciente_obra = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4953C639-6B3E-4842-AFBB-B8020F7BDC24"}
 */
var Atcons_paciente_nya = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1D4924C0-0F5A-42F2-B2C3-B82527482770",variableType:4}
 */
var AtCons_vhistcli = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FD52D7D3-593D-484C-8540-F1EFE20C5D79",variableType:4}
 */
var AtCons_dieta_cod = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9F4AE6A5-76DC-42DA-AA07-8263CCC0BCF6",variableType:4}
 */
var AtCons_dos = 2;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E929E569-ECDE-4978-8785-76E0CC9CAC1B",variableType:4}
 */
var AtCons_cero = 0;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"A44E1CCD-1A6B-436D-8B9C-FCA07CE8E982",variableType:93}
 */
var AtCons_pedido_amb_hora = null;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"6DE314A7-27AC-41BE-8212-D246AB091AC5",variableType:93}
 */
var AtCons_pedido_amb_fecha = null;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"D26C233C-7E3C-4418-9F7D-C710E11C6D49",variableType:93}
 */
var AtCons_vhora_atenc = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"92FACA90-E87B-4322-916B-89C7C0531742",variableType:4}
 */
var AtCons_vfecha_integer = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"876C4C9D-0526-4FC9-9F4A-629FBF1DE91A",variableType:4}
 */
var AtCons_uno = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6980F045-5E11-47DB-932A-87AAAB52C3CD",variableType:4}
 */
var AtCons_vclave = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"22D7E540-43AF-4580-9C56-EF630EC0A932",variableType:4}
 */
var AtCons_vlegajo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"164DED45-9527-4AB6-B6FE-96B9E817F953",variableType:4}
 */
var AtCons_vespecial = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"CB3CE5A8-D866-400C-8568-583EF920ADA9"}
 */
var AtCons_vmensaje = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"EBA84527-A959-49E6-BCFB-EAFFC3246DCD"}
 */
var AtCons_vmedico = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"DAAFE849-F3D4-4061-8D12-75C9CAD49FA0",variableType:4}
 */
var AtCons_vlargo = 0;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"279079E8-0197-4489-AE4D-0E801DEEC4DB",variableType:93}
 */
var AtCons_vfecha = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1F6DEF24-58D7-4F5A-B6E4-FCFE1D91F0ED",variableType:4}
 */
var AtCons_vdigito_verificador = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"95E2892B-9CAB-4E05-AF43-AADBA2C8ED78",variableType:4}
 */
var AtCons_vlega = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"331E27BA-CC81-420D-8F5B-2CB8AF5BCB98"}
 */
var AtCons_vpassmedico = 'null';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C225C7AA-F5FC-4C03-8E8B-F9AB24E5AAB9",variableType:4}
 */
var AtCons_vhor_perlega = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4A41F127-B0F9-4174-8A2F-ABDA9EE8F15F",variableType:4}
 */
var AtCons_vhor_pertipo = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C0420157-4B60-447F-9BAB-5E52E907BCDF",variableType:4}
 */
var AtCons_vhor_peredias = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"EA778018-B82F-442F-A570-0CE98A73932F",variableType:4}
 */
var AtCons_vhor_peresemana = 0;

/**
 * @properties={typeid:24,uuid:"6F885D7D-91A2-4DA2-A73F-C255C96B255C"}
 */
function AtCons_llamada_desde_Menu(arguments) {
	// TODO copiado de MenuCirugia (<-no poner a Ã©ste como modulo)
	
	var globalVariables = solutionModel.getGlobalVariables('globals');
	for (var e in globalVariables){
		globalVariables[e] = globalVariables[e].defaultValue
		
	}
	arguments = arguments.toString()
	arguments = arguments.split(';')
	globals.vLegajo = utils.stringToNumber(arguments[0])
	globals.vLega = utils.stringToNumber(arguments[1])
	globals.vOperador = arguments[2]
	globals.vTipoOperador = utils.stringToNumber(arguments[3])
	var args_reporte  = new Array()
	var query_reporte = "select reportlegasec from tbc_report_lega where reportlegalega = ? and reportlegatipo = ?"
	var args_horper  = new Array()
	var query_horper = "select hor_persector_1, hor_persector_2, hor_persector_3, hor_persector_4, hor_persector_5, hor_persector_6 from tbc_horper_report where hor_pertipo = ? and hor_perlega = ? and hor_peredias = 0 and hor_peresemana = 0"
	var args  = new Array()
	var query = "select mensattylega, mensattytipop from tbc_mensa_tty where mensattysector = ?"
	
	var encontre_report = false
	args_reporte[0] = globals.vLega
	args_reporte[1] = globals.vTipoOperador
	var dataset_reporte = databaseManager.getDataSetByQuery("validalegajo",query_reporte,args_reporte,10)
	
	
	if (dataset_reporte.getMaxRowIndex() >0 ){
		for (var i=1 ;i <= dataset_reporte.getMaxRowIndex() ; i++){
			args[0]=dataset_reporte.getValue(i,1)
			var dataset1 = databaseManager.getDataSetByQuery("validalegajo",query,args,2000)
			if(dataset1.getMaxRowIndex() >0 ){
				for (var j = 1;j <= dataset1.getMaxRowIndex() && !encontre_report ; j++){
					if (globals.vLega == dataset1.getValue(j,1) && globals.vTipoOperador == dataset1.getValue(j,2)){
						encontre_report = true
					}
				}
			}
		}
	}
	if (!encontre_report) {
		args_horper[1]=globals.vLega
		args_horper[0]=globals.vTipoOperador
		var dataset_horper = databaseManager.getDataSetByQuery("validalegajo",query_horper,args_horper,10)
		
		if(dataset_horper.getMaxRowIndex()>0){
			for(var k=1;k<=6;k++){
				globals.vSectorReport=dataset_horper.getValue(1,k)
				args[0]=globals.vSectorReport
				var dataset2 = databaseManager.getDataSetByQuery("validalegajo",query,args,2000)
									
				if(dataset2.getMaxRowIndex()>0){
					for(var m=1;m<=dataset2.getMaxRowIndex()&&!encontre_report;m++){
						if(globals.vLega == dataset2.getValue(m,1) && globals.vTipoOperador == dataset2.getValue(m,1)){
							encontre_report = true
						}
					}
				}
			}
		}
	}
	if(encontre_report){
		plugins.dialogs.showInfoDialog("Aviso de Reportes No Leidos","Usted tiene mensajes pendientes de DirecciÃ³n General"+'\n'+"Para continuar la operaciÃ³n debe proceder a su lectura previa,"+'\n'+"en la opciÃ³n varios del MenÃº."+'\n'+"Muchas Gracias.")
		globals.vOperadorActual = globals.vOperador
		globals.vLegajoActual = globals.vLega
		application.showForm("AtCons_pideLegajo")
		//globals.vClose=true
		//application.exit()
		//var args1 = globals.vLegajo+';'+globals.vLega+';'+globals.vOperador+';'+globals.vTipoOperador+';'+"true";
		//application.closeSolution('Menu','retorno_MenuCirugia',args1)
		
		return false
	}else{  /*
		globals.vOperadorActual=globals.vOperador
		globals.vLegajoActual=globals.vLega
		application.showForm("tab_scr_tbc_admision")   */
		return true
	}
}

/**
 * Callback method for when solution is opened.
 *
 * @properties={typeid:24,uuid:"B7D885A8-1403-4F67-9337-B1F9D7A7F3BE"}
 */
function onSolutionOpen_AtCons() {
	databaseManager.setAutoSave(false)
}

/**
 * Called for performing a conversion between a database value and a displayed value.
 *
 * @param databaseValue The database value.
 * @param {String} dbType The type of the database column. Can be one of "TEXT", "INTEGER", "NUMBER", "DATETIME" or "MEDIA".
 *
 * @returns {Object} the displayed value.
 *
 * @properties={typeid:24,uuid:"5148A254-AF6F-4763-97AD-65D82D5BC29A"}
 */
function globalConverterIntaHora(databaseValue, dbType) {
	var $hora_min_string = databaseValue + ''
	 if (databaseValue < 1000 )
			 {$hora_min_string = '0' + databaseValue + ''}
	else {
	 if (databaseValue < 10000000 && databaseValue > 10000)
	 	{$hora_min_string = '0' + databaseValue + ''}
	 	}
    var $hora_string = $hora_min_string.substr(0,2)
    var $min_string = $hora_min_string.substr(2,2)

	var $valor
    if ($hora_string == '88'){
    	$valor = 'S::' + $min_string }
    else
    	{$valor = $hora_string + ':' + $min_string}

	return $valor;
}

/**
 * @param args
 * @properties={typeid:24,uuid:"F83D6223-CD1E-40EA-AE86-F232F453343F"}
 */
function llamada_a_AtencionConsultorio(args) {
	// Trae datos desde el Menu
	args = args.toString()
	args=args.split(';') 
	globals.vLegajo=utils.stringToNumber(args[0])
	globals.vLega=utils.stringToNumber(args[1])
	globals.vOperador=args[2]
	globals.vTipoOperador=utils.stringToNumber(args[3])
	globals.gbl_transacciones_1=args[4] 
	globals.vEmpresa=args[5]	
	globals.gbl_expanding_Nodes=args[6] 
	globals.gbl_title = ' '
	
	//Cargar permisos
	var $ip         = application.getIPAddress()
	var $solucion   =  application.getSolutionName()	
	var $Args       = new Array()
	var $SQL ="select  PERF.codigo_perfil, PERF.codigo_solucion, PERF.codigo_formulario, PERF.codigo_elemento, " 
             +"PERF.visible, PERF.accesible, SOL.control_acceso "
	         +"from tbl_permiso "
             +"left join tbl_perfil_itm PERF on tbl_permiso.codigo_perfil = PERF.codigo_perfil "
             +"left join tbl_solucion SOL on PERF.codigo_solucion = SOL.codigo "
             +"where tbl_permiso.codigo_legajo = "
             + globals.vLega
			 if (globals.vLega == 0){
				 $SQL = $SQL + " and ip = '"
				 + $ip + "'"
			 }
			 $SQL = $SQL + " and PERF.codigo_solucion = '"
			 + $solucion
             +"' order by PERF.codigo_perfil asc, PERF.codigo_solucion asc, PERF.codigo_formulario asc, PERF.codigo_elemento asc"
	globals.AtCons_permisos = databaseManager.getDataSetByQuery("desal", $SQL, $Args, -1);	
    var $max = globals.AtCons_permisos.getMaxRowIndex()
	if(!$max){ return}
    
    //Muestra Formulario Principal 
	
	    var $form = 'AtCons_pideLegajo'
	    
	     
	     var win = application.createWindow("Menu_itm",JSWindow.MODAL_DIALOG)	
         win.title= globals.gbl_title
         win.resizable = false
         win.show(forms[$form])
		 win.destroy()
	
}

/**
 * Called for performing a conversion between a database value and a displayed value.
 *
 * @param databaseValue The database value.
 * @param {String} dbType The type of the database column. Can be one of "TEXT", "INTEGER", "NUMBER", "DATETIME" or "MEDIA".
 *
 * @returns {Object} the displayed value.
 *
 * @properties={typeid:24,uuid:"568ADD12-ADF9-4E44-AE08-867F838C4697"}
 */
function globalConverteintafecha(databaseValue, dbType) {
	var $fec_string = databaseValue + ''
    var $anio_string = $fec_string.substr(0,4)
    var $mes_string = $fec_string.substr(4,2)
	var $dia_string = $fec_string.substr(6,2)

	var $valor
    $valor = $dia_string + '/' + $mes_string + '/' + $anio_string 

	return $valor;
	// return the original value without conversion
	//return databaseValue;
}

/**
 * Called when the valuelist needs data, it has 3 modes.
 * real and display params both null: return the whole list
 * only display is specified, called by a typeahead, return a filtered list
 * only real value is specified, called when the list doesnt contain the real value for the give record value, this will insert this value into the existing list
 *
 * @param {String} displayValue The value of a lookupfield that a user types
 * @param realValue The real value for a lookupfield where a display value should be get for
 * @param {JSRecord} record The current record for the valuelist.
 * @param {String} valueListName The valuelist name that triggers the method. (This is the FindRecord in find mode, which is like JSRecord has all the columns/dataproviders, but doesn't have its methods)
 * @param {Boolean} findMode True if foundset of this record is in find mode
 *
 * @returns {JSDataSet} A dataset with 1 or 2 columns display[,real]
 *
 * @properties={typeid:24,uuid:"4CCC6E9F-A09E-4C18-9C6F-33E84D26255D"}
 */
function getDataSetForValueList_dietas(displayValue, realValue, record, valueListName, findMode) {
	var $sql  = 'SELECT dietadescri, dietacodigo FROM tbc_dieta WHERE dietatipo = 0 '
	var $order = ' ORDER BY dietadescri'
     /** @type {Array} */
     var $args = new Array()
     var $ds
     if (displayValue == null && realValue == null) {
    	//Al comenzar, debe mostrar todo sin filtros (solo muestra 50 registros)
    		$ds = databaseManager.getDataSetByQuery('maestros',$sql+$order,$args,90)
    } else if (displayValue != null) {
		 //Cuando el usuario empieza a tipear, aca el where va a cambiar
		 //Ejemplo para buscar sobre un campo con el texto que pone el
		 //usuario que lo encuentre encualquier parte del texto
         //$sql += ' AND (upper(dietacodigo) LIKE upper(?) OR upper(dietadescri) LIKE upper(?))'
         $sql += ' AND dietadescri LIKE ? '
         $args.push('%'+displayValue.toUpperCase()+'%')
         $ds = databaseManager.getDataSetByQuery('maestros',$sql+$order,$args,90)
     } else if (realValue != null) {
    	 //Ya hay algo elegido, encuentra solo el registro elegido
         $sql += ' AND dietacodigo = ?'
         $args.push(realValue)
         $ds = databaseManager.getDataSetByQuery('maestros',$sql,$args,1)
     }
     return $ds
}

/**
 * @param {String} $texto
 * @properties={typeid:24,uuid:"E190B14D-EE50-48C6-8D46-099B6B1CAE07"}
 */
function conversion_caract_espec($texto) {
	// lista de carateres a reemplazar  los dos primeros son 'enter' y 'tab' respec.
	//var $ar_busq = ['\n','\r\n','	','Ã¡','Ã©','Ã­','Ã³','Ãº','Ã','Ã','Ã','Ã','Ã','Ã¤','Ã«','Ã¯','Ã¶','Ã¼','Ã','Ã','Ã','Ã','Âº','Âª','Ã ','Ã¨','Ã¬','Ã²','Ã¹','Ã±','Ã','Ã','Ã¥','Ã¢','Ãª','Ã®','Ã´','Ã»','Ã¿','Ã§','Ã']   // buscar todos los necesarios
	//var $ar_reem = [' ',' ',' ','a','e','i','o','u','A','E','I','O','U','a','e','i','o','u','A','E','O','U','.','.','a','e','i','o','u','#','#','A','a','a','e','i','o','u','y','c','C']
	// lista de carateres a reemplazar el primero son es 'tab' . NO trata aqui los 'enters'. Ver metodo global enter_conversion_nueva_linea   07/05/2018
	var $ar_busq = ['	','Ã¡','Ã©','Ã­','Ã³','Ãº','Ã','Ã','Ã','Ã','Ã','Ã¤','Ã«','Ã¯','Ã¶','Ã¼','Ã','Ã','Ã','Ã','Âº','Âª','Ã ','Ã¨','Ã¬','Ã²','Ã¹','Ã±','Ã','Ã','Ã¥','Ã¢','Ãª','Ã®','Ã´','Ã»','Ã¿','Ã§','Ã']   // buscar todos los necesarios
	var $ar_reem = [' ','a','e','i','o','u','A','E','I','O','U','a','e','i','o','u','A','E','O','U','.','.','a','e','i','o','u','#','#','A','a','a','e','i','o','u','y','c','C']
	//  del 032 al 095,  096 = no se,  y del 097 al 125  serÃ­an los rangos validos
	var cuantos = 0
	for (var i = 0 ; i < $ar_busq.length ; i++)
	{
		cuantos = utils.stringPatternCount($texto, $ar_busq[i])   // cuenta cuantos hay del caracter a buscar
		for (var j = 1 ; j < cuantos + 1 ; j++)    // reemplaza todos los caracteres del texto , el "replace" solo cambia el primero que encuentra
			{$texto = $texto.replace($ar_busq[i], $ar_reem[i])}
	}
	// rango valido
	for ( i = 0 ; i < $texto.length ; i++)
	{
	var $cod = $texto.charCodeAt(i)
	if ($cod < 32 || $cod > 125 )
		if ($cod != 10)  // 08/05/2018
		{$texto = $texto.replace($texto.substr(i , 1), ' ')}
	}
	return $texto
}

/**
 * 
 * @param {Number} value
 *
 * @return {String} 
 * @properties={typeid:24,uuid:"94D2BF8F-2A58-45E1-91B3-5CB61BC3AA8F"}
 */
function Hora_4_digitos(value) {
	var hora = String(value);
	var result = '0';
	
	if(value > 0){
		
		if(hora.length > 4)
			result = hora.substr(0,hora.length - 4);
	}

	return result;
}

/**
 * @properties={typeid:24,uuid:"BF9B7699-79DB-4B79-9325-2613BB349532"}
 */
function numeracion_txt($paramid) {
	var nro_tomado = null;
	var done0 = plugins.rawSQL.executeSQL("desal", "tbl_parametros", "begin; lock table tbl_parametros in row exclusive mode;")
	if (!done0) {
		var msg0 = plugins.rawSQL.getException().getMessage(); //see exception node for more info about the exception obj
		plugins.dialogs.showErrorDialog('Error', 'SQL exception: ' + msg0, 'Ok');
	}
	var done = plugins.rawSQL.executeSQL("desal", "tbl_parametros", "select * from tbl_parametros where paramid = " + $paramid + "for update;");
	if (!done) {
		var msg = plugins.rawSQL.getException().getMessage(); //see exception node for more info about the exception obj
		plugins.dialogs.showErrorDialog('Error', 'SQL exception: ' + msg, 'Ok');
	}

	var vQuery = " SELECT contador_entero FROM tbl_parametros WHERE paramid = " + $paramid;
	var vDataset = databaseManager.getDataSetByQuery("desal", vQuery, null, 1);
	
	var done1 = plugins.rawSQL.executeSQL("desal", "tbl_parametros", "update tbl_parametros set contador_entero = contador_entero + 1 where paramid = " + $paramid + "; commit;")
	if (done1) {
		
		nro_tomado = vDataset.getValue(1,1) + 1;
	}
	else{
		var msg1 = plugins.rawSQL.getException().getMessage(); //see exception node for more info about the exception obj
		plugins.dialogs.showErrorDialog('Error', 'SQL exception: ' + msg1, 'Ok')
	}
	return nro_tomado
}

/**
 * @properties={typeid:24,uuid:"77628D31-7D35-4F96-BC88-EAAAEDF6AC4D"}
 */
function Mensaje_HistoriaClinica() {
		var $fecha_tope = 20181231
		var $fechahoy = application.getServerTimeStamp() 
		var $anio = $fechahoy.getFullYear()
		var $mes  = $fechahoy.getMonth() + 1
		if ($mes < 10)
		{$mes = '0' + $mes}
		var $dia  = $fechahoy.getDate()
		if ($dia < 10)
			{$dia = '0' + $dia}
		//var $fectrahoy_aux  = $anio + '' + $mes + '' + $dia
		//var $fecha_int = utils.stringToNumber($fectrahoy_aux )
		var $fecha_int = $anio + '' + $mes + '' + $dia
		if ($fecha_int < $fecha_tope)
		{
			scopes.globals.AtCons_vmensaje = 'CONSULTA HISTORIA CLINICA CRONOLOGICA' + '\n' + 'Ya estÃ¡ disponible en la pantalla del paciente'
			globals.DIALOGS.showInfoDialog('Aviso',scopes.globals.AtCons_vmensaje,"Aceptar")
		}
}
