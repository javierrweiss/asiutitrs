/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D65672B9-79EA-40AE-B2A2-95ACAAC3E479",variableType:8}
 */
var gbl_solo_OSECAC = 0;

/**
 * @properties={typeid:35,uuid:"EE83A686-3110-40E7-9D6A-476C8B411AE5",variableType:-4}
 */
var gbl_permisos = new Array();
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"21CD5135-8380-4272-A85C-710655792E62"}
 */
var gbl_sector_des = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"CC348A1E-99E2-4CAF-9EA9-C77BC75854B9",variableType:4}
 */
var gbl_encontro = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"63BA14C3-AD00-4843-933C-C7218EF228F8",variableType:4}
 */
var gbl_habitacion_td = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5AC4C648-46D9-4E0A-9F3A-53E276FD256B",variableType:4}
 */

var gbl_cama_td = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"88697467-7040-47C5-BC59-4BAD71F0D20E",variableType:4}
 */

var gbl_hab_dis = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D5583BA6-8BD8-4170-9B21-C7B260007266",variableType:4}
 */

var gbl_hab_dial = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3B8A2854-B9E1-4CA0-A415-E79794FBC1E1"}
 */

var gbl_pac_alta = '0';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"703A19BE-F951-49C6-BC0D-0850E559B7AD",variableType:4}
 */

var gbl_pac_amb = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"659D5F94-73FF-406C-A7CA-A31DED9E7AC4",variableType:4}
 */

var gbl_pac_pedi = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E3E2E50E-2F2C-4966-BE03-844561AFEDF4",variableType:4}
 */

var gbl_pac_pase = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"99BD885F-555E-43CE-8F04-AB40ECC737B4",variableType:4}
 */

var gbl_pac_oxi = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"38511C28-B2AD-4CDC-A00B-F0BEE515C7C9",variableType:4}
 */
var gbl_pac_aislado = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2A62A5E1-8A85-421A-A54C-FED72761AE0B",variableType:4}
 */
var gbl_pac_reserva = 0;
/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1A0C5E7F-D50E-4A97-9EB7-E6279811A74C",variableType:4}
 */
var gbl_pac_obra = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"484A79E8-CA63-4C1E-BCD2-B1E8FFF3E074",variableType:4}
 */

var gbl_pac_der = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C157A966-DAE4-4D46-8E95-6044A9316F93",variableType:4}
 */

var gbl_pac_noc = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1AAEF37F-379C-4D88-9D82-2CA78140090C",variableType:4}
 */

var gbl_pac_resp = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F4EECA08-CBD1-475A-A533-4BA298292261",variableType:4}
 */

var gbl_pac_supn = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"32D1A906-1385-4336-8889-7236C2652E8A",variableType:4}
 */

var gbl_pac_pan = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F4B466CC-5DFF-4957-AEFF-3181277B7F3A",variableType:4}
 */

var gbl_pac_b_epi = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"C0813982-0495-4A46-B313-815295FE9373",variableType:4}
 */

var gbl_pac_esp_cam = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2F4B5AA8-4CED-4428-8B41-47BC3E260B95",variableType:4}
 */

var gbl_pac_egr_epi = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"EABE0F2F-37E6-423B-A33E-68D568D07C2E",variableType:4}
 */
var gbl_habita = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E7B2B1D5-EAEC-4CE2-A36F-11D8630AFCC5",variableType:4}
 */
var gbl_pres_guardia = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8D5B652E-9705-4F33-B017-19B9D6B51E16",variableType:-4}
 */
var gbl_hab_30_est_guardia = new Array();

/**
 * @properties={typeid:35,uuid:"75CCD505-7ABC-4242-BF10-EA09C141EA4A",variableType:-4}
 */
var gbl_res_ocupacion = new Array();
/**
 * @properties={typeid:35,uuid:"486B9C89-9127-4702-9C90-10ADF48CE581",variableType:-4}
 */
var gbl_res_ocupacion_cober = new Array();
/**
 * @properties={typeid:35,uuid:"26966386-76F7-408C-9397-B5110A2E8A22",variableType:-4}
 */
var gbl_res_reserva_cober = new Array();

/**
 * @properties={typeid:35,uuid:"3DA3B1F9-6589-4452-97B6-B3D40A3A6CDA",variableType:-4}
 */
var gbl_hab_321_est_guardia = new Array();

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7B7EEE39-45C3-45D1-96D4-E889DA21D622"}
 */
var gbl_cama = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"12BF4D15-1113-4D10-9EE8-E2CFC6EB0618"}
 */
var gbl_ip = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A105671E-4666-4B1E-BFEC-907B13B65D46",variableType:4}
 */
var gbl_fecha_hoy_int = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"BC29C7D6-A97B-401C-A3DD-313810558D90",variableType:4}
 */
var gbl_hora_hoy_int = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D75BE5C0-3964-49EF-9F2E-640EE29CC013",variableType:4}
 */
var gbl_fecha_ayer_int = 0;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"EE6930B9-3A07-4B93-9C3E-78C260BEE273",variableType:93}
 */
var gbl_fecha_ayer = new Date();

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F2799626-9F75-4E0D-AD4C-FD9F8328AE53",variableType:4}
 */
var gbl_quien_usa = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"65E0E888-F580-444E-8E0D-04E103D3F5C8",variableType:4}
 */
var gbl_habitacion = 0;

/**
 * Callback method for when solution is opened.
 *
 * @properties={typeid:24,uuid:"1BF1F911-8D84-4E6E-A617-CEFECDD88636"}
 */
function llamada_desde_Menu(args) {
	
	// Trae datos desde el Menu
	args = args.toString()
	args=args.split(';') 
	globals.vLegajo=utils.stringToNumber(args[0])
	globals.vLega=utils.stringToNumber(args[1])
	globals.vOperador=args[2]
	globals.vTipoOperador=utils.stringToNumber(args[3])
	globals.gbl_transacciones_1= 0 //args[4] 
	globals.vEmpresa=args[5]
	globals.gbl_expanding_Nodes=args[6]
	globals.gbl_title= 'Mapa Habitacional'
	forms.frm_menu.elements.frm_main.dividerLocation = 0.20	// divide ventana
	application.updateUI()
	
	//Cargar permisos
	var $ip         = application.getIPAddress()
	var $solucion   =  application.getSolutionName()	
	var $Args       = new Array()
	var $SQL ="select  PERF.codigo_perfil, PERF.codigo_solucion, PERF.codigo_formulario, PERF.codigo_elemento, " 
             +"PERF.visible, PERF.accesible "
	         +"from tbl_permiso "
             +"left join tbl_perfil_itm PERF on tbl_permiso.codigo_perfil = PERF.codigo_perfil "             
             +"where tbl_permiso.codigo_legajo = "
             + globals.vLega
			 if (globals.vLega == 0){
				 $SQL = $SQL + " and ip = '"
				 + $ip + "'"
			 }
			 $SQL = $SQL + " and PERF.codigo_solucion = '"
			 + $solucion
             +"' order by PERF.codigo_perfil asc, PERF.codigo_solucion asc, PERF.codigo_formulario asc, PERF.codigo_elemento asc"
    gbl_permisos = databaseManager.getDataSetByQuery("desal", $SQL, $Args, -1);	
    var $max = gbl_permisos.getMaxRowIndex()
	if(!$max){ return}	
	//Muestra Formulario Principal
	var win = application.createWindow("Menu_item",JSWindow.MODAL_DIALOG)	
    win.title= globals.gbl_title
    win.resizable = true
	win.show(forms.frm_MenuMapa)
	//win.destroy()
}
/**
 * @properties={typeid:24,uuid:"528D2B69-6F5E-40D9-9842-82C37DF50669"}
 */
function onSolutionOpen() { 
	databaseManager.setAutoSave(false)
	plugins.scheduler.removeJob('actualiza_fecha')
	plugins.scheduler.removeJob('actualiza_hora')
	
	plugins.scheduler.addCronJob('actualiza_fecha','0 0/1 * * * ?',actualiza_fecha)
	plugins.scheduler.addCronJob('actualiza_hora','0 0/15 * * * ?',forms.Mapa_Cama_todos.onShow_inicializa)
	
	// esto es para borrar la barra de menu
	plugins.window.getMenuBar().setVisible(false)
    plugins.window.setToolBarAreaVisible(false)
    
    var names1 = plugins.window.getToolbarNames();
    for (var i = 0 ; i < names1.length ; i++) {
         plugins.window.removeToolBar(names1[i])
    }    
    //plugins.window.setFullScreen(false)
    plugins.window.getMenuBar().setVisible(false)
    plugins.window.setToolBarAreaVisible(false)
	plugins.window.setStatusBarVisible(false);
}

/**
 * @properties={typeid:24,uuid:"AE27ACA4-D03F-4392-A302-2D8E1E74AF6E"}
 */
function actualiza_fecha(){
	globals.gbl_fecha_ayer = application.getServerTimeStamp()
	globals.gbl_fecha_hoy  = application.getServerTimeStamp()
}
/**
 * @param formname
 * @param rec
 *
 * @properties={typeid:24,uuid:"CF3F48C4-F597-4659-8EE1-0E0C9C0B00FD"}
 */
function printRoutine(formname, rec) {
	var frm = formname;
	var oneRecord = rec;

	if(!oneRecord) oneRecord = false

	if(!frm) return;
    forms[frm].controller.setPageFormat(210,297,5,5,10,10,1,0)
	//forms[frm].controller.showPrintPreview(oneRecord)
	forms[frm].controller.print(oneRecord)   
}
/**
 * @param formname
 * @param rec
 *
 * @properties={typeid:24,uuid:"FB49E861-8895-408E-82BD-E21FC2E77108"}
 */
function printPdfRoutine(formname, rec) {
	var frm = formname;
	var oneRecord = rec;

	if(!oneRecord) oneRecord = false

	if(!frm) return;
    forms[frm].controller.setPageFormat(210,297,5,5,10,10,1,0)
	var file = plugins.file.showFileSaveDialog("PF-080-" + application.getIPAddress() +".pdf")	
    if (file != null) {
		var pdf_file = file.getAbsolutePath()
       forms[frm].controller.print(true, false, plugins.pdf_output.getPDFPrinter(pdf_file) )
	}
   
}

/**
 * @param $form
 *
 * @properties={typeid:24,uuid:"9D884AA3-1D0D-4E79-816B-8F46E79B3595"}
 */
function controlar_elementos($form){
	var $tope_form = globals.gbl_permisos.getMaxRowIndex()
	var $element = forms[$form].elements.allnames
	var $tope_elem = $element.length
	
	for (var i = 1; i <= $tope_form; i++){		
		if ($form == globals.gbl_permisos.getValue(i,3)){
			for(var j=0;j <= $tope_elem; j++){
				if($element[j]== globals.gbl_permisos.getValue(i,4)){
					if(globals.gbl_permisos.getValue(i,5)==true){
						forms[$form].elements[$element[j]].visible = true
					}else{
						forms[$form].elements[$element[j]].visible = false
					}
					if(globals.gbl_permisos.getValue(i,6)==true){
						forms[$form].elements[$element[j]].enabled = true
					}else{
						forms[$form].elements[$element[j]].enabled = false
					}
					j = 99
				}
			}
		}
	}
}
