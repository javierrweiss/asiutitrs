/**
 * @properties={typeid:35,uuid:"73227D39-8F8D-43FB-B4FA-9A991EB806F3",variableType:-4}
 */
var vencontroCirugintDtl = false;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"61815DDA-6CB0-43AC-9695-E42D67AAFEEB"}
 */
var vciricodmed_7 = '';

/**
 * @properties={typeid:35,uuid:"3FDFD939-0F51-4941-9302-F855B8693805",variableType:-4}
 */
var vencontroNomencla = true;

/**
 * @properties={typeid:35,uuid:"9EE52523-316E-4963-BFC6-A296946058E2",variableType:-4}
 */
var vencontroProfe = true;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8B1FC56B-61D8-4F05-9D1B-0C7A8ABF05FC",variableType:4}
 */
var vtipomed_7 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"EAF7CE97-B879-462C-B3D4-CEE0C0484CE1",variableType:4}
 */
var vtipomed_6 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3E6CFCC5-97EB-4B48-81ED-EE5C331CA13E",variableType:4}
 */
var vtipomed_5 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"02198C07-176C-4244-B7C4-6835E1EC0AE7",variableType:4}
 */
var vtipomed_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4EA64341-6ACC-42DD-90E5-F15F72811E7B",variableType:4}
 */
var vtipomed_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"56B18D62-6A44-4584-ADCB-3B2EEA856BB1",variableType:4}
 */
var vtipomed_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D6840B3E-1681-445C-8A2A-0C0CFF8F9AD0",variableType:4}
 */
var vtipomed_1 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"6214D919-AC52-4842-BE20-5BEBE429F1BF"}
 */
var vApeynomCirujano = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4BD6D6A5-B641-4B2A-834E-4F55F9DA0DCF"}
 */
var vdescrimed_7 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"84C1ADF4-40E4-43A7-95D3-4430940196F8"}
 */
var vdescrimed_6 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"81F6361F-D6AA-4FF4-BD65-FCCFC0095044"}
 */
var vdescrimed_5 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"06B76D51-09BD-4F6C-B717-96CDF8B8FA18"}
 */
var vdescrimed_4 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B445E186-C056-4E4C-8CB7-79AFFF9F1F85"}
 */
var vdescrimed_3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"50D49AE1-D0DF-48D7-8875-D31AA1CF7417"}
 */
var vdescrimed_2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"27297C38-B93D-4A68-9C8B-0F5DB0C9C48C"}
 */
var vdescrimed_1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"F25691FB-F215-4450-A580-EC64F444ACBD"}
 */
var vdescrinome = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8F0FEC5B-F3E4-469E-A41E-C56EAE5E735D",variableType:4}
 */
var vciriporcen_8 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"44BA82E1-5C12-4EE3-8E7A-711671ED9CF4",variableType:4}
 */
var vciriporcen_7 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FFE27B88-1540-4106-A70E-954E40004F20",variableType:4}
 */
var vciriporcen_6 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A7040122-920D-426C-A2B5-72A51C11D355",variableType:4}
 */
var vciriporcen_5 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"757E1758-C941-42F3-840F-DCF2B823F7B7",variableType:4}
 */
var vciriporcen_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"84E75BCE-ECA6-490D-AF76-899002D64100",variableType:4}
 */
var vciriporcen_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"936A026B-FD70-4A19-8D70-B3534B988FD6",variableType:4}
 */
var vciriporcen_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"FD2A1EFC-F667-4FAB-9258-9E6F181640EE",variableType:4}
 */
var vciriporcen_1 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3CA7A81F-F932-4533-9FBF-E32B814EC6D5"}
 */
var vciricodmed_6 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"14698555-1B92-43DE-BF55-FCD632E6B390"}
 */
var vciricodmed_5 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"95930810-C8E1-4410-9D28-A7320971B4D5"}
 */
var vciricodmed_4 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8C8FC09F-BF5E-4D35-9AF0-B044E7DB2A28"}
 */
var vciricodmed_3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0468EFC7-1EBC-410B-84D0-EBA8C60A173B"}
 */
var vciricodmed_2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8DF30A90-FD0A-43A8-AD5C-BFBF712529B5"}
 */
var vciricodmed_1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4FE5ECC6-1AF2-4A2E-A6C9-DFB1AE3A6B26"}
 */
var vciricodnome = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9BBEADC5-E3FE-490A-839F-E1B9C9F7A82E",variableType:4}
 */
var vciritipnome = 0;

/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"3E539F36-9734-4155-8939-11E54075FCC5",variableType:-4}
 */
var camposObligatorios = false;

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"48A8C38A-1AF9-4170-81EC-9F82E62203E7"}
 */
function onAction_Save_tbc_cirugint_dtl(event) {
	
	
	validaCamposObligatorios()
	if (camposObligatorios){
		if(vciricodmed_1!=''&&vciricodmed_1!=null){
			foundset.ciricodmed_1=utils.stringToNumber(vciricodmed_1)
		}
		if(vciricodmed_2!=''&&vciricodmed_2!=null){	
			foundset.ciricodmed_2=utils.stringToNumber(vciricodmed_2)
		}
		if(vciricodmed_3!=''&&vciricodmed_3!=null){
			foundset.ciricodmed_3=utils.stringToNumber(vciricodmed_3)
		}
		if(vciricodmed_4!=''&&vciricodmed_4!=null){
			foundset.ciricodmed_4=utils.stringToNumber(vciricodmed_4)
		}
		if(vciricodmed_5!=''&&vciricodmed_5!=null){
			foundset.ciricodmed_5=utils.stringToNumber(vciricodmed_5)
		}
		if(vciricodmed_6!=''&&vciricodmed_6!=null){
			foundset.ciricodmed_6=utils.stringToNumber(vciricodmed_6)
		}
		
		if(globals.vciricodmed_7!=''&&globals.vciricodmed_7!=null){
			foundset.ciricodmed_7=utils.stringToNumber(globals.vciricodmed_7)
		}
		foundset.ciritipmed_1=vtipomed_1
		foundset.ciritipmed_2=vtipomed_2
		foundset.ciritipmed_3=vtipomed_3
		foundset.ciritipmed_4=vtipomed_4
		foundset.ciritipmed_5=vtipomed_5
		foundset.ciritipmed_6=vtipomed_6
		foundset.ciritipmed_7=vtipomed_7
		foundset.ciriporcen_1=vciriporcen_1
		foundset.ciriporcen_2=vciriporcen_2
		foundset.ciriporcen_3=vciriporcen_3
		foundset.ciriporcen_4=vciriporcen_4
		foundset.ciriporcen_5=vciriporcen_5
		foundset.ciriporcen_6=vciriporcen_6
		foundset.ciriporcen_7=vciriporcen_7
		foundset.ciriporcen_8=vciriporcen_8	
		
		try{
			databaseManager.saveData(foundset.getRecord(1))
			var array = databaseManager.getFailedRecords(forms.tbc_cirugint_detalle_dtl_edit.foundset)
			for (var i = 0; i < array.length; i++) {
				var record = array[i];
				// find out the table of the record (similar to getEditedRecords)
				var jstable = databaseManager.getTable(record);
				var tableSQLName = jstable.getSQLName();
				plugins.dialogs.showErrorDialog("Error de Grabación",'Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!')
				plugins.dialogs.showErrorDialog("Error en grabación de tbc_cirugint_dtl",record.exception);
				application.output(record.exception)
				if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
				// exception thrown in pre-insert/update/delete event method
					var thrown = record.exception.getValue()
					plugins.dialogs.showErrorDialog("Error de grabación","Record validation failed: " + thrown)
				}
				application.output("Error de Grabación Tabla:" + tableSQLName + " en server:" + jstable.getServerName() + " falló la grabación.")
			}
		}catch (msg){
			(plugins.dialogs.showInfoDialog("No graba detalle de Cirugia",msg.toString(),"ok"))
		}
		forms.IngresoCirugia_tab.elements.btn_new.visible=true
		forms.IngresoCirugia_tab.elements.btn_edit.visible=true
		forms.IngresoCirugia_tab.elements.btn_delete.visible=true
		forms.IngresoCirugia_tab.elements.btn_ayuda.visible=true
		forms.form116_dtl.elements.volver_form116.enabled=true
		foundset.loadAllRecords()
		//databaseManager.refreshRecordFromDatabase(foundset,1)
		vciricodmed_1=''
		vciricodmed_2=''
		vciricodmed_3=''
		vciricodmed_4=''
		vciricodmed_5=''
		vciricodmed_6=''
		vdescrimed_1=''
		vdescrimed_2=''
		vdescrimed_3=''
		vdescrimed_4=''
		vdescrimed_5=''
		vdescrimed_6=''
		vdescrimed_7=''
		vciriporcen_1=0
		vciriporcen_2=0
		vciriporcen_3=0
		vciriporcen_4=0
		vciriporcen_5=0
		vciriporcen_6=0
		vciriporcen_7=0
		vciriporcen_8=0
		vciricodnome=''
		vApeynomCirujano=''
		vciritipnome=0
		vtipomed_1=0
		vtipomed_2=0
		vtipomed_3=0
		vtipomed_4=0
		vtipomed_5=0
		vtipomed_6=0
		vtipomed_7=0
		vdescrinome=''
		globals.vNomencla=0
		globals.vNomenclaAlfa=''	
		globals.vciricodmed_7=0
		globals.vciricodmed_7descri=''
		globals.vTipoNome=1		
		forms.IngresoCirugia_tab.elements.tabless_ingreso_cirugia.tabIndex=1
	}
}

/**
 * @properties={typeid:24,uuid:"BEEB2281-BE4B-4EBA-B880-1A8C59D31C96"}
 */
function validaCamposObligatorios() {
	camposObligatorios = true
	//}else{
		
		var err_ingreso_codigo_cirugia=''
		if (vciritipnome==0||vciricodnome==''){
			err_ingreso_codigo_cirugia+="Falta ingresar código de cirugía"+'\n'
			camposObligatorios = false
		}else{
			globals.vNomenclaAlfa=vciricodnome
			if(globals.vNomenclaAlfa!=''){
				if(!BuscaNomencla()){
					err_ingreso_codigo_cirugia+="Código de cirugía no validado"+'\n'
					camposObligatorios = false
				}
			}
		}
		if (vciricodmed_1==''){
			err_ingreso_codigo_cirugia+="Falta ingresar código del Especialista"+'\n'
			camposObligatorios = false
		}else{
			if(vdescrimed_1==''){
				err_ingreso_codigo_cirugia+="Campo del Especialista no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_1)){
					err_ingreso_codigo_cirugia+="Código del Especialista erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}
		if(vciriporcen_1==0){
			err_ingreso_codigo_cirugia+="Falta ingresar porcentaje correspondiente al Especialista"+'\n'
			camposObligatorios = false
		}
		if(vciriporcen_8==0){
			err_ingreso_codigo_cirugia+="Falta ingresar porcentaje de gastos"+'\n'
			camposObligatorios = false
		}
		if (vciricodmed_2!=''){
			if(vdescrimed_2==''){
				err_ingreso_codigo_cirugia+="Campo del 1er.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_2)){
					err_ingreso_codigo_cirugia+="Código del 1er.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_2!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 1er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		if (vciricodmed_3!=''){
			if(vdescrimed_3==''){
				err_ingreso_codigo_cirugia+="Campo del 2do.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_3)){
					err_ingreso_codigo_cirugia+="Código del 2do.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_3!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 2er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}	
		}
		if (vciricodmed_4!=''){
			if(vdescrimed_4==''){
				err_ingreso_codigo_cirugia+="Campo del 3er.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_4)){
					err_ingreso_codigo_cirugia+="Código del 3er.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_4!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 3er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		if (vciricodmed_5!=''){
			if(vdescrimed_5==''){
				err_ingreso_codigo_cirugia+="Campo del Anestesiólogo no validado"+'\n'
				camposObligatorios = false
			}else{
				globals.vCodigoMedico=utils.stringToNumber(vciricodmed_5)
				vencontroProfe=true
				buscaAnestesista()
				if(!vencontroProfe){
					err_ingreso_codigo_cirugia+="Código del Anestesista erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_5!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar Anestesiólogo con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}	
		}
		if(globals.vciricodmed_7!=''){
			if(globals.vciricodmed_7descri==''){
				err_ingreso_codigo_cirugia+="Campo de la Instrumentadora no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!buscoInstrumentadora()){
					err_ingreso_codigo_cirugia+="Código de la Intrumentadora erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_7!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar Instrumentadora con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		
		if(!camposObligatorios){
			plugins.dialogs.showErrorDialog("Faltan Datos",err_ingreso_codigo_cirugia)
		}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"407F1059-CEEF-4C8E-8636-4F7DC95E9761"}
 */
function onAction_busco_Nomencla(event) {
	var win = application.createWindow("f",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Nomenclador";
	win.setSize(600,500)
	win.show(forms.frm_busqueda_nomenclador)
	if(globals.vNomencla!=0){
		vciricodnome=globals.vNomencla
		vdescrinome=globals.vNomenclaAlfa
		elements.ciri_porcen_8.requestFocus()
	}else{
		elements.ciri_codnome_codigo.requestFocus()
	}
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"E2D03175-2F52-414A-99F5-2D34FB597885"}
 */
function onDataChange_tipo_nomencla(oldValue, newValue, event) {
	globals.vTipoNome=forms.tbc_cirugint_detalle_dtl_edit.ciritiponome
	return true
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"78E241B3-57E8-4935-AE08-0AFF808E9556"}
 */
function onAction_btn_Cancel_DetalleCirugia(event) {
	/*
	try{
		forms.tbc_cirugint_detalle_dtl.foundset.deleteRecord()
	}catch (msg){
		(plugins.dialogs.showInfoDialog("No borra detalle de Cirugia",msg.toString(),"ok"))
	}
	*/
	vciricodmed_1=''
	vciricodmed_2=''
	vciricodmed_3=''
	vciricodmed_4=''
	vciricodmed_5=''
	vciricodmed_6=''
	vdescrimed_1=''
	vdescrimed_2=''
	vdescrimed_3=''
	vdescrimed_4=''
	vdescrimed_5=''
	vdescrimed_6=''
	vdescrimed_7=''
	vciriporcen_1=0
	vciriporcen_2=0
	vciriporcen_3=0
	vciriporcen_4=0
	vciriporcen_5=0
	vciriporcen_6=0
	vciriporcen_7=0
	vciriporcen_8=0
	vciricodnome=''
	vApeynomCirujano=''
	vciritipnome=0
	vtipomed_1=0
	vtipomed_2=0
	vtipomed_3=0
	vtipomed_4=0
	vtipomed_5=0
	vtipomed_6=0
	vtipomed_7=0
	vdescrinome=''
	globals.vNomencla=0
	globals.vNomenclaAlfa=''
	globals.vciricodmed_7=0
	globals.vciricodmed_7descri=''
	globals.vTipoNome=1	
	forms.IngresoCirugia_tab.elements.btn_new.visible=true
	forms.IngresoCirugia_tab.elements.btn_edit.visible=true
	forms.IngresoCirugia_tab.elements.btn_delete.visible=true
	forms.IngresoCirugia_tab.elements.btn_ayuda.visible=true
	forms.form116_dtl.elements.volver_form116.enabled=true
	forms.IngresoCirugia_tab.elements.tabless_ingreso_cirugia.tabIndex=1
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"BA9E55D5-C2C8-4F3D-BE82-28D607A894DF"}
 */
function onAction_busco_Especialista(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Especialista";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_1=globals.vCodigoMedico
		var largo=vciricodmed_1.length
		if(vciricodmed_1.substr(0,largo)!=globals.vciri_legciru){
			plugins.dialogs.showWarningDialog("Error en código","Error en código de especialista. No coincide con el Cirujano","Ok")
			vdescrimed_1=''
			vtipomed_1=0
			vciricodmed_1=''
			elements.ciri_codimed_1_codigo.requestFocus()
		}else{
			vciricodmed_1=globals.vCodigoMedico
			vtipomed_1=globals.vtipo_ciru_ie
			vdescrimed_1=globals.vApeynomMedico
			elements.ciri_porcen_1.requestFocus()
		}
	}else{
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"10586E99-E083-421C-A2FB-8086783017AB"}
 */
function onAction_busca_Ayudante1(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_1";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_2=globals.vCodigoMedico
		vtipomed_2=globals.vtipo_ciru_ie
		vdescrimed_2=globals.vApeynomMedico
		elements.ciri_porcen_2.requestFocus()
	}else{
		elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"E7986D70-E0E3-4DF5-AB1E-C4342634FF54"}
 */
function onAction_busca_Ayudante2(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_2";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_3=globals.vCodigoMedico
		vtipomed_3=globals.vtipo_ciru_ie
		vdescrimed_3=globals.vApeynomMedico
		elements.ciri_porcen_3.requestFocus()
	}else{
		elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"FC5D54FB-AE29-4F16-AA4B-C5ED64748A5B"}
 */
function onAction_busca_Ayudante3(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_3";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_4=globals.vCodigoMedico
		vtipomed_4=globals.vtipo_ciru_ie
		vdescrimed_4=globals.vApeynomMedico
		elements.ciri_porcen_4.requestFocus()
	}else{
		elements.ciri_codimed_4_codigo.requestFocus()
	}	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"00CC5936-E58F-4672-A0EC-2FC3DF6CB6DD"}
 */
function onAction_busca_Perfusionista(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Perfusionista";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_6=globals.vCodigoMedico
		vtipomed_6=globals.vtipo_ciru_ie
		vdescrimed_6=globals.vApeynomMedico
		elements.ciri_porcen_6.requestFocus()
	}else{
		elements.ciri_codimed_6_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"12C49FB1-2701-4A81-93E7-04DE1C214E13"}
 */
function onAction_busca_Instrumentista(event) {
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Instrumentadora";
	win.setSize(850,550)
	globals.vCodigoMedico=0
	win.show(forms.frm_busqueda_personal_copy)
	if(globals.vCodigoMedico!=0){
		//application.output(globals.vCodigoMedico)
		vciricodmed_7=globals.vCodigoMedico
		//application.output(vciricodmed_7)
		vtipomed_7=globals.vTipoIntrumentadora
		globals.vciricodmed_7=globals.vCodigoMedico
		globals.vciricodmed_7descri=globals.vApeynomMedico
		elements.ciri_porcen_7.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"E34DD398-170A-4446-BE2C-54D223825D39"}
 * @AllowToRunInFind
 */
function onAction_busca_Anestesista(event) {
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Anestesiólogo";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	vciricodmed_5=globals.vCodigoMedico
	var fs5 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
	fs5.find()
	fs5['medpercod']=globals.vCodigoMedico
	fs5.search(true)
	if(fs5.getSize()>0){
		fs5.setSelectedIndex(1)
		vtipomed_5=fs5['medpertipoie']
		vdescrimed_5=fs5['medperapeynom']
		vencontroProfe=true
		buscaAnestesista()
		if(vencontroProfe){
			elements.ciri_porcen_5.requestFocus()
		}else{
			plugins.dialogs.showWarningDialog("Error en Médico Anestesista","El profesional seleccionado no es un Anestesiólogo","Ok")
			vdescrimed_5=''
			vtipomed_5=0
			vciricodmed_5=''
			elements.ciri_codimed_5_codigo.requestFocus()
		}
		elements.ciri_porcen_5.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"7295FE45-645A-43FB-AA04-53431149B351"}
 */
function onAction_ciricodnome(event) {
	globals.vNomenclaAlfa=vciricodnome
	if(globals.vNomenclaAlfa!=''){
		vencontroNomencla=false
		BuscoNomenclador()
		if(vencontroNomencla){
			
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_8.requestFocus()
			
		}else{
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codnome_codigo.requestFocus()
		}
	}else{
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codnome_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"BC0A2C49-452F-4A87-ABBB-7F741209F09A"}
 */
function onAction_ciriporcen8(event) {
	if(vciriporcen_8>0){
		if(vciriporcen_8>100){
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_8.requestFocus()
		}else{
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_1_codigo.requestFocus()
		}
	}else{
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_8.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B0E39AEE-9ACF-4142-BA14-F4A65FF1072C"}
 */
function onAction_ciricodimed1(event) {
	var largo = 0;
	globals.LegajoApeynomCiru=vciricodmed_1
	globals.vTipoMedico=1
	vencontroProfe=true
	BuscoProfesional()
	if(vencontroProfe){
		if(buscaProtocoloAbierto(globals.vCodigoMedico)){
			vdescrimed_1=vApeynomCirujano
			vtipomed_1=globals.vtipo_ciru_ie
			vciricodmed_1=globals.vCodigoMedico
			if(vciricodmed_1!=null){
				largo=vciricodmed_1.length
				if(vciricodmed_1.substr(0,largo)!=globals.vciri_legciru){
					plugins.dialogs.showWarningDialog("Error en código","Error en código de especialista. No coincide con el Cirujano","Ok")
					vdescrimed_1=''
					vtipomed_1=0
					vciricodmed_1=''
					forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_1_codigo.requestFocus()
					return
				}else{
					forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_1.requestFocus()
				}
			}else{
				vdescrimed_1=''
				vtipomed_1=0
				vciricodmed_1=''
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_1_codigo.requestFocus()
			}
			
		}else{
			vdescrimed_1=''
			vtipomed_1=0
			vciricodmed_1=''
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_1_codigo.requestFocus()
		}
	}else{
		vdescrimed_1=''
		vtipomed_1=0
		vciricodmed_1=''
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"41FD4045-6FEB-4F93-9923-87C714CD62FD"}
 * @AllowToRunInFind
 */
function onAction_ciricodmed_7(event) {
	if(globals.vciricodmed_7!=0&&globals.vciricodmed_7!=null){
		var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
		var largo_codigo = utils.stringToNumber(globals.vciricodmed_7.toString().length)
		fs.find()
		fs['per_legajo']=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			globals.vciricodmed_7descri=fs['per_apelnom']
			vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
			vtipomed_7=0
			globals.vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_7.requestFocus()
		}else{
			var fs1 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
			fs1.find()
			fs1['medpercod']=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				globals.vciricodmed_7descri=fs1['medperapeynom']
				vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
				globals.vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
				vtipomed_7=fs1['medpertipoie']
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_7.requestFocus()
			}else{
				elements.ciri_codimed_7_codigo.requestFocus()
			}
		}
		
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"690620CF-7D30-4C38-84D9-2D562FCCA620"}
 */
function onAction_codimed5(event) {
	//foundset.ciritipmed_5=ciricodmed5_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_5
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			vdescrimed_5=vApeynomCirujano
			vtipomed_5=globals.vtipo_ciru_ie
			vciricodmed_5=globals.vCodigoMedico
			buscaAnestesista()
			if(vencontroProfe){
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_5.requestFocus()
			}else{
				plugins.dialogs.showWarningDialog("Error en Médico Anestesista","El profesional ingresado no es un Anestesiólogo","Ok")
				vdescrimed_5=''
				vtipomed_5=0
				vciricodmed_5=''
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_5_codigo.requestFocus()
			}
		}else{
			vdescrimed_5=''
			vtipomed_5=0
			vciricodmed_5=''
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_5_codigo.requestFocus()
		}
	}else{
		vdescrimed_5=''
		vtipomed_5=0
		vciricodmed_5=''
		forms.tbc_cirugint_detalle_dtl_edit.elements.btn_graba.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"6291E26E-1586-4E2C-B46B-BE9BEA40E636"}
 */
function onAction_codimed6(event) {
	//foundset.ciritipmed_6=ciricodmed6_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_6
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			vdescrimed_6=vApeynomCirujano
			vtipomed_6=globals.vtipo_ciru_ie
			vciricodmed_6=globals.vCodigoMedico
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_6.requestFocus()
		}else{
			vdescrimed_6=''
			vtipomed_6=0
			vciricodmed_6=''
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_6_codigo.requestFocus()
		}
	}else{
		vdescrimed_6=''
		vtipomed_6=0
		vciricodmed_6=''
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_7_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"7EC9DD98-923F-490B-9D0C-62B4D95235D0"}
 */
function onAction_codimed4(event) {
	//foundset.ciritipmed_4=ciricodmed4_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_4
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.vCodigoMedico)){
				vdescrimed_4=vApeynomCirujano
				vtipomed_4=globals.vtipo_ciru_ie
				vciricodmed_4=globals.vCodigoMedico
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_4.requestFocus()
			}else{
				vdescrimed_4=''
				vtipomed_4=0
				vciricodmed_4=0
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_4_codigo.requestFocus()
			}
		}else{
			vdescrimed_4=''
			vtipomed_4=0
			vciricodmed_4=0
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_4_codigo.requestFocus()
		}
	}else{
		vdescrimed_4=''
		vtipomed_4=0
		vciricodmed_4=''
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_6_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"8436B21C-2619-47BC-B7D2-76902495A6E1"}
 */
function onAction_codimed3(event) {
	//foundset.ciritipmed_3=ciricodmed3_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_3
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.vCodigoMedico)){
				vdescrimed_3=vApeynomCirujano
				vtipomed_3=globals.vtipo_ciru_ie
				vciricodmed_3=globals.vCodigoMedico
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_3.requestFocus()
			}else{
				vdescrimed_3=''
				vtipomed_3=0
				vciricodmed_3=0
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_3_codigo.requestFocus()
			}
		}else{
			vdescrimed_3=''
			vtipomed_3=0
			vciricodmed_3=0
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_3_codigo.requestFocus()
		}
	}else{
		vdescrimed_3=''
		vtipomed_3=0
		vciricodmed_3=''
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_4_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B240EC9B-F421-4B65-8342-CB373CB5C425"}
 */
function onAction_codimed2(event) {
	//foundset.ciritipmed_2=ciricodmed2_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_2
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.vCodigoMedico)){
				vdescrimed_2=vApeynomCirujano
				vtipomed_2=globals.vtipo_ciru_ie
				vciricodmed_2=globals.vCodigoMedico
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_porcen_2.requestFocus()
			}else{
				vdescrimed_2=''
				vtipomed_2=0
				vciricodmed_2=''
				forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_2_codigo.requestFocus()
			}
		}else{
			vdescrimed_2=''
			vtipomed_2=0
			vciricodmed_2=''
			forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_2_codigo.requestFocus()
		}
	}else{
		vdescrimed_2=''
		vtipomed_2=0
		vciricodmed_2=''
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_3_codigo.requestFocus()		
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"24F8A9BA-BEF8-44AB-BB9B-881A36F3DF95"}
 */
function onAction_ciriporcen_2(event) {
	if(vciriporcen_2>100){
		elements.ciri_porcen_2.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"C66CC637-2205-4B50-8DE3-057F99C6C6C1"}
 */
function onAction_ciriporcen_3(event) {
	if(vciriporcen_3>100){
		elements.ciri_porcen_3.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_4_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4FF5FF0B-2EEC-47B7-A337-0E32560DAF5E"}
 */
function onAction_ciriporcen_4(event) {
	if(vciriporcen_4>100){
		elements.ciri_porcen_4.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_6_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"955AB748-5A3A-4034-9244-67609A1DB200"}
 */
function onAction_ciriporcen_6(event) {
	if(vciriporcen_6>100){
		elements.ciri_porcen_6.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_7_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"A2C73B98-7DEA-4656-9A23-E0232FB36BCA"}
 */
function onAction_ciriporcen_7(event) {
	if(vciriporcen_7>100){
		elements.ciri_porcen_7.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_5_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"81ED0A5F-6171-461F-8B07-576FFB714301"}
 */
function onAction_ciriporcen_5(event) {
	if(vciriporcen_5>100){
		elements.ciri_porcen_5.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl_edit.elements.btn_graba.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D8356286-0506-4C22-86B5-2A1CE1E3DB8E"}
 */
function onAction_ayuda_tbc_cirugint_dtl(event) {
	globals.textoAyuda='AYUDA-14'
	var win = application.createWindow("p",JSWindow.MODAL_DIALOG)
	win.title = "Ayuda en Ingreso de Código de Cirugía según Nomenclador";
	win.setLocation(810,300)
	win.setSize(500,350)
	win.show(forms.frm_ayuda_gral_Z)
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"04532A27-BFBE-46BB-B71B-51703750CB1E"}
 */
function onAction_ciri_porcen_1(event) {
	if(vciriporcen_1>100){
		elements.ciri_porcen_1.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl_edit.elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"2CCA3FCA-7312-483A-86E4-5043E169A7A3"}
 * @AllowToRunInFind
 */
function onShow_tbc_cirugint_detalle_dtl(firstShow, event) {
	/*
	vciricodmed_1=''
	vciricodmed_2=''
	vciricodmed_3=''
	vciricodmed_4=''
	vciricodmed_5=''
	vciricodmed_6=''
	vdescrimed_1=''
	vdescrimed_2=''
	vdescrimed_3=''
	vdescrimed_4=''
	vdescrimed_5=''
	vdescrimed_6=''
	vdescrimed_7=''
	vciriporcen_1=0
	vciriporcen_2=0
	vciriporcen_3=0
	vciriporcen_4=0
	vciriporcen_5=0
	vciriporcen_6=0
	vciriporcen_7=0
	vciriporcen_8=0
	vciricodnome=''
	vApeynomCirujano=''
	vtipomed_1=0
	vtipomed_2=0
	vtipomed_3=0
	vtipomed_4=0
	vtipomed_5=0
	vtipomed_6=0
	vtipomed_7=0
	vdescrinome=''
	globals.vciricodmed_7=0
	globals.vciricodmed_7descri=''
	*/
	globals.vTipoNome=1
	vciritipnome=1
	var fs1 = databaseManager.getFoundSet('maestros','tbc_nomencla')
	if(fs1.find()){
		fs1['nome_tipo']=foundset.ciritiponome
		fs1['nome_codigo']=foundset.ciricodnome
		fs1.search()
		if(fs1.getSize()>0){
			fs1.setSelectedIndex(1)
			vdescrinome=fs1['nome_descr']
			vciricodnome=foundset.ciricodnome
		}else{
			vdescrinome='Código Nomenclador Inexistente'
			globals.vNomenclaAlfa=''
			
		}
	}
	var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
	fs.find()
	fs['per_legajo']=foundset.ciricodmed_7
	fs.search()
	if(fs.getSize()>0){
		fs.setSelectedIndex(1)
		globals.vciricodmed_7descri=fs['per_apelnom']
		globals.vciricodmed_7=foundset.ciricodmed_7
		vtipomed_7=foundset.ciritipmed_7
	}else{
		var fs2 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
		fs2.find()
		fs2['medpercod']=foundset.ciricodmed_7
		fs2.search()
		if(fs2.getSize()>0){
			fs2.setSelectedIndex(1)
			globals.vciricodmed_7descri=fs2['medperapeynom']
			globals.vciricodmed_7=foundset.ciricodmed_7
			foundset.ciritipmed_7=fs2['medpertipoie']
			vtipomed_7=foundset.ciritipmed_7
		}
	}
	var fs3 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
	if(foundset.ciricodmed_1!=0&&foundset.ciricodmed_1!=null){
		fs3.find()
		fs3['medpercod']=foundset.ciricodmed_1
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_1=fs3['medperapeynom']
			vciricodmed_1=foundset.ciricodmed_1
			foundset.ciritipmed_1=fs3['medpertipoie']
			vtipomed_1=foundset.ciritipmed_1
		}
	}
	if(foundset.ciricodmed_2!=0&&foundset.ciricodmed_2!=null){
		fs3.find()
		fs3['medpercod']=foundset.ciricodmed_2
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_2=fs3['medperapeynom']
			vciricodmed_2=foundset.ciricodmed_2
			foundset.ciritipmed_2=fs3['medpertipoie']
			vtipomed_2=foundset.ciritipmed_2
		}
	}
	if(foundset.ciricodmed_3!=0&&foundset.ciricodmed_3!=null){
		fs3.find()
		fs3['medpercod']=foundset.ciricodmed_3
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_3=fs3['medperapeynom']
			vciricodmed_3=foundset.ciricodmed_3
			foundset.ciritipmed_3=fs3['medpertipoie']
			vtipomed_3=foundset.ciritipmed_3
		}
	}
	if(foundset.ciricodmed_4!=0&&foundset.ciricodmed_4!=null){
		fs3.find()
		fs3['medpercod']=foundset.ciricodmed_4
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_4=fs3['medperapeynom']
			vciricodmed_4=foundset.ciricodmed_4
			foundset.ciritipmed_4=fs3['medpertipoie']
			vtipomed_4=foundset.ciritipmed_4
		}
	}
	if(foundset.ciricodmed_5!=0&&foundset.ciricodmed_5!=null){
		fs3.find()
		fs3['medpercod']=foundset.ciricodmed_5
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_5=fs3['medperapeynom']
			vciricodmed_5=foundset.ciricodmed_5
			foundset.ciritipmed_5=fs3['medpertipoie']
			vtipomed_5=foundset.ciritipmed_5
		}
	}
	if(foundset.ciricodmed_6!=0&&foundset.ciricodmed_6!=null){
		fs3.find()
		fs3['medpercod']=foundset.ciricodmed_6
		fs3.search()
		if(fs3.getSize()>0){
			fs3.setSelectedIndex(1)
			vdescrimed_6=fs3['medperapeynom']
			vciricodmed_6=foundset.ciricodmed_6
			foundset.ciritipmed_6=fs3['medpertipoie']
			vtipomed_6=foundset.ciritipmed_6
		}
	}
	vciriporcen_1=foundset.ciriporcen_1
	vciriporcen_2=foundset.ciriporcen_2
	vciriporcen_3=foundset.ciriporcen_3
	vciriporcen_4=foundset.ciriporcen_4
	vciriporcen_5=foundset.ciriporcen_5
	vciriporcen_6=foundset.ciriporcen_6
	vciriporcen_7=foundset.ciriporcen_7
	vciriporcen_8=foundset.ciriporcen_8
	controller.focusFirstField()
	//elements.ciri_codnome_codigo.requestFocus()
	
	//forms.tbc_cirugint_detalle_dtl.foundset.newRecord()
	//globals.InicializarDatos('tbc_cirugint_detalle_dtl','asistencial','tbc_cirugint_dtl')
}

/**
 * @properties={typeid:24,uuid:"70CE9569-B347-43FF-9369-D110790CFE09"}
 * @AllowToRunInFind
 */
function BuscoProfesional() {
	var largo = globals.LegajoApeynomCiru.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero == true; i++){
		if (globals.LegajoApeynomCiru.charCodeAt(i)< 48 || globals.LegajoApeynomCiru.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_medicos_personal')
		if(fs.find()){
			fs['medpercod']=utils.stringToNumber(globals.LegajoApeynomCiru.substr(0,largo-1))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				vApeynomCirujano=fs['medperapeynom']
				globals.vtipo_ciru_ie=fs['medpertipoie']
				globals.vCodigoMedico=fs['medpercod']
				globals.LegajoApeynomCiru=''
				vencontroProfe=true
			}else{
				vApeynomCirujano='Profesional Inexistente'
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
    }else{
        globals.vProfeAlfa = globals.LegajoApeynomCiru.toLocaleUpperCase()
 	    var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
		win.title = "Búsqueda de Código de Cirujano";
		win.setSize(850,550)
		win.show(forms.frm_busqueda_medicos_personal_cpy)
		vApeynomCirujano=globals.vApeynomMedico
		globals.LegajoApeynomCiru=''
		vencontroProfe=true	
    }
}

/**
 * @properties={typeid:24,uuid:"D46F0C1E-14EE-4FFF-91F2-0AAEEEFFDF87"}
 * @AllowToRunInFind
 */
function BuscoNomenclador() {
	var largo = globals.vNomenclaAlfa.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero; i++){
		if (globals.vNomenclaAlfa.charCodeAt(i)< 48 || globals.vNomenclaAlfa.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_nomencla')
		if(fs.find()){
			fs['nome_tipo']=vciritipnome
			fs['nome_codigo']=utils.stringToNumber(globals.vNomenclaAlfa.substr(0,largo))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				vdescrinome=fs['nome_descr']
				globals.vNomencla=fs['nome_codigo']
				vciricodnome=globals.vNomencla
				vencontroNomencla=true
			}else{
				vdescrinome='Código Nomenclador Inexistente'
				globals.vNomenclaAlfa=''
				vciricodnome=''	
				vencontroNomencla=false
			}
		}
    }else{
    	globals.vNomencla=0
        globals.vNomenclaAlfa = globals.vNomenclaAlfa.toLocaleUpperCase()
 	    var win = application.createWindow("f",JSWindow.MODAL_DIALOG)
 	    win.title = "Búsqueda de Código de Nomenclador";
 	    win.setSize(600,500)
 	    win.show(forms.frm_busqueda_nomenclador)
		if(globals.vNomencla>0){
			vciricodnome=globals.vNomencla
			vdescrinome=globals.vNomenclaAlfa
			vencontroNomencla=true
		}else{
			vencontroNomencla=false
		}
    }
}

/**
 * @returns {Boolean} successfull or not
 *
 * @properties={typeid:24,uuid:"6C1A57BD-E524-4ECB-AD9B-1393512802BE"}
 * @AllowToRunInFind
 */
function BuscoCirugintDtl() {
	var fs = databaseManager.getFoundSet('asistencial','tbc_cirugint_dtl')
	if(fs.find()){
		fs['cirihistcl']=globals.vHiscli
		fs['cirifechacarga']=globals.vFechaCarga
		fs['cirihoracarga']=globals.vHoraCarga
		fs['ciricodnome']=utils.stringToNumber(vciricodnome)
		fs['ciritiponome']=vciritipnome
		fs.search()
		if(fs.getSize()>0){
			return true
		}else{
			return false
		}
	}else{
		return false
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"0AE04A04-FA47-4BC6-92B9-5A2795E6F80F"}
 */
function buscaAnestesista() {
	if(globals.vtipo_ciru_ie==0){
		var fs = databaseManager.getFoundSet('maestros','tbc_personal')
		if(fs.find()){
			fs['per_legajo']=globals.vCodigoMedico
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				if(fs['per_espemed']==24){
					globals.LegajoApeynomCiru=fs['per_apellnom']
					vencontroProfe=true
				}else{
					globals.LegajoApeynomCiru=''
					vencontroProfe=false
				}
			}else{
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
	}else{
		var fs1 = databaseManager.getFoundSet('maestros','tbc_medicos')
		if(fs1.find()){
			fs1['med_codigo']=globals.vCodigoMedico
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				if(fs1['med_espemed']==24){
					globals.LegajoApeynomCiru=fs1['med_apenom']
					vencontroProfe=true
				}else{
					globals.LegajoApeynomCiru=''
					vencontroProfe=false
				}
			}else{
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
	}
}

/**
 * @properties={typeid:24,uuid:"2ADCA5EB-5C19-48DC-8224-76807A56B7EE"}
 */
function buscaProtocoloAbierto(codigo) {
	var fecha_actual=application.getServerTimeStamp();
	var anio = fecha_actual.getFullYear();
	var mes = fecha_actual.getMonth();
	var dia = fecha_actual.getDate();
	var mes_ed='';
	var dia_ed='';
	if(mes<10){
		mes_ed='0'+mes
	}else{
		mes_ed=mes
	}
	var protocolo_abierto='';
	var kant_protocolos_abiertos=0;
	var fecha_selec=anio+''+mes_ed+''+'01'
	var sql = "select ciriprotocolo, cirilegciru from tbc_cirugint where CiriFechaCarga>="+fecha_selec+" and CiriEstado=0 and CiriTipoNome=0"
	var dataset = databaseManager.getDataSetByQuery("asistencial",sql,null,-1)
	var kanti = dataset.getMaxRowIndex()
	if(kanti>0){
		for(var i=1;i<=kanti;i++){
			if(dataset.getValue(i,1)!=globals.vNroProtocolo){
				var sql2 = "select ciricodmed_1, ciricodmed_2, ciricodmed_3, ciricodmed_4, ciricodmed_5, ciricodmed_6, ciricodmed_7, ciricodmed_8, ciricodmed_9, ciricodmed_10 from tbc_cirugint_dtl where CiriProtocolo="+dataset.getValue(i,1)+" and CiriTipoNome<>0"
				var dataset2 = databaseManager.getDataSetByQuery("asistencial",sql2,null,-1)
				var kanti2 = dataset2.getMaxRowIndex()
				if(kanti2>0){
					for(var j=1;j<=kanti2;j++){
						for(var k=1;k<=10;k++){
							if(codigo==dataset2.getValue(j,k)){
								kant_protocolos_abiertos++
								protocolo_abierto+=dataset.getValue(i,1)
							}
						}
					}
				}
			}	
		}
		if(kant_protocolos_abiertos>0){
			plugins.dialogs.showWarningDialog("Protocolo sin Cerrar","El Profesional tiene el protocolo "+protocolo_abierto+" sin cerrar","Ok")
			return false
		}else{
			return true
		}
	}else{
		return true
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"EBA2F0E0-9123-4BA5-8560-2379074C8878"}
 */
function onFocusLost_codimed(event) {
	if(!buscaProtocoloAbierto(vciricodmed_1)){
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param codigo
 * @param codimed
 *
 * @properties={typeid:24,uuid:"0CEEF4C9-907E-4EF9-B698-7D42B4AE3840"}
 */
function lost_codimed(codigo,codimed){
	if(buscaProtocoloAbierto(codigo)){
		return true
	}else{
		elements['ciri_codimed_'+codimed+'_codigo'].requestFocus()
		return false
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"1ABCC376-4AA7-41B2-B462-40F8C5ABB4C8"}
 */
function onFocusLost_ciricodmed2(event) {
	if(!buscaProtocoloAbierto(vciricodmed_2)){
		elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"1E87516A-829E-4F88-B11B-4DBB746AD1CE"}
 */
function onFocusLost_ciricodmed3(event) {
	if(!buscaProtocoloAbierto(vciricodmed_3)){
		elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"973202E8-2DDC-4E5D-9679-C741C34B22A2"}
 */
function onFocusLost_ciricodmed4(event) {
	if(!buscaProtocoloAbierto(vciricodmed_4)){
		elements.ciri_codimed_4_codigo.requestFocus()
	}
}

/**
 * @AllowToRunInFind
 * 
 * TODO generated, please specify type and doc for the params
 * @param codigo
 *
 * @properties={typeid:24,uuid:"72C6799C-80DD-46A1-B57B-861DA59B18E8"}
 */
function validoProfesional(codigo) {
	var fs = databaseManager.getFoundSet('maestros','tbc_medicos_personal')
	//var largo = codigo.length
	if(fs.find()){
		fs['medpercod']=utils.stringToNumber(codigo)
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			if(buscaProtocoloAbierto(fs['medpercod'])){
				return true
			}else{
				return false
			}
		}else{
				return false
		}
	}else{
		return false
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"4F867889-C6D8-4E12-89D2-5099759CD71D"}
 */
function BuscaNomencla() {
	var largo = globals.vNomenclaAlfa.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero; i++){
		if (globals.vNomenclaAlfa.charCodeAt(i)< 48 || globals.vNomenclaAlfa.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_nomencla')
		if(fs.find()){
			fs['nome_tipo']=vciritipnome
			fs['nome_codigo']=utils.stringToNumber(globals.vNomenclaAlfa.substr(0,largo))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				vdescrinome=fs['nome_descr']
				globals.vNomencla=fs['nome_codigo']
				vciricodnome=globals.vNomencla
				return true
			}else{
				vdescrinome='Código Nomenclador Inexistente'
				globals.vNomenclaAlfa=''
				vciricodnome=''	
				return false
			}
		}else{
			return false
		}
    }else{
    	return false
    }
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"EA7D50ED-3D51-4305-9951-AC3A059756D5"}
 */
function buscoInstrumentadora() {
	if(globals.vciricodmed_7!=0&&globals.vciricodmed_7!=null){
		var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
		var largo_codigo = utils.stringToNumber(globals.vciricodmed_7.toString().length)
		fs.find()
		fs['per_legajo']=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo))
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			globals.vciricodmed_7descri=fs['per_apelnom']
			vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo))
			return true
		}else{
			var fs1 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
			fs1.find()
			fs1['medpercod']=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo))
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				globals.vciricodmed_7descri=fs1['medperapeynom']
				vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo))
				vtipomed_7=fs1['medpertipoie']
				return true
			}else{
				return false
			}
		}
		
	}else{
		return false
	}
}

