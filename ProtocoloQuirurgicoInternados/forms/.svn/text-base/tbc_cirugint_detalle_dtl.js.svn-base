/**
 * @properties={typeid:35,uuid:"D0B35A09-813F-46B8-90DB-FB39371E7076",variableType:-4}
 */
var vencontroCirugintDtl = false;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"D2CDE3DE-561A-4ED6-AFD8-6C0D78A89D8F"}
 */
var vciricodmed_7 = '';

/**
 * @properties={typeid:35,uuid:"9327137C-98E0-4014-9C98-F55C8FAB88AF",variableType:-4}
 */
var vencontroNomencla = true;

/**
 * @properties={typeid:35,uuid:"BA4F7AEF-C8C3-4A76-83B5-507E0AD891D4",variableType:-4}
 */
var vencontroProfe = true;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6B4BC8CA-66BD-456F-8E3E-6CD2690F6EE5",variableType:4}
 */
var vtipomed_7 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"201B173A-A3BD-4F58-9E10-D608B36D31BA",variableType:4}
 */
var vtipomed_6 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B91285E4-AF32-4E63-8E7E-9F721D4332CE",variableType:4}
 */
var vtipomed_5 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6A5BF72A-5253-4F45-91C5-302A7ABAE45B",variableType:4}
 */
var vtipomed_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F6E98685-E2FA-4794-9EF0-A2769A649AA8",variableType:4}
 */
var vtipomed_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7CEDDB30-C7A9-4DBC-9E36-79D1B2C3D7C1",variableType:4}
 */
var vtipomed_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6DE15086-2AE0-403C-9231-8DE906EA775F",variableType:4}
 */
var vtipomed_1 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"088FF4BF-AB99-4FA1-8047-76A4CDEC1BD5"}
 */
var vApeynomCirujano = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"10685FC8-C6BB-41C1-862D-C0A2A9E95440"}
 */
var vdescrimed_7 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"AAEA2816-ED49-4EEA-A26D-5B89FCFA177C"}
 */
var vdescrimed_6 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2B0E4210-FB68-4D9D-8057-0E027B24B5EF"}
 */
var vdescrimed_5 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"B5A135B7-38CC-465E-88B4-3F5D6AD743E4"}
 */
var vdescrimed_4 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"801D7828-A448-4B93-8328-170E69B5B90D"}
 */
var vdescrimed_3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"85F3141E-FC32-4B74-8C01-BE6E9F69FD3B"}
 */
var vdescrimed_2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"F267C30A-D4CF-4712-820B-9A129AE6AAE7"}
 */
var vdescrimed_1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2B7AE989-C34F-47D6-893A-0946C7CBBFD5"}
 */
var vdescrinome = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"688A6C3F-59BB-4F61-B2EE-5FF0988D6F51",variableType:4}
 */
var vciriporcen_8 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D8F70F0C-5AFC-400D-9262-C5728E38F0FE",variableType:4}
 */
var vciriporcen_7 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"972D1CE7-2B35-4A3D-A610-7FB0908954DC",variableType:4}
 */
var vciriporcen_6 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"528FAADE-E66E-4644-B931-A74A7A4C077F",variableType:4}
 */
var vciriporcen_5 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2B0A8FE5-34FC-4DF0-91BD-4A57796C5F06",variableType:4}
 */
var vciriporcen_4 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F054D424-24C0-4093-8F4E-85FC0B4D8E12",variableType:4}
 */
var vciriporcen_3 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"48C451A7-D357-4F22-A125-1A5A71D92AC8",variableType:4}
 */
var vciriporcen_2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"E332EB12-B387-400A-8267-B109244595A9",variableType:4}
 */
var vciriporcen_1 = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"FB08205D-C012-4596-8D2F-C4A78517C9C8"}
 */
var vciricodmed_6 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"389ACD1A-C64A-485D-ACB8-A59CACF22161"}
 */
var vciricodmed_5 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"78F77FDB-D450-481B-9AE3-6A4F8F71E598"}
 */
var vciricodmed_4 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3A15C5CB-A1E4-43A0-AE82-1FF57D3AB68A"}
 */
var vciricodmed_3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"F984086B-DCEA-4D1E-87E6-B32F50F0FFE2"}
 */
var vciricodmed_2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0BB50E3D-7570-45A3-8D09-72230E0338AD"}
 */
var vciricodmed_1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"17C779FA-481E-43A7-8A1D-F3B1AED541DE"}
 */
var vciricodnome = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D358F289-0A32-46AE-91A9-2DBAC731E263",variableType:4}
 */
var vciritipnome = 0;

/**
 * @type {Boolean}
 *
 * @properties={typeid:35,uuid:"F11D6A8E-09CC-4E5C-8D85-21F1656778C6",variableType:-4}
 */
var camposObligatorios = false;

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"AE2F08C6-F82C-4718-8F60-B672571E8ABD"}
 */
function onAction_Save_tbc_cirugint_dtl(event) {
	validaCamposObligatorios()
	if (camposObligatorios){
		forms.tbc_cirugint_detalle_dtl.foundset.newRecord()
		globals.InicializarDatos('tbc_cirugint_detalle_dtl','asistencial','tbc_cirugint_dtl')
		var fecha_actual = application.getServerTimeStamp()
		var aniocarga = fecha_actual.getFullYear()
		var mescarga = fecha_actual.getMonth()+1
		var diacarga = fecha_actual.getDate()
		var mescarga_ed
		var diacarga_ed
		if(mescarga<10){
			mescarga_ed='0'+mescarga
		}else{
			mescarga_ed = mescarga
		}
		if(diacarga<10){
			diacarga_ed='0'+diacarga
		}else{
			diacarga_ed=diacarga
		}
		var hora=utils.stringToNumber(fecha_actual.getHours().toString())
		var min =utils.stringToNumber(fecha_actual.getMinutes().toString())
		var min_ed=''
	    var hora_ed=''
	    if(hora < 10){
	    	hora_ed='0'+hora
		}else{
			hora_ed=hora
		}	    
		if (min < 10){
			min_ed='0'+min
		}else{
			min_ed=min
		}
		var seg =utils.stringToNumber(fecha_actual.getSeconds().toString())
		var seg_ed=''
		if (seg < 10){
			seg_ed='0'+seg
		}else{
			seg_ed=seg
		}
		var hora_hoy=hora_ed+''+min_ed+''+seg_ed
		foundset.cirihistcl=globals.vHiscli
		foundset.cirifechacarga=aniocarga+''+mescarga_ed+''+diacarga_ed
		foundset.cirihoracarga=hora_hoy
		foundset.cirifechacarga1=aniocarga+''+mescarga_ed+''+diacarga_ed
		foundset.cirihoracarga1=hora_hoy
		foundset.ciriprotocolo=globals.vNroProtocolo
		foundset.ciricodnome=utils.stringToNumber(vciricodnome)
		foundset.ciritiponome=vciritipnome
		
		if(vciricodmed_1!=''&&vciricodmed_1!=null){
			foundset.ciricodmed_1=utils.stringToNumber(vciricodmed_1)
		}
		if(vciricodmed_2!=''&&vciricodmed_2!=null){	
			foundset.ciricodmed_2=utils.stringToNumber(vciricodmed_2)
		}
		if(vciricodmed_3!=''&&vciricodmed_3!=null){
			foundset.ciricodmed_3=utils.stringToNumber(vciricodmed_3)
		}
		if(vciricodmed_4!=''&&vciricodmed_4!=null){
			foundset.ciricodmed_4=utils.stringToNumber(vciricodmed_4)
		}
		if(vciricodmed_5!=''&&vciricodmed_5!=null){
			foundset.ciricodmed_5=utils.stringToNumber(vciricodmed_5)
		}
		if(vciricodmed_6!=''&&vciricodmed_6!=null){
			foundset.ciricodmed_6=utils.stringToNumber(vciricodmed_6)
		}
		
		
		if(globals.vciricodmed_7!=''&&globals.vciricodmed_7!=null){
			foundset.ciricodmed_7=utils.stringToNumber(globals.vciricodmed_7)
		}
		foundset.ciritipmed_1=vtipomed_1
		foundset.ciritipmed_2=vtipomed_2
		foundset.ciritipmed_3=vtipomed_3
		foundset.ciritipmed_4=vtipomed_4
		foundset.ciritipmed_5=vtipomed_5
		foundset.ciritipmed_6=vtipomed_6
		foundset.ciritipmed_7=vtipomed_7
		foundset.ciriporcen_1=vciriporcen_1
		foundset.ciriporcen_2=vciriporcen_2
		foundset.ciriporcen_3=vciriporcen_3
		foundset.ciriporcen_4=vciriporcen_4
		foundset.ciriporcen_5=vciriporcen_5
		foundset.ciriporcen_6=vciriporcen_6
		foundset.ciriporcen_7=vciriporcen_7
		foundset.ciriporcen_8=vciriporcen_8
		
		try{
			databaseManager.saveData(forms.tbc_cirugint_detalle_dtl.foundset.getRecord(1))
			var array = databaseManager.getFailedRecords(forms.tbc_cirugint_detalle_dtl.foundset)
			for (var i = 0; i < array.length; i++) {
				var record = array[i];
				// find out the table of the record (similar to getEditedRecords)
				var jstable = databaseManager.getTable(record);
				var tableSQLName = jstable.getSQLName();
				plugins.dialogs.showErrorDialog("Error de Grabación",'Tabla:' + tableSQLName + ' en server:' + jstable.getServerName() + ' falló la grabación. Avise urgente a Sistemas, por favor!')
				plugins.dialogs.showErrorDialog("Error en grabación de tbc_cirugint_dtl",record.exception);
				application.output(record.exception)
				if (record.exception.getErrorCode() == ServoyException.RECORD_VALIDATION_FAILED) {
				// exception thrown in pre-insert/update/delete event method
					var thrown = record.exception.getValue()
					plugins.dialogs.showErrorDialog("Error de grabación","Record validation failed: " + thrown)
				}
				application.output("Error de Grabación Tabla:" + tableSQLName + " en server:" + jstable.getServerName() + " falló la grabación.")
			}
		}catch (msg){
			(plugins.dialogs.showInfoDialog("No graba detalle de Cirugia",msg.toString(),"ok"))
		}
		forms.IngresoCirugia_tab.elements.btn_new.visible=true
		forms.IngresoCirugia_tab.elements.btn_edit.visible=true
		forms.IngresoCirugia_tab.elements.btn_delete.visible=true
		forms.IngresoCirugia_tab.elements.btn_ayuda.visible=true
		forms.form116_dtl.elements.volver_form116.enabled=true
		foundset.loadAllRecords()
		//databaseManager.refreshRecordFromDatabase(foundset,1)
		vciricodmed_1=''
		vciricodmed_2=''
		vciricodmed_3=''
		vciricodmed_4=''
		vciricodmed_5=''
		vciricodmed_6=''
		vdescrimed_1=''
		vdescrimed_2=''
		vdescrimed_3=''
		vdescrimed_4=''
		vdescrimed_5=''
		vdescrimed_6=''
		vdescrimed_7=''
		vciriporcen_1=0
		vciriporcen_2=0
		vciriporcen_3=0
		vciriporcen_4=0
		vciriporcen_5=0
		vciriporcen_6=0
		vciriporcen_7=0
		vciriporcen_8=0
		vciricodnome=''
		vApeynomCirujano=''
		vciritipnome=0
		vtipomed_1=0
		vtipomed_2=0
		vtipomed_3=0
		vtipomed_4=0
		vtipomed_5=0
		vtipomed_6=0
		vtipomed_7=0
		vdescrinome=''
		globals.vNomencla=0
		globals.vNomenclaAlfa=''	
		globals.vciricodmed_7=0
		globals.vciricodmed_7descri=''
		globals.vTipoNome=1		
		forms.IngresoCirugia_tab.elements.tabless_ingreso_cirugia.tabIndex=1
	}
}

/**
 * @properties={typeid:24,uuid:"2F7C7780-0765-4C6D-A0B0-A6B5B74DC66C"}
 */
function validaCamposObligatorios() {
	
	//if(vciritipnome!=0&&vciricodnome!=''&&vciricodmed_1!=''&&vciriporcen_1!=0&&vciriporcen_8!=0){
		camposObligatorios = true
	//}else{
		
		var err_ingreso_codigo_cirugia=''
		if (vciritipnome==0||vciricodnome==''){
			err_ingreso_codigo_cirugia+="Falta ingresar código de cirugía"+'\n'
			camposObligatorios = false
		}else{
			if(vdescrinome==''){
				err_ingreso_codigo_cirugia+="Código de cirugía no validado"+'\n'
				camposObligatorios = false
			}else{
				globals.vNomenclaAlfa=vciricodnome
				if(globals.vNomenclaAlfa!=''){
					if(!BuscaNomencla()){
						err_ingreso_codigo_cirugia+="Código de cirugía no validado"+'\n'
						camposObligatorios = false
					}
				}
			}
		}
		if (vciricodmed_1==''){
			err_ingreso_codigo_cirugia+="Falta ingresar código del Especialista"+'\n'
			camposObligatorios = false
		}else{
			if(vdescrimed_1==''){
				err_ingreso_codigo_cirugia+="Campo del Especialista no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_1)){
					err_ingreso_codigo_cirugia+="Código del Especialista erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}
		if(vciriporcen_1==0){
			err_ingreso_codigo_cirugia+="Falta ingresar porcentaje correspondiente al Especialista"+'\n'
			camposObligatorios = false
		}
		if(vciriporcen_8==0){
			err_ingreso_codigo_cirugia+="Falta ingresar porcentaje de gastos"+'\n'
			camposObligatorios = false
		}
		if (vciricodmed_2!=''){
			if(vdescrimed_2==''){
				err_ingreso_codigo_cirugia+="Campo del 1er.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_2)){
					err_ingreso_codigo_cirugia+="Código del 1er.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_2!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 1er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		if (vciricodmed_3!=''){
			if(vdescrimed_3==''){
				err_ingreso_codigo_cirugia+="Campo del 2do.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_3)){
					err_ingreso_codigo_cirugia+="Código del 2do.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_3!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 2er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}	
		}
		if (vciricodmed_4!=''){
			if(vdescrimed_4==''){
				err_ingreso_codigo_cirugia+="Campo del 3er.Ayudante no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!validoProfesional(vciricodmed_4)){
					err_ingreso_codigo_cirugia+="Código del 3er.Ayudante erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_4!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar 3er.Ayudante con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		if (vciricodmed_5!=''){
			if(vdescrimed_5==''){
				err_ingreso_codigo_cirugia+="Campo del Anestesiólogo no validado"+'\n'
				camposObligatorios = false
			}else{
				globals.vCodigoMedico=utils.stringToNumber(vciricodmed_5)
				globals.vtipo_ciru_ie=vtipomed_5
				vencontroProfe=true
				buscaAnestesista()
				if(!vencontroProfe){
					err_ingreso_codigo_cirugia+="Código del Anestesista erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_5!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar Anestesiólogo con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}	
		}
		if(globals.vciricodmed_7!=''){
			if(globals.vciricodmed_7descri==''){
				err_ingreso_codigo_cirugia+="Campo de la Instrumentadora no validado"+'\n'
				camposObligatorios = false
			}else{
				if(!buscoInstrumentadora()){
					err_ingreso_codigo_cirugia+="Código de la Intrumentadora erróneo"+'\n'
					camposObligatorios = false
				}
			}
		}else{
			if(vciriporcen_7!=0){
				err_ingreso_codigo_cirugia+="Falta ingresar Instrumentadora con porcentaje ingresado."+'\n'
				camposObligatorios = false
			}
		}
		
		if(!camposObligatorios){
			plugins.dialogs.showErrorDialog("Faltan Datos",err_ingreso_codigo_cirugia)
		}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"10A8DB4F-6A57-46CC-BDAE-ACE5F1CD571D"}
 */
function onAction_busco_Nomencla(event) {
	var win = application.createWindow("f",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Nomenclador";
	win.setSize(600,500)
	win.show(forms.frm_busqueda_nomenclador)
	if(globals.vNomencla!=0){
		vciricodnome=globals.vNomencla
		vdescrinome=globals.vNomenclaAlfa
		elements.ciri_porcen_8.requestFocus()
	}else{
		elements.ciri_codnome_codigo.requestFocus()
	}
}

/**
 * Handle changed data.
 *
 * @param oldValue old value
 * @param newValue new value
 * @param {JSEvent} event the event that triggered the action
 *
 * @returns {Boolean}
 *
 * @properties={typeid:24,uuid:"554D05FB-D422-471F-820C-722CA307F502"}
 */
function onDataChange_tipo_nomencla(oldValue, newValue, event) {
	globals.vTipoNome=forms.tbc_cirugint_detalle_dtl.ciritiponome
	return true
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"C9D3C9BF-2763-4B06-A382-AE29E1654689"}
 */
function onAction_btn_Cancel_DetalleCirugia(event) {
	/*
	try{
		forms.tbc_cirugint_detalle_dtl.foundset.deleteRecord()
	}catch (msg){
		(plugins.dialogs.showInfoDialog("No borra detalle de Cirugia",msg.toString(),"ok"))
	}
	*/
	vciricodmed_1=''
	vciricodmed_2=''
	vciricodmed_3=''
	vciricodmed_4=''
	vciricodmed_5=''
	vciricodmed_6=''
	vdescrimed_1=''
	vdescrimed_2=''
	vdescrimed_3=''
	vdescrimed_4=''
	vdescrimed_5=''
	vdescrimed_6=''
	vdescrimed_7=''
	vciriporcen_1=0
	vciriporcen_2=0
	vciriporcen_3=0
	vciriporcen_4=0
	vciriporcen_5=0
	vciriporcen_6=0
	vciriporcen_7=0
	vciriporcen_8=0
	vciricodnome=''
	vApeynomCirujano=''
	vciritipnome=0
	vtipomed_1=0
	vtipomed_2=0
	vtipomed_3=0
	vtipomed_4=0
	vtipomed_5=0
	vtipomed_6=0
	vtipomed_7=0
	vdescrinome=''
	globals.vNomencla=0
	globals.vNomenclaAlfa=''
	globals.vciricodmed_7=0
	globals.vciricodmed_7descri=''
	globals.vTipoNome=1	
	forms.IngresoCirugia_tab.elements.btn_new.visible=true
	forms.IngresoCirugia_tab.elements.btn_edit.visible=true
	forms.IngresoCirugia_tab.elements.btn_delete.visible=true
	forms.IngresoCirugia_tab.elements.btn_ayuda.visible=true
	forms.form116_dtl.elements.volver_form116.enabled=true
	forms.IngresoCirugia_tab.elements.tabless_ingreso_cirugia.tabIndex=1
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"B4FE3ED7-7548-47D0-BC09-AA78C57A0E67"}
 */
function onAction_busco_Especialista(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Especialista";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_1=globals.vCodigoMedico
		var largo=vciricodmed_1.length
		if(vciricodmed_1.substr(0,largo)!=globals.vciri_legciru){
			plugins.dialogs.showWarningDialog("Error en código","Error en código de especialista. No coincide con el Cirujano","Ok")
			vdescrimed_1=''
			vtipomed_1=0
			vciricodmed_1=''
			elements.ciri_codimed_1_codigo.requestFocus()
		}else{
			vciricodmed_1=globals.vCodigoMedico
			vtipomed_1=globals.vtipo_ciru_ie
			vdescrimed_1=globals.vApeynomMedico
			elements.ciri_porcen_1.requestFocus()
		}
	}else{
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"DDE4E5AC-B0FF-4462-AF19-BD021D64EC27"}
 */
function onAction_busca_Ayudante1(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_1";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_2=globals.vCodigoMedico
		vtipomed_2=globals.vtipo_ciru_ie
		vdescrimed_2=globals.vApeynomMedico
		elements.ciri_porcen_2.requestFocus()
	}else{
		elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D25EB40A-B028-421A-91D5-0B38791E4F2F"}
 */
function onAction_busca_Ayudante2(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_2";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_3=globals.vCodigoMedico
		vtipomed_3=globals.vtipo_ciru_ie
		vdescrimed_3=globals.vApeynomMedico
		elements.ciri_porcen_3.requestFocus()
	}else{
		elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"31B118A7-764D-47DA-8715-F883EBC5F2BA"}
 */
function onAction_busca_Ayudante3(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Ayudante_3";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_4=globals.vCodigoMedico
		vtipomed_4=globals.vtipo_ciru_ie
		vdescrimed_4=globals.vApeynomMedico
		elements.ciri_porcen_4.requestFocus()
	}else{
		elements.ciri_codimed_4_codigo.requestFocus()
	}	
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4475EEBB-1425-4CFF-9803-5328273A5EF8"}
 */
function onAction_busca_Perfusionista(event) {
	globals.vTipoMedico=1
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Perfusionista";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_6=globals.vCodigoMedico
		vtipomed_6=globals.vtipo_ciru_ie
		vdescrimed_6=globals.vApeynomMedico
		elements.ciri_porcen_6.requestFocus()
	}else{
		elements.ciri_codimed_6_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"07E332DA-2808-4A92-B9FA-49B2862DAEF4"}
 */
function onAction_busca_Instrumentista(event) {
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Instrumentadora";
	win.setSize(850,550)
	globals.vCodigoMedico=0
	win.show(forms.frm_busqueda_personal_copy)
	if(globals.vCodigoMedico!=0){
		vciricodmed_7=globals.vCodigoMedico
		vtipomed_7=globals.vTipoIntrumentadora
		globals.vciricodmed_7=globals.vCodigoMedico
		globals.vciricodmed_7descri=globals.vApeynomMedico
		elements.ciri_porcen_7.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"4EF92DBF-529C-41D7-AE24-1FAA4AFFAE32"}
 * @AllowToRunInFind
 */
function onAction_busca_Anestesista(event) {
	globals.vCodigoMedico=0
	var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
	win.title = "Búsqueda de Código de Anestesiólogo";
	win.setSize(850,550)
	win.show(forms.frm_busqueda_medicos_personal)
	if(globals.vCodigoMedico!=0){
		vciricodmed_5=globals.vCodigoMedico
		var fs5 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
		fs5.find()
		fs5['medpercod']=globals.vCodigoMedico
		fs5.search(true)
		if(fs5.getSize()>0){
			fs5.setSelectedIndex(1)
			vtipomed_5=fs5['medpertipoie']
			vdescrimed_5=fs5['medperapeynom']
			vencontroProfe=true
			buscaAnestesista()
			if(vencontroProfe){
				elements.ciri_porcen_5.requestFocus()
			}else{
				plugins.dialogs.showWarningDialog("Error en Médico Anestesista","El profesional seleccionado no es un Anestesiólogo","Ok")
				vdescrimed_5=''
				vtipomed_5=0
				vciricodmed_5=''
				elements.ciri_codimed_5_codigo.requestFocus()
			}
		}
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"A61B8CE0-178C-42AC-A334-9424AB25465D"}
 */
function onAction_ciricodnome(event) {
	globals.vNomenclaAlfa=vciricodnome
	if(globals.vNomenclaAlfa!=''){
		vencontroNomencla=false
		BuscoNomenclador()
		if(vencontroNomencla){
			
			forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_8.requestFocus()
			
		}else{
			forms.tbc_cirugint_detalle_dtl.elements.ciri_codnome_codigo.requestFocus()
		}
	}else{
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codnome_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D8FA2573-39F0-483A-832E-AC3DEA08D11E"}
 */
function onAction_ciriporcen8(event) {
	if(vciriporcen_8>0){
		if(vciriporcen_8>100){
			forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_8.requestFocus()
		}else{
			forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_1_codigo.requestFocus()
		}
	}else{
		forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_8.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"EE4A47EE-8B91-4CBF-8D7D-E2AF5B299945"}
 */
function onAction_ciricodimed1(event) {
	//foundset.ciritipmed_1=ciricodmed1_to_tbc_medicos_personal.medpertipoie
	var largo = 0;
	globals.LegajoApeynomCiru=vciricodmed_1
	globals.vTipoMedico=1
	vencontroProfe=true
	BuscoProfesional()
	if(vencontroProfe){
		if(buscaProtocoloAbierto(globals.vCodigoMedico)){
			vdescrimed_1=vApeynomCirujano
			vtipomed_1=globals.vtipo_ciru_ie
			vciricodmed_1=globals.vCodigoMedico
			if(vciricodmed_1!=null){
				largo=vciricodmed_1.length
				if(vciricodmed_1.substr(0,largo)!=globals.vciri_legciru){
					plugins.dialogs.showWarningDialog("Error en código","Error en código de especialista. No coincide con el Cirujano","Ok")
					vdescrimed_1=''
					vtipomed_1=0
					vciricodmed_1=''
					forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_1_codigo.requestFocus()
					return
				}else{
					forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_1.requestFocus()
				}
			}else{
				vdescrimed_1=''
				vtipomed_1=0
				vciricodmed_1=''
				forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_1_codigo.requestFocus()
			}
			
		}else{
			vdescrimed_1=''
			vtipomed_1=0
			vciricodmed_1=''
			forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_1_codigo.requestFocus()
		}
	}else{
		vdescrimed_1=''
		vtipomed_1=0
		vciricodmed_1=''
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"6B0038FA-CC66-46A6-A200-3BDA38597813"}
 * @AllowToRunInFind
 */
function onAction_ciricodmed_7(event) {
	if(globals.vciricodmed_7!=0&&globals.vciricodmed_7!=null){
		var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
		var largo_codigo = utils.stringToNumber(globals.vciricodmed_7.toString().length)
		fs.find()
		fs['per_legajo']=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			globals.vciricodmed_7descri=fs['per_apelnom']
			vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
			vtipomed_7=0
			globals.vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
			forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_7.requestFocus()
		}else{
			var fs1 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
			fs1.find()
			fs1['medpercod']=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				globals.vciricodmed_7descri=fs1['medperapeynom']
				vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
				globals.vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo-1))
				vtipomed_7=fs1['medpertipoie']
				forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_7.requestFocus()
			}else{
				elements.ciri_codimed_7_codigo.requestFocus()
			}
		}
		
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"590A004F-943D-45E9-A3AE-6848F02FA34E"}
 * @AllowToRunInFind
 */
function onAction_codimed5(event) {
	//foundset.ciritipmed_5=ciricodmed5_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_5
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			vdescrimed_5=vApeynomCirujano
			vtipomed_5=globals.vtipo_ciru_ie
			vciricodmed_5=globals.vCodigoMedico
			buscaAnestesista()
			if(vencontroProfe){
				forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_5.requestFocus()
			}else{
				plugins.dialogs.showWarningDialog("Error en Médico Anestesista","El profesional ingresado no es un Anestesiólogo","Ok")
				vdescrimed_5=''
				vtipomed_5=0
				vciricodmed_5=''
				forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_5_codigo.requestFocus()
			}
		}else{
			vdescrimed_5=''
			vtipomed_5=0
			vciricodmed_5=''
			forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_5_codigo.requestFocus()
		}
	}else{
		vdescrimed_5=''
		vtipomed_5=0
		vciricodmed_5=''
		forms.tbc_cirugint_detalle_dtl.elements.btn_graba.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"40F14262-60F4-4153-A7DC-77ABC5FDA933"}
 */
function onAction_codimed6(event) {
	//foundset.ciritipmed_6=ciricodmed6_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_6
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.vCodigoMedico)){
				vdescrimed_6=vApeynomCirujano
				vtipomed_6=globals.vtipo_ciru_ie
				vciricodmed_6=globals.vCodigoMedico
				forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_6.requestFocus()
			}else{
				vdescrimed_6=''
				vtipomed_6=0
				vciricodmed_6=''
				forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_6_codigo.requestFocus()
			}
		}else{
			vdescrimed_6=''
			vtipomed_6=0
			vciricodmed_6=''
			forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_6_codigo.requestFocus()
		}
	}else{
		vdescrimed_6=''
		vtipomed_6=0
		vciricodmed_6=''
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_7_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"7726AD52-01A5-41C0-90E3-42CD91198639"}
 */
function onAction_codimed4(event) {
	//foundset.ciritipmed_4=ciricodmed4_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_4
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.vCodigoMedico)){
				vdescrimed_4=vApeynomCirujano
				vtipomed_4=globals.vtipo_ciru_ie
				vciricodmed_4=globals.vCodigoMedico
				forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_4.requestFocus()
			}else{
				vdescrimed_4=''
				vtipomed_4=0
				vciricodmed_4=0
				forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_4_codigo.requestFocus()
			}
		}else{
			vdescrimed_4=''
			vtipomed_4=0
			vciricodmed_4=0
			forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_4_codigo.requestFocus()
		}
	}else{
		vdescrimed_4=''
		vtipomed_4=0
		vciricodmed_4=''
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_6_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"E6DADA2D-AB86-4BE1-A289-89EB36B3A556"}
 */
function onAction_codimed3(event) {
	//foundset.ciritipmed_3=ciricodmed3_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_3
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.vCodigoMedico)){
				vdescrimed_3=vApeynomCirujano
				vtipomed_3=globals.vtipo_ciru_ie
				vciricodmed_3=globals.vCodigoMedico
				forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_3.requestFocus()
			}else{
				vdescrimed_3=''
				vtipomed_3=0
				vciricodmed_3=0
				forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_3_codigo.requestFocus()
			}
		}else{
			vdescrimed_3=''
			vtipomed_3=0
			vciricodmed_3=0
			forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_3_codigo.requestFocus()
		}
	}else{
		vdescrimed_3=''
		vtipomed_3=0
		vciricodmed_3=''
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_4_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"78D11568-4167-41B0-AA13-744791202780"}
 */
function onAction_codimed2(event) {
	//foundset.ciritipmed_2=ciricodmed2_to_tbc_medicos_personal.medpertipoie
	globals.LegajoApeynomCiru=vciricodmed_2
	if(globals.LegajoApeynomCiru!=''){
		globals.vTipoMedico=1
		vencontroProfe=true
		BuscoProfesional()
		if(vencontroProfe){
			if(buscaProtocoloAbierto(globals.vCodigoMedico)){
				vdescrimed_2=vApeynomCirujano
				vtipomed_2=globals.vtipo_ciru_ie
				vciricodmed_2=globals.vCodigoMedico
				forms.tbc_cirugint_detalle_dtl.elements.ciri_porcen_2.requestFocus()
			}else{
				vdescrimed_2=''
				vtipomed_2=0
				vciricodmed_2=''
				forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_2_codigo.requestFocus()
			}
		}else{
			vdescrimed_2=''
			vtipomed_2=0
			vciricodmed_2=''
			forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_2_codigo.requestFocus()
		}
	}else{
		vdescrimed_2=''
		vtipomed_2=0
		vciricodmed_2=''
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_3_codigo.requestFocus()		
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"281D0548-D677-4A5B-B91B-404B8E57661B"}
 */
function onAction_ciriporcen_2(event) {
	if(vciriporcen_2>100){
		elements.ciri_porcen_2.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"868B961D-A924-44A4-BBE8-DE6BD72B0962"}
 */
function onAction_ciriporcen_3(event) {
	if(vciriporcen_3>100){
		elements.ciri_porcen_3.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_4_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"A78DF974-E6CB-4EB5-8679-0EA98CC06610"}
 */
function onAction_ciriporcen_4(event) {
	if(vciriporcen_4>100){
		elements.ciri_porcen_4.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_6_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"AE5B0615-E5B8-48DB-B63C-138D08148992"}
 */
function onAction_ciriporcen_6(event) {
	if(vciriporcen_6>100){
		elements.ciri_porcen_6.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_7_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"A4B9ED5F-29EE-4A70-BBCC-4A2F09792134"}
 */
function onAction_ciriporcen_7(event) {
	if(vciriporcen_7>100){
		elements.ciri_porcen_7.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_5_codigo.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"D46909F8-CFCA-40C7-B7C1-B565CB437DDA"}
 */
function onAction_ciriporcen_5(event) {
	if(vciriporcen_5>100){
		elements.ciri_porcen_5.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl.elements.btn_graba.requestFocus()
	}
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"3EEC759C-8A16-4362-8F27-B674F1EC1A5C"}
 */
function onAction_ayuda_tbc_cirugint_dtl(event) {
	globals.textoAyuda='AYUDA-14'
	var win = application.createWindow("p",JSWindow.MODAL_DIALOG)
	win.title = "Ayuda en Ingreso de Código de Cirugía según Nomenclador";
	win.setLocation(810,300)
	win.setSize(500,350)
	win.show(forms.frm_ayuda_gral_Z)
}

/**
 * Perform the element default action.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"21E81500-1E8D-4D3C-9FB3-F4E57946006C"}
 */
function onAction_ciri_porcen_1(event) {
	if(vciriporcen_1>100){
		elements.ciri_porcen_1.requestFocus()
	}else{
		forms.tbc_cirugint_detalle_dtl.elements.ciri_codimed_2_codigo.requestFocus()
	}
}

/**
 * Callback method for when form is shown.
 *
 * @param {Boolean} firstShow form is shown first time after load
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"59576662-F306-446C-8D50-799AC67337AC"}
 */
function onShow_tbc_cirugint_detalle_dtl(firstShow, event) {
	/*
	vciricodmed_1=''
	vciricodmed_2=''
	vciricodmed_3=''
	vciricodmed_4=''
	vciricodmed_5=''
	vciricodmed_6=''
	vdescrimed_1=''
	vdescrimed_2=''
	vdescrimed_3=''
	vdescrimed_4=''
	vdescrimed_5=''
	vdescrimed_6=''
	vdescrimed_7=''
	vciriporcen_1=0
	vciriporcen_2=0
	vciriporcen_3=0
	vciriporcen_4=0
	vciriporcen_5=0
	vciriporcen_6=0
	vciriporcen_7=0
	vciriporcen_8=0
	vciricodnome=''
	vApeynomCirujano=''
	vtipomed_1=0
	vtipomed_2=0
	vtipomed_3=0
	vtipomed_4=0
	vtipomed_5=0
	vtipomed_6=0
	vtipomed_7=0
	vdescrinome=''
	globals.vciricodmed_7=0
	globals.vciricodmed_7descri=''
	*/
	globals.vTipoNome=1
	vciritipnome=1
	elements.ciri_codnome_codigo.requestFocus()
	
	//forms.tbc_cirugint_detalle_dtl.foundset.newRecord()
	//globals.InicializarDatos('tbc_cirugint_detalle_dtl','asistencial','tbc_cirugint_dtl')
}

/**
 * @properties={typeid:24,uuid:"43101F56-D37C-4F4B-83AD-94AF086DF70C"}
 * @AllowToRunInFind
 */
function BuscoProfesional() {
	var largo = globals.LegajoApeynomCiru.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero == true; i++){
		if (globals.LegajoApeynomCiru.charCodeAt(i)< 48 || globals.LegajoApeynomCiru.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_medicos_personal')
		if(fs.find()){
			fs['medpercod']=utils.stringToNumber(globals.LegajoApeynomCiru.substr(0,largo-1))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				vApeynomCirujano=fs['medperapeynom']
				globals.vtipo_ciru_ie=fs['medpertipoie']
				globals.vCodigoMedico=fs['medpercod']
				globals.LegajoApeynomCiru=''
				vencontroProfe=true
			}else{
				vApeynomCirujano='Profesional Inexistente'
				globals.vCodigoMedico=0
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
    }else{
        globals.vProfeAlfa = globals.LegajoApeynomCiru.toLocaleUpperCase()
 	    var win = application.createWindow("c",JSWindow.MODAL_DIALOG)
		win.title = "Búsqueda de Código de Cirujano";
		win.setSize(850,550)
		win.show(forms.frm_busqueda_medicos_personal_cpy)
		vApeynomCirujano=globals.vApeynomMedico
		globals.LegajoApeynomCiru=''
		vencontroProfe=true	
    }
}

/**
 * @properties={typeid:24,uuid:"3E3AB402-4649-4505-BC73-BDBD33068FD5"}
 * @AllowToRunInFind
 */
function BuscoNomenclador() {
	var largo = globals.vNomenclaAlfa.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero; i++){
		if (globals.vNomenclaAlfa.charCodeAt(i)< 48 || globals.vNomenclaAlfa.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_nomencla')
		if(fs.find()){
			fs['nome_tipo']=vciritipnome
			fs['nome_codigo']=utils.stringToNumber(globals.vNomenclaAlfa.substr(0,largo))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				if(fs['nome_pantalla']==1||fs['nome_pantalla']==3||fs['nome_pantalla']==7){
					vdescrinome=fs['nome_descr']
					globals.vNomencla=fs['nome_codigo']
					vciricodnome=globals.vNomencla
					vencontroNomencla=true
				}else{
					vdescrinome='Código Nomenclador no pertenece a Cirugía'
					globals.vNomenclaAlfa=''
					vciricodnome=''	
					vencontroNomencla=false
				}
				
			}else{
				vdescrinome='Código Nomenclador Inexistente'
				globals.vNomenclaAlfa=''
				vciricodnome=''	
				vencontroNomencla=false
			}
		}
    }else{
    	globals.vNomencla=0
        globals.vNomenclaAlfa = globals.vNomenclaAlfa.toLocaleUpperCase()
 	    var win = application.createWindow("f",JSWindow.MODAL_DIALOG)
 	    win.title = "Búsqueda de Código de Nomenclador";
 	    win.setSize(600,500)
 	    win.show(forms.frm_busqueda_nomenclador)
		if(globals.vNomencla>0){
			vciricodnome=globals.vNomencla
			vdescrinome=globals.vNomenclaAlfa
			vencontroNomencla=true
		}else{
			vencontroNomencla=false
		}
    }
}

/**
 * @returns {Boolean} successfull or not
 *
 * @properties={typeid:24,uuid:"34C5CEAE-8010-45EE-92F5-41F834EADDAB"}
 * @AllowToRunInFind
 */
function BuscoCirugintDtl() {
	var fs = databaseManager.getFoundSet('asistencial','tbc_cirugint_dtl')
	if(fs.find()){
		fs['cirihistcl']=globals.vHiscli
		fs['cirifechacarga']=globals.vFechaCarga
		fs['cirihoracarga']=globals.vHoraCarga
		fs['ciricodnome']=utils.stringToNumber(vciricodnome)
		fs['ciritiponome']=vciritipnome
		fs.search()
		if(fs.getSize()>0){
			return true
		}else{
			return false
		}
	}else{
		return false
	}
}

/**
 * @properties={typeid:24,uuid:"62F5C4E5-9AFE-48E7-92D7-FE48F7D76737"}
 * @AllowToRunInFind
 */
function buscaAnestesista() {
	if(globals.vtipo_ciru_ie==0){
		var fs = databaseManager.getFoundSet('maestros','tbc_personal')
		if(fs.find()){
			fs['per_legajo']=globals.vCodigoMedico
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				if(fs['per_espemed']==24){
					globals.LegajoApeynomCiru=fs['per_apellnom']
					vencontroProfe=true
				}else{
					globals.LegajoApeynomCiru=''
					vencontroProfe=false
				}
			}else{
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
	}else{
		var fs1 = databaseManager.getFoundSet('maestros','tbc_medicos')
		if(fs1.find()){
			fs1['med_codigo']=globals.vCodigoMedico
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				if(fs1['med_espemed']==24){
					globals.LegajoApeynomCiru=fs1['med_apenom']
					vencontroProfe=true
				}else{
					globals.LegajoApeynomCiru=''
					vencontroProfe=false
				}
			}else{
				globals.LegajoApeynomCiru=''
				vencontroProfe=false
			}
		}
	}
}

/**
 * @properties={typeid:24,uuid:"2027970A-E51E-4872-BCCE-ED514B095EDF"}
 */
function buscaProtocoloAbierto(codigo) {
	var fecha_actual=application.getServerTimeStamp();
	var anio = fecha_actual.getFullYear();
	var mes = fecha_actual.getMonth();
	var dia = fecha_actual.getDate();
	var mes_ed='';
	var dia_ed='';
	if(mes<10){
		mes_ed='0'+mes
	}else{
		mes_ed=mes
	}
	var protocolo_abierto='';
	var kant_protocolos_abiertos=0;
	var fecha_selec=anio+''+mes_ed+''+'01'
	var sql = "select ciriprotocolo, cirilegciru from tbc_cirugint where CiriFechaCarga>="+fecha_selec+" and CiriEstado=0 and CiriTipoNome=0"
	var dataset = databaseManager.getDataSetByQuery("asistencial",sql,null,-1)
	var kanti = dataset.getMaxRowIndex()
	if(kanti>0){
		for(var i=1;i<=kanti;i++){
			if(dataset.getValue(i,1)!=globals.vNroProtocolo){
				var sql2 = "select ciricodmed_1, ciricodmed_2, ciricodmed_3, ciricodmed_4, ciricodmed_5, ciricodmed_6, ciricodmed_7, ciricodmed_8, ciricodmed_9, ciricodmed_10 from tbc_cirugint_dtl where CiriProtocolo="+dataset.getValue(i,1)+" and CiriTipoNome<>0"
				var dataset2 = databaseManager.getDataSetByQuery("asistencial",sql2,null,-1)
				var kanti2 = dataset2.getMaxRowIndex()
				if(kanti2>0){
					for(var j=1;j<=kanti2;j++){
						for(var k=1;k<=10;k++){
							if(codigo==dataset2.getValue(j,k)){
								kant_protocolos_abiertos++
								protocolo_abierto+=dataset.getValue(i,1)
							}
						}
					}
				}
			}	
		}
		if(kant_protocolos_abiertos>0){
			plugins.dialogs.showWarningDialog("Protocolo sin Cerrar","El Profesional con código "+codigo+" tiene el protocolo "+protocolo_abierto+" sin cerrar","Ok")
			return false
		}else{
			return true
		}
	}else{
		return true
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"C9F58A47-1FD2-4DF1-93D6-0197518DAF96"}
 */
function onFocusLost_codimed(event) {
	if(!buscaProtocoloAbierto(vciricodmed_1)){
		elements.ciri_codimed_1_codigo.requestFocus()
	}
}

/**
 * TODO generated, please specify type and doc for the params
 * @param codigo
 * @param codimed
 *
 * @properties={typeid:24,uuid:"F37A44D8-A763-4A95-AF6D-4562B2088214"}
 */
function lost_codimed(codigo,codimed){
	if(buscaProtocoloAbierto(codigo)){
		return true
	}else{
		elements['ciri_codimed_'+codimed+'_codigo'].requestFocus()
		return false
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"99C235FC-2BF3-4207-BD5E-542EBA589780"}
 */
function onFocusLost_ciricodmed2(event) {
	onAction_codimed2(event)
	//if(!buscaProtocoloAbierto(vciricodmed_2)){
		//elements.ciri_codimed_2_codigo.requestFocus()
	//}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"2456DC2A-A387-437B-8342-761E285AB989"}
 */
function onFocusLost_ciricodmed3(event) {
	if(!buscaProtocoloAbierto(vciricodmed_3)){
		elements.ciri_codimed_3_codigo.requestFocus()
	}
}

/**
 * Handle focus lost event of the element.
 *
 * @param {JSEvent} event the event that triggered the action
 *
 * @properties={typeid:24,uuid:"62B14EBA-ACB1-41C8-AAD5-76C5586B11D0"}
 */
function onFocusLost_ciricodmed4(event) {
	if(!buscaProtocoloAbierto(vciricodmed_4)){
		elements.ciri_codimed_4_codigo.requestFocus()
	}
}

/**
 * @properties={typeid:24,uuid:"F73BD304-1DEE-4DA7-A303-C58EB332B9AD"}
 * @AllowToRunInFind
 */
function validoProfesional(codigo) {
	var fs = databaseManager.getFoundSet('maestros','tbc_medicos_personal')
	//var largo = codigo.length
	if(fs.find()){
		fs['medpercod']=utils.stringToNumber(codigo)
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			if(buscaProtocoloAbierto(fs['medpercod'])){
				return true
			}else{
				return false
			}
		}else{
				return false
		}
	}else{
		return false
	}
}

/**
 * @AllowToRunInFind
 *
 * @properties={typeid:24,uuid:"E484B36C-1559-41F9-8139-697DFFB39F23"}
 */
function BuscaNomencla() {
	var largo = globals.vNomenclaAlfa.length;
	var esnumero = true;
	for (var i= 0;i<largo && esnumero; i++){
		if (globals.vNomenclaAlfa.charCodeAt(i)< 48 || globals.vNomenclaAlfa.charCodeAt(i) > 57){
			esnumero = false
		}
	}
	
    if (esnumero){
    	var fs = databaseManager.getFoundSet('maestros','tbc_nomencla')
		if(fs.find()){
			fs['nome_tipo']=vciritipnome
			fs['nome_codigo']=utils.stringToNumber(globals.vNomenclaAlfa.substr(0,largo))
			fs.search()
			if(fs.getSize()>0){
				fs.setSelectedIndex(1)
				if(fs['nome_pantalla']==1||fs['nome_pantalla']==3||fs['nome_pantalla']==7){
					vdescrinome=fs['nome_descr']
					globals.vNomencla=fs['nome_codigo']
					vciricodnome=globals.vNomencla
					return true
				}else{
					vdescrinome='Código Nomenclador no pertenece a Cirugía'
					globals.vNomenclaAlfa=''
					vciricodnome=''	
					return false
				}
			}else{
				vdescrinome='Código Nomenclador Inexistente'
				globals.vNomenclaAlfa=''
				vciricodnome=''	
				return false
			}
		}else{
			return false
		}
    }else{
    	return false
    }
}


/**
 * @properties={typeid:24,uuid:"B668D157-B2A4-41C0-B101-375B6C0B8273"}
 * @AllowToRunInFind
 */
function buscoInstrumentadora() {
	if(globals.vciricodmed_7!=0&&globals.vciricodmed_7!=null){
		var fs = databaseManager.getFoundSet("validalegajo","tbc_personal_login")
		var largo_codigo = utils.stringToNumber(globals.vciricodmed_7.toString().length)
		fs.find()
		fs['per_legajo']=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo))
		fs.search()
		if(fs.getSize()>0){
			fs.setSelectedIndex(1)
			globals.vciricodmed_7descri=fs['per_apelnom']
			vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo))
			return true
		}else{
			var fs1 = databaseManager.getFoundSet("maestros","tbc_medicos_personal")
			fs1.find()
			fs1['medpercod']=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo))
			fs1.search()
			if(fs1.getSize()>0){
				fs1.setSelectedIndex(1)
				globals.vciricodmed_7descri=fs1['medperapeynom']
				vciricodmed_7=utils.stringToNumber(globals.vciricodmed_7.toString().substr(0,largo_codigo))
				vtipomed_7=fs1['medpertipoie']
				return true
			}else{
				return false
			}
		}
		
	}else{
		return false
	}
}
